<?xml version="1.0" encoding="WINDOWS-1252" ?>
<report name="FAO0087R" DTDVersion="9.0.2.0.10"
 beforeParameterFormTrigger="beforepform"
 afterParameterFormTrigger="afterpform" beforeReportTrigger="beforereport"
 unitOfMeasurement="centimeter">
  <xmlSettings xmlTag="FAO0087R" xmlPrologType="text">
  <![CDATA[<?xml version="1.0" encoding="&Encoding"?>]]>
  </xmlSettings>
  <comment>
  <![CDATA[TAG_REPOSID:500894]]>
  </comment>
  <reportHtmlEscapes>
    <beforeReportHtmlEscape>
    <![CDATA[<html>
<body bgcolor="#ffffff">
]]>
    </beforeReportHtmlEscape>
    <beforePageHtmlEscape>
    <![CDATA[#NULL#]]>
    </beforePageHtmlEscape>
    <afterPageHtmlEscape>
    <![CDATA[<hr size=5 noshade>
]]>
    </afterPageHtmlEscape>
    <beforeFormHtmlEscape>
    <![CDATA[<html>
<body bgcolor="#ffffff">
<form method=post>
<center>
<p><hr>
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td><input type=submit>
<td width=15>
<td><input type=reset>
</table>
<p><hr><p>]]>
    </beforeFormHtmlEscape>
    <pageNavigationHtmlEscape>
    <![CDATA[<HTML>
<TITLE>Oracle HTML Navigator</TITLE>
<HEAD>
<SCRIPT LANGUAGE = "JavaScript">

var jump_index = 1			// Jump to this page
var num_pages = &TotalPages			// Total number of pages
var basefilename = "&file_name"		// Base file name
var fileext = "&file_ext"		//File extension

/* jumps to "new_page" */
function new_page(form, new_page)
{
	form.reqpage.value = new_page;
	parent.frames[0].location = basefilename + "_" + new_page + "."+fileext;
}

/* go back one page */
function back(form)
{
	/* if we are not in first page */
	if (jump_index > 1)
	{
		jump_index--;
		new_page(form, jump_index);
	}
}

/* go forward one page */
function forward(form)
{
	/* if we are not in last page */
	if (jump_index < num_pages)
	{
		jump_index++;
		new_page(form, jump_index);
	}
}

/* go to first page */
function first(form)
{
	if(jump_index != 1)
	{
		jump_index = 1;
		new_page(form, jump_index);
	}
}

/* go to last page */
function last(form)
{
	if(jump_index != num_pages)
	{
		jump_index = num_pages;
		new_page(form, jump_index);
	}
}

/* go to the user specified page number */
function pagenum(form)
{
	/* sanity check */
	if (form.reqpage.value < 1)
	{
		form.reqpage.value = 1;
	}
	if (form.reqpage.value > num_pages)
	{
		form.reqpage.value = num_pages;
	}
	jump_index = form.reqpage.value;
	new_page(form, jump_index);
}
</SCRIPT>
</HEAD>

<BODY>
<FORM NAME="ThisForm" onSubmit="pagenum(this); return false;">
<center><table><tr>
<td> <INPUT TYPE="button"  VALUE="<< " onClick="first(this.form)">
<td> <INPUT TYPE="button"  VALUE=" < " onClick="back(this.form)">
<td> <INPUT TYPE="button"  VALUE="Page:" onClick="pagenum(this.form)">
<td> <INPUT NAME="reqpage" VALUE="1" SIZE=2>
<td> <INPUT TYPE="button"  VALUE=" > " onClick="forward(this.form)">
<td> <INPUT TYPE="button"  VALUE=" >>" onClick="last(this.form)">
</table></center>
</FORM></BODY>
</HTML>
]]>
    </pageNavigationHtmlEscape>
  </reportHtmlEscapes>
  <data>
    <userParameter name="P_OBA_ID" datatype="character" precision="10"
     initialValue="88354" label="P Oba Id" defaultWidth="100000"
     defaultHeight="10000">
      <comment>
      <![CDATA[TAG_REPOSID:683451]]>
      </comment>
    </userParameter>
    <userParameter name="P_ID" datatype="character" width="40"
     initialValue="110591" defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_ATENDER_ENTREGAS" datatype="character" width="1"
     precision="10" initialValue="N" defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_OBS" datatype="character" width="200"
     precision="10" defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_DATA" datatype="character" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_SES_ID" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_SES_ID_EXT" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_TIRAGEM" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_SES_ID_SUBC_ENCAD" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_ACUM_ACA_SUBC" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_ANO_GERA_CUS" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_VPF_ID" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_SES_ID_CUS_PE" datatype="number" precision="10"
     defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_VAL_TOT_BG_RES_DET_CUS" datatype="number"
     precision="10" initialValue="0" defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_CUSTOS_ADICIONAIS" datatype="character"
     precision="10" initialValue="N" defaultWidth="0" defaultHeight="0"/>
    <userParameter name="P_USER" datatype="character" width="100"
     precision="10" defaultWidth="0" defaultHeight="0"/>
    <systemParameter name="DECIMAL" initialValue=","/>
    <dataSource name="Q_Master_cabecalho">
      <select>
      <![CDATA[	   /* Master - Cabeçalho */
 
SELECT     oba.id oba_id,
	   oba.chave_principal chave_principal,
	   oba.titulo_completo titulo,
	   --DECODE (oba.numero_codigo,NULL,' ',SUBSTR(oba.numero_codigo,1,5)||'.'||SUBSTR(oba.numero_codigo,6,2))  numero_codigo,
                    UC$SGP_PLAN_OPER.OBTE_OBA_NUME_CODI_MASC_02 (oba.numero_codigo,oba.add_on) numero_codigo,
	   ene_autor.nome_abreviado autor,
	   oba.numero_folhas numero_folhas,
	   oba.numero_folhas*16 numero_paginas,
	   oba.tiragem tiragem,
                   OBA.TIRAGEM_TOTAL tiragem_total,
	   oba.tiragem_edicao tiragem_edicao,
	   oba.cores_texto  nr_cores_texto,
	   oba.cores_capa nr_cores_capa,
	   ene_cliente.nome_abreviado cliente,
	   ene_editor.nome_abreviado editor,
	   ene_coord_ed.nome_abreviado coord_editorial
FROM         BGO_OBRAS oba,
	   BGO_ENTIDADES ene_autor,
	   BGO_ENTIDADES ene_cliente,
	   BGO_ENTIDADES ene_editor,
	   BGO_ENTIDADES ene_coord_ed
WHERE      oba.id = :P_oba_id
AND	   ene_autor.id(+) = oba.ene_id_criada_por
AND	   ene_cliente.id(+) = oba.ene_id_dest
AND	   ene_editor.id(+) = oba.ene_id_editada
AND	   ene_coord_ed.id(+) = oba.ene_id_coord_ce  ]]>
      </select>
      <displayInfo x="0.66229" y="0.08527" width="5.63935" height="0.50788"/>
      <group name="G_Master_Cabecalho">
        <displayInfo x="0.58198" y="2.10127" width="5.82104" height="10.64369"
        />
        <dataItem name="tiragem_total" oracleDatatype="number"
         columnOrder="57" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Tiragem Total">
          <dataDescriptor expression="OBA.TIRAGEM_TOTAL"
           descriptiveExpression="TIRAGEM_TOTAL" order="9"
           oracleDatatype="number" width="22" precision="7"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="nr_cores_texto" datatype="vchar2" columnOrder="58"
         width="50" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Nr Cores Texto">
          <dataDescriptor expression="oba.cores_texto"
           descriptiveExpression="NR_CORES_TEXTO" order="11" width="50"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="oba_id" oracleDatatype="number" columnOrder="12"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Oba Id">
          <dataDescriptor expression="oba.id" descriptiveExpression="OBA_ID"
           order="1" oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="chave_principal" oracleDatatype="number"
         columnOrder="13" width="22" defaultWidth="100000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Chave Principal">
          <dataDescriptor expression="oba.chave_principal"
           descriptiveExpression="CHAVE_PRINCIPAL" order="2"
           oracleDatatype="number" width="22" precision="8"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="titulo" datatype="vchar2" columnOrder="14" width="100"
         defaultWidth="100000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Titulo">
          <dataDescriptor expression="oba.titulo_completo"
           descriptiveExpression="TITULO" order="3" width="100"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="numero_codigo" datatype="vchar2" columnOrder="15"
         width="4000" defaultWidth="80000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Numero Codigo">
          <dataDescriptor
           expression="UC$SGP_PLAN_OPER.OBTE_OBA_NUME_CODI_MASC_02 ( oba.numero_codigo , oba.add_on )"
           descriptiveExpression="NUMERO_CODIGO" order="4" width="4000"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="autor" datatype="vchar2" columnOrder="16" width="30"
         defaultWidth="100000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Autor:">
          <dataDescriptor expression="ene_autor.nome_abreviado"
           descriptiveExpression="AUTOR" order="5" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="numero_folhas" oracleDatatype="number"
         columnOrder="17" width="22" defaultWidth="80000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Nº Folhas:">
          <dataDescriptor expression="oba.numero_folhas"
           descriptiveExpression="NUMERO_FOLHAS" order="6"
           oracleDatatype="number" width="22" scale="3" precision="6"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="numero_paginas" oracleDatatype="number"
         columnOrder="18" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Nº Páginas:">
          <dataDescriptor expression="oba.numero_folhas * 16"
           descriptiveExpression="NUMERO_PAGINAS" order="7"
           oracleDatatype="number" width="22" precision="38"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="tiragem" oracleDatatype="number" columnOrder="19"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Tiragem:">
          <dataDescriptor expression="oba.tiragem"
           descriptiveExpression="TIRAGEM" order="8" oracleDatatype="number"
           width="22" precision="7"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="tiragem_edicao" oracleDatatype="number"
         columnOrder="20" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Tiragem Edição:">
          <dataDescriptor expression="oba.tiragem_edicao"
           descriptiveExpression="TIRAGEM_EDICAO" order="10"
           oracleDatatype="number" width="22" precision="7"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="nr_cores_capa" datatype="vchar2" columnOrder="21"
         width="50" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Nº Cores Capa:">
          <dataDescriptor expression="oba.cores_capa"
           descriptiveExpression="NR_CORES_CAPA" order="12" width="50"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="cliente" datatype="vchar2" columnOrder="22" width="30"
         defaultWidth="100000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Cliente:">
          <dataDescriptor expression="ene_cliente.nome_abreviado"
           descriptiveExpression="CLIENTE" order="13" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="editor" datatype="vchar2" columnOrder="23" width="30"
         defaultWidth="100000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Editor:">
          <dataDescriptor expression="ene_editor.nome_abreviado"
           descriptiveExpression="EDITOR" order="14" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="coord_editorial" datatype="vchar2" columnOrder="24"
         width="30" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Coordenador Editorial:">
          <dataDescriptor expression="ene_coord_ed.nome_abreviado"
           descriptiveExpression="COORD_EDITORIAL" order="15" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <formula name="CF_AUTOR_NOME_LITE" source="cf_autor_nome_liteformula"
         datatype="character" width="200" precision="10" defaultWidth="0"
         defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <summary name="CS_total" source="CS_subtotal" function="sum"
         width="14" precision="12" reset="G_Master_Cabecalho" compute="report"
         defaultWidth="120000" defaultHeight="10000" columnFlags="8"
         defaultLabel="TOTAL">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_total_eur" source="CS_subtotal_eur" function="sum"
         width="20" precision="10" reset="report" compute="report"
         defaultWidth="120000" defaultHeight="10000" columnFlags="8"
         defaultLabel="Cs Total Eur">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_total_cons" source="CF_total_linha" function="sum"
         width="20" precision="10" reset="report" compute="report"
         defaultWidth="120000" defaultHeight="10000" columnFlags="8"
         defaultLabel="Cs Total Cons" valueIfNull="0">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_DESIG_ENT" source="cf_desig_entformula"
         datatype="character" width="500" precision="10" defaultWidth="100000"
         defaultHeight="10000" columnFlags="16" defaultLabel="Cf Desig Ent"
         breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <summary name="CS_CF_ASSO" source="CP_CUST_FIX" function="maximum"
         width="4" precision="2" reset="G_Master_Cabecalho" compute="report"
         defaultWidth="40000" defaultHeight="10000" columnFlags="8"
         defaultLabel="Cs Cf Asso" valueIfNull="0">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_CF_ASSO_OUTR" source="CP_CUST_FIX_OUTR"
         function="maximum" width="4" precision="2" reset="G_Master_Cabecalho"
         compute="report" defaultWidth="40000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Cf Asso Outr" valueIfNull="0">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_TITULO" source="cf_tituloformula"
         datatype="character" width="500" precision="10" defaultWidth="100000"
         defaultHeight="10000" columnFlags="16" defaultLabel="Cf Titulo"
         breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
      </group>
    </dataSource>
    <dataSource name="Q_Detail">
      <select>
      <![CDATA[SELECT      afg.oba_id oba_id_Detail,
                    afg.oba_id_prov oba_id_prov,
                   afg.gfo_id gfo_id_Detail,  
                   afg.descricao descricao_Detail,
                   afg.tipo_movimento_aux tipo_mov_aux,
                   DECODE(tipo_movimento_aux,'4A',substr(afg.descricao,instr(afg.descricao,'-')+2),afg.order_by) order_by_detail,
                   afg.order_by_num order_by_num,
                   SUM(afg.quantidade) quantidade,
                    afg.unidade unidade,
                   SUM(afg.tempo) tempo,
       SUM(afg.valor) Valor_Detail,
       SUM(afg.valor_eur) Valor_eur_Detail,
                   NULL dummy
FROM         BGO_ANALISE_FACTURACAO_GF_V afg
WHERE          EXISTS (SELECT 1
             FROM      BGO_RESUMO_ARTIGOS_GF_TEMP tmp
          WHERE  tmp.Id = :P_Id
                                  AND    tmp.gfo_id = afg.gfo_id)
and             (nvl(:p_custos_adicionais,'N') != 'S' or afg.tipo_movimento_aux  != '7B'  )    -- JGS20160506
GROUP BY
       afg.oba_id,
       afg.oba_id_prov,
       afg.gfo_id,  
       afg.descricao,
       afg.tipo_movimento_aux,
       afg.order_by,
       afg.order_by_num,
       afg.unidade/*,
       afg.tempo*/
-- jgs20141030 
union all
SELECT  arf.oba_id oba_id_Detail,
        arf.oba_id_prov oba_id_prov,
        arf.n1 gfo_id_Detail , 
        arf.descricao descricao_Detail,
        arf.tipo_mov_aux tipo_mov_aux,
        arf.order_by order_by_detail,
        arf.order_by_num order_by_num,
        sum(arf.quantidade) quantidade,
        arf.unidade unidade,
        sum(arf.tempo) tempo,
        sum(arf.valor) Valor_Detail,
        sum(arf.valor_eur) Valor_eur_Detail,
        null dummy
FROM    bgo_auxi_repo_fatu arf
where   arf.seq_id = :p_ses_id
and       tip_reg      = 'BG'
and       c1 is null
group   by 
        arf.oba_id,
        arf.oba_id_prov,
        arf.descricao,
        arf.tipo_mov_aux,
        arf.order_by,
        arf.order_by_num,
        arf.unidade, --,
        null,
       arf.n1
-- fim jgs20141030 ----------------------------------
UNION    -- Ivo Oliveira 24/05/2006    Valores Indicativos
----------------------------------
SELECT val_ind.oba_id_ref oba_id_detail,
       to_number(null) oba_id_prov,
       val_ind.gfo_id gfo_id_detail,  
       Nvl(too.descricao_output,'Acabamento') descricao_detail,
       '7C' tipo_mov_aux,
       null order_by_detail,
       to_number(null) order_by_num,
       to_number(Null) Quantidade,
       Null Unidade,
       to_number(Null) Tempo,
       to_number(null) valor_detail,
       Sum(val_ind.val) valor_eur_detail,
       NULL dummy
FROM   bgo_valo_fact_indi val_ind
,            bgo_indices_geracao_custos igc
,            bgo_obras oba
,            bgo_tipos_acabamento too
WHERE  EXISTS (SELECT 1
                  FROM      BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.id = :p_id
               AND    tmp.gfo_id = val_ind.gfo_id)
AND    val_ind.tip_mov = 'B'
and     igc.id=val_ind.igc_id
and     igc.estado='A'
and     oba.id=val_ind.oba_id_ref
and     oba.too_id=too.id(+)
and     nvl(:p_custos_adicionais,'N') != 'S' 
GROUP BY
    val_ind.oba_id_ref,
    val_ind.gfo_id,
    Nvl(too.descricao_output,'Acabamento') 
ORDER BY order_by_detail                               ]]>
      </select>
      <displayInfo x="14.49338" y="0.27037" width="3.88813" height="1.21853"/>
      <group name="G_Detail">
        <displayInfo x="14.24161" y="1.66688" width="4.38206" height="5.00063"
        />
        <dataItem name="tipo_mov_aux" datatype="vchar2" columnOrder="39"
         width="40" defaultWidth="20000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Tipo Mov Aux">
          <dataDescriptor expression="afg.tipo_movimento_aux"
           descriptiveExpression="TIPO_MOV_AUX" order="5" width="40"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="oba_id_Detail" oracleDatatype="number"
         columnOrder="25" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="0" defaultLabel="Oba Id S"
         breakOrder="none">
          <dataDescriptor expression="afg.oba_id"
           descriptiveExpression="OBA_ID_DETAIL" order="1"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="oba_id_prov" oracleDatatype="number" columnOrder="131"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="0"
         defaultLabel="Oba Id Prov" breakOrder="none">
          <dataDescriptor expression="afg.oba_id_prov"
           descriptiveExpression="OBA_ID_PROV" order="2"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="gfo_id_Detail" oracleDatatype="number"
         columnOrder="42" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="0" defaultLabel="Gfo Id"
         breakOrder="none">
          <dataDescriptor expression="afg.gfo_id"
           descriptiveExpression="GFO_ID_DETAIL" order="3"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_subtotal" source="CS_Valor_Detail" function="sum"
         width="14" precision="12" reset="G_Detail" compute="report"
         defaultWidth="120000" defaultHeight="10000" columnFlags="8"
         defaultLabel="SUB-TOTAL">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_subtotal_eur" source="CS_Valor_Eur_Detail"
         function="sum" width="20" precision="10" reset="G_Detail"
         compute="report" defaultWidth="120000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Subtotal Eur">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_DETALHE" source="cf_detalheformula"
         datatype="number" width="20" precision="10" defaultWidth="120000"
         defaultHeight="10000" columnFlags="16" defaultLabel="Cf Detalhe"
         breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <placeholder name="CP_VALOR_1" datatype="number" width="20"
         precision="10" defaultWidth="120000" defaultHeight="10000"
         columnFlags="16" defaultLabel="Cp Valor 1">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </placeholder>
        <placeholder name="CP_VALOR_2" datatype="number" width="20"
         precision="10" defaultWidth="120000" defaultHeight="10000"
         columnFlags="16" defaultLabel="Cp Valor 2">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </placeholder>
        <summary name="CS_SUBCONTRATACAO" source="CF_SUBCONTRATACAO"
         function="sum" width="16" precision="14" scale="5" reset="G_oba_id1"
         compute="report" defaultWidth="90000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Subcontratacao">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      <filter type="plsql" plsqlFilter="g_detailgroupfilter"
       numberOfRecords="0"/>
      </group>
      <group name="G_descricao_Detail">
        <displayInfo x="14.18890" y="6.71029" width="4.46577" height="5.86879"
        />
        <dataItem name="order_by_num" oracleDatatype="number"
         columnOrder="141" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Order By Num">
          <dataDescriptor expression="afg.order_by_num"
           descriptiveExpression="ORDER_BY_NUM" order="7"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="order_by_detail" datatype="vchar2" columnOrder="34"
         width="4000" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Order By Detail">
          <dataDescriptor
           expression="DECODE ( tipo_movimento_aux , &apos;4A&apos; , substr ( afg.descricao , instr ( afg.descricao , &apos;-&apos; ) + 2 ) , afg.order_by )"
           descriptiveExpression="ORDER_BY_DETAIL" order="6" width="4000"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="descricao_Detail" datatype="vchar2" columnOrder="26"
         width="4000" defaultWidth="100000" defaultHeight="10000"
         columnFlags="33" defaultLabel="Descricao">
          <dataDescriptor expression="afg.descricao"
           descriptiveExpression="DESCRICAO_DETAIL" order="4" width="4000"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_Valor_Detail" source="Valor_Detail" function="sum"
         width="14" precision="12" reset="G_descricao_Detail" compute="report"
         defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_Valor_Eur_Detail" source="Valor_eur_Detail"
         function="sum" width="20" precision="10" reset="G_descricao_Detail"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_quantidade" source="quantidade" function="sum"
         width="20" precision="10" reset="G_descricao_Detail" compute="report"
         defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_tempo" source="tempo" function="sum" width="20"
         precision="10" reset="G_descricao_Detail" compute="report"
         defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <dataItem name="unidade" datatype="vchar2" columnOrder="56" width="40"
         defaultWidth="20000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Unidade">
          <dataDescriptor expression="afg.unidade"
           descriptiveExpression="UNIDADE" order="9" width="40"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <formula name="CF_SUBCONTRATACAO" source="cf_subcontratacaoformula"
         datatype="number" width="16" precision="14" scale="5"
         defaultWidth="0" defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <formula name="CF_DESCRI" source="cf_descriformula"
         datatype="character" width="80" precision="10" defaultWidth="0"
         defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <placeholder name="CP_CUST_FIX" datatype="number" width="4"
         precision="2" defaultWidth="0" defaultHeight="0" columnFlags="16"
         valueIfNull="0">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </placeholder>
        <placeholder name="preco_venda" datatype="number" width="20"
         precision="10" defaultWidth="0" defaultHeight="0" columnFlags="16">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </placeholder>
      </group>
      <group name="G_Valor_eur_Detail">
        <displayInfo x="14.13650" y="12.82588" width="4.63321"
         height="2.39613"/>
        <dataItem name="quantidade" oracleDatatype="number" columnOrder="52"
         width="22" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Quantidade">
          <dataDescriptor expression="SUM ( afg.quantidade )"
           descriptiveExpression="QUANTIDADE" order="8"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="tempo" oracleDatatype="number" columnOrder="53"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Tempo">
          <dataDescriptor expression="SUM ( afg.tempo )"
           descriptiveExpression="TEMPO" order="10" oracleDatatype="number"
           width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="Valor_Detail" oracleDatatype="number" columnOrder="27"
         width="22" defaultWidth="90000" defaultHeight="10000"
         columnFlags="33" defaultLabel="Valor">
          <dataDescriptor expression="SUM ( afg.valor )"
           descriptiveExpression="VALOR_DETAIL" order="11"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="Valor_eur_Detail" oracleDatatype="number"
         columnOrder="28" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Valor Eur S">
          <dataDescriptor expression="SUM ( afg.valor_eur )"
           descriptiveExpression="VALOR_EUR_DETAIL" order="12"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
      <group name="G_dummy">
        <displayInfo x="14.16317" y="15.38542" width="4.54949"
         height="1.52797"/>
        <dataItem name="dummy" datatype="vchar2" columnOrder="40" width="0"
         defaultWidth="10000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Dummy">
          <dataDescriptor expression="NULL" descriptiveExpression="DUMMY"
           order="13"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
    </dataSource>
    <dataSource name="Q_Consumiveis">
      <select>
      <![CDATA[SELECT     vfo.oba_id_referente oba_id_consumiveis,
                   vfo.oba_id_proveniente oba_id_prov_cons,
	   vfo.gfo_id gfo_id_consumiveis,
	   aro.codigo || ' - ' || aro.descricao aro_consumido,
   	   une.codigo  une_consumiveis,
	   DECODE (ene.nome_abreviado, pmo.valor_bg , aro.preco_venda, aro.preco_venda_outros) preco_unit_consumiveis,
	   DECODE (ene.nome_abreviado, pmo.valor_bg , aro.preco_venda_EUR, aro.preco_venda_outros_EUR) preco_unit__EUR_consumiveis,
	   sum(vfo.quantidade) qtd_consumiveis
FROM         BGO_OBRAS oba,
	   BGO_VALORES_FACTURACAO vfo,
	   BGO_INDICES_GERACAO_CUSTOS igc,
	   BGO_ARTIGOS aro,
	   BGO_UNIDADES une,
	   BGO_ENTIDADES ene,
	   BGO_PARAMETROS pmo
WHERE     EXISTS (SELECT 1
	   	  FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		  WHERE  tmp.Id = :P_Id
                                  AND          tmp.gfo_id = :gfo_id
                                  AND          tmp.gfo_id = vfo.gfo_id)
AND            vfo.oba_id_referente = oba.id
AND	   oba.id = :P_Oba_Id
AND	   vfo.tipo_movimento = 'G'
AND	   igc.id = vfo.igc_id
AND	   igc.estado = 'A'
AND	   ene.id(+) = oba.ene_id_dest
AND	   aro.id = vfo.aro_id	   
AND           aro.empresa = 'P'
AND	   une.id = aro.une_id
AND	   pmo.descricao = 'entidade_porto_editora'
group by     vfo.oba_id_referente ,vfo.oba_id_proveniente,
	   vfo.gfo_id ,
	   aro.codigo || ' - ' || aro.descricao ,
   	   une.codigo,
	   DECODE (ene.nome_abreviado, pmo.valor_bg , aro.preco_venda, aro.preco_venda_outros),
	   DECODE (ene.nome_abreviado, pmo.valor_bg , aro.preco_venda_EUR, aro.preco_venda_outros_EUR)
order by qtd_consumiveis desc,substr(aro.codigo || ' - ' || aro.descricao,10)]]>
      </select>
      <displayInfo x="18.99605" y="17.24422" width="3.70396" height="1.21853"
      />
      <group name="G_Consumiveis">
        <displayInfo x="18.41066" y="19.20658" width="4.95071"
         height="5.43471"/>
        <dataItem name="oba_id_prov_cons" oracleDatatype="number"
         columnOrder="152" width="22" defaultWidth="110000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Oba Id Prov Cons">
          <dataDescriptor expression="vfo.oba_id_proveniente"
           descriptiveExpression="OBA_ID_PROV_CONS" order="2"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="preco_unit_EUR_consumiveis" oracleDatatype="number"
         columnOrder="63" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1"
         defaultLabel="Preco Unit Eur Consumiveis">
          <dataDescriptor
           expression="DECODE ( ene.nome_abreviado , pmo.valor_bg , aro.preco_venda_EUR , aro.preco_venda_outros_EUR )"
           descriptiveExpression="PRECO_UNIT__EUR_CONSUMIVEIS" order="7"
           oracleDatatype="number" width="22" precision="38"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="aro_consumido" datatype="vchar2" columnOrder="30"
         width="44" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Aro Consumido">
          <dataDescriptor
           expression="aro.codigo || &apos; - &apos; || aro.descricao"
           descriptiveExpression="ARO_CONSUMIDO" order="4" width="44"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="gfo_id_consumiveis" oracleDatatype="number"
         columnOrder="61" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1"
         defaultLabel="Gfo Id Consumiveis">
          <dataDescriptor expression="vfo.gfo_id"
           descriptiveExpression="GFO_ID_CONSUMIVEIS" order="3"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="oba_id_consumiveis" oracleDatatype="number"
         columnOrder="29" width="22" defaultWidth="110000"
         defaultHeight="10000" columnFlags="1"
         defaultLabel="Oba Id Consumiveis">
          <dataDescriptor expression="vfo.oba_id_referente"
           descriptiveExpression="OBA_ID_CONSUMIVEIS" order="1"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="qtd_consumiveis" oracleDatatype="number"
         columnOrder="33" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Qtd Consumiveis">
          <dataDescriptor expression="sum ( vfo.quantidade )"
           descriptiveExpression="QTD_CONSUMIVEIS" order="8"
           oracleDatatype="number" width="22" precision="38"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="une_consumiveis" datatype="vchar2" columnOrder="32"
         width="2" defaultWidth="50000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Une Consumiveis">
          <dataDescriptor expression="une.codigo"
           descriptiveExpression="UNE_CONSUMIVEIS" order="5" width="2"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="preco_unit_consumiveis" oracleDatatype="number"
         columnOrder="31" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1"
         defaultLabel="Preco Unit Consumiveis">
          <dataDescriptor
           expression="DECODE ( ene.nome_abreviado , pmo.valor_bg , aro.preco_venda , aro.preco_venda_outros )"
           descriptiveExpression="PRECO_UNIT_CONSUMIVEIS" order="6"
           oracleDatatype="number" width="22" precision="38"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <formula name="CF_total_linha" source="cf_total_linhaformula"
         datatype="number" width="14" precision="12" defaultWidth="120000"
         defaultHeight="10000" columnFlags="16" defaultLabel="Cf Total Linha"
         valueIfNull="0" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <formula name="estrago" source="estragoformula" datatype="character"
         width="200" precision="10" defaultWidth="100000"
         defaultHeight="10000" columnFlags="16" defaultLabel="Estrago"
         breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <formula name="linha_mostrar" source="linha_mostrarformula"
         datatype="character" width="1000" precision="10"
         defaultWidth="100000" defaultHeight="10000" columnFlags="16"
         defaultLabel="Linha Mostrar" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
      </group>
    </dataSource>
    <dataSource name="Q_1">
      <select>
      <![CDATA[SELECT	   distinct tmp.oba_id oba_id,
                               tmp.gfo_id gfo_id,
 		tmp.GFO_CODIGO || ' ' ||
                                tmp.GFO_descricao desc_GF,
                               /* decode(gfo.numero_folhas, 0, '', null, '', '(' || to_char(gfo.numero_folhas) || ' fls)') num_folhas*/
                                 gfo.numero_folhas num_folhas             
		 --Confirmado com Jorge Rafael só é para aparecer a Descrição do Grupo de facturação
FROM    bgo_grupos_facturacao  gfo,
          BGO_RESUMO_ARTIGOS_GF_TEMP tmp/*,
		BGO_VALORES_FACTURACAO vfa*/
WHERE                  gfo.id = tmp.gfo_id and
                                 tmp.Id = :P_Id	
/*AND		vfa.gfo_id = tmp.gfo_id*/   
 --Confirmado com Jorge Rafael que são para aparecer todos os Grupos de Facturação que o utilizador escolher na emissão do report
order by tmp.GFO_CODIGO || ' ' || tmp.GFO_descricao]]>
      </select>
      <displayInfo x="9.47198" y="8.41406" width="1.77788" height="0.83778"/>
      <group name="G_oba_id1">
        <displayInfo x="8.28104" y="9.36625" width="4.20688" height="7.60512"
        />
        <dataItem name="num_folhas" oracleDatatype="number" columnOrder="65"
         width="22" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Numero Folhas1">
          <dataDescriptor expression="gfo.numero_folhas"
           descriptiveExpression="NUM_FOLHAS" order="4"
           oracleDatatype="number" width="22" scale="3" precision="6"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <formula name="estragos_obs1" source="estragos_obs1formula"
         datatype="character" width="5000" precision="10" defaultWidth="0"
         defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <dataItem name="desc_GF" datatype="vchar2" columnOrder="47"
         width="103" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Desc Gf">
          <dataDescriptor
           expression="tmp.GFO_CODIGO || &apos; &apos; || tmp.GFO_descricao"
           descriptiveExpression="DESC_GF" order="3" width="103"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="oba_id2" oracleDatatype="number" columnOrder="45"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="0" defaultLabel="Oba Id1" breakOrder="none">
          <dataDescriptor expression="tmp.oba_id"
           descriptiveExpression="OBA_ID" order="1" oracleDatatype="number"
           width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="gfo_id" oracleDatatype="number" columnOrder="46"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="0" defaultLabel="Gfo Id" breakOrder="none">
          <dataDescriptor expression="tmp.gfo_id"
           descriptiveExpression="GFO_ID" order="2" oracleDatatype="number"
           width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_total_aro_cons" source="CF_total_linha"
         function="sum" width="14" precision="12" reset="G_oba_id1"
         compute="report" defaultWidth="120000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Total Aro Cons" valueIfNull="0">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_NUM_FOLHAS" source="cf_num_folhasformula"
         datatype="character" width="20" precision="10" defaultWidth="100000"
         defaultHeight="10000" columnFlags="16" defaultLabel="Cf Num Folhas"
         breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <summary name="CS_VALOR_1" source="CP_VALOR_1" function="maximum"
         width="20" precision="10" reset="G_oba_id1" compute="report"
         defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_VALOR_2" source="CP_VALOR_2" function="maximum"
         width="20" precision="10" reset="G_oba_id1" compute="report"
         defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_ROUND" source="cf_roundformula" datatype="number"
         width="20" precision="10" defaultWidth="0" defaultHeight="0"
         columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <summary name="CS1_VALOR_2" source="CP1_VALOR_2" function="maximum"
         width="20" precision="10" reset="G_oba_id1" compute="report"
         defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_TOTAL_SUB" source="CS_SUO_VAL" function="sum"
         width="16" precision="14" scale="5" reset="G_oba_id1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_total_sub_outr" source="CS_SUO_VAL_OUTR"
         function="sum" width="16" precision="14" scale="5" reset="G_oba_id1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_obs_gfo" source="cf_obs_gfoformula"
         datatype="character" width="2000" precision="10" defaultWidth="0"
         defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <summary name="CS_TOTAL_SUB_PE" source="CS_SUO_VAL_PE" function="sum"
         width="16" precision="14" scale="5" reset="G_oba_id1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_TOT_SUB_OUTR" source="valor_sub" function="sum"
         width="16" precision="14" scale="5" reset="G_oba_id1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_Existe_Sub" source="cf_existe_subformula"
         datatype="character" width="20" precision="10" defaultWidth="0"
         defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <formula name="CF_Existe_Sub_Outr" source="cf_existe_sub_outrformula"
         datatype="character" width="20" precision="10" defaultWidth="0"
         defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
      </group>
    </dataSource>
    <dataSource name="Q_Requisicao">
      <select>
      <![CDATA[SELECT      oba.id oba_id_req,
	   roa.codigo||'; ' nr_requisicao
FROM         BGO_OBRAS oba,
	   BGO_OBRAS_REQUISICOES_PEL_BG org,
	   BGO_REQUISICOES_ABERTURA roa
WHERE     oba.id = org.oba_id
AND	   roa.id = org.roa_id]]>
      </select>
      <displayInfo x="8.78396" y="0.13240" width="2.98958" height="0.83778"/>
      <group name="G_Requisicao">
        <displayInfo x="8.58273" y="1.91027" width="3.39855" height="1.52797"
        />
        <dataItem name="oba_id_req" oracleDatatype="number" columnOrder="48"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Oba Id Req">
          <dataDescriptor expression="oba.id"
           descriptiveExpression="OBA_ID_REQ" order="1" width="22"
           precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="nr_requisicao" datatype="vchar2" columnOrder="49"
         width="14" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Nr Requisicao">
          <dataDescriptor expression="roa.codigo || &apos;; &apos;"
           descriptiveExpression="NR_REQUISICAO" order="2" width="14"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
    </dataSource>
    <dataSource name="Q_Data_Entrega">
      <select>
      <![CDATA[SELECT lga.oba_id_facturacao oba_id_prim_entrega,
	   MIN (cga.data_emissao) prim_entrega
FROM   BGO_LINHAS_GUIAS_ENTREGA lga,
	   BGO_CABECALHOS_GUIAS cga
WHERE  cga.id = lga.cga_id
and    nvl(cga.estado,'X')!='N' 
and    nvl(lga.tipo_entrega_obras,'X') in ('P','N') 
GROUP BY lga.oba_id_facturacao
]]>
      </select>
      <displayInfo x="8.75698" y="4.97427" width="3.67792" height="0.83778"/>
      <group name="G__Data_Entrega">
        <displayInfo x="8.43700" y="6.67277" width="4.32439" height="1.52797"
        />
        <dataItem name="oba_id_prim_entrega" oracleDatatype="number"
         columnOrder="50" width="22" defaultWidth="110000"
         defaultHeight="10000" columnFlags="1"
         defaultLabel="Oba Id Prim Entrega">
          <dataDescriptor expression="lga.oba_id_facturacao"
           descriptiveExpression="OBA_ID_PRIM_ENTREGA" order="1"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="prim_entrega" datatype="date" oracleDatatype="date"
         columnOrder="51" width="9" defaultWidth="90000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Prim Entrega">
          <dataDescriptor expression="MIN ( cga.data_emissao )"
           descriptiveExpression="PRIM_ENTREGA" order="2"
           oracleDatatype="date" width="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
    </dataSource>
    <dataSource name="Q_2">
      <select>
      <![CDATA[SELECT      ang.oba_id oba_id_Detail,
                    ang.oba_id_prov oba_id_prov,
                   ang.gfo_id gfo_id_Detail,  
                   ang.descricao descricao_Detail,
                   ang.tipo_movimento_aux tipo_mov_aux,
                   ang.order_by order_by_detail,
                   ang.order_by_num order_by_num,
                   SUM(ang.quantidade) quantidade,
                    ang.unidade unidade,
                   SUM(ang.tempo) tempo,
       SUM(ang.valor) Valor_Detail,
       SUM(ang.valor_eur) Valor_eur_Detail,
                   SUM(ang.valor_sub) valor_sub,
                   NULL dummy
FROM         BGO_ANALISE_NAO_FACT_GF_V ang
WHERE          EXISTS (SELECT 1
             FROM      BGO_RESUMO_ARTIGOS_GF_TEMP tmp
          WHERE  tmp.Id = :P_Id
                                  AND    tmp.gfo_id = ang.gfo_id)
GROUP BY
       ang.oba_id,
       ang.oba_id_prov,
       ang.gfo_id,  
       ang.descricao,
       ang.tipo_movimento_aux,
       ang.order_by,
       ang.order_by_num,
       ang.unidade/*,
       ang.tempo*/
-- jgs20141031 
union all
SELECT  arf.oba_id oba_id_Detail1,
        arf.oba_id_prov oba_id_prov2,
        ARF.N1 gfo_id_Detail,
        arf.descricao descricao_Detail1,
        arf.tipo_mov_aux tipo_mov_aux1,
        arf.order_by order_by_detail1,
        arf.order_by_num order_by_num2,
        sum(arf.quantidade) quantidade1,
        arf.unidade unidade1,
        sum(arf.tempo) tempo1,
        sum(arf.valor) Valor_Detail1,
        sum(arf.valor_eur) Valor_eur_Detail1,
        0 valor_sub,
        null dummy1
FROM    bgo_auxi_repo_fatu arf
where   arf.seq_id = :p_ses_id
and     tip_reg      = 'EDI'
and     c1 is null
group   by 
        arf.oba_id,
        arf.oba_id_prov,
        arf.descricao,
        arf.tipo_mov_aux,
        arf.order_by,
        arf.order_by_num,
        arf.unidade, --,
        ARF.N1,
        null
-- fim jgs20141031 ORDER BY ang.order_by  
-- jgs20150318          
union all
SELECT  arf.oba_id oba_id_Detail1,
        arf.oba_id_prov oba_id_prov2,
        ARF.N1 gfo_id_Detail,
        arf.descricao descricao_Detail1,
        arf.tipo_mov_aux tipo_mov_aux1,
        arf.order_by order_by_detail1,
        arf.order_by_num order_by_num2,
        sum(arf.quantidade) quantidade1,
        arf.unidade unidade1,
        sum(arf.tempo) tempo1,
        sum(arf.valor) Valor_Detail1,
        sum(arf.valor_eur) Valor_eur_Detail1,
        0 valor_sub,
        null dummy1
FROM    bgo_auxi_repo_fatu arf
where   arf.seq_id = :P_SES_ID_CUS_PE
and     tip_reg      = 'CUS_PE'
and     c1= 'TOTAL'
group   by 
        arf.oba_id,
        arf.oba_id_prov,
        arf.descricao,
        arf.tipo_mov_aux,
        arf.order_by,
        arf.order_by_num,
        arf.unidade, --,
        ARF.N1,
        null
-- fim jgs20150318]]>
      </select>
      <displayInfo x="19.92313" y="0.55563" width="1.77788" height="1.21853"/>
      <group name="G_oba_id_Detail1">
        <displayInfo x="18.84846" y="1.83121" width="3.92751" height="4.56654"
        />
        <dataItem name="tipo_mov_aux1" datatype="vchar2" columnOrder="77"
         width="40" defaultWidth="20000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Tipo Mov Aux1">
          <dataDescriptor expression="ang.tipo_movimento_aux"
           descriptiveExpression="TIPO_MOV_AUX" order="5" width="40"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="oba_id_Detail1" oracleDatatype="number"
         columnOrder="74" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="0" defaultLabel="Oba Id Detail1"
         breakOrder="none">
          <dataDescriptor expression="ang.oba_id"
           descriptiveExpression="OBA_ID_DETAIL" order="1"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="oba_id_prov2" oracleDatatype="number"
         columnOrder="132" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="0" defaultLabel="Oba Id Prov1"
         breakOrder="none">
          <dataDescriptor expression="ang.oba_id_prov"
           descriptiveExpression="OBA_ID_PROV" order="2"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="gfo_id_Detail1" oracleDatatype="number"
         columnOrder="75" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="0" defaultLabel="Gfo Id Detail1"
         breakOrder="none">
          <dataDescriptor expression="ang.gfo_id"
           descriptiveExpression="GFO_ID_DETAIL" order="3"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_subtotal1" source="CS_Valor_Detail1" function="sum"
         width="14" precision="12" reset="G_oba_id_Detail1" compute="report"
         defaultWidth="90000" defaultHeight="10000" columnFlags="8"
         defaultLabel="Cs Subtotal1">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_subtotal_eur1" source="CS_Valor_Eur_Detail1"
         function="sum" width="14" precision="12" reset="G_oba_id_Detail1"
         compute="report" defaultWidth="90000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Subtotal Eur1">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_DETALHE1" source="cf_detalhe1formula"
         datatype="number" width="20" precision="10" defaultWidth="120000"
         defaultHeight="10000" columnFlags="16" defaultLabel="Cf Detalhe1"
         breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <placeholder name="CP1_VALOR_2" datatype="number" width="20"
         precision="10" defaultWidth="120000" defaultHeight="10000"
         columnFlags="16" defaultLabel="Cp1 Valor 2">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </placeholder>
        <summary name="CS_SUBCONTRATACAO_OUTR" source="CS_VALOR_SUB"
         function="sum" width="16" precision="14" scale="5"
         reset="G_oba_id_Detail1" compute="report" defaultWidth="90000"
         defaultHeight="10000" columnFlags="8"
         defaultLabel="Cs Subcontratacao Outr">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      <filter type="plsql" plsqlFilter="g_oba_id_detail1groupfilter"
       numberOfRecords="0"/>
      </group>
      <group name="G_descricao_Detail1">
        <displayInfo x="18.82180" y="6.59092" width="4.01123" height="5.00063"
        />
        <dataItem name="order_by_num2" oracleDatatype="number"
         columnOrder="142" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Order By Num1">
          <dataDescriptor expression="ang.order_by_num"
           descriptiveExpression="ORDER_BY_NUM" order="7"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="order_by_detail1" datatype="vchar2" columnOrder="78"
         width="100" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Order By Detail1">
          <dataDescriptor expression="ang.order_by"
           descriptiveExpression="ORDER_BY_DETAIL" order="6" width="100"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="descricao_Detail1" datatype="vchar2" columnOrder="76"
         width="4000" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Descricao Detail1">
          <dataDescriptor expression="ang.descricao"
           descriptiveExpression="DESCRICAO_DETAIL" order="4" width="4000"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_Valor_Detail1" source="Valor_Detail1" function="sum"
         width="14" precision="12" reset="G_descricao_Detail1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_Valor_Eur_Detail1" source="Valor_eur_Detail1"
         function="sum" width="12" precision="10" reset="G_descricao_Detail1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_quantidade1" source="quantidade1" function="sum"
         width="20" precision="10" reset="G_descricao_Detail1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <summary name="CS_tempo1" source="tempo1" function="sum" width="20"
         precision="10" reset="G_descricao_Detail1" compute="report"
         defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <dataItem name="unidade1" datatype="vchar2" columnOrder="80"
         width="40" defaultWidth="10000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Unidade1">
          <dataDescriptor expression="ang.unidade"
           descriptiveExpression="UNIDADE" order="9" width="40"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_VALOR_SUB" source="valor_sub" function="sum"
         width="16" precision="14" scale="5" reset="G_descricao_Detail1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
        <formula name="CF_DESCRI_OUTR" source="cf_descri_outrformula"
         datatype="character" width="80" precision="10" defaultWidth="0"
         defaultHeight="0" columnFlags="16" breakOrder="none">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </formula>
        <placeholder name="CP_CUST_FIX_OUTR" datatype="number" width="4"
         precision="2" defaultWidth="0" defaultHeight="0" columnFlags="16"
         valueIfNull="0">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </placeholder>
      </group>
      <group name="G_Valor_eur_Detail1">
        <displayInfo x="18.87451" y="12.22220" width="4.01123"
         height="2.83021"/>
        <dataItem name="quantidade1" oracleDatatype="number" columnOrder="79"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Quantidade1">
          <dataDescriptor expression="SUM ( ang.quantidade )"
           descriptiveExpression="QUANTIDADE" order="8"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="tempo1" oracleDatatype="number" columnOrder="81"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Tempo1">
          <dataDescriptor expression="SUM ( ang.tempo )"
           descriptiveExpression="TEMPO" order="10" oracleDatatype="number"
           width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="Valor_Detail1" oracleDatatype="number"
         columnOrder="82" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Valor Detail1">
          <dataDescriptor expression="SUM ( ang.valor )"
           descriptiveExpression="VALOR_DETAIL" order="11"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="valor_sub" oracleDatatype="number" columnOrder="126"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Valor Sub">
          <dataDescriptor expression="SUM ( ang.valor_sub )"
           descriptiveExpression="VALOR_SUB" order="13"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="Valor_eur_Detail1" oracleDatatype="number"
         columnOrder="83" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1"
         defaultLabel="Valor Eur Detail1">
          <dataDescriptor expression="SUM ( ang.valor_eur )"
           descriptiveExpression="VALOR_EUR_DETAIL" order="12"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
      <group name="G_dummy1">
        <displayInfo x="18.90086" y="15.35596" width="4.01123"
         height="1.52797"/>
        <dataItem name="dummy1" datatype="vchar2" columnOrder="84" width="0"
         defaultWidth="10000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Dummy1">
          <dataDescriptor expression="NULL" descriptiveExpression="DUMMY"
           order="14"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
    </dataSource>
    <dataSource name="Q_3">
      <select>
      <![CDATA[SELECT ODA.OBA_ID OBA_ID_SUO,
       PRE.GFO_ID,
       opo.des_orc  DESCRICAO,   --   OPO.DESCRICAO,
       ENE.NOME_ABREVIADO,
      decode(opo.sinal_operacao,'-',-1,1)*SUO.PRE_VEN SUO_VALOR,  /* JGS20150121 decode(opo.sinal_operacao,'-',-1,1)*SUO.VALOR_EUR SUO_VALOR, */
       null order_by,
       cco.ord order_by_num
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_CENTROS_CUSTOS CCO,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_CLASSES_CENTROS_CUSTOS CCC,
       BGO_OPERACOES OPO
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    ODA.ONO_ID=ONO.ID
AND    CCC.ID=CCO.CCC_ID
AND    ODA.OBA_ID=:OBA_ID
AND    ONO.CCO_ID=CCO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    ODA.IGC_ID IN (SELECT DISTINCT 
                             IGC.ID
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_REFERENTE=ODA.OBA_ID
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      AND    ODA.IGC_ID=IGC.ID
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID)
AND    CONSIDERAR='S'
AND    ODA.PRE_ID=PRE.ID
union all
SELECT aoa.OBA_ID_receptora OBA_ID_SUO,
       PRE.GFO_ID,
       opo.des_orc   descricao,  ---OPO.DESCRICAO descricao,
       ENE.NOME_ABREVIADO,
       decode(opo.sinal_operacao,'-',-1,1)*(SUO.VALOR_EUR*AOA.PERCENTAGEM_CUSTOS/100) SUO_VALOR,
       oba.titulo_abreviado order_by,
       to_number(null) order_by_num
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_ASSOCIACOES_OBRAS AOA,
       BGO_OBRAS OBA,
       BGO_ASSOCIACOES_PARTES APE,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_OPERACOES OPO
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    ODA.ONO_ID=ONO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
AND    OBA.ID=AOA.OBA_ID_ASSOCIADA
AND    AOA.OBA_ID_RECEPTORA=:OBA_ID -- IVO OLIVEIRA 25/07/2003
AND    APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
AND    PRE.ID=APE.PRE_ID_RECEPTORA
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    APE.PRE_ID_RECEPTORA IN (SELECT ID 
                                FROM   BGO_PARTES 
                                WHERE  OBA_ID=AOA.OBA_ID_RECEPTORA)
AND    AOA.ID=(SELECT MAX(ID)
               FROM   BGO_ASSOCIACOES_OBRAS
               WHERE  OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
               AND    OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
AND    ODA.IGC_ID IN (SELECT DISTINCT 
                             IGC_id_proveniente
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      and    vfo.oba_id_referente=aoa.oba_id_receptora
                      AND    vfo.tipo_movimento != 'G' 
                      AND    vfo.oba_id_referente <> vfo.oba_id_proveniente
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID
                      AND    ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE)
AND    CONSIDERAR='S'
union all   -- jgs20141118, entidade de acabamento externas
SELECT to_number( :P_OBA_ID)  OBA_ID_SUO,
      :gfo_id,
       DESCRICAO,
       c1 NOME_ABREVIADO,
       valor_euR*N3 SUO_VALOR,
       to_char(null) order_by,
       98 order_by_num
from  BGO_AUXI_REPO_FATU
where seq_id = :p_ses_id_ext
and     n2       = :gfo_id
union all   -- jgs20141118, registos de subcontratação
SELECT to_number( :P_OBA_ID)  OBA_ID_SUO,
      :gfo_id,
       DESCRICAO,
       c1 NOME_ABREVIADO,
       valor_euR SUO_VALOR,
       to_char(null) order_by,
       99 order_by_num
from  BGO_AUXI_REPO_FATU
where seq_id = :p_ses_id_subc_encad
and     n2       = :gfo_id
order by 7    -- jgs290150327]]>
      </select>
      <displayInfo x="9.41896" y="17.91240" width="2.69906" height="1.21853"/>
      <group name="G_OBA_ID_SUO">
        <displayInfo x="8.21221" y="19.45215" width="4.19230" height="2.83021"
        />
        <dataItem name="order_by_num4" oracleDatatype="number"
         columnOrder="144" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Order By Num1">
          <dataDescriptor expression="cco.ord"
           descriptiveExpression="ORDER_BY_NUM" order="7"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="order_by" datatype="vchar2" columnOrder="115"
         width="30" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Order By">
          <dataDescriptor expression="null" descriptiveExpression="ORDER_BY"
           order="6" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="DESCRICAO" datatype="vchar2" columnOrder="99"
         width="4000" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Descricao">
          <dataDescriptor expression="opo.des_orc"
           descriptiveExpression="DESCRICAO" order="3" width="4000"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="OBA_ID_SUO" oracleDatatype="number" columnOrder="97"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="0" defaultLabel="Oba Id Suo" breakOrder="none">
          <dataDescriptor expression="ODA.OBA_ID"
           descriptiveExpression="OBA_ID_SUO" order="1"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="GFO_ID1" oracleDatatype="number" columnOrder="98"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="0" defaultLabel="Gfo Id1" breakOrder="none">
          <dataDescriptor expression="PRE.GFO_ID"
           descriptiveExpression="GFO_ID" order="2" oracleDatatype="number"
           width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_SUO_VAL" source="CS_SUO_VALOR" function="sum"
         width="16" precision="14" scale="5" reset="G_OBA_ID_SUO"
         compute="report" defaultWidth="90000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Suo Val">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      </group>
      <group name="G_SUO_VALOR">
        <displayInfo x="8.15950" y="22.43336" width="4.27602" height="1.52797"
        />
        <dataItem name="NOME_ABREVIADO" datatype="vchar2" columnOrder="100"
         width="4000" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Nome Abreviado">
          <dataDescriptor expression="ENE.NOME_ABREVIADO"
           descriptiveExpression="NOME_ABREVIADO" order="4" width="4000"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_SUO_VALOR" source="SUO_VALOR" function="sum"
         width="16" precision="14" scale="5" reset="G_SUO_VALOR"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      </group>
      <group name="G_2">
        <displayInfo x="8.05408" y="24.40502" width="4.35973" height="1.52797"
        />
        <dataItem name="SUO_VALOR" oracleDatatype="number" columnOrder="101"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Suo Valor">
          <dataDescriptor
           expression="decode ( opo.sinal_operacao , &apos;-&apos; , - 1 , 1 ) * SUO.PRE_VEN"
           descriptiveExpression="SUO_VALOR" order="5" oracleDatatype="number"
           width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
    </dataSource>
    <dataSource name="Q_4">
      <select>
      <![CDATA[SELECT ODA.OBA_ID OBA_ID_SUO,
       PRE.GFO_ID,
       opo.des_orc   DESCRICAO,    -- OPO.DESCRICAO,
       ENE.NOME_ABREVIADO,
       decode(opo.sinal_operacao,'-',-1,1)*SUO.VALOR_EUR SUO_VALOR,
       null order_by,
       cco.ord order_by_num
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_CENTROS_CUSTOS CCO,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_CLASSES_CENTROS_CUSTOS CCC,
       BGO_OPERACOES OPO
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    ODA.OBA_ID=:OBA_ID
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    ODA.ONO_ID=ONO.ID
AND    CCC.ID=CCO.CCC_ID
AND    ONO.CCO_ID=CCO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    ODA.IGC_ID IN (SELECT DISTINCT 
                             IGC.ID
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_REFERENTE=ODA.OBA_ID
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      AND    ODA.IGC_ID=IGC.ID
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID)
AND    CONSIDERAR<>'S' 
AND    CONSIDERAR IS NOT NULL
AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='N'
AND    ODA.PRE_ID=PRE.ID
union all
SELECT aoa.OBA_ID_receptora OBA_ID_SUO,
       PRE.GFO_ID,
       opo.des_orc  descricao,   --   OPO.DESCRICAO descricao,
       ENE.NOME_ABREVIADO,
       decode(opo.sinal_operacao,'-',-1,1)*(SUO.VALOR_EUR*AOA.PERCENTAGEM_CUSTOS/100) SUO_VALOR, 
       oba.titulo_abreviado order_by,
       to_number(null) order_by_num
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_ASSOCIACOES_OBRAS AOA,
       BGO_OBRAS OBA,
       BGO_ASSOCIACOES_PARTES APE,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_OPERACOES OPO
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    ODA.ONO_ID=ONO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
AND    OBA.ID=AOA.OBA_ID_ASSOCIADA
AND    AOA.OBA_ID_RECEPTORA=:OBA_ID
AND    APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
AND    PRE.ID=APE.PRE_ID_RECEPTORA
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    APE.PRE_ID_RECEPTORA IN (SELECT ID 
                                FROM   BGO_PARTES 
                                WHERE  OBA_ID=AOA.OBA_ID_RECEPTORA)
AND    AOA.ID=(SELECT MAX(ID)
               FROM   BGO_ASSOCIACOES_OBRAS
               WHERE  OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
               AND    OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
AND    ODA.IGC_ID IN (SELECT DISTINCT 
                             IGC_id_proveniente
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      and    vfo.oba_id_referente=aoa.oba_id_receptora
                      AND    vfo.tipo_movimento != 'G' 
                      AND    vfo.oba_id_referente <> vfo.oba_id_proveniente
                      AND    ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID)
AND    CONSIDERAR<>'S' 
AND    CONSIDERAR IS NOT NULL
AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='N'
-- jgs20150316
union all
SELECT ODA.OBA_ID OBA_ID_SUO,
       PRE.GFO_ID,
       opo.des_orc   DESCRICAO,   --   OPO.DESCRICAO,
       ENE.NOME_ABREVIADO,
       decode(opo.sinal_operacao,'-',-1,1)*SUO.VALOR_EUR SUO_VALOR,
       null order_by,
       cco.ord order_by_num
  --     CG.RV_MEANING EMP
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_CENTROS_CUSTOS CCO,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_CLASSES_CENTROS_CUSTOS CCC,
       BGO_OPERACOES OPO,
       CG_REF_CODES CG
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    CG.RV_DOMAIN='EMPRESA_SUBCONTRATACAO'
AND    CG.RV_LOW_VALUE=SUO.EMP_FAC
and      suo.emp_fac = 'P'
AND    ODA.OBA_ID=:OBA_ID
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    ODA.ONO_ID=ONO.ID
AND    CCC.ID=CCO.CCC_ID
AND    ONO.CCO_ID=CCO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    ODA.IGC_ID IN (SELECT DISTINCT
                             IGC.ID
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_REFERENTE=ODA.OBA_ID
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      AND    ODA.IGC_ID=IGC.ID
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID)
AND    CONSIDERAR='N'
AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='S'
AND    ODA.PRE_ID=PRE.ID
union all
SELECT aoa.OBA_ID_receptora OBA_ID_SUO,
       PRE.GFO_ID,
       opo.des_orc   descricao,   --   OPO.DESCRICAO descricao,
       ENE.NOME_ABREVIADO,
       decode(opo.sinal_operacao,'-',-1,1)*(SUO.VALOR_EUR*AOA.PERCENTAGEM_CUSTOS/100) SUO_VALOR,
       oba.titulo_abreviado order_by,
       to_number(null) order_by_num
   --    CG.RV_MEANING EMP
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_ASSOCIACOES_OBRAS AOA,
       BGO_OBRAS OBA,
       BGO_ASSOCIACOES_PARTES APE,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_OPERACOES OPO,
       CG_REF_CODES CG
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    CG.RV_DOMAIN='EMPRESA_SUBCONTRATACAO'
AND    CG.RV_LOW_VALUE=SUO.EMP_FAC
and      suo.emp_fac = 'P'
AND    ODA.ONO_ID=ONO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
AND    OBA.ID=AOA.OBA_ID_ASSOCIADA
AND    AOA.OBA_ID_RECEPTORA=:OBA_ID
AND    APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
AND    PRE.ID=APE.PRE_ID_RECEPTORA
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    APE.PRE_ID_RECEPTORA IN (SELECT ID 
                                FROM   BGO_PARTES 
                                WHERE  OBA_ID=AOA.OBA_ID_RECEPTORA)
AND    AOA.ID=(SELECT MAX(ID)
               FROM   BGO_ASSOCIACOES_OBRAS
               WHERE  OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
               AND    OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
AND    ODA.IGC_ID IN (SELECT DISTINCT 
                             IGC_id_proveniente
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      and    vfo.oba_id_referente=aoa.oba_id_receptora
                      AND    vfo.tipo_movimento != 'G' 
                      AND    vfo.oba_id_referente <> vfo.oba_id_proveniente
                      AND    ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID)
AND    CONSIDERAR='N'
AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='S'
-- fim jgs20150316
order by 7  -- jgs20150327]]>
      </select>
      <displayInfo x="2.83115" y="16.13948" width="2.69875" height="1.21853"/>
      <group name="G_OBA_ID_SUO1">
        <displayInfo x="1.54471" y="17.91736" width="4.35105" height="2.83021"
        />
        <dataItem name="order_by_num3" oracleDatatype="number"
         columnOrder="143" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Order By Num1">
          <dataDescriptor expression="cco.ord"
           descriptiveExpression="ORDER_BY_NUM" order="7"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="order_by2" datatype="vchar2" columnOrder="116"
         width="30" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Order By1">
          <dataDescriptor expression="null" descriptiveExpression="ORDER_BY"
           order="6" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="DESCRICAO1" datatype="vchar2" columnOrder="106"
         width="40" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Descricao1">
          <dataDescriptor expression="opo.des_orc"
           descriptiveExpression="DESCRICAO" order="3" width="40"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="GFO_ID3" oracleDatatype="number" columnOrder="109"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="0" defaultLabel="Gfo Id2" breakOrder="none">
          <dataDescriptor expression="PRE.GFO_ID"
           descriptiveExpression="GFO_ID" order="2" oracleDatatype="number"
           width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="OBA_ID_SUO1" oracleDatatype="number" columnOrder="105"
         width="22" defaultWidth="110000" defaultHeight="10000"
         columnFlags="0" defaultLabel="Oba Id Suo1" breakOrder="none">
          <dataDescriptor expression="ODA.OBA_ID"
           descriptiveExpression="OBA_ID_SUO" order="1"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_SUO_VAL_OUTR" source="CS_SUO_VALOR1" function="sum"
         width="16" precision="14" scale="5" reset="G_OBA_ID_SUO1"
         compute="report" defaultWidth="90000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Suo Val Outr">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      </group>
      <group name="G_SUO_VALOR1">
        <displayInfo x="1.59773" y="21.36552" width="4.43477" height="1.52797"
        />
        <dataItem name="NOME_ABREVIADO1" datatype="vchar2" columnOrder="107"
         width="30" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Nome Abreviado1">
          <dataDescriptor expression="ENE.NOME_ABREVIADO"
           descriptiveExpression="NOME_ABREVIADO" order="4" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_SUO_VALOR1" source="SUO_VALOR1" function="sum"
         width="16" precision="14" scale="5" reset="G_SUO_VALOR1"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      </group>
      <group name="G_1">
        <displayInfo x="1.62409" y="23.38989" width="4.51848" height="1.52797"
        />
        <dataItem name="SUO_VALOR1" oracleDatatype="number" columnOrder="108"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Suo Valor1">
          <dataDescriptor
           expression="decode ( opo.sinal_operacao , &apos;-&apos; , - 1 , 1 ) * SUO.VALOR_EUR"
           descriptiveExpression="SUO_VALOR" order="5" oracleDatatype="number"
           width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
    </dataSource>
    <dataSource name="Q_5">
      <select>
      <![CDATA[SELECT ODA.OBA_ID OBA_ID_SUO,
       PRE.GFO_ID,
       OPO.DESCRICAO,
       ENE.NOME_ABREVIADO,
       decode(opo.sinal_operacao,'-',-1,1)*SUO.VALOR_EUR SUO_VALOR,
       null order_by,
       cco.ord order_by_num,
       CG.RV_MEANING EMP
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_CENTROS_CUSTOS CCO,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_CLASSES_CENTROS_CUSTOS CCC,
       BGO_OPERACOES OPO,
       CG_REF_CODES CG
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    CG.RV_DOMAIN='EMPRESA_SUBCONTRATACAO'
AND    CG.RV_LOW_VALUE=SUO.EMP_FAC
AND    ODA.OBA_ID=:OBA_ID
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    ODA.ONO_ID=ONO.ID
AND    CCC.ID=CCO.CCC_ID
AND    ONO.CCO_ID=CCO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    ODA.IGC_ID IN (SELECT DISTINCT
                             IGC.ID
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_REFERENTE=ODA.OBA_ID
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      AND    ODA.IGC_ID=IGC.ID
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID)
AND    CONSIDERAR='N'
AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='S'
AND    ODA.PRE_ID=PRE.ID
-- JGS20150313
AND    ODA.ID NOT IN (SELECT ODA_ID FROM BGO_AUXI_REPO_FATU WHERE SEQ_ID = :P_SES_ID_CUS_PE AND ODA_ID IS NOT NULL and n1 = :GFO_ID)
-- FIM JGS20150313
union all
SELECT aoa.OBA_ID_receptora OBA_ID_SUO,
       PRE.GFO_ID,
       OPO.DESCRICAO descricao,
       ENE.NOME_ABREVIADO,
       decode(opo.sinal_operacao,'-',-1,1)*(SUO.VALOR_EUR*AOA.PERCENTAGEM_CUSTOS/100) SUO_VALOR,
       oba.titulo_abreviado order_by,
       to_number(null) order_by_num,
       CG.RV_MEANING EMP
FROM   BGO_SUBCONTRATACOES SUO,
       BGO_OPERACOES_PROCESSADAS ODA,
       BGO_OPERACOES_ANUAIS ONO,
       BGO_ASSOCIACOES_OBRAS AOA,
       BGO_OBRAS OBA,
       BGO_ASSOCIACOES_PARTES APE,
       BGO_ENTIDADES ENE,
       BGO_PARTES PRE,
       BGO_OPERACOES OPO,
       CG_REF_CODES CG
WHERE  SUO.ODA_ID=ODA.ID
AND    ONO.OPO_ID=OPO.ID
AND    CG.RV_DOMAIN='EMPRESA_SUBCONTRATACAO'
AND    CG.RV_LOW_VALUE=SUO.EMP_FAC
AND    ODA.ONO_ID=ONO.ID
AND    ENE.ID=SUO.ENE_ID_PRODUTOR
AND    AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
AND    OBA.ID=AOA.OBA_ID_ASSOCIADA
AND    AOA.OBA_ID_RECEPTORA=:OBA_ID
AND    APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
AND    PRE.ID=APE.PRE_ID_RECEPTORA
AND    EXISTS (SELECT 1
               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
               WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)
AND    APE.PRE_ID_RECEPTORA IN (SELECT ID 
                                FROM   BGO_PARTES 
                                WHERE  OBA_ID=AOA.OBA_ID_RECEPTORA)
AND    AOA.ID=(SELECT MAX(ID)
               FROM   BGO_ASSOCIACOES_OBRAS
               WHERE  OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
               AND    OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
AND    ODA.IGC_ID IN (SELECT DISTINCT 
                             IGC_id_proveniente
                      FROM   BGO_VALORES_FACTURACAO VFO,
                             BGO_INDICES_GERACAO_CUSTOS IGC
                      WHERE  VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
                      AND    VFO.IGC_ID=IGC.ID
                      AND    IGC.ESTADO='A'
                      and    vfo.oba_id_referente=aoa.oba_id_receptora
                      AND    vfo.tipo_movimento != 'G' 
                      AND    vfo.oba_id_referente <> vfo.oba_id_proveniente
                      AND    ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID)
AND    CONSIDERAR='N'
AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='S'
-- JGS20150313
AND    ODA.ID NOT IN (SELECT ODA_ID FROM BGO_AUXI_REPO_FATU WHERE SEQ_ID = :P_SES_ID_CUS_PE AND ODA_ID IS NOT NULL and n1 = :GFO_ID)
-- FIM JGS20150313]]>
      </select>
      <displayInfo x="15.29302" y="17.01292" width="1.77788" height="1.21853"
      />
      <group name="G_OBA_ID_SUO2">
        <displayInfo x="13.84784" y="18.55236" width="4.35105"
         height="2.83021"/>
        <dataItem name="EMP" datatype="vchar2" columnOrder="139" width="240"
         defaultWidth="100000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Emp">
          <dataDescriptor expression="CG.RV_MEANING"
           descriptiveExpression="EMP" order="8" width="240"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="OBA_ID_SUO2" oracleDatatype="number" columnOrder="117"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="0"
         defaultLabel="Oba Id Suo2" breakOrder="none">
          <dataDescriptor expression="ODA.OBA_ID"
           descriptiveExpression="OBA_ID_SUO" order="1"
           oracleDatatype="number" width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="GFO_ID2" oracleDatatype="number" columnOrder="118"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="2"
         defaultLabel="Gfo Id2" breakOrder="none">
          <dataDescriptor expression="PRE.GFO_ID"
           descriptiveExpression="GFO_ID" order="2" oracleDatatype="number"
           width="22" precision="9"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_SUO_VAL_PE" source="CS_SUO_VAL_DESC" function="sum"
         width="16" precision="14" scale="5" reset="G_OBA_ID_SUO2"
         compute="report" defaultWidth="90000" defaultHeight="10000"
         columnFlags="8" defaultLabel="Cs Suo Val Pe">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      </group>
      <group name="G_DESCRICAO2">
        <displayInfo x="13.84784" y="21.68798" width="4.43477"
         height="1.96205"/>
        <dataItem name="order_by_num5" oracleDatatype="number"
         columnOrder="145" width="22" defaultWidth="90000"
         defaultHeight="10000" columnFlags="1" defaultLabel="Order By Num1">
          <dataDescriptor expression="cco.ord"
           descriptiveExpression="ORDER_BY_NUM" order="7"
           oracleDatatype="number" width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="order_by1" datatype="vchar2" columnOrder="122"
         width="30" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Order By1">
          <dataDescriptor expression="null" descriptiveExpression="ORDER_BY"
           order="6" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <dataItem name="DESCRICAO2" datatype="vchar2" columnOrder="119"
         width="20" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Descricao2">
          <dataDescriptor expression="OPO.DESCRICAO"
           descriptiveExpression="DESCRICAO" order="3" width="20"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_SUO_VAL_DESC" source="CS_SUO_VALOR2" function="sum"
         width="16" precision="14" scale="5" reset="G_DESCRICAO2"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      </group>
      <group name="G_SUO_VALOR2">
        <displayInfo x="13.84753" y="24.38394" width="4.43477"
         height="1.52797"/>
        <dataItem name="NOME_ABREVIADO2" datatype="vchar2" columnOrder="120"
         width="30" defaultWidth="100000" defaultHeight="10000"
         columnFlags="1" defaultLabel="Nome Abreviado2">
          <dataDescriptor expression="ENE.NOME_ABREVIADO"
           descriptiveExpression="NOME_ABREVIADO" order="4" width="30"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
        <summary name="CS_SUO_VALOR2" source="SUO_VALOR2" function="sum"
         width="16" precision="14" scale="5" reset="G_SUO_VALOR2"
         compute="report" defaultWidth="0" defaultHeight="0" columnFlags="8">
          <displayInfo x="0.00000" y="0.00000" width="0.00000"
           height="0.00000"/>
        </summary>
      </group>
      <group name="G_3">
        <displayInfo x="13.82148" y="26.21204" width="4.51848"
         height="1.52797"/>
        <dataItem name="SUO_VALOR2" oracleDatatype="number" columnOrder="121"
         width="22" defaultWidth="90000" defaultHeight="10000" columnFlags="1"
         defaultLabel="Suo Valor2">
          <dataDescriptor
           expression="decode ( opo.sinal_operacao , &apos;-&apos; , - 1 , 1 ) * SUO.VALOR_EUR"
           descriptiveExpression="SUO_VALOR" order="5" oracleDatatype="number"
           width="22" scale="-127"/>
          <dataItemPrivate adtName="" schemaName=""/>
        </dataItem>
      </group>
    </dataSource>
    <formula name="CF_LOGO" source="cf_logoformula" datatype="character"
     width="1" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="1.98438" y="13.54646" width="2.03181" height="0.50788"/>
    </formula>
    <placeholder name="global_oba_id" datatype="number" width="20"
     precision="10" defaultWidth="0" defaultHeight="0" columnFlags="16">
      <displayInfo x="1.93135" y="14.47260" width="2.03181" height="0.50788"/>
    </placeholder>
    <formula name="user" source="userformula" datatype="character" width="200"
     precision="10" defaultWidth="0" defaultHeight="0" columnFlags="16"
     breakOrder="none">
      <displayInfo x="4.60375" y="13.70552" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_obs" source="cf_obsformula" datatype="character"
     width="4000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="8.67823" y="3.75698" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_TIRAGEM" source="cf_tiragemformula" datatype="number"
     width="20" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="2.96323" y="26.80240" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_CORES" source="cf_coresformula" datatype="character"
     width="2000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="2.77813" y="28.07240" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_AUTOR" source="cf_autorformula" datatype="character"
     width="2000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="6.42938" y="26.77573" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_CHAVE" source="cf_chaveformula" datatype="character"
     width="20" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="6.24427" y="27.64885" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_G_TIT" source="cf_g_titformula" datatype="character"
     width="2000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="13.49375" y="28.49563" width="2.03181" height="0.50788"
      />
    </formula>
    <formula name="CF_NUM_COD" source="cf_num_codformula" datatype="character"
     width="2000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="9.73646" y="28.36354" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_CLIENTE" source="cf_clienteformula" datatype="character"
     width="2000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="14.36688" y="29.87135" width="2.03181" height="0.50788"
      />
    </formula>
    <formula name="CF_NUM_FOL" source="cf_num_folformula" datatype="character"
     width="2000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="5.97948" y="28.73375" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_REG_GRA" source="cf_reg_graformula" datatype="character"
     width="2000" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="10.58354" y="29.68625" width="2.03181" height="0.50788"
      />
    </formula>
    <formula name="CF_COORDENA" source="cf_coordenaformula"
     datatype="character" width="2000" precision="10" defaultWidth="0"
     defaultHeight="0" columnFlags="16" breakOrder="none">
      <displayInfo x="10.02760" y="26.61698" width="2.03181" height="0.50788"
      />
    </formula>
    <formula name="CF_EDITORES" source="cf_editoresformula"
     datatype="character" width="2000" precision="10" defaultWidth="0"
     defaultHeight="0" columnFlags="16" breakOrder="none">
      <displayInfo x="5.13302" y="30.55938" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_COORDENADORES" source="cf_coordenadoresformula"
     datatype="character" width="2000" precision="10" defaultWidth="0"
     defaultHeight="0" columnFlags="16" breakOrder="none">
      <displayInfo x="9.81615" y="31.67063" width="2.03181" height="0.50788"/>
    </formula>
    <formula name="CF_DADOS_ADIC" source="cf_dados_adicformula"
     datatype="character" width="4000" precision="10" defaultWidth="0"
     defaultHeight="0" columnFlags="16" breakOrder="none">
      <displayInfo x="18.67948" y="28.89250" width="2.03181" height="0.50788"
      />
    </formula>
    <formula name="CF_clo" source="cf_cloformula" datatype="character"
     width="200" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="17.80635" y="32.46438" width="2.03181" height="0.50788"
      />
    </formula>
    <formula name="CF_tit" source="cf_titformula" datatype="character"
     width="200" precision="10" defaultWidth="0" defaultHeight="0"
     columnFlags="16" breakOrder="none">
      <displayInfo x="14.65802" y="33.57563" width="2.03181" height="0.50788"
      />
    </formula>
    <link parentGroup="G_Master_Cabecalho" parentColumn="oba_id"
     childQuery="Q_1" childColumn="oba_id2" condition="eq" sqlClause="where"/>
    <link parentGroup="G_Master_Cabecalho" parentColumn="oba_id"
     childQuery="Q_Requisicao" childColumn="oba_id_req" condition="eq"
     sqlClause="where"/>
    <link parentGroup="G_Master_Cabecalho" parentColumn="oba_id"
     childQuery="Q_Data_Entrega" childColumn="oba_id_prim_entrega"
     condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="oba_id2" childQuery="Q_Detail"
     childColumn="oba_id_Detail" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="gfo_id" childQuery="Q_Detail"
     childColumn="gfo_id_Detail" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="oba_id2"
     childQuery="Q_Consumiveis" childColumn="oba_id_consumiveis"
     condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="gfo_id"
     childQuery="Q_Consumiveis" childColumn="gfo_id_consumiveis"
     condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="oba_id2" childQuery="Q_2"
     childColumn="oba_id_Detail1" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="gfo_id" childQuery="Q_2"
     childColumn="gfo_id_Detail1" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="oba_id2" childQuery="Q_3"
     childColumn="OBA_ID_SUO" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="gfo_id" childQuery="Q_3"
     childColumn="GFO_ID1" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="oba_id2" childQuery="Q_4"
     childColumn="OBA_ID_SUO1" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="gfo_id" childQuery="Q_4"
     childColumn="GFO_ID3" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="oba_id2" childQuery="Q_5"
     childColumn="OBA_ID_SUO2" condition="eq" sqlClause="where"/>
    <link parentGroup="G_oba_id1" parentColumn="gfo_id" childQuery="Q_5"
     childColumn="GFO_ID2" condition="eq" sqlClause="where"/>
  </data>
  <layout>
  <section name="header" width="21.59000" height="27.94000">
    <body width="19.05000" height="22.86000">
      <location x="1.27000" y="2.54000"/>
    </body>
  </section>
  <section name="trailer" width="21.59000" height="27.94000">
    <body width="19.05000" height="22.86000">
      <location x="1.27000" y="2.54000"/>
    </body>
  </section>
  <section name="main" width="20.32000" height="27.94000">
    <body width="19.12534" height="22.84574">
      <location x="0.74972" y="4.84188"/>
      <frame name="M_G_Master_Cabecalho_GRPFR">
        <geometryInfo x="0.00000" y="0.00217" width="18.70987"
         height="22.28484"/>
        <generalLayout verticalElasticity="variable"/>
        <visualSettings fillForegroundColor="white"
         lineForegroundColor="white"/>
        <repeatingFrame name="R_G_Master_Cabecalho"
         source="G_Master_Cabecalho" printDirection="down" minWidowRecords="1"
         columnMode="no">
          <geometryInfo x="0.00000" y="0.10790" width="18.70987"
           height="22.05416"/>
          <generalLayout verticalElasticity="variable"/>
          <visualSettings fillForegroundColor="white"
           lineForegroundColor="white"/>
          <frame name="M_6">
            <geometryInfo x="0.00000" y="0.27626" width="18.70987"
             height="16.55124"/>
            <advancedLayout printObjectOnPage="firstPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"/>
            <text name="B_Valor_Detail2" minWidowLines="1">
              <textSettings justify="center" spacing="0"/>
              <geometryInfo x="0.00000" y="0.61888" width="18.70987"
               height="0.55283"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillPattern="transparent"
               fillForegroundColor="white" fillBackgroundColor="gray12"
               linePattern="solid"/>
              <textSegment>
                <font face="Arial" size="10" bold="yes" italic="yes"/>
                <string>
                <![CDATA[Grupo de Facturação]]>
                </string>
              </textSegment>
            </text>
          </frame>
          <repeatingFrame name="R_2" source="G_oba_id1" printDirection="down"
           maxRecordsPerPage="1" minWidowRecords="1" columnMode="no">
            <geometryInfo x="0.00000" y="0.83189" width="18.70987"
             height="21.03469"/>
            <visualSettings fillForegroundColor="white"/>
            <rectangle name="B_17">
              <geometryInfo x="0.00000" y="1.17450" width="18.70987"
               height="0.42323"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="black" linePattern="solid"/>
              <points>
                <point x="0.00000" y="1.17450"/>
                <point x="18.70987" y="0.42323"/>
              </points>
            </rectangle>
            <field name="F_2" source="desc_GF" minWidowLines="1" spacing="0"
             alignment="start">
              <font face="Arial" size="9" bold="yes" italic="yes"/>
              <geometryInfo x="0.11906" y="1.17450" width="13.85094"
               height="0.42354"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="black"/>
            </field>
            <frame name="M_32">
              <geometryInfo x="0.00000" y="1.81105" width="18.70987"
               height="14.15510"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="gray12"/>
              <frame name="M_G_Detail_GRPFR1">
                <geometryInfo x="0.00000" y="2.10902" width="18.70987"
                 height="8.35608"/>
                <generalLayout verticalElasticity="expand"/>
                <advancedLayout printObjectOnPage="firstPage"
                 basePrintingOn="anchoringObject"/>
                <visualSettings fillForegroundColor="white"/>
                <frame name="M_G_descricao_Detail_HDR1">
                  <geometryInfo x="0.00000" y="2.10964" width="18.70987"
                   height="0.76274"/>
                  <advancedLayout printObjectOnPage="allPage"
                   basePrintingOn="enclosingObject"/>
                  <visualSettings fillPattern="transparent"
                   fillForegroundColor="white" fillBackgroundColor="gray12"
                   linePattern="solid"/>
                  <text name="B_descricao_Detail1" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="0.00000" y="2.11243" width="9.36997"
                     height="0.75995"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Descrição]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_4" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="9.36563" y="2.10964" width="1.49975"
                     height="0.76274"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12" linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Qtd.]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_Valor_Detail1" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="16.57976" y="2.48791" width="2.13010"
                     height="0.38447"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Total]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_5" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="10.86476" y="2.10964" width="1.19807"
                     height="0.76274"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12" linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Tempo]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_descricao_Detail3" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="12.06221" y="2.10964" width="6.64766"
                     height="0.37517"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12" linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Valor]]>
                      </string>
                    </textSegment>
                  </text>
                  <field name="F_Exterior1" source="BACKGROUND"
                   minWidowLines="1" spacing="0" alignment="center">
                    <font face="Arial" size="9" bold="yes" italic="yes"/>
                    <geometryInfo x="14.26487" y="2.48450" width="2.23800"
                     height="0.38788"/>
                    <advancedLayout formatTrigger="f_exterior1formattrigger"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                  </field>
                </frame>
                <repeatingFrame name="R_G_Detail1" source="G_Detail"
                 printDirection="down" minWidowRecords="1" columnMode="no">
                  <geometryInfo x="0.00000" y="2.87176" width="18.70987"
                   height="1.87585"/>
                  <generalLayout verticalElasticity="variable"/>
                  <visualSettings fillForegroundColor="white"/>
                  <frame name="M_5">
                    <geometryInfo x="0.00000" y="2.87176" width="18.70987"
                     height="1.84950"/>
                    <generalLayout verticalElasticity="variable"/>
                    <advancedLayout formatTrigger="m_5formattrigger"/>
                    <visualSettings fillForegroundColor="white"
                     linePattern="solid"/>
                    <repeatingFrame name="R_1" source="G_descricao_Detail"
                     printDirection="down" minWidowRecords="1" columnMode="no"
                      >
                      <geometryInfo x="0.00000" y="2.97253" width="18.70987"
                       height="0.37455"/>
                      <advancedLayout formatTrigger="r_1formattrigger"/>
                      <visualSettings fillForegroundColor="white"/>
                      <field name="F_Aux1" source="BACKGROUND"
                       minWidowLines="1" spacing="0" alignment="start">
                        <font face="Arial" size="8"/>
                        <geometryInfo x="0.18510" y="2.97253" width="9.13154"
                         height="0.37455"/>
                        <advancedLayout formatTrigger="f_aux1formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         fillBackgroundColor="r50g100b75"
                         lineForegroundColor="white"/>
                      </field>
                      <field name="F_Aux_valor1" source="CS_subtotal"
                       minWidowLines="1" formatMask="999 999 990L" spacing="0"
                       alignment="end">
                        <font face="Arial Narrow" size="8"/>
                        <geometryInfo x="16.52705" y="2.97253" width="2.14406"
                         height="0.37455"/>
                        <advancedLayout
                         formatTrigger="f_aux_valor1formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         fillBackgroundColor="r50g88b50"
                         lineForegroundColor="white"/>
                      </field>
                    </repeatingFrame>
                    <frame name="M_G_descricao_Detail_GRPFR1">
                      <geometryInfo x="0.00000" y="3.39638" width="18.70987"
                       height="0.87281"/>
                      <generalLayout verticalElasticity="variable"/>
                      <advancedLayout printObjectOnPage="firstPage"
                       basePrintingOn="anchoringObject"
                       formatTrigger="m_g_descricao_detail_grpfr1for"/>
                      <visualSettings fillForegroundColor="white"/>
                      <repeatingFrame name="R_G_descricao_Detail1"
                       source="G_descricao_Detail" printDirection="down"
                       minWidowRecords="1" columnMode="no">
                        <geometryInfo x="0.00000" y="3.39638" width="18.70987"
                         height="0.37269"/>
                        <generalLayout verticalElasticity="expand"/>
                        <advancedLayout
                         formatTrigger="r_g_descricao_detail1formattri"/>
                        <visualSettings fillForegroundColor="white"/>
                        <field name="F_descricao_Detail1" source="CF_DESCRI"
                         minWidowLines="1" spacing="0" alignment="start">
                          <font face="Arial" size="8"/>
                          <geometryInfo x="0.18510" y="3.39638"
                           width="7.92417" height="0.37238"/>
                          <advancedLayout
                           formatTrigger="f_descricao_detail1formattrigg"/>
                          <visualSettings fillForegroundColor="white"
                           fillBackgroundColor="r75g75b88"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_Acabamento1" source="BACKGROUND"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial" size="8" bold="yes"/>
                          <geometryInfo x="5.85918" y="3.39638"
                           width="3.46025" height="0.31998"/>
                          <advancedLayout
                           formatTrigger="f_acabamento1formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_4" source="BACKGROUND"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="9.20998" y="3.39638"
                           width="1.62843" height="0.35657"/>
                          <advancedLayout formatTrigger="f_4formattrigger"/>
                          <visualSettings fillForegroundColor="white"/>
                        </field>
                        <field name="F_Valor_Detail1" source="CS_Valor_Detail"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="16.26257" y="3.39638"
                           width="2.40854" height="0.37269"/>
                          <advancedLayout
                           formatTrigger="f_valor_detail1formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           fillBackgroundColor="r88g100b100"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_3" source="BACKGROUND"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="10.89143" y="3.39669"
                           width="1.15063" height="0.34975"/>
                          <advancedLayout formatTrigger="f_3formattrigger"/>
                          <visualSettings fillForegroundColor="white"/>
                        </field>
                        <field name="F_Valor_Detail4" source="COPIES"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="14.04007" y="3.39638"
                           width="2.41598" height="0.36401"/>
                          <advancedLayout
                           formatTrigger="f_valor_detail4formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_Valor_Detail3" source="COPIES"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="11.84393" y="3.40289"
                           width="2.38125" height="0.36401"/>
                          <advancedLayout
                           formatTrigger="f_valor_detail3formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="f_preco_venda" source="preco_venda"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8" italic="yes"/>
                          <geometryInfo x="6.40302" y="3.39638"
                           width="2.91331" height="0.34603"/>
                          <advancedLayout
                           formatTrigger="f_preco_vendaformattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           fillBackgroundColor="r75g75b88"
                           lineForegroundColor="white"/>
                        </field>
                      </repeatingFrame>
                      <frame name="M_G_descricao_Detail_FTR1">
                        <geometryInfo x="0.18510" y="3.84101" width="18.52476"
                         height="0.37703"/>
                        <advancedLayout printObjectOnPage="firstPage"
                         basePrintingOn="anchoringObject"
                         formatTrigger="m_g_descricao_detail_ftr1forma"/>
                        <visualSettings fillForegroundColor="white"
                         lineForegroundColor="white"/>
                        <field name="F_5" source="BACKGROUND"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial" size="8"/>
                          <geometryInfo x="0.18510" y="3.84101"
                           width="9.13185" height="0.37703"/>
                          <advancedLayout formatTrigger="f_5formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_CS_subtotal1" source="CS_subtotal"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="9" bold="yes"/>
                          <geometryInfo x="16.26257" y="3.84101"
                           width="2.40854" height="0.37703"/>
                          <advancedLayout
                           formatTrigger="f_cs_subtotal1formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_CS_subtotal3" source="COPIES"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="9" bold="yes"/>
                          <geometryInfo x="14.09278" y="3.84101"
                           width="2.36327" height="0.36804"/>
                          <advancedLayout
                           formatTrigger="f_cs_subtotal3formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_CS_subtotal2" source="COPIES"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="9" bold="yes"/>
                          <geometryInfo x="11.84393" y="3.84101"
                           width="2.38125" height="0.36804"/>
                          <advancedLayout
                           formatTrigger="f_cs_subtotal2formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                      </frame>
                    </frame>
                    <repeatingFrame name="R_11" source="G_descricao_Detail"
                     printDirection="down" minWidowRecords="1" columnMode="no"
                      >
                      <geometryInfo x="0.00000" y="4.30051" width="18.70987"
                       height="0.37455"/>
                      <advancedLayout formatTrigger="r_11formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <field name="F_Aux3" source="BACKGROUND"
                       minWidowLines="1" spacing="0" alignment="start">
                        <font face="Arial" size="8"/>
                        <geometryInfo x="0.19844" y="4.30051" width="9.11820"
                         height="0.37455"/>
                        <advancedLayout formatTrigger="f_aux3formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         fillBackgroundColor="r50g100b75"
                         lineForegroundColor="white"/>
                      </field>
                      <field name="F_Aux_valor3" source="CS_subtotal"
                       minWidowLines="1" formatMask="999 999 990L" spacing="0"
                       alignment="end">
                        <font face="Arial Narrow" size="8"/>
                        <geometryInfo x="16.52705" y="4.30051" width="2.14406"
                         height="0.37455"/>
                        <advancedLayout
                         formatTrigger="f_aux_valor3formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         fillBackgroundColor="r50g88b50"
                         lineForegroundColor="white"/>
                      </field>
                    </repeatingFrame>
                    <line name="B_7" arrow="none" stretchWithFrame="M_5">
                      <geometryInfo x="9.36687" y="2.88944" width="0.00000"
                       height="1.83183"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="9.36687" y="2.88944"/>
                        <point x="9.36687" y="4.72126"/>
                      </points>
                    </line>
                    <line name="B_6" arrow="none" stretchWithFrame="M_5">
                      <geometryInfo x="16.50628" y="2.87176" width="0.00000"
                       height="1.84950"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="16.50628" y="2.87176"/>
                        <point x="16.50628" y="4.72126"/>
                      </points>
                    </line>
                    <line name="B_3" arrow="none" stretchWithFrame="M_5">
                      <geometryInfo x="14.25990" y="2.87176" width="0.00000"
                       height="1.84950"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="14.25990" y="2.87176"/>
                        <point x="14.25990" y="4.72126"/>
                      </points>
                    </line>
                    <line name="B_31" arrow="none" stretchWithFrame="M_5">
                      <geometryInfo x="12.06407" y="2.87176" width="0.00000"
                       height="1.84950"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="12.06407" y="2.87176"/>
                        <point x="12.06407" y="4.72126"/>
                      </points>
                    </line>
                    <line name="B_32" arrow="none" stretchWithFrame="M_5">
                      <geometryInfo x="10.86445" y="2.87176" width="0.00000"
                       height="1.84950"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="10.86445" y="2.87176"/>
                        <point x="10.86445" y="4.72126"/>
                      </points>
                    </line>
                  </frame>
                </repeatingFrame>
                <frame name="M_G_Detail_FTR1">
                  <geometryInfo x="4.00534" y="5.05023" width="14.70453"
                   height="0.56555"/>
                  <advancedLayout printObjectOnPage="lastPage"
                   basePrintingOn="anchoringObject"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <text name="B_CS_total1" minWidowLines="1">
                    <textSettings justify="end" spacing="0"/>
                    <geometryInfo x="12.55768" y="5.15565" width="2.22901"
                     height="0.36897"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <textSegment>
                      <font face="Arial" size="8" bold="yes"/>
                      <string>
                      <![CDATA[Total]]>
                      </string>
                    </textSegment>
                  </text>
                  <field name="F_CS_total1" source="CS_VALOR_2"
                   minWidowLines="1" formatMask="999 999 990L" spacing="0"
                   alignment="end">
                    <font face="Arial Narrow" size="9" bold="yes"/>
                    <geometryInfo x="14.83444" y="5.15565" width="3.83635"
                     height="0.44679"/>
                    <advancedLayout formatTrigger="f_cs_total1formattrigger"/>
                    <visualSettings fillForegroundColor="white"/>
                  </field>
                </frame>
                <text name="B_15" minWidowLines="1">
                  <textSettings justify="center" spacing="0"/>
                  <geometryInfo x="12.06097" y="2.48357" width="1.96577"
                   height="0.38943"/>
                  <visualSettings fillForegroundColor="white"
                   fillBackgroundColor="gray12"/>
                  <textSegment>
                    <font face="Arial" size="9" bold="yes" italic="yes"/>
                    <string>
                    <![CDATA[BG]]>
                    </string>
                  </textSegment>
                </text>
              </frame>
              <frame name="M_G_Consumiveis_GRPFR2">
                <geometryInfo x="0.00000" y="10.64679" width="18.70987"
                 height="2.02096"/>
                <generalLayout verticalElasticity="expand"/>
                <advancedLayout printObjectOnPage="firstPage"
                 basePrintingOn="enclosingObject"
                 formatTrigger="m_g_consumiveis_grpfr2formattr"/>
                <visualSettings fillForegroundColor="white"
                 linePattern="solid"/>
                <repeatingFrame name="R_G_descricao_Detail3"
                 source="G_OBA_ID_SUO" printDirection="down"
                 minWidowRecords="1" columnMode="no">
                  <geometryInfo x="0.00000" y="11.02940" width="18.70987"
                   height="1.04645"/>
                  <generalLayout pageProtect="yes"
                   verticalElasticity="variable"/>
                  <advancedLayout printObjectOnPage="firstPage"
                   basePrintingOn="enclosingObject"
                   formatTrigger="r_g_descricao_detail3formattri"/>
                  <visualSettings fillForegroundColor="white"
                   linePattern="solid"/>
                  <field name="F_descricao_Detail3" source="DESCRICAO"
                   minWidowLines="1" spacing="0" alignment="start">
                    <font face="Arial" size="8"/>
                    <geometryInfo x="0.10573" y="11.05514" width="6.61293"
                     height="0.37300"/>
                    <advancedLayout
                     formatTrigger="f_descricao_detail3formattrigg"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                  </field>
                  <repeatingFrame name="R_8" source="G_SUO_VALOR"
                   printDirection="down" minWidowRecords="1" columnMode="no">
                    <geometryInfo x="6.74688" y="11.07622" width="11.96299"
                     height="0.50943"/>
                    <generalLayout verticalElasticity="variable"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <field name="F_Valor_Detail5" source="CS_SUO_VALOR"
                     minWidowLines="1" formatMask="999 999 990L" spacing="0"
                     alignment="end">
                      <font face="Arial Narrow" size="8"/>
                      <geometryInfo x="16.54814" y="11.10165" width="2.16173"
                       height="0.42447"/>
                      <advancedLayout
                       formatTrigger="f_valor_detail5formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                    <field name="F_Entidade1" source="NOME_ABREVIADO"
                     minWidowLines="1" spacing="0" alignment="start">
                      <font face="Arial" size="8"/>
                      <geometryInfo x="6.83307" y="11.09700" width="4.89490"
                       height="0.37300"/>
                      <advancedLayout formatTrigger="f_entidade1formattrigger"
                      />
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                  </repeatingFrame>
                  <frame name="M_G_descricao_Detail_FTR2">
                    <geometryInfo x="2.79518" y="11.60952" width="15.91469"
                     height="0.42571"/>
                    <advancedLayout printObjectOnPage="firstPage"
                     basePrintingOn="anchoringObject"
                     formatTrigger="m_g_descricao_detail_ftr2forma"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <field name="F_CS_subtotal4" source="CS_SUO_VAL"
                     minWidowLines="1" formatMask="999 999 990L" spacing="0"
                     alignment="end">
                      <font face="Arial Narrow" size="9" bold="yes"/>
                      <geometryInfo x="16.55620" y="11.60952" width="2.15367"
                       height="0.42571"/>
                      <advancedLayout
                       formatTrigger="f_cs_subtotal4formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                    <field name="F_18" source="BACKGROUND" minWidowLines="1"
                     spacing="0" alignment="end">
                      <font face="Arial" size="8" bold="yes"/>
                      <geometryInfo x="10.66726" y="11.64828" width="4.84188"
                       height="0.32370"/>
                      <advancedLayout formatTrigger="f_18formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                  </frame>
                  <line name="B_33" arrow="none"
                   stretchWithFrame="R_G_descricao_Detail3">
                    <geometryInfo x="16.51372" y="11.02940" width="0.00000"
                     height="1.04645"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                    <points>
                      <point x="16.51372" y="11.02940"/>
                      <point x="16.51372" y="12.07585"/>
                    </points>
                  </line>
                </repeatingFrame>
                <field name="F_CS_total3" source="CS_TOTAL_SUB"
                 minWidowLines="1" formatMask="999 999 999L" spacing="0"
                 alignment="end">
                  <font face="Arial Narrow" size="9" bold="yes"/>
                  <geometryInfo x="15.79966" y="12.10066" width="2.88385"
                   height="0.44400"/>
                  <advancedLayout formatTrigger="f_cs_total3formattrigger"/>
                  <visualSettings fillForegroundColor="white"/>
                </field>
                <text name="B_CS_total3" minWidowLines="1">
                  <textSettings justify="end" spacing="0"/>
                  <geometryInfo x="3.90116" y="12.16577" width="11.60797"
                   height="0.36990"/>
                  <generalLayout>
                    <conditionalFormat>
                      <formatException label="aro_consumido">
                        <font size="0"/>
                      <cond name="first" column="aro_consumido" exception="11"
                       conjunction="1"/>
                      </formatException>
                    </conditionalFormat>
                  </generalLayout>
                  <advancedLayout formatTrigger="b_cs_total3formattrigger"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <textSegment>
                    <font face="Arial" size="8" bold="yes"/>
                    <string>
                    <![CDATA[Total]]>
                    </string>
                  </textSegment>
                </text>
                <frame name="M_30">
                  <geometryInfo x="0.00000" y="10.64679" width="18.70987"
                   height="0.37703"/>
                  <advancedLayout printObjectOnPage="allPage"
                   basePrintingOn="enclosingObject"/>
                  <visualSettings fillPattern="transparent"
                   fillForegroundColor="white" fillBackgroundColor="gray12"
                   linePattern="solid"/>
                  <text name="B_35" minWidowLines="1">
                    <textSettings justify="center" spacing="single"/>
                    <geometryInfo x="0.00000" y="10.64679" width="16.51651"
                     height="0.37703"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[* Detalhe de custos externos]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_34" minWidowLines="1">
                    <textSettings justify="center" spacing="single"/>
                    <geometryInfo x="16.51651" y="10.64679" width="2.19335"
                     height="0.37703"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Valor]]>
                      </string>
                    </textSegment>
                  </text>
                </frame>
              </frame>
              <frame name="M_G_Consumiveis_GRPFR4">
                <geometryInfo x="0.00000" y="12.86061" width="18.70987"
                 height="2.99982"/>
                <generalLayout verticalElasticity="expand"/>
                <advancedLayout printObjectOnPage="firstPage"
                 basePrintingOn="enclosingObject"
                 formatTrigger="m_g_consumiveis_grpfr4formattr"/>
                <visualSettings fillForegroundColor="white"
                 linePattern="solid"/>
                <repeatingFrame name="R_G_descricao_Detail6"
                 source="G_OBA_ID_SUO2" printDirection="down"
                 minWidowRecords="1" columnMode="no">
                  <geometryInfo x="0.00000" y="12.86061" width="18.70987"
                   height="1.98469"/>
                  <generalLayout pageProtect="yes"
                   verticalElasticity="variable"/>
                  <advancedLayout printObjectOnPage="firstPage"
                   basePrintingOn="enclosingObject"
                   formatTrigger="r_g_descricao_detail6formattri"/>
                  <visualSettings fillForegroundColor="white"
                   linePattern="solid"/>
                  <repeatingFrame name="R_G_descricao_Detail5"
                   source="G_DESCRICAO2" printDirection="down"
                   minWidowRecords="1" columnMode="no">
                    <geometryInfo x="0.00000" y="13.24322" width="18.70987"
                     height="1.04645"/>
                    <generalLayout pageProtect="yes"
                     verticalElasticity="variable"/>
                    <advancedLayout printObjectOnPage="firstPage"
                     basePrintingOn="enclosingObject"
                     formatTrigger="r_g_descricao_detail5formattri"/>
                    <visualSettings fillForegroundColor="white"
                     linePattern="solid"/>
                    <field name="F_descricao_Detail5" source="DESCRICAO2"
                     minWidowLines="1" spacing="0" alignment="start">
                      <font face="Arial" size="8"/>
                      <geometryInfo x="0.11875" y="13.26896" width="6.61293"
                       height="0.37300"/>
                      <advancedLayout
                       formatTrigger="f_descricao_detail5formattrigg"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                    <repeatingFrame name="R_10" source="G_SUO_VALOR2"
                     printDirection="down" minWidowRecords="1" columnMode="no"
                      >
                      <geometryInfo x="6.74688" y="13.29004" width="11.96299"
                       height="0.50943"/>
                      <generalLayout verticalElasticity="variable"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                      <field name="F_Valor_Detail9" source="CS_SUO_VALOR2"
                       minWidowLines="1" formatMask="999 999 990L" spacing="0"
                       alignment="end">
                        <font face="Arial Narrow" size="8"/>
                        <geometryInfo x="16.54814" y="13.31547"
                         width="2.16173" height="0.42447"/>
                        <advancedLayout
                         formatTrigger="f_valor_detail9formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         lineForegroundColor="white"/>
                      </field>
                      <field name="F_Entidade3" source="NOME_ABREVIADO2"
                       minWidowLines="1" spacing="0" alignment="start">
                        <font face="Arial" size="8"/>
                        <geometryInfo x="6.83307" y="13.31082" width="4.89490"
                         height="0.37300"/>
                        <advancedLayout
                         formatTrigger="f_entidade3formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         lineForegroundColor="white"/>
                      </field>
                    </repeatingFrame>
                    <frame name="M_G_descricao_Detail_FTR4">
                      <geometryInfo x="2.79518" y="13.82334" width="15.91469"
                       height="0.42571"/>
                      <advancedLayout printObjectOnPage="firstPage"
                       basePrintingOn="anchoringObject"
                       formatTrigger="m_g_descricao_detail_ftr4forma"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                      <field name="F_CS_subtotal6" source="CS_SUO_VAL_DESC"
                       minWidowLines="1" formatMask="999 999 990L" spacing="0"
                       alignment="end">
                        <font face="Arial Narrow" size="9" bold="yes"/>
                        <geometryInfo x="16.55620" y="13.82334"
                         width="2.15367" height="0.42571"/>
                        <advancedLayout
                         formatTrigger="f_cs_subtotal6formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         lineForegroundColor="white"/>
                      </field>
                      <field name="F_20" source="BACKGROUND" minWidowLines="1"
                       spacing="0" alignment="end">
                        <font face="Arial" size="8" bold="yes"/>
                        <geometryInfo x="10.66726" y="13.86210"
                         width="4.84188" height="0.32370"/>
                        <advancedLayout formatTrigger="f_20formattrigger"/>
                        <visualSettings fillForegroundColor="white"
                         lineForegroundColor="white"/>
                      </field>
                    </frame>
                    <line name="B_43" arrow="none"
                     stretchWithFrame="R_G_descricao_Detail5">
                      <geometryInfo x="16.51372" y="13.24322" width="0.00000"
                       height="1.04645"/>
                      <visualSettings fillPattern="transparent"
                       fillForegroundColor="white"
                       fillBackgroundColor="gray12" linePattern="solid"/>
                      <points>
                        <point x="16.51372" y="13.24322"/>
                        <point x="16.51372" y="14.28967"/>
                      </points>
                    </line>
                  </repeatingFrame>
                  <field name="F_CS_total6" source="CS_SUO_VAL_PE"
                   minWidowLines="1" formatMask="999 999 999L" spacing="0"
                   alignment="end">
                    <font face="Arial Narrow" size="9" bold="yes"/>
                    <geometryInfo x="15.82601" y="14.34269" width="2.88385"
                     height="0.44400"/>
                    <advancedLayout formatTrigger="f_cs_total6formattrigger"/>
                    <visualSettings fillForegroundColor="white"/>
                  </field>
                  <text name="B_CS_total6" minWidowLines="1">
                    <textSettings justify="end" spacing="0"/>
                    <geometryInfo x="3.95387" y="14.40780" width="11.60797"
                     height="0.36990"/>
                    <generalLayout>
                      <conditionalFormat>
                        <formatException label="aro_consumido">
                          <font size="0"/>
                        <cond name="first" column="aro_consumido"
                         exception="11" conjunction="1"/>
                        </formatException>
                      </conditionalFormat>
                    </generalLayout>
                    <advancedLayout formatTrigger="b_cs_total6formattrigger"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <textSegment>
                      <font face="Arial" size="8" bold="yes"/>
                      <string>
                      <![CDATA[Total&F_EMP2  ]]>
                      </string>
                    </textSegment>
                  </text>
                  <frame name="M_33">
                    <geometryInfo x="0.00000" y="12.86061" width="18.70987"
                     height="0.37703"/>
                    <advancedLayout printObjectOnPage="allPage"
                     basePrintingOn="enclosingObject"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                    <text name="B_45" minWidowLines="1">
                      <textSettings justify="center" spacing="single"/>
                      <geometryInfo x="0.00000" y="12.86061" width="16.51651"
                       height="0.37703"/>
                      <visualSettings fillPattern="transparent"
                       fillForegroundColor="white"
                       fillBackgroundColor="gray12" linePattern="solid"/>
                      <textSegment>
                        <font face="Arial" size="9" bold="yes" italic="yes"/>
                        <string>
                        <![CDATA[Discriminativo de custos externos -&F_EMP2 &F_EMP1]]>
                        </string>
                      </textSegment>
                    </text>
                    <field name="F_label1" source="DESNAME" minWidowLines="1"
                     spacing="0" alignment="center">
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <geometryInfo x="16.51372" y="12.86061" width="2.19615"
                       height="0.37703"/>
                      <advancedLayout formatTrigger="f_label1formattrigger"/>
                      <visualSettings fillPattern="transparent"
                       fillForegroundColor="white"
                       fillBackgroundColor="gray12" linePattern="solid"/>
                    </field>
                    <field name="F_EMP1" source="EMP" visible="no"
                     minWidowLines="1" spacing="0" alignment="end">
                      <font face="Arial" size="8" bold="yes" italic="yes"/>
                      <geometryInfo x="12.22313" y="12.86061" width="4.23478"
                       height="0.37703"/>
                      <advancedLayout formatTrigger="f_emp1formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                    </field>
                    <field name="F_EMP2" source="EMP" visible="no"
                     minWidowLines="1" spacing="0" alignment="end">
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <geometryInfo x="0.65608" y="12.86061" width="0.96583"
                       height="0.37703"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                    </field>
                  </frame>
                </repeatingFrame>
                <field name="F_CS_total5" source="CS_TOTAL_SUB_PE"
                 minWidowLines="1" formatMask="999 999 999L" spacing="0"
                 alignment="end">
                  <font face="Arial Narrow" size="9" bold="yes"/>
                  <geometryInfo x="15.82601" y="14.94730" width="2.88385"
                   height="0.44400"/>
                  <advancedLayout formatTrigger="f_cs_total5formattrigger"/>
                  <visualSettings fillForegroundColor="white"/>
                </field>
                <frame name="M_35">
                  <geometryInfo x="7.65008" y="15.41766" width="11.05979"
                   height="0.44276"/>
                  <advancedLayout formatTrigger="m_35formattrigger"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <field name="F_Aux_valor2" source="COPIES" minWidowLines="1"
                   formatMask="999 999 990L" spacing="0" alignment="end">
                    <font face="Arial Narrow" size="9" bold="yes"/>
                    <geometryInfo x="15.64835" y="15.41766" width="2.85068"
                     height="0.44276"/>
                    <advancedLayout formatTrigger="f_aux_valor2formattrigger"
                    />
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                  </field>
                  <field name="F_Aux2" source="DESNAME" minWidowLines="1"
                   spacing="0" alignment="end">
                    <font face="Arial" size="8" bold="yes"/>
                    <geometryInfo x="8.26461" y="15.41766" width="7.27087"
                     height="0.44276"/>
                    <advancedLayout formatTrigger="f_aux2formattrigger"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                  </field>
                </frame>
                <text name="B_CS_total5" minWidowLines="1">
                  <textSettings justify="end" spacing="0"/>
                  <geometryInfo x="3.90116" y="15.01242" width="11.60797"
                   height="0.36990"/>
                  <generalLayout>
                    <conditionalFormat>
                      <formatException label="aro_consumido">
                        <font size="0"/>
                      <cond name="first" column="aro_consumido" exception="11"
                       conjunction="1"/>
                      </formatException>
                    </conditionalFormat>
                  </generalLayout>
                  <advancedLayout formatTrigger="b_cs_total5formattrigger"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <textSegment>
                    <font face="Arial" size="8" bold="yes"/>
                    <string>
                    <![CDATA[Total]]>
                    </string>
                  </textSegment>
                </text>
              </frame>
            </frame>
            <field name="F_9" source="CF_NUM_FOLHAS" minWidowLines="1"
             formatMask="999 999 990D0999" spacing="0" alignment="end">
              <font face="Arial" size="9" italic="yes"/>
              <geometryInfo x="13.97000" y="1.17450" width="4.48469"
               height="0.42323"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"
               formatTrigger="f_9formattrigger"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="black"/>
            </field>
            <frame name="M_1">
              <geometryInfo x="0.00000" y="19.55292" width="14.20813"
               height="2.27397"/>
              <advancedLayout printObjectOnPage="firstPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillForegroundColor="white" linePattern="solid"/>
              <text name="B_2" minWidowLines="1">
                <textSettings justify="center" spacing="single"/>
                <geometryInfo x="0.00000" y="19.55292" width="14.20813"
                 height="0.37703"/>
                <advancedLayout printObjectOnPage="allPage"
                 basePrintingOn="enclosingObject"/>
                <visualSettings fillPattern="transparent"
                 fillForegroundColor="white" fillBackgroundColor="gray12"
                 linePattern="solid"/>
                <textSegment>
                  <font face="Arial" size="8" bold="yes" italic="yes"/>
                  <string>
                  <![CDATA[Observações]]>
                  </string>
                </textSegment>
              </text>
              <frame name="M_36">
                <geometryInfo x="0.00000" y="19.91289" width="6.29791"
                 height="0.44276"/>
                <generalLayout verticalElasticity="variable"/>
                <advancedLayout formatTrigger="m_36formattrigger"/>
                <visualSettings fillForegroundColor="white"
                 lineForegroundColor="white"/>
                <text name="B_19" minWidowLines="1">
                  <textSettings spacing="single"/>
                  <geometryInfo x="0.02635" y="19.93243" width="2.83115"
                   height="0.42323"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <textSegment>
                    <font face="Arial" size="10"/>
                    <string>
                    <![CDATA[(*) Só custos fixos]]>
                    </string>
                  </textSegment>
                </text>
              </frame>
              <frame name="M_11">
                <geometryInfo x="0.00000" y="20.40000" width="14.20813"
                 height="0.37052"/>
                <generalLayout verticalElasticity="variable"/>
                <advancedLayout formatTrigger="m_11formattrigger"/>
                <visualSettings fillForegroundColor="white"/>
                <field name="OBS1" source="CF_obs_gfo" minWidowLines="1"
                 spacing="single" alignment="start">
                  <font face="Arial" size="9"/>
                  <geometryInfo x="0.00000" y="20.40000" width="14.20813"
                   height="0.37052"/>
                  <generalLayout verticalElasticity="variable"/>
                  <advancedLayout formatTrigger="obs1formattrigger"/>
                  <visualSettings fillForegroundColor="white"/>
                </field>
              </frame>
              <field name="OBS2" source="estragos_obs1" minWidowLines="1"
               spacing="single" alignment="start">
                <font face="Arial" size="8"/>
                <geometryInfo x="0.00000" y="20.82571" width="14.20813"
                 height="0.42323"/>
                <generalLayout verticalElasticity="variable"/>
                <advancedLayout formatTrigger="obs2formattrigger"/>
                <visualSettings fillForegroundColor="white"/>
              </field>
            </frame>
            <frame name="M_4">
              <geometryInfo x="14.20813" y="19.55416" width="4.49554"
               height="2.27397"/>
              <advancedLayout printObjectOnPage="firstPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillForegroundColor="white" linePattern="solid"/>
              <text name="B_1" minWidowLines="1">
                <textSettings justify="center" spacing="single"/>
                <geometryInfo x="14.20813" y="19.55416" width="4.49554"
                 height="0.37703"/>
                <advancedLayout printObjectOnPage="allPage"
                 basePrintingOn="enclosingObject"/>
                <visualSettings fillPattern="transparent"
                 fillForegroundColor="white" fillBackgroundColor="gray12"
                 linePattern="solid"/>
                <textSegment>
                  <font face="Arial" size="8" bold="yes" italic="yes"/>
                  <string>
                  <![CDATA[Rubrica]]>
                  </string>
                </textSegment>
              </text>
            </frame>
            <frame name="M_12">
              <geometryInfo x="0.00000" y="16.88052" width="18.70615"
               height="2.48698"/>
              <advancedLayout printObjectOnPage="firstPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillForegroundColor="white" linePattern="solid"/>
              <text name="B_8" minWidowLines="1">
                <textSettings justify="center" spacing="single"/>
                <geometryInfo x="0.00000" y="16.88052" width="18.70615"
                 height="0.37703"/>
                <advancedLayout printObjectOnPage="allPage"
                 basePrintingOn="enclosingObject"/>
                <visualSettings fillPattern="transparent"
                 fillForegroundColor="white" fillBackgroundColor="gray12"
                 linePattern="solid"/>
                <textSegment>
                  <font face="Arial" size="8" bold="yes" italic="yes"/>
                  <string>
                  <![CDATA[Dados Adicionais]]>
                  </string>
                </textSegment>
              </text>
              <field name="OBS3" source="CF_DADOS_ADIC" minWidowLines="1"
               spacing="single" alignment="start">
                <font face="Arial" size="8"/>
                <geometryInfo x="0.00000" y="17.25290" width="18.70615"
                 height="0.37052"/>
                <generalLayout verticalElasticity="variable"/>
                <advancedLayout formatTrigger="obs3formattrigger"/>
                <visualSettings fillForegroundColor="white"/>
              </field>
            </frame>
          </repeatingFrame>
          <text name="B_PAGENUM1" minWidowLines="1">
            <textSettings justify="left" spacing="0"/>
            <geometryInfo x="16.82843" y="21.89634" width="0.54384"
             height="0.25270"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="anchoringObject"/>
            <textSegment>
              <font face="Arial" size="6" italic="yes"/>
              <string>
              <![CDATA[Pág.: ]]>
              </string>
            </textSegment>
          </text>
          <field name="F_22" source="PageNumber" minWidowLines="1" spacing="0"
           alignment="end">
            <font face="Arial" size="6" italic="yes"/>
            <geometryInfo x="17.33507" y="21.88487" width="0.34417"
             height="0.27347"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
            <pageNumbering header="yes" main="yes" trailer="yes" startAt="1"
             incrementBy="1" resetAt="report"/>
          </field>
          <field name="F_21" source="TotalPages" minWidowLines="1" spacing="0"
           alignment="center">
            <font face="Arial" size="6" italic="yes"/>
            <geometryInfo x="18.03704" y="21.88487" width="0.62911"
             height="0.27347"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
            <pageNumbering header="yes" main="yes" trailer="yes" startAt="1"
             incrementBy="1" resetAt="report"/>
          </field>
          <text name="B_46" minWidowLines="1">
            <textSettings justify="left" spacing="0"/>
            <geometryInfo x="17.79798" y="21.89758" width="0.23813"
             height="0.26448"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <textSegment>
              <font face="Arial" size="6" italic="yes"/>
              <string>
              <![CDATA[de]]>
              </string>
            </textSegment>
          </text>
          <field name="F_25" source="user" minWidowLines="1" spacing="0"
           alignment="center">
            <font face="Arial" size="6"/>
            <geometryInfo x="4.81397" y="21.88859" width="9.06735"
             height="0.27347"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
          </field>
        </repeatingFrame>
      </frame>
      <frame name="M_G_Master_Cabecalho_GRPFR1">
        <geometryInfo x="0.00000" y="23.05937" width="18.70987"
         height="22.47150"/>
        <generalLayout verticalElasticity="variable"/>
        <advancedLayout formatTrigger="m_g_master_cabecalho_grpfr1for"/>
        <visualSettings fillForegroundColor="white"
         lineForegroundColor="white"/>
        <repeatingFrame name="R_G_Master_Cabecalho1"
         source="G_Master_Cabecalho" printDirection="down" minWidowRecords="1"
         columnMode="no">
          <geometryInfo x="0.00000" y="23.21812" width="18.70987"
           height="22.18779"/>
          <generalLayout verticalElasticity="variable"/>
          <advancedLayout formatTrigger="r_g_master_cabecalho1formattri"/>
          <visualSettings fillForegroundColor="white"
           lineForegroundColor="white"/>
          <repeatingFrame name="R_7" source="G_oba_id1" printDirection="down"
           maxRecordsPerPage="1" minWidowRecords="1" columnMode="no">
            <geometryInfo x="0.00000" y="23.98582" width="18.70987"
             height="20.49022"/>
            <advancedLayout formatTrigger="r_7formattrigger"/>
            <visualSettings fillForegroundColor="white"/>
            <frame name="M_34">
              <geometryInfo x="0.00000" y="24.63229" width="18.70987"
               height="19.73802"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="gray12"/>
              <frame name="M_G_Detail_GRPFR2">
                <geometryInfo x="0.00000" y="24.95383" width="18.70987"
                 height="12.56792"/>
                <generalLayout verticalElasticity="expand"/>
                <advancedLayout printObjectOnPage="firstPage"
                 basePrintingOn="anchoringObject"/>
                <visualSettings fillForegroundColor="white"/>
                <frame name="M_G_descricao_Detail_HDR2">
                  <geometryInfo x="0.00000" y="25.23505" width="18.70987"
                   height="0.76274"/>
                  <advancedLayout printObjectOnPage="allPage"
                   basePrintingOn="enclosingObject"/>
                  <visualSettings fillPattern="transparent"
                   fillForegroundColor="white" fillBackgroundColor="gray12"
                   linePattern="solid"/>
                  <text name="B_descricao_Detail2" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="1.61385" y="25.23505" width="6.94531"
                     height="0.76274"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Descrição]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_27" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="8.57312" y="25.23505" width="1.48425"
                     height="0.76274"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12" linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Qtd.]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_Valor_Detail4" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="15.93887" y="25.60309" width="2.51365"
                     height="0.38447"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Total]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_25" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="10.05737" y="25.23505" width="1.19187"
                     height="0.76274"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12" linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Tempo]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_37" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="11.24955" y="25.60309" width="2.07212"
                     height="0.38447"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Interno]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_descricao_Detail4" minWidowLines="1">
                    <textSettings justify="center" spacing="0"/>
                    <geometryInfo x="11.24955" y="25.23505" width="7.46032"
                     height="0.37796"/>
                    <visualSettings fillForegroundColor="white"
                     fillBackgroundColor="gray12" linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Valor]]>
                      </string>
                    </textSegment>
                  </text>
                  <field name="F_Exterior2" source="BACKGROUND"
                   minWidowLines="1" spacing="0" alignment="center">
                    <font face="Arial" size="9" bold="yes" italic="yes"/>
                    <geometryInfo x="13.32167" y="25.61332" width="2.44760"
                     height="0.38447"/>
                    <advancedLayout formatTrigger="f_exterior2formattrigger"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                  </field>
                </frame>
                <repeatingFrame name="R_G_Detail2" source="G_oba_id_Detail1"
                 printDirection="down" minWidowRecords="1" columnMode="no">
                  <geometryInfo x="0.00000" y="25.99717" width="18.70615"
                   height="0.51346"/>
                  <generalLayout verticalElasticity="variable"/>
                  <visualSettings fillForegroundColor="white"/>
                  <frame name="M_29">
                    <geometryInfo x="0.00000" y="25.99717" width="18.70615"
                     height="0.48710"/>
                    <generalLayout verticalElasticity="variable"/>
                    <advancedLayout formatTrigger="m_29formattrigger"/>
                    <visualSettings fillForegroundColor="white"
                     linePattern="solid"/>
                    <frame name="M_G_descricao_Detail_GRPFR2">
                      <geometryInfo x="0.00000" y="26.03996" width="18.67948"
                       height="0.41765"/>
                      <generalLayout verticalElasticity="variable"/>
                      <advancedLayout printObjectOnPage="firstPage"
                       basePrintingOn="anchoringObject"
                       formatTrigger="m_g_descricao_detail_grpfr2for"/>
                      <visualSettings fillForegroundColor="white"/>
                      <repeatingFrame name="R_G_descricao_Detail2"
                       source="G_descricao_Detail1" printDirection="down"
                       minWidowRecords="1" columnMode="no">
                        <geometryInfo x="0.00000" y="26.03996"
                         width="18.67948" height="0.37269"/>
                        <generalLayout verticalElasticity="expand"/>
                        <advancedLayout
                         formatTrigger="r_g_descricao_detail2formattri"/>
                        <visualSettings fillForegroundColor="white"/>
                        <field name="F_descricao_Detail2"
                         source="CF_DESCRI_OUTR" minWidowLines="1" spacing="0"
                         alignment="start">
                          <font face="Arial" size="8"/>
                          <geometryInfo x="0.12495" y="26.03996"
                           width="6.75990" height="0.37238"/>
                          <advancedLayout
                           formatTrigger="f_descricao_detail2formattrigg"/>
                          <visualSettings fillForegroundColor="white"
                           fillBackgroundColor="r75g75b88"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_Acabamento2" source="BACKGROUND"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial" size="8" bold="yes"/>
                          <geometryInfo x="5.04837" y="26.03996"
                           width="3.46025" height="0.31998"/>
                          <advancedLayout
                           formatTrigger="f_acabamento2formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_15" source="BACKGROUND"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="8.39918" y="26.03996"
                           width="1.62843" height="0.35657"/>
                          <advancedLayout formatTrigger="f_15formattrigger"/>
                          <visualSettings fillForegroundColor="white"/>
                        </field>
                        <field name="F_Valor_Detail2"
                         source="CS_Valor_Detail1" minWidowLines="1"
                         formatMask="999 999 990L" spacing="0" alignment="end"
                          >
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="11.00677" y="26.03996"
                           width="2.27521" height="0.37269"/>
                          <advancedLayout
                           formatTrigger="f_valor_detail2formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           fillBackgroundColor="r88g100b100"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_14" source="BACKGROUND"
                         minWidowLines="1" spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="10.08745" y="26.04027"
                           width="1.15063" height="0.34975"/>
                          <advancedLayout formatTrigger="f_14formattrigger"/>
                          <visualSettings fillForegroundColor="white"/>
                        </field>
                        <field name="F_Valor_Detail7" source="COPIES"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="13.01750" y="26.03996"
                           width="2.75177" height="0.36401"/>
                          <advancedLayout
                           formatTrigger="f_valor_detail7formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                        <field name="F_Valor_Detail6" source="COPIES"
                         minWidowLines="1" formatMask="999 999 990L"
                         spacing="0" alignment="end">
                          <font face="Arial Narrow" size="8"/>
                          <geometryInfo x="15.58385" y="26.03996"
                           width="3.09563" height="0.36401"/>
                          <advancedLayout
                           formatTrigger="f_valor_detail6formattrigger"/>
                          <visualSettings fillForegroundColor="white"
                           lineForegroundColor="white"/>
                        </field>
                      </repeatingFrame>
                    </frame>
                    <line name="B_26" arrow="none" stretchWithFrame="M_29">
                      <geometryInfo x="8.56196" y="25.99717" width="0.00186"
                       height="0.48710"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="8.56196" y="25.99717"/>
                        <point x="8.56382" y="26.48427"/>
                      </points>
                    </line>
                    <line name="B_28" arrow="none" stretchWithFrame="M_29">
                      <geometryInfo x="10.05706" y="25.99717" width="0.00000"
                       height="0.48710"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="10.05706" y="26.48427"/>
                        <point x="10.05706" y="25.99717"/>
                      </points>
                    </line>
                    <line name="B_29" arrow="none" stretchWithFrame="M_29">
                      <geometryInfo x="11.25327" y="25.99717" width="0.00000"
                       height="0.48710"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="11.25327" y="26.48427"/>
                        <point x="11.25327" y="25.99717"/>
                      </points>
                    </line>
                    <line name="B_36" arrow="none" stretchWithFrame="M_29">
                      <geometryInfo x="15.77516" y="25.99717" width="0.00000"
                       height="0.48710"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="15.77516" y="26.48427"/>
                        <point x="15.77516" y="25.99717"/>
                      </points>
                    </line>
                    <line name="B_39" arrow="none" stretchWithFrame="M_29">
                      <geometryInfo x="13.32074" y="25.99717" width="0.00000"
                       height="0.48710"/>
                      <visualSettings fillForegroundColor="white"
                       linePattern="solid"/>
                      <points>
                        <point x="13.32074" y="26.48427"/>
                        <point x="13.32074" y="25.99717"/>
                      </points>
                    </line>
                  </frame>
                </repeatingFrame>
                <frame name="M_G_Detail_FTR2">
                  <geometryInfo x="3.19453" y="26.54009" width="15.51533"
                   height="0.56555"/>
                  <advancedLayout printObjectOnPage="lastPage"
                   basePrintingOn="anchoringObject"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <text name="B_CS_total2" minWidowLines="1">
                    <textSettings justify="end" spacing="0"/>
                    <geometryInfo x="9.26331" y="26.64551" width="5.50323"
                     height="0.36897"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <textSegment>
                      <font face="Arial" size="8" bold="yes"/>
                      <string>
                      <![CDATA[Total &F_DESIG_ENT]]>
                      </string>
                    </textSegment>
                  </text>
                  <field name="F_CS_total2" source="COPIES" minWidowLines="1"
                   formatMask="999 999 990L" spacing="0" alignment="end">
                    <font face="Arial Narrow" size="9" bold="yes"/>
                    <geometryInfo x="14.81460" y="26.64551" width="3.83635"
                     height="0.44679"/>
                    <advancedLayout formatTrigger="f_cs_total2formattrigger"/>
                    <visualSettings fillForegroundColor="white"/>
                  </field>
                </frame>
                <frame name="M_37">
                  <geometryInfo x="1.66656" y="36.99433" width="6.29791"
                   height="0.44276"/>
                  <generalLayout verticalElasticity="variable"/>
                  <advancedLayout formatTrigger="m_37formattrigger"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <text name="B_38" minWidowLines="1">
                    <textSettings spacing="single"/>
                    <geometryInfo x="1.69292" y="37.01386" width="2.83115"
                     height="0.42323"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <textSegment>
                      <font face="Arial" size="10"/>
                      <string>
                      <![CDATA[(*) Só custos fixos]]>
                      </string>
                    </textSegment>
                  </text>
                </frame>
              </frame>
              <frame name="M_G_Consumiveis_GRPFR3">
                <geometryInfo x="0.00000" y="38.72880" width="18.70987"
                 height="2.07677"/>
                <generalLayout verticalElasticity="expand"/>
                <advancedLayout printObjectOnPage="firstPage"
                 basePrintingOn="enclosingObject"
                 formatTrigger="m_g_consumiveis_grpfr3formattr"/>
                <visualSettings fillForegroundColor="white"
                 linePattern="solid"/>
                <repeatingFrame name="R_G_descricao_Detail4"
                 source="G_OBA_ID_SUO1" printDirection="down"
                 minWidowRecords="1" columnMode="no">
                  <geometryInfo x="0.00000" y="39.11141" width="18.70987"
                   height="1.04645"/>
                  <generalLayout pageProtect="yes"
                   verticalElasticity="variable"/>
                  <advancedLayout printObjectOnPage="firstPage"
                   basePrintingOn="enclosingObject"
                   formatTrigger="r_g_descricao_detail4formattri"/>
                  <visualSettings fillForegroundColor="white"
                   linePattern="solid"/>
                  <field name="F_descricao_Detail4" source="DESCRICAO1"
                   minWidowLines="1" spacing="0" alignment="start">
                    <font face="Arial" size="8"/>
                    <geometryInfo x="0.10542" y="39.13715" width="6.74594"
                     height="0.37300"/>
                    <advancedLayout
                     formatTrigger="f_descricao_detail4formattrigg"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                  </field>
                  <repeatingFrame name="R_9" source="G_SUO_VALOR1"
                   printDirection="down" minWidowRecords="1" columnMode="no">
                    <geometryInfo x="6.87927" y="39.15823" width="11.83060"
                     height="0.50943"/>
                    <generalLayout verticalElasticity="variable"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <field name="F_Valor_Detail8" source="CS_SUO_VALOR1"
                     minWidowLines="1" formatMask="999 999 990L" spacing="0"
                     alignment="end">
                      <font face="Arial Narrow" size="8"/>
                      <geometryInfo x="16.54814" y="39.18365" width="2.16173"
                       height="0.42447"/>
                      <advancedLayout
                       formatTrigger="f_valor_detail8formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                    <field name="F_Entidade2" source="NOME_ABREVIADO1"
                     minWidowLines="1" spacing="0" alignment="start">
                      <font face="Arial" size="8"/>
                      <geometryInfo x="6.96485" y="39.17900" width="4.89490"
                       height="0.37300"/>
                      <advancedLayout formatTrigger="f_entidade2formattrigger"
                      />
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                  </repeatingFrame>
                  <frame name="M_G_descricao_Detail_FTR3">
                    <geometryInfo x="2.79518" y="39.69153" width="15.91469"
                     height="0.42571"/>
                    <advancedLayout printObjectOnPage="firstPage"
                     basePrintingOn="anchoringObject"
                     formatTrigger="m_g_descricao_detail_ftr3forma"/>
                    <visualSettings fillForegroundColor="white"
                     lineForegroundColor="white"/>
                    <field name="F_CS_subtotal5" source="CS_SUO_VAL_OUTR"
                     minWidowLines="1" formatMask="999 999 990L" spacing="0"
                     alignment="end">
                      <font face="Arial Narrow" size="9" bold="yes"/>
                      <geometryInfo x="16.55620" y="39.69153" width="2.15367"
                       height="0.42571"/>
                      <advancedLayout
                       formatTrigger="f_cs_subtotal5formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                    <field name="F_19" source="BACKGROUND" minWidowLines="1"
                     spacing="0" alignment="end">
                      <font face="Arial" size="8" bold="yes"/>
                      <geometryInfo x="10.66726" y="39.73029" width="4.84188"
                       height="0.32370"/>
                      <advancedLayout formatTrigger="f_19formattrigger"/>
                      <visualSettings fillForegroundColor="white"
                       lineForegroundColor="white"/>
                    </field>
                  </frame>
                  <line name="B_40" arrow="none"
                   stretchWithFrame="R_G_descricao_Detail4">
                    <geometryInfo x="16.51372" y="39.11141" width="0.00000"
                     height="1.04645"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                    <points>
                      <point x="16.51372" y="39.11141"/>
                      <point x="16.51372" y="40.15786"/>
                    </points>
                  </line>
                </repeatingFrame>
                <field name="F_CS_total4" source="CS_total_sub_outr"
                 minWidowLines="1" formatMask="999 999 999L" spacing="0"
                 alignment="end">
                  <font face="Arial Narrow" size="9" bold="yes"/>
                  <geometryInfo x="15.82601" y="40.18266" width="2.88385"
                   height="0.44400"/>
                  <advancedLayout formatTrigger="f_cs_total4formattrigger"/>
                  <visualSettings fillForegroundColor="white"/>
                </field>
                <text name="B_CS_total4" minWidowLines="1">
                  <textSettings justify="end" spacing="0"/>
                  <geometryInfo x="3.90116" y="40.24778" width="11.60797"
                   height="0.36990"/>
                  <generalLayout>
                    <conditionalFormat>
                      <formatException label="aro_consumido">
                        <font size="0"/>
                      <cond name="first" column="aro_consumido" exception="11"
                       conjunction="1"/>
                      </formatException>
                    </conditionalFormat>
                  </generalLayout>
                  <advancedLayout formatTrigger="b_cs_total4formattrigger"/>
                  <visualSettings fillForegroundColor="white"
                   lineForegroundColor="white"/>
                  <textSegment>
                    <font face="Arial" size="8" bold="yes"/>
                    <string>
                    <![CDATA[Total]]>
                    </string>
                  </textSegment>
                </text>
                <frame name="M_31">
                  <geometryInfo x="0.00000" y="38.72880" width="18.70987"
                   height="0.37703"/>
                  <advancedLayout printObjectOnPage="allPage"
                   basePrintingOn="enclosingObject"/>
                  <visualSettings fillPattern="transparent"
                   fillForegroundColor="white" fillBackgroundColor="gray12"
                   linePattern="solid"/>
                  <text name="B_42" minWidowLines="1">
                    <textSettings justify="center" spacing="single"/>
                    <geometryInfo x="0.00000" y="38.72880" width="16.51651"
                     height="0.37703"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[* Detalhe de custos externos]]>
                      </string>
                    </textSegment>
                  </text>
                  <text name="B_41" minWidowLines="1">
                    <textSettings justify="center" spacing="single"/>
                    <geometryInfo x="16.51651" y="38.72880" width="2.19335"
                     height="0.37703"/>
                    <visualSettings fillPattern="transparent"
                     fillForegroundColor="white" fillBackgroundColor="gray12"
                     linePattern="solid"/>
                    <textSegment>
                      <font face="Arial" size="9" bold="yes" italic="yes"/>
                      <string>
                      <![CDATA[Valor]]>
                      </string>
                    </textSegment>
                  </text>
                </frame>
              </frame>
              <text name="B_30" minWidowLines="1">
                <textSettings justify="center" spacing="single"/>
                <geometryInfo x="0.00000" y="24.85740" width="18.70987"
                 height="0.37703"/>
                <visualSettings fillPattern="transparent"
                 fillForegroundColor="white" fillBackgroundColor="gray12"
                 linePattern="solid"/>
                <textSegment>
                  <font face="Arial" size="8" bold="yes"/>
                  <string>
                  <![CDATA[&F_DESIG_ENT]]>
                  </string>
                </textSegment>
              </text>
            </frame>
            <rectangle name="B_24">
              <geometryInfo x="0.00000" y="23.98582" width="18.70987"
               height="0.42323"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="black" linePattern="solid"/>
              <points>
                <point x="0.00000" y="23.98582"/>
                <point x="18.70987" y="0.42323"/>
              </points>
            </rectangle>
            <field name="F_13" source="desc_GF" minWidowLines="1" spacing="0"
             alignment="start">
              <font face="Arial" size="9" bold="yes" italic="yes"/>
              <geometryInfo x="0.11906" y="23.98582" width="13.85094"
               height="0.42354"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="black"/>
            </field>
            <field name="F_12" source="BACKGROUND" minWidowLines="1"
             spacing="0" alignment="end">
              <font face="Arial" size="9" italic="yes"/>
              <geometryInfo x="13.97000" y="23.98582" width="4.48469"
               height="0.42323"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"
               formatTrigger="f_12formattrigger"/>
              <visualSettings fillForegroundColor="white"
               fillBackgroundColor="black"/>
            </field>
          </repeatingFrame>
          <field name="F_DESIG_ENT" source="CF_DESIG_ENT" visible="no"
           minWidowLines="1" spacing="0" alignment="start">
            <font face="Arial" size="8" bold="yes"/>
            <geometryInfo x="3.04292" y="44.58581" width="1.48146"
             height="0.47625"/>
            <generalLayout horizontalElasticity="expand"/>
            <visualSettings fillForegroundColor="white" linePattern="solid"
             lineForegroundColor="white"/>
          </field>
          <field name="F_26" source="user" minWidowLines="1" spacing="0"
           alignment="center">
            <font face="Arial" size="6"/>
            <geometryInfo x="4.81397" y="45.13244" width="9.06735"
             height="0.27347"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
          </field>
          <text name="B_Valor_Detail3" minWidowLines="1">
            <textSettings justify="center" spacing="0"/>
            <geometryInfo x="0.00000" y="23.43020" width="18.70987"
             height="0.55283"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillPattern="transparent"
             fillForegroundColor="white" fillBackgroundColor="gray12"
             linePattern="solid"/>
            <textSegment>
              <font face="Arial" size="10" bold="yes" italic="yes"/>
              <string>
              <![CDATA[Grupo de Facturação]]>
              </string>
            </textSegment>
          </text>
        </repeatingFrame>
        <text name="B_PAGENUM2" minWidowLines="1">
          <textSettings justify="left" spacing="0"/>
          <geometryInfo x="16.82843" y="45.16655" width="0.54384"
           height="0.25270"/>
          <advancedLayout printObjectOnPage="allPage"
           basePrintingOn="anchoringObject"/>
          <textSegment>
            <font face="Arial" size="6" italic="yes"/>
            <string>
            <![CDATA[Pág.: ]]>
            </string>
          </textSegment>
        </text>
        <field name="F_24" source="PageNumber" minWidowLines="1" spacing="0"
         alignment="end">
          <font face="Arial" size="6" italic="yes"/>
          <geometryInfo x="17.36111" y="45.15507" width="0.34417"
           height="0.27347"/>
          <advancedLayout printObjectOnPage="allPage"
           basePrintingOn="enclosingObject"/>
          <visualSettings fillForegroundColor="white"
           lineForegroundColor="white"/>
          <pageNumbering header="yes" main="yes" trailer="yes" startAt="1"
           incrementBy="1" resetAt="report"/>
        </field>
        <field name="F_23" source="TotalPages" minWidowLines="1" spacing="0"
         alignment="center">
          <font face="Arial" size="6" italic="yes"/>
          <geometryInfo x="18.06308" y="45.15507" width="0.60306"
           height="0.27347"/>
          <advancedLayout printObjectOnPage="allPage"
           basePrintingOn="enclosingObject"/>
          <visualSettings fillForegroundColor="white"
           lineForegroundColor="white"/>
          <pageNumbering header="yes" main="yes" trailer="yes" startAt="1"
           incrementBy="1" resetAt="report"/>
        </field>
        <text name="B_47" minWidowLines="1">
          <textSettings justify="left" spacing="0"/>
          <geometryInfo x="17.82403" y="45.16779" width="0.23813"
           height="0.26448"/>
          <advancedLayout printObjectOnPage="allPage"
           basePrintingOn="enclosingObject"/>
          <textSegment>
            <font face="Arial" size="6" italic="yes"/>
            <string>
            <![CDATA[de]]>
            </string>
          </textSegment>
        </text>
      </frame>
    </body>
    <margin>
      <field name="F_NTH1_SEC2" source="PageNumber" visible="no"
       minWidowLines="1" spacing="0" alignment="left" templateSection="main">
        <font face="Arial" size="10"/>
        <geometryInfo x="15.07815" y="0.18448" width="4.12750"
         height="0.47625"/>
        <visualSettings lineForegroundColor="white"/>
        <pageNumbering header="yes" main="yes" trailer="yes" startAt="1"
         incrementBy="1" resetAt="report"/>
      </field>
      <field name="F_TOTAL1_SEC2" source="TotalPages" visible="no"
       minWidowLines="1" spacing="0" alignment="left" templateSection="main">
        <font face="Arial" size="10"/>
        <geometryInfo x="14.76065" y="0.18448" width="4.12750"
         height="0.47625"/>
        <visualSettings lineForegroundColor="white"/>
        <pageNumbering header="yes" main="yes" trailer="yes" startAt="1"
         incrementBy="1" resetAt="report"/>
      </field>
      <frame name="M_16">
        <geometryInfo x="0.80739" y="0.30262" width="18.69312"
         height="0.62353"/>
        <advancedLayout printObjectOnPage="allPage"
         basePrintingOn="enclosingObject"/>
        <visualSettings fillForegroundColor="white" linePattern="solid"/>
        <text name="B_16" minWidowLines="1">
          <textSettings justify="center" spacing="0"/>
          <geometryInfo x="4.33028" y="0.36401" width="11.81230"
           height="0.56214"/>
          <visualSettings fillForegroundColor="white"/>
          <textSegment>
            <font face="Arial" size="12" bold="yes"/>
            <string>
            <![CDATA[RESUMO DETALHADO DE CUSTOS]]>
            </string>
          </textSegment>
        </text>
      </frame>
      <frame name="M_15">
        <geometryInfo x="0.79065" y="1.16024" width="18.70987"
         height="3.12663"/>
        <generalLayout verticalElasticity="expand"/>
        <advancedLayout printObjectOnPage="allPage"
         basePrintingOn="enclosingObject"/>
        <visualSettings fillForegroundColor="white" linePattern="solid"/>
        <frame name="M_13">
          <geometryInfo x="0.79065" y="1.16024" width="18.70987"
           height="0.92956"/>
          <generalLayout verticalElasticity="expand"/>
          <advancedLayout printObjectOnPage="allPage"
           basePrintingOn="enclosingObject"/>
          <visualSettings fillPattern="transparent"
           fillForegroundColor="white" fillBackgroundColor="gray12"
           linePattern="solid"/>
          <field name="F_titulo1" source="CF_tit" minWidowLines="1"
           spacing="0" alignment="center">
            <font face="Arial Narrow" size="10" bold="yes"/>
            <geometryInfo x="2.60418" y="1.20272" width="13.95574"
             height="0.25239"/>
            <generalLayout verticalElasticity="variable"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillPattern="transparent"
             fillForegroundColor="white" fillBackgroundColor="gray12"/>
          </field>
          <frame name="M_14">
            <geometryInfo x="2.54000" y="1.48425" width="14.07573"
             height="0.26324"/>
            <generalLayout verticalElasticity="expand"/>
            <advancedLayout formatTrigger="m_14formattrigger"/>
            <visualSettings fillPattern="transparent"
             fillForegroundColor="white" fillBackgroundColor="gray12"/>
            <field name="F_titulo2" source="CF_clo" minWidowLines="1"
             spacing="0" alignment="center">
              <font face="Arial Narrow" size="10" bold="yes"/>
              <geometryInfo x="2.60418" y="1.51154" width="13.95574"
               height="0.15875"/>
              <generalLayout verticalElasticity="variable"/>
              <advancedLayout printObjectOnPage="allPage"
               basePrintingOn="enclosingObject"
               formatTrigger="f_titulo2formattrigger"/>
              <visualSettings fillPattern="transparent"
               fillForegroundColor="white" fillBackgroundColor="gray12"/>
            </field>
          </frame>
          <frame name="M_17">
            <geometryInfo x="2.61938" y="1.78966" width="0.71438"
             height="0.03969"/>
            <advancedLayout formatTrigger="m_17formattrigger"/>
            <visualSettings fillForegroundColor="white"/>
          </frame>
          <field name="F_numero_codigo1" source="CF_NUM_COD" minWidowLines="1"
           spacing="0" alignment="center">
            <font face="Arial Narrow" size="10" bold="yes"/>
            <geometryInfo x="16.69200" y="1.37108" width="2.75177"
             height="0.48059"/>
            <generalLayout verticalElasticity="expand"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             fillBackgroundColor="gray12"/>
          </field>
          <line name="B_11" arrow="none" stretchWithFrame="M_13">
            <geometryInfo x="2.43427" y="1.16396" width="0.00000"
             height="0.92583"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             fillBackgroundColor="black" linePattern="solid"/>
            <points>
              <point x="2.43427" y="2.08979"/>
              <point x="2.43427" y="1.16396"/>
            </points>
          </line>
          <line name="B_10" arrow="none" stretchWithFrame="M_13">
            <geometryInfo x="16.63991" y="1.16024" width="0.00000"
             height="0.92583"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             fillBackgroundColor="black" linePattern="solid"/>
            <points>
              <point x="16.63991" y="2.08607"/>
              <point x="16.63991" y="1.16024"/>
            </points>
          </line>
          <field name="F_chave_principal1" source="CF_CHAVE" minWidowLines="1"
           spacing="0" alignment="center">
            <font face="Arial Narrow" size="10" bold="yes"/>
            <geometryInfo x="0.83034" y="1.37108" width="1.57417"
             height="0.48090"/>
            <generalLayout verticalElasticity="expand"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             fillBackgroundColor="gray12"/>
          </field>
        </frame>
        <frame name="M_10">
          <geometryInfo x="0.79065" y="2.08979" width="13.07362"
           height="0.56307"/>
          <visualSettings fillForegroundColor="white" linePattern="solid"/>
          <text name="B_autor1" minWidowLines="1">
            <textSettings justify="left" spacing="0"/>
            <geometryInfo x="0.91591" y="2.16390" width="1.49169"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
            <textSegment>
              <font face="Arial" size="9"/>
              <string>
              <![CDATA[Autor(es):]]>
              </string>
            </textSegment>
          </text>
          <field name="F_autor1" source="CF_AUTOR" minWidowLines="1"
           spacing="0" alignment="left">
            <font face="Arial" size="9" bold="yes"/>
            <geometryInfo x="2.54000" y="2.16390" width="11.21823"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"/>
          </field>
        </frame>
        <frame name="M_9">
          <geometryInfo x="0.79065" y="2.65286" width="6.88237"
           height="0.50292"/>
          <visualSettings fillForegroundColor="white" linePattern="solid"/>
          <text name="B_autor2" minWidowLines="1">
            <textSettings justify="left" spacing="0"/>
            <geometryInfo x="0.91591" y="2.69224" width="1.80919"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
            <textSegment>
              <font face="Arial" size="9"/>
              <string>
              <![CDATA[Nº Pág.:]]>
              </string>
            </textSegment>
          </text>
          <field name="F_nr_cores_capa2" source="CF_NUM_FOL" minWidowLines="1"
           spacing="0" alignment="start">
            <font face="Arial" size="9" bold="yes"/>
            <geometryInfo x="2.11677" y="2.71208" width="5.47594"
             height="0.37827"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"/>
          </field>
        </frame>
        <frame name="M_7">
          <geometryInfo x="0.79065" y="3.15578" width="14.58175"
           height="0.56338"/>
          <visualSettings fillForegroundColor="white" linePattern="solid"/>
          <text name="B_autor3" minWidowLines="1">
            <textSettings justify="left" spacing="0"/>
            <geometryInfo x="0.91591" y="3.22058" width="2.20607"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
            <textSegment>
              <font face="Arial" size="9"/>
              <string>
              <![CDATA[Reg. Gráfico:]]>
              </string>
            </textSegment>
          </text>
          <field name="F_nr_cores_capa3" source="CF_REG_GRA" minWidowLines="1"
           spacing="0" alignment="start">
            <font face="Arial" size="8" bold="yes"/>
            <geometryInfo x="3.17500" y="3.24104" width="11.93292"
             height="0.37827"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"/>
          </field>
        </frame>
        <text name="B_autor4" minWidowLines="1">
          <textSettings justify="left" spacing="0"/>
          <geometryInfo x="0.91591" y="3.80163" width="2.20607"
           height="0.37796"/>
          <advancedLayout printObjectOnPage="allPage"
           basePrintingOn="enclosingObject"/>
          <visualSettings fillForegroundColor="white"
           lineForegroundColor="white"/>
          <textSegment>
            <font face="Arial" size="9"/>
            <string>
            <![CDATA[Coordenação:]]>
            </string>
          </textSegment>
        </text>
        <field name="F_nr_cores_capa4" source="CF_COORDENA" minWidowLines="1"
         spacing="0" alignment="start">
          <font face="Arial" size="9" bold="yes"/>
          <geometryInfo x="3.17500" y="3.82209" width="16.11313"
           height="0.37827"/>
          <advancedLayout printObjectOnPage="allPage"
           basePrintingOn="enclosingObject"/>
          <visualSettings fillForegroundColor="white"/>
        </field>
        <frame name="M_2">
          <geometryInfo x="13.87419" y="2.08979" width="5.62632"
           height="0.56307"/>
          <visualSettings fillForegroundColor="white" linePattern="solid"/>
          <field name="F_tiragem_edicao2" source="CF_CLIENTE"
           minWidowLines="1" formatMask=" NNN NNN NNN" spacing="0"
           alignment="left">
            <font face="Arial" size="9" bold="yes"/>
            <geometryInfo x="14.47136" y="2.18839" width="4.31198"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"/>
          </field>
        </frame>
        <frame name="M_8">
          <geometryInfo x="7.67302" y="2.65286" width="11.82750"
           height="0.50260"/>
          <visualSettings fillForegroundColor="white" linePattern="solid"/>
          <text name="B_nr_cores_capa1" minWidowLines="1">
            <textSettings justify="left" spacing="0"/>
            <geometryInfo x="7.76666" y="2.73720" width="1.02226"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
            <textSegment>
              <font face="Arial" size="9"/>
              <string>
              <![CDATA[Capa:]]>
              </string>
            </textSegment>
          </text>
          <field name="F_nr_cores_capa1" source="CF_CORES" minWidowLines="1"
           spacing="0" alignment="start">
            <font face="Arial" size="9" bold="yes"/>
            <geometryInfo x="8.73590" y="2.73720" width="10.68462"
             height="0.37827"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"/>
          </field>
        </frame>
        <frame name="M_3">
          <geometryInfo x="15.37240" y="3.15640" width="4.12812"
           height="0.56245"/>
          <visualSettings fillForegroundColor="white" linePattern="solid"/>
          <text name="B_coord_editorial1" minWidowLines="1">
            <textSettings justify="left" spacing="0"/>
            <geometryInfo x="15.55719" y="3.24135" width="1.41759"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"
             lineForegroundColor="white"/>
            <textSegment>
              <font face="Arial" size="9"/>
              <string>
              <![CDATA[Tiragem:]]>
              </string>
            </textSegment>
          </text>
          <field name="F_tiragem_edicao1" source="CF_TIRAGEM"
           minWidowLines="1" formatMask=" NNN NNN NNN" spacing="0"
           alignment="left">
            <font face="Arial" size="9" bold="yes"/>
            <geometryInfo x="17.06563" y="3.24135" width="2.34900"
             height="0.37796"/>
            <advancedLayout printObjectOnPage="allPage"
             basePrintingOn="enclosingObject"/>
            <visualSettings fillForegroundColor="white"/>
          </field>
        </frame>
      </frame>
      <field name="F_1" source="CF_LOGO" minWidowLines="1" spacing="0"
       alignment="start">
        <font face="Logotipos" size="14"/>
        <geometryInfo x="0.89638" y="0.18573" width="3.95542" height="0.63438"
        />
        <advancedLayout printObjectOnPage="allPage"
         basePrintingOn="enclosingObject" formatTrigger="f_1formattrigger"/>
        <visualSettings fillForegroundColor="white"
         lineForegroundColor="white"/>
      </field>
    </margin>
  </section>
  </layout>
  <parameterForm width="10.16000" height="10.16000"/>
  <programUnits>
    <function name="beforereport">
      <textSource>
      <![CDATA[function BeforeReport return boolean is
begin


  --                                                          CG$DF0001.WN..WINDOW


SRW.DO_SQL('alter session set NLS_DATE_FORMAT=''YYYY/MM/DD HH24:MI:SS''');
  --                                                          CG$DF0001.WN..WINDOW


-- JGS20141120
-- JGS20141118

-- jgs20141118
BEGIN

    if upper(:P_Atender_Entregas) = 'N' then
        
          select nvl(tiragem_total,1) into :p_tiragem from bgo_obras where id = :P_OBA_ID;
            
    elsif upper(:P_Atender_Entregas) = 'S' then
        
        --SELECT  nvl(MAX(lge.quantidade_facturada),0) 
        SELECT  nvl(SUM(lge.quantidade - lge.quantidade_facturada),0) --Alterado Joao Repolho 2000-09-07
        INTO        :p_tiragem
        FROM        bgo_linhas_guias_entrega lge
        WHERE        oba_id_facturacao = :P_OBA_ID
        AND     lge.estado <>'N'; 

    end if;
    
exception
        when no_data_found then
        :p_tiragem := 1;
END;
 
/* jgs20150612: mail RAMARAL
- obra 20120153 - na fatura 20150464 de montante de 19781,65  (custos BG), não foram considerados 30 000  (custos da editora) oriundos do registo de subcontratação com o ID 7668168;

O tratamento da bgo_vali_pre_fatu já não é feito no POR GRUPOS. Este tipo de updates apagava os custos da editora...

-- JGS20150130: preparar acumulados bgo_vali_pre_fatu
begin
    select max(vpf.id)
    into   :P_vpf_id
    from   bgo_vali_pre_fatu vpf
    where  vpf.oba_id = :P_OBA_ID
    and    (vpf.cur_id is null or (not exists (select 1 from bgo_cabecalhos_facturas where id = vpf.cur_id)));
    
    UPDATE bgo_vali_pre_fatu
    SET    VAL_TOT_RES_DET_CUS = 0, 
           VAL_TOT_BG_RES_DET_CUS = 0, 
           VAL_TOT_EDI_RES_DET_CUS = 0
    WHERE  ID = :P_vpf_id;
    
    COMMIT;
    
exception when others then null;
end;
-- fim JGS20150130: preparar acumulados bgo_vali_pre_fatu
*/



IF :P_VPF_ID IS NOT NULL THEN   -- jgs20151006: se for por defeito por grupos, passa como parâmetro o P_VPF_ID ...

    -- PARA JÁ, TRATO SÓ O BG, PQUE PARECE QUE É O QUE DEU PROBLEMAS.
    -- NÃO SABEMOS SE É PARA TRATAR EDITORA. QUANDO APARECER O PRIMEIRO CASO, ANALISAMOS.

    UPDATE bgo_vali_pre_fatu
    SET    VAL_TOT_RES_DET_CUS = VAL_TOT_RES_DET_CUS - VAL_TOT_BG_RES_DET_CUS, 
           VAL_TOT_BG_RES_DET_CUS = 0 
           -- VAL_TOT_EDI_RES_DET_CUS = 0
    WHERE  ID = :P_vpf_id;

END IF;



SELECT arf_ses_seq.NEXTVAL INTO :P_SES_ID_EXT FROM DUAL;  -- um id diferente, para poder controlar melhor...

-- JGS20141030
SELECT arf_ses_seq.NEXTVAL INTO :P_SES_ID FROM DUAL;

-- JGS20141119
SELECT arf_ses_seq.NEXTVAL INTO :P_SES_ID_SUBC_ENCAD FROM DUAL; -- para poder controlar os registos de subcontratação internos...

-- jgs20150312 custos da editora Ticket#2015021210000552
SELECT arf_ses_seq.NEXTVAL INTO :P_SES_ID_CUS_PE FROM DUAL; -- para poder controlar os registos de subcontratação internos...


UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> ANTES DE UC$TRATA_OPER_DISCR', null, null);


UC$TRATA_OPER_DISCR;

UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> DEPOIS DE UC$TRATA_OPER_DISCR', null, null);

ACAB_SUB;

UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> DEPOIS DE ACAB_SUB', null, null);

SELECT  TO_NUMBER(PAR.VALOR_BG) INTO :P_ANO_GERA_CUS FROM BGO_PARAMETROS PAR WHERE PAR.DESCRICAO = 'ano_geracao_custos';


       ACAB_EXT(:P_OBA_ID,
                :P_ANO_GERA_CUS,
                'S',                   -- P_GFO            IN VARCHAR2,
                :P_id,                  -- P_ID             IN NUMBER,  -- PARA TESTES 109380, OBRA P_OBA_ID = 106392
                null,                  -- não é utilizado... P_IGC_ID         IN NUMBER, 
                'N');                  -- P_INDICATIVO     IN VARCHAR2, -- Ivo Oliveira 16/05/2006 - Indica que é para gerar o valor como indicativo não conta para facturar



-- FIM JGS20141120

uc$custos_pe; -- jgs20150318

return(TRUE);


end;]]>
      </textSource>
    </function>
    <function name="g_detailgroupfilter">
      <textSource>
      <![CDATA[function G_DetailGroupFilter return boolean is
	v_custos_fixos	BGO_RESUMO_CUSTOS_V.tipo_movimento_aux%TYPE;
	v_temp					number(9);
begin
	
  /* Se a obra tiver Custos Fixos e Custos Variáveis devem ser mostrados os Tipos_Movimentos_Aux: '1S' e '3X' 
     Caso contrário deve ser mostrado o '2N' (Ver descrição no Designer - FAO0090R )*/
     
				/* Em termos funcionais uma obra possui tto Custos Fixos como Custo Variáveis qdo a Tiragem da Edição é
					 superior à Tiragem. Isto pode ser facilmente detectado pelo valor do campo 'Tiragem_Edicao' */
	  
	 if :tiragem_edicao is null and (:tipo_mov_aux = '1S' or :tipo_mov_aux = '3X')then 
	 	return (FALSE);
	 end if;
	   
	  if (:tiragem <> :tiragem_edicao) and :tipo_mov_aux = '2N' then
	  	return (FALSE);
	  end if;
	  
  
  /* Os restantes tipo_movimento_aux devem ser mostrado em todas as situações */


/*  */

	if :tipo_mov_aux = '7C' then -- Ivo Oliveira 24/05/2006
		-- Surgiu uma obra que para o gfo do valor unitário, não tinha nenhum valor em bgo_valores_facturacao
	  SELECT	   count(1)
		into 			 v_temp
		FROM       BGO_RESUMO_ARTIGOS_GF_TEMP tmp,
						   BGO_VALO_FACT_INDI val_ind
		WHERE      tmp.Id = :P_Id	
		AND		     val_ind.gfo_id = tmp.gfo_id
		and				 tmp.gfo_id = :gfo_id_detail
		and				 val_ind.gfo_id = :gfo_id_detail;
		
		If nvl(v_temp,0)>0 then
			return(TRUE);
		Else
			return (FALSE);
		End if;
	Else
		begin
		  	
			SELECT	   tmp.gfo_id gfo_id
			into 			 v_temp
			FROM       BGO_RESUMO_ARTIGOS_GF_TEMP tmp,
							   BGO_VALORES_FACTURACAO vfa
			WHERE      tmp.Id = :P_Id	
			AND		     vfa.gfo_id = tmp.gfo_id
			and				 tmp.gfo_id = :gfo_id_detail
			and				 vfa.gfo_id = :gfo_id_detail;
			
			return(TRUE);
			
		exception
				when no_data_found then
						return (FALSE);
				when too_many_rows then
						return(TRUE);
		end ;	
  	  
	End if;

	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="tiragem">
      <textSource>
      <![CDATA[FUNCTION Tiragem (p_Oba_Id Number) RETURN Number IS
	v_qtd_facturada bgo_linhas_guias_entrega.quantidade_facturada%TYPE;
BEGIN

	if upper(:P_Atender_Entregas) = 'N' then

			SELECT MIN (x.total_entrega)
			INTO	 v_qtd_facturada
			FROM (SELECT  pre.gfo_id,
									  (NVL(pre.tiragem,0)) total_entrega
						FROM	BGO_PARTES pre
						WHERE	pre.oba_id = P_Oba_Id
						AND 	pre.codigo_nivel2 ='00'
						AND 	pre.codigo_nivel3 ='00'
						AND		nvl(pre.tiragem,0) <> 0
						-- Ivo Oliveira 23/09/2002
						--AND		pre.gfo_id = :gfo_id_detail  -- Condição de no caso de se ter que procurar o mínimo por Grupo de Facturação
						AND		pre.gfo_id = :gfo_id
						-- Ivo Fim
						AND		EXISTS (SELECT  1
   			    							FROM	BGO_RESUMO_ARTIGOS_GF_TEMP tmp
   												WHERE	tmp.oba_id = P_Oba_Id
   												AND		tmp.Id = :P_Id
   												AND     tmp.gfo_id = pre.gfo_id)) X;
   												
	elsif upper(:P_Atender_Entregas) = 'S' then

	
		SELECT MIN (X.tiragem)
		INTO	 v_qtd_facturada
		FROM (SELECT pre.gfo_id,
							   NVL(SUM(lge.quantidade - lge.quantidade_facturada),0) tiragem --Alterado Joao Repolho 2000-09-06
		  		FROM	 BGO_LINHAS_GUIAS_ENTREGA lge,
				  			 BGO_CABECALHOS_GUIAS cga,
				  			 BGO_PARTES pre
		  		WHERE	  oba_id_facturacao = p_Oba_Id
		  		AND		pre.id = lge.pre_id_facturacao
		  		AND		cga.id = lge.cga_id
		  		AND   lge.estado <>'N' --Acrescentado em 23/11/2000 Teresa Coutinho
		  		AND   cga.estado <>'N' --Acrescentado em 23/11/2000 Teresa Coutinho
		  		AND		cga.tipo_guia IN ('R','S')
		  		-- Ivo Oliveira 23/09/2002
		  		--AND		pre.gfo_id = :gfo_id_detail  -- Condição de no caso de se ter que procurar o mínimo por Grupo de Facturação
		  		AND		pre.gfo_id = :gfo_id
		  		-- Ivo Fim
		  		AND		EXISTS (SELECT  1
												FROM	BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		 										WHERE	tmp.oba_id = P_Oba_Id
		 										AND		tmp.Id = :P_Id
		 										AND     tmp.gfo_id = pre.gfo_id)
		 			GROUP BY pre.gfo_id ) X;
		 							
	end if;
	  
	return (v_qtd_facturada);
	
exception
		when no_data_found then
			return (-1);
END;]]>
      </textSource>
    </function>
    <function name="subtotal">
      <textSource>
      <![CDATA[FUNCTION Subtotal (p_Oba_Id Number, p_tipo_movimento Varchar2, p_gfo_id Number)RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_3X     		Number(16,5):=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;
	v_tiragem					Number(16):= Tiragem(p_Oba_Id);	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if :tiragem_edicao is null then

		SELECT  SUM(Subtotal.valor) 	   Valor,
	  	 			SUM(Subtotal.valor_eur) Valor_eur
		INTO		v_valor,
						v_valor_eur
		FROM (SELECT 	SUM(afg1.valor)    	valor,
	 			 					SUM(afg1.valor_eur) valor_eur
				  FROM   BGO_ANALISE_FACTURACAO_GF_V afg1
		  		WHERE  afg1.oba_id = p_Oba_Id
	  			AND	   afg1.tipo_movimento_aux BETWEEN '2N' AND p_tipo_movimento
	  			AND	   p_tipo_movimento >= afg1.tipo_movimento_aux
					AND	 	 afg1.tipo_movimento_aux NOT IN ('3X','7B')
					and		 afg1.gfo_id = p_gfo_id
					AND		 EXISTS (SELECT 1
												 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				 WHERE	tmp.oba_id = :P_Oba_Id
								 				 AND		tmp.Id = :P_Id
								 				 AND    tmp.gfo_id = afg1.gfo_id)					
	  			UNION all
	  			SELECT SUM(afg2.valor)     * v_tiragem 	  valor,
	  					 	 SUM(afg2.valor_eur) * v_tiragem valor_eur
	  			FROM   BGO_ANALISE_FACTURACAO_GF_V afg2
	  			WHERE  afg2.oba_id = p_Oba_Id
	  			AND	 	 afg2.tipo_movimento_aux = '7B' 					/* Acabamentos Adicionar */
	  			AND	   p_tipo_movimento >= afg2.tipo_movimento_aux
	  			and		 afg2.gfo_id = p_gfo_id
	  			AND		 EXISTS (SELECT 1
												 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				 WHERE	tmp.oba_id = :P_Oba_Id
								 				 AND		tmp.Id = :P_Id
								 				 AND   tmp.gfo_id = afg2.gfo_id)
	 			)Subtotal;
	 		
	else

			SELECT  SUM(Subtotal.valor) 	   Valor,
	   					SUM(Subtotal.valor_eur) Valor_eur
			INTO		v_valor,
							v_valor_eur
			FROM (SELECT 	SUM(afg1.valor)    	valor,
	 		 							SUM(afg1.valor_eur) valor_eur
			  		FROM   BGO_ANALISE_FACTURACAO_GF_V afg1
	  				WHERE  afg1.oba_id = p_Oba_Id
	  				AND	   afg1.tipo_movimento_aux BETWEEN '4A' AND p_tipo_movimento
	  				AND	   p_tipo_movimento >= afg1.tipo_movimento_aux
						AND	   afg1.tipo_movimento_aux NOT IN ('7B')
						and		 afg1.gfo_id = p_gfo_id
						AND		 EXISTS (SELECT 1
													 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 				 WHERE	tmp.oba_id = :P_Oba_Id
									 				 AND		tmp.Id = :P_Id
									 				 AND    tmp.gfo_id = afg1.gfo_id)
	  				UNION all
	  				SELECT SUM(afg2.valor) 			* v_tiragem 	  valor,
	  							 SUM(afg2.valor_eur)	* v_tiragem valor_eur
	  				FROM   BGO_ANALISE_FACTURACAO_GF_V afg2
	  				WHERE  afg2.oba_id = p_Oba_Id
	  				AND	 	 afg2.tipo_movimento_aux = '7B' 					/* Acabamentos Adicionar */
	  				AND	   p_tipo_movimento >= afg2.tipo_movimento_aux 
	  				and		 afg2.gfo_id = p_gfo_id
	  				AND		 EXISTS (SELECT 1
													 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 				 WHERE	tmp.oba_id = :P_Oba_Id
									 				 AND		tmp.Id = :P_Id
								 					 AND   tmp.gfo_id = afg2.gfo_id)	  				
	 				)Subtotal;
	
		if p_tipo_movimento >= '3X' then
			v_valor_3X := Subtotal_3X (p_oba_id, p_gfo_id);
		end if;
	
	end if; /*:Tiragem_Edicao */
	
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := v_valor_eur;
	end if;

		
  return (nvl(v_valor,0) + nvl(v_valor_3X,0));
  
END;]]>
      </textSource>
    </function>
    <function name="subtotal_1s">
      <textSource>
      <![CDATA[FUNCTION Subtotal_1S (p_Oba_Id Number, p_gfo_id Number)RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
  SELECT SUM(afg.valor),
	 			 SUM(afg.valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM   BGO_ANALISE_FACTURACAO_GF_V afg
	WHERE  afg.oba_id = P_Oba_Id
	AND	   afg.tipo_movimento_aux = '1S'
	AND		 afg.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = afg.gfo_id);
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := v_valor_eur;
	end if;
	
	return (nvl(v_valor,0));
END;]]>
      </textSource>
    </function>
    <function name="subtotal_3x">
      <textSource>
      <![CDATA[FUNCTION Subtotal_3X (p_Oba_Id Number, p_Gfo_Id Number) RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
  SELECT SUM(afg.valor),
	 			 SUM(afg.valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM   BGO_ANALISE_FACTURACAO_GF_V afg
	WHERE  afg.oba_id = P_Oba_Id
	AND	   afg.tipo_movimento_aux = '3X'
	AND		 afg.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = afg.gfo_id);
		
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := nvl(v_valor_eur,0);
	end if;
	
	--return (Subtotal_1S(p_Oba_id, p_gfo_id) * (:tiragem_TOTAL / nvl(:tiragem_edicao,:tiragem_TOTAL)) + v_valor);  --Está a dividir pelo NVL da :tiragem_edicao porque esta pode ser nula
	return (Subtotal_2A(p_Oba_id, p_gfo_id) * (:tiragem_TOTAL / nvl(:tiragem_edicao,:tiragem_TOTAL)) + v_valor);  --Está a dividir pelo NVL da :tiragem_edicao porque esta pode ser nula
END;]]>
      </textSource>
    </function>
    <function name="f_3formattrigger">
      <textSource>
      <![CDATA[function F_3FormatTrigger return boolean is
		v_arf_reg bgo_auxi_repo_fatu%rowtype;
begin 

    -- jgs20141030
    begin

                  select *
                  into   v_arf_reg
                  from   bgo_auxi_repo_fatu
                  where  seq_id                 = :p_ses_id
                  and    tip_reg                = 'BG'
                  and    c1                     = 'ACUMULADO'
                  and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
                  and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
                  and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
                  and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
                  and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
                  and    nvl(unidade,'#')       = nvl(:unidade,'#')
                  and    n1                     = :gfo_id;

    exception when others then v_arf_reg.tempo := 0;
    end;
    -- fim jgs20141030



	IF upper(:tipo_mov_aux)='7C' THEN -- Ivo Oliveira 24/05/2006 (7C)
		Return(False);
	Else	
		if :CS_tempo is not null then
	  	SRW.set_field_char (0, FLOOR((:CS_tempo/*jgs20141030*/- nvl(v_arf_reg.tempo,0))/60) || ':' || to_char(MOD((:cs_tempo/*jgs20141030*/- nvl(v_arf_reg.tempo,0)),60),'00'));
		else
			SRW.set_field_char (0, ' ');
		end if;
		
	  return (TRUE);
	End if;
end;]]>
      </textSource>
    </function>
    <function name="f_4formattrigger">
      <textSource>
      <![CDATA[function F_4FormatTrigger return boolean is
  
  
   V_QTD_FACTURADA number;--VARCHAR2(400);
   	v_teste varchar2(400);
		v_teste1 number;
		v_teste2 number;
 
v_data_euro				bgo_parametros.valor_bg%TYPE;

   v_arf_reg bgo_auxi_repo_fatu%rowtype;

begin	
	IF upper(:tipo_mov_aux)='7C' THEN -- Ivo Oliveira 24/05/2006 (7C)
		Return(False);
	Else	
		SELECT	valor_BG
		INTO		v_data_euro
		FROM 		BGO_PARAMETROS
		WHERE 	descricao = 'data_transicao';
		
		
		IF :TIPO_MOV_AUX <> '7B' THEN
			
			
			
			  -- jgs20141127
        begin

          select *
          into   v_arf_reg
          from   bgo_auxi_repo_fatu
          where  seq_id                 = :p_ses_id
          AND    TIP_REG                = 'BG'
          and    c1                     = 'ACUMULADO'
          and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
          and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
          and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
          and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
          and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
          and    nvl(unidade,'#')       = nvl(:unidade,'#')
          and    n1                     = :gfo_id; -- para o GF

        exception when others then v_arf_reg.quantidade := 0;
        end;
			  -- jgs20141127
			
			
			
				if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			 			V_TESTE := TO_CHAR(:CS_quantidade /*jgs20141030*/ -nvl(v_arf_reg.quantidade,0) ,'999,999,990.00');
			 			-- JGS20170331 V_TESTE := TO_CHAR(:CS_quantidade /*jgs20141030*/ -nvl(v_arf_reg.quantidade,0) ,'999,999,990');
			 			V_TESTE := REPLACE(V_TESTE,',',' ');
			 			V_TESTE := REPLACE(V_TESTE,'.',',');
			 			--V_TESTE := REPLACE(V_TESTE,',00','');
				ELSE
						V_TESTE := TO_CHAR(:CS_quantidade /*jgs20141030*/ -nvl(v_arf_reg.quantidade,0),'999G999G990D99');
						V_TESTE := REPLACE(V_TESTE,'.00','');
					  V_TESTE := REPLACE(V_TESTE,',00','');
			 	  	V_TESTE := REPLACE(V_TESTE,'.',' ');
			 
				end if;
					
				--Alterado Por Rui Losa Faria em 2002-08-22
		 		SRW.set_field_char (0, V_TESTE);	
	    -- 	SRW.set_field_char (0, V_TESTE || ' ' || :unidade);  	
			
			    
	  --  SRW.set_field_char (0, :Cs_quantidade || ' ' || :unidade);
		
		ELSIF :P_ATENDER_ENTREGAS = 'N' AND :TIPO_MOV_AUX = '7B' THEN     
		   
		   v_qtd_facturada := tiragem(:p_oba_id);
		   	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			 			-- V_TESTE := TO_CHAR(tiragem(:p_oba_id),'999G999G990D99');
			 			V_TESTE := TO_CHAR(tiragem(:p_oba_id),'999G999G990');
				ELSE
						V_TESTE := TO_CHAR(tiragem(:p_oba_id),'999G999G990D90');
						V_TESTE := REPLACE(V_TESTE,'.00','');
					  V_TESTE := REPLACE(V_TESTE,',00','');
			 	  	V_TESTE := REPLACE(V_TESTE,'.',' ');
	
						
			 	end if;
			--	V_TESTE := TO_CHAR(tiragem(:p_oba_id),'999G999G990D90');
		
		   --Alterado Por Rui Losa Faria em 2002-08-22
		    SRW.set_field_char (0, V_TESTE);
	     --	SRW.set_field_char (0, V_TESTE || ' ' || :unidade);  		
			
		ELSIF :P_ATENDER_ENTREGAS = 'S' AND :TIPO_MOV_AUX = '7B' THEN
	
			SELECT  nvl(SUM(lge.quantidade),0) --Alterado Joao Repolho 2000-09-07
			INTO		v_qtd_facturada
			FROM		bgo_linhas_guias_entrega lge
			,	      bgo_partes pre
			WHERE		oba_id_facturacao = :p_Oba_Id
			and     lge.estado != 'N'
			and     pre.id = lge.pre_id_facturacao
			and	    pre.gfo_id = :gfo_id;
	    
	    	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			 			-- V_TESTE := TO_CHAR(v_qtd_facturada,'999G999G990D99');
			 			V_TESTE := TO_CHAR(v_qtd_facturada,'999G999G990');
				ELSE
						V_TESTE := TO_CHAR(v_qtd_facturada,'999G999G990D90');
						V_TESTE := REPLACE(V_TESTE,'.00','');
					  V_TESTE := REPLACE(V_TESTE,',00','');
			 	  	V_TESTE := REPLACE(V_TESTE,'.',' ');
	
			 	end if;
	    
	    --	V_TESTE := TO_CHAR(v_qtd_facturada,'999G999G990D90');
			 --	V_TESTE := REPLACE(V_TESTE,',',' ');
	    
	    --Alterado Por Rui Losa Faria em 2002-08-22
		    SRW.set_field_char (0, V_TESTE);
	     --	SRW.set_field_char (0, V_TESTE || ' ' || :unidade);  		
	    
	    
	    
		--	 SRW.set_field_char (0, V_QTD_FACTURADA || ' ' || :unidade);
			 
		END IF;
	  
	  return (TRUE);
	End if;
end;]]>
      </textSource>
    </function>
    <function name="f_5formattrigger">
      <textSource>
      <![CDATA[function F_5FormatTrigger return boolean is
  dummy number(1);
begin
 if :tipo_mov_aux = '1S' then
		begin -- Verificar se existe Obras associadas Ivo Oliveira 13/05/2003
	 	   SELECT 1
			 INTO dummy
			 FROM BGO_ANALISE_FACTURACAO_GF_V afg
			 WHERE  afg.oba_id = :p_Oba_Id
			 AND	  afg.tipo_movimento_aux='2A'
			 and		afg.gfo_id = :gfo_id
			 AND		EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = afg.gfo_id)
			 AND ROWNUM=1;
		exception when others then
			 dummy:=0;
		end;
			
		If dummy=0 then
  		SRW.set_field_char (0, 'Total dos custos fixos');
  		VARS.V_1S := TRUE; -- PARA IMPRIMIR A LINHA DE CUSTOS FIXOS  X/X * CUSTOS FIXOS  IOL 13/05/2003
		else
			-- SRW.set_field_char (0, 'Sub-total');
			SRW.set_field_char (0, 'Sutotal');
		end if;
		
 elsif :tipo_mov_aux = '2A' then
	 SRW.set_field_char (0, 'Total dos custos fixos');
	 VARS.V_1S := TRUE; -- PARA IMPRIMIR A LINHA DE CUSTOS FIXOS  X/X * CUSTOS FIXOS  IOL 13/05/2003	 
 else
  	--SRW.set_field_char (0, 'Sub-total');
  	SRW.set_field_char (0, 'Subtotal');
 end if;
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_total1formattrigger">
      <textSource>
      <![CDATA[function F_CS_total1FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_total 					Number (20,2):=0;
	v_max_tipo_mov		BGO_RESUMO_CUSTOS_V.tipo_movimento_aux%TYPE;
	
	V_TOTAL2           NUMBER := 0; -- JGS20150130
	
begin
	
	/* EURO */
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		--SRW.SET_FORMAT_MASK('999 999 999D99');
			SRW.SET_FORMAT_MASK('999 999 990D09" "');
	end if;
	
/*	SELECT MAX(tipo_movimento_aux)
	into	 v_max_tipo_mov		
	FROM   BGO_ANALISE_FACTURACAO_V /*BGO_ANALISES_FACTURACAO_V*/
/*	WHERE  oba_id = :P_Oba_Id;*/
	
--	v_total := Subtotal_RND (:P_Oba_Id, v_max_tipo_mov, :gfo_id);

	-- jgs20140227: Ticket#2012092610000662
	/*
		É necessário implementar as seguintes alterações no SIBG:
		Análise de Valores de Faturação e Resumo de Custos: alterar o
		cálculo do custo unitário, passando o divisor a ser as entregas ou a tiragem
		consoante aquelas sejam ou não consideradas;	
  */

	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'f_cs_total1 :TIRAGEM = '||to_char(nvl(TIRAGEM(:OBA_ID),-1)), null, null);

	-- deixo original no exception

  begin

			IF :TIRAGEM_EDICAO IS NULL THEN -- IVO OLIVEIRA 21/05/2003
				V_TOTAL2 :=  nvl(:CS_VALOR_2,0);
		  	SRW.set_field_num (0, nvl(:CS_VALOR_2,0));
			ELSE
				IF EXISTE_MOV_SUP('2A',:gfo_id)='N' THEN -- Se não existir movimentos a seguir aos custos fixos é necessário fazer o cálculo dos c.f. caso contrário o cálculo já está incluido no valor
          V_TOTAL2 :=  nvl(:CS_VALOR_2,0)* (TIRAGEM(:OBA_ID) / nvl(:tiragem_edicao,TIRAGEM(:OBA_ID)));
					SRW.set_field_num (0, (nvl(:CS_VALOR_2,0)* (TIRAGEM(:OBA_ID) / nvl(:tiragem_edicao,TIRAGEM(:OBA_ID)))));
				ELSE
					V_TOTAL2 := nvl(:CS_VALOR_2,0);
					SRW.set_field_num (0, nvl(:CS_VALOR_2,0));
				END IF;
			END IF;

	exception when others then

			IF :TIRAGEM_EDICAO IS NULL THEN -- IVO OLIVEIRA 21/05/2003
				V_TOTAL2 := nvl(:CS_VALOR_2,0);
		  	SRW.set_field_num (0, nvl(:CS_VALOR_2,0));
			ELSE
				IF EXISTE_MOV_SUP('2A',:gfo_id)='N' THEN -- Se não existir movimentos a seguir aos custos fixos é necessário fazer o cálculo dos c.f. caso contrário o cálculo já está incluido no valor
					V_TOTAL2 := nvl(:CS_VALOR_2,0)* (:tiragem_total / nvl(:tiragem_edicao,:tiragem_total));
					SRW.set_field_num (0, (nvl(:CS_VALOR_2,0)* (:tiragem_total / nvl(:tiragem_edicao,:tiragem_total))));
				ELSE
					V_TOTAL2 := nvl(:CS_VALOR_2,0);
					SRW.set_field_num (0, nvl(:CS_VALOR_2,0));
				END IF;
			END IF;

	end;

/* jgs20150612: mail RAMARAL
- obra 20120153 - na fatura 20150464 de montante de 19781,65  (custos BG), não foram considerados 30 000  (custos da editora) oriundos do registo de subcontratação com o ID 7668168;

O tratamento da bgo_vali_pre_fatu já não é feito no POR GRUPOS. Este tipo de updates apagava os custos da editora...

  -- JGS20140125
*/  
  
IF :P_VPF_ID IS NOT NULL THEN   -- jgs20151006: se for por defeito por grupos, passa como parâmetro o P_VPF_ID ...
  
  UPDATE BGO_VALI_PRE_FATU
  SET    VAL_TOT_RES_DET_CUS    = VAL_TOT_RES_DET_CUS + V_TOTAL2, 
         VAL_TOT_BG_RES_DET_CUS = VAL_TOT_BG_RES_DET_CUS + V_TOTAL2,
         obs_aux                = substr('FAO0087R-FCSTOTAL1'||chr(10)||obs_aux,1,3000)
  WHERE  ID = :P_VPF_ID;

  COMMIT;

END IF;
  -- FIM JGS20140125
/* */
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_acabamento1formattrigger">
      <textSource>
      <![CDATA[function F_Acabamento1FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						Number(10,5):=0;
	v_valor_eur				Number(10,5):=0;
begin	
	if upper(:tipo_mov_aux) = '7B' then

		SELECT	valor_BG
		INTO		v_data_euro
		FROM 		BGO_PARAMETROS
		WHERE 	descricao = 'data_transicao';
		
		
		SELECT SUM(afg.valor), 
		   		 SUM(afg.valor_eur)
		into	 v_valor,
					 v_valor_eur
		FROM	 BGO_ANALISE_FACTURACAO_GF_V afg
		WHERE	 afg.oba_id = :P_Oba_Id
		AND		 afg.tipo_movimento_aux = '7B'
		AND		 afg.gfo_id = :gfo_id
		AND		 EXISTS (SELECT 1
									 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 WHERE	tmp.oba_id = :P_Oba_Id
									 AND		tmp.Id = :P_Id
									 AND    tmp.gfo_id = afg.gfo_id);
	
	  --if upper(:tipo_mov_aux) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
	  if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
	  	SRW.set_field_char(0, to_char(v_valor_eur, '999990D09999') || ' /Ex.');
	  	return (TRUE);
	  	
	  --elsif upper(:tipo_mov_aux) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') < v_data_euro) then
	  elsif (to_char(sysdate, 'YYYY-MM-DD') < v_data_euro) then
	  	SRW.set_field_char(0, to_char(v_valor, '99999990L99') || '/Ex.');
	  	return (TRUE);
	
	  else    
	  	return (FALSE);
	  end if;
	Elsif upper(:tipo_mov_aux) = '7C' then -- Ivo Oliveira 24/05/2006 (7C)
		SELECT SUM(val_ind.val)
		into	 v_valor_eur
		FROM	 bgo_valo_fact_indi val_ind
		,			 bgo_indices_geracao_custos igc
		WHERE	 igc.id=val_ind.igc_id
		and 	 igc.estado='A'
		and 	 val_ind.oba_id_ref = :P_Oba_Id
		AND		 val_ind.gfo_id = :gfo_id
		AND		 val_ind.tip_mov = 'B'
		AND		 EXISTS (SELECT 1
									 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 WHERE	tmp.oba_id = :P_Oba_Id
									 AND		tmp.Id = :P_Id
									 AND    tmp.gfo_id = val_ind.gfo_id);

  	SRW.set_field_char(0, to_char(v_valor_eur, '999990D09999') || ' /Ex.');
				
		return (TRUE);
	else    
		return (FALSE);
	end if;  
exception 
	when no_data_found then
		SRW.set_field_char(0, to_char(round(v_valor,3), '99999990L09') || '/Ex.');
		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail1formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail1FormatTrigger return boolean is
	
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
	v_valor 		Number(10,5):=0;
	v_valor_eur Number(10,5):=0;
	
	v_arf_reg   bgo_auxi_repo_fatu%rowtype;
	
begin
	IF upper(:tipo_mov_aux)='7C' THEN -- Ivo Oliveira 24/05/2006 (7C)
		Return(False);
	Else	
		SELECT	valor_BG
		INTO		v_data_euro
		FROM 		BGO_PARAMETROS
		WHERE 	descricao = 'data_transicao';
		
		SELECT SUM(afg.valor), 
				   SUM(afg.valor_eur)
		into	 v_valor,
					 v_valor_eur	   
		FROM	 BGO_ANALISE_FACTURACAO_GF_V afg
		WHERE	 afg.oba_id = :P_Oba_Id
		AND		 afg.tipo_movimento_aux = '7B'
		AND		 afg.gfo_id = :gfo_id_detail
		AND		 EXISTS (SELECT 1
									 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 WHERE	tmp.oba_id = :P_Oba_Id
									 AND		tmp.Id = :P_Id
									 AND    tmp.gfo_id = afg.gfo_id);
	
    --
            -- jgs20141030
      begin

        select *
        into   v_arf_reg
        from   bgo_auxi_repo_fatu
        where  seq_id                 = :p_ses_id
        AND    tip_reg                = 'BG'
        and    c1                     = 'ACUMULADO'
        and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
        and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
        and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
        and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
        and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
        and    nvl(unidade,'#')       = nvl(:unidade,'#')
        and    n1                     = :gfo_id;

      exception when others then v_arf_reg.valor_eur := 0;
      end;
            
            
       -- fim jgs20141030
            

		if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro then
		--	SRW.SET_FORMAT_MASK('999 999 990D09');
				SRW.SET_FORMAT_MASK('999 999 990D09" "');
			SRW.set_field_num (0, :CS_valor_eur_detail /*jgs20141030*/ - nvl(v_arf_reg.valor_eur,0));
		end if;		
			
	  if upper(:tipo_mov_aux) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
	  	SRW.set_field_num (0, nvl(v_valor_eur,1) * Tiragem(:P_Oba_Id));  	
	  elsif upper(:tipo_mov_aux) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') < v_data_euro) then
	  	SRW.set_field_num (0, nvl(v_valor,1) * Tiragem(:P_Oba_Id));
	  end if;
	  
		return (TRUE);
	End if;
end;]]>
      </textSource>
    </function>
    <function name="f_cs_subtotal1formattrigger">
      <textSource>
      <![CDATA[function F_CS_subtotal1FormatTrigger return boolean is
v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						Number(16,5):=0;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		--SRW.SET_FORMAT_MASK('999 999 990D09');
			SRW.SET_FORMAT_MASK('999 999 990D09" "');
	end if;	
	
	if :tipo_mov_aux = '1S' then		
		v_valor := Subtotal_1S_RND (:P_Oba_Id, :gfo_id);

	elsif :tipo_mov_aux = '2A' then
		v_valor := Subtotal_2A_RND (:P_Oba_Id, :gfo_id);		
		
	elsif :tipo_mov_aux = '3X' then
		v_valor := Subtotal_3X_RND (:P_Oba_Id, :gfo_id);		
		
	else
	--	SRW.MESSAGE(:P_Oba_Id,1);
	--	SRW.MESSAGE(:tipo_mov_aux,1);
	--	SRW.MESSAGE(:gfo_id_detail,1);

		v_valor := Subtotal_RND(:P_Oba_Id, :tipo_mov_aux, :gfo_id);
		
  end if;
	
	SRW.set_field_num (0, v_valor);
	
  return (TRUE);
  
Exception
	when others then
		SRW.set_field_num (0, -1);
		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="r_g_descricao_detail1formattri">
      <textSource>
      <![CDATA[function R_G_descricao_Detail1FormatTri return boolean is

    v_arf_reg  bgo_auxi_repo_fatu%rowtype;
 
begin
	-- IVO OLIVEIRA 2/05/2002 - quando a tiragem_edicao está preenchida tem que ser 
	--													 sempre maior que a tiragem (Engº Furtado - 30/4/2002),
	--												   no entanto isso não se verificava

  --if :tipo_mov_aux = '2N' and :tiragem <> :tiragem_edicao then

  	if :tipo_mov_aux = '2N' and :tiragem_edicao is not null then
  		return (FALSE);
  	end if;

  	
  	  begin
          select *
          into   v_arf_reg
          from   bgo_auxi_repo_fatu
          where  seq_id                 = :p_ses_id
          AND    TIP_REG                = 'BG'
          and    c1                     = 'ACUMULADO'
          and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
          and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
          and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
          and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
          and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
          and    nvl(unidade,'#')       = nvl(:unidade,'#')
          and    n1                     = :gfo_id;
  	  exception when others then null;
  	  end;
          


--    UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', ':::::::R_G_descricao_Detail4 v_arf_reg.QUANTIDADE = '||TO_CHAR(NVL(v_arf_reg.QUANTIDADE,-1))||', '||TO_CHAR(NVL(v_arf_reg.TEMPO,-1))||', '||TO_CHAR(NVL(v_arf_reg.VALOR_EUR,-1)), null, null);
--    UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', ':::::::R_G_descricao_Detail4 xxxxxxxxx.QUANTIDADE = '||TO_CHAR(NVL(:quantidade,-1))||', '||TO_CHAR(NVL(:tempo,-1))||', '||TO_CHAR(NVL(:valor_eur_detail,-1)), null, null);
          
          
          if  nvl(v_arf_reg.QUANTIDADE,0) = nvl(:cs_quantidade,0)
          and nvl(v_arf_reg.TEMPO,0)      = nvl(:cs_tempo,0)
        and nvl(v_arf_reg.VALOR_EUR,0)  = nvl(:cs_valor_eur_detail,0)
        then
        
            -- só para testar cálculos... return false;
            return false;
            --return true;
        
          else
              
              return true;
              
          end if;
  	
  	
  	
/*
  	
  	if :tipo_mov_aux = '2N' and :tiragem_edicao is not null then
  		return (FALSE);
  	end if;
  	
    return (TRUE);
*/
end;]]>
      </textSource>
    </function>
    <function name="f_aux_valor1formattrigger">
      <textSource>
      <![CDATA[function F_Aux_valor1FormatTrigger return boolean is
	v_custos_fixos 		 Number (10,3) :=0;
	v_custos_fixos_eur Number (10,3) :=0;
	v_data_euro				 bgo_parametros.valor_bg%TYPE;
begin
		
  /*if :tipo_mov_aux <> '3X' then  -- Ivo Oliveira 21/05/2003
  	return (FALSE);
  end if;*/
	
	/*SELECT SUM (afg.valor),
				 SUM (afg.valor_eur)		   
	INTO	 v_custos_fixos,
				 v_custos_fixos_eur
	FROM	 BGO_ANALISE_FACTURACAO_GF_V afg
	WHERE	 afg.oba_id = :P_Oba_Id
	AND	   UPPER(afg.tipo_movimento_aux) IN ('1S','2A')
	and		 afg.gfo_id = :gfo_id
	and		 exists (select 1
								 from		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 where	tmp.oba_id = :P_Oba_Id
								 and		tmp.Id = :P_Id
								 and    tmp.gfo_id = afg.gfo_id);

	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';

	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro then*/
		SRW.SET_FORMAT_MASK('999 999 990D09" "');
		/*v_custos_fixos := v_custos_fixos_eur;
	end if;*/

	-- Ivo Oliveira 13/05/2003
	v_custos_fixos := Subtotal_2A_RND(:P_Oba_Id,:gfo_id);
	
  SRW.set_field_num (0, (:Tiragem_TOTAL / :tiragem_edicao) * v_custos_fixos);
  
  VARS.V_1S := FALSE;
  
  return (TRUE);
  
exception
		when others then
			SRW.set_field_num (0, (:Tiragem_TOTAL / :tiragem_edicao) * v_custos_fixos);
end;]]>
      </textSource>
    </function>
    <function name="f_aux1formattrigger">
      <textSource>
      <![CDATA[function F_Aux1FormatTrigger return boolean is
begin
	
  --if :tipo_mov_aux = '3X' then  -- Ivo Oliveira 21/05/2003
  	SRW.set_field_char (0, to_char(:tiragem_TOTAL) || '/' || to_char(:tiragem_edicao) || ' X CUSTOS FIXOS');
  	return (TRUE);
  /*else
  	return (FALSE);
  end if;*/
  
end;]]>
      </textSource>
    </function>
    <function name="r_1formattrigger">
      <textSource>
      <![CDATA[function R_1FormatTrigger return boolean is
begin
	
  --if :tipo_mov_aux <> '3X' then -- Ivo Oliveira 21/05/2003
  if :tipo_mov_aux < '3X' then
  	return (FALSE);
  end if;
  
  IF VARS.V_1S = TRUE and :tiragem_edicao is not null THEN
  	
  	 RETURN(TRUE);
  	 
  ELSIF VARS.V_1S = FALSE THEN
  	
  	 RETURN(FALSE);
  	 
  END IF;
  
  
  return (FALSE);
  /*
    if :tipo_mov_aux = '3X' and :tiragem <> :tiragem_edicao then
		return (TRUE);	--  	return (FALSE);
  else
  	return (FALSE);		
  end if;
  
  */
end;]]>
      </textSource>
    </function>
    <function name="m_5formattrigger">
      <textSource>
      <![CDATA[function M_5FormatTrigger return boolean is
begin
  if :tipo_mov_aux = '2N' and :tiragem <> :tiragem_edicao then
  	return (FALSE);
  end if;
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="cf_total_linhaformula" returnType="number">
      <textSource>
      <![CDATA[function CF_total_linhaFormula return Number is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
begin
	
	/* EURO */
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
	--	SRW.SET_FORMAT_MASK('999 999 999D99');
		return (ROUND(:qtd_consumiveis * :preco_unit_EUR_consumiveis,2));
	else
  	return (:qtd_consumiveis * :preco_unit_consumiveis);		
	end if;
	
end;






]]>
      </textSource>
    </function>
    <function name="vars" type="packageSpec">
      <textSource>
      <![CDATA[PACKAGE VARS IS
  
  V_1S BOOLEAN := TRUE;
  
END;]]>
      </textSource>
    </function>
    <function name="cf_num_folhasformula" returnType="character">
      <textSource>
      <![CDATA[function CF_NUM_FOLHASFormula return char is

 v_num_folhas number(6,3):=0;
 v_tot_folhas varchar2(20):=null; 
 --v_erro       varchar2(1) := 'N';

begin
  
  --v_erro := 'N';
  
  if :num_folhas is null or :num_folhas = 0 then
  	-- Ivo Oliveira 29/08/2002
  	--v_tot_folhas := null;
  	begin
      SELECT SUM(numero_paginas)/16
      into   v_num_folhas
      FROM   BGO_PARTES p
      WHERE  p.gfo_id = :gfo_id
      AND    p.oba_id = :oba_id2
      AND    p.tipo_parte = 'T'
      AND		 p.classe<>0;
  	exception
    when others then
      v_num_folhas:=0;
    end;  		  	
  	
  	if v_num_folhas>0 then
  		v_tot_folhas := to_char(v_num_folhas);
  	end if;
  	
  else
  
  -- Ivo Oliveira 29/08/2002		
  
  /*	begin
      SELECT SUM(numero_paginas)/16
      into   v_num_folhas
      FROM   BGO_PARTES p,
             BGO_GRUPOS_FACTURACAO g
      WHERE  :gfo_id = g.id
      AND    p.gfo_id = g.id
      AND    p.oba_id = :oba_id2
      AND    p.oba_id = g.oba_id    
      AND    p.tipo_parte in ('C','S');
  	exception
    when others then
      v_erro := 'S';
    end;  	

    if v_erro = 'S' then
    	 v_num_folhas := :num_folhas;
    else	
       v_num_folhas := :num_folhas - nvl(v_num_folhas,0);
	  end if;
	
	  if v_num_folhas <= 0 then
	  	 v_tot_folhas := null;
	  else
	  	 v_tot_folhas := to_char(v_num_folhas);
	  end if;	*/ 
	  	
	 	v_tot_folhas := to_char(:num_folhas);
  end if;
  	
	return(v_tot_folhas);
	
end;]]>
      </textSource>
    </function>
    <function name="beforepform">
      <textSource>
      <![CDATA[function BeforePForm return boolean is
begin
	--SRW.DO_SQL('set role bgo_dsi identified by r1dsi');	
  SRW.DO_SQL(GET_ROLE);
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="subtotal_rnd">
      <textSource>
      <![CDATA[FUNCTION Subtotal_RND (p_Oba_Id Number, p_tipo_movimento Varchar2, p_gfo_id Number)RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_3X     		Number(16,5):=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;
	v_tiragem					Number(16):= Tiragem(p_Oba_Id);	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	

	if :tiragem_edicao is null then

		SELECT  SUM(Subtotal.valor) 	   Valor,
	  	 			SUM(Subtotal.valor_eur) Valor_eur
		INTO		v_valor,
						v_valor_eur
		FROM (SELECT 	SUM(afg1.valor)    	valor,
	 			 					ROUND(SUM(afg1.valor_eur),2) valor_eur
				  FROM   BGO_ANALISE_FACTURACAO_GF_V afg1
		  		WHERE  afg1.oba_id = p_Oba_Id
	  			AND	   afg1.tipo_movimento_aux BETWEEN '2N' AND p_tipo_movimento
	  			AND	   p_tipo_movimento >= afg1.tipo_movimento_aux
					AND	 	 afg1.tipo_movimento_aux NOT IN ('3X','7B')
					and		 afg1.gfo_id = p_gfo_id
					AND		 EXISTS (SELECT 1
												 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				 WHERE	tmp.oba_id = :P_Oba_Id
								 				 AND		tmp.Id = :P_Id
								 				 AND    tmp.gfo_id = afg1.gfo_id)
				  GROUP BY /*afg1.oba_id,
						       afg1.gfo_id,  */
						       afg1.descricao/*,
						       afg1.tipo_movimento_aux,
						       afg1.order_by,
						       afg1.unidade,
						       afg1.tempo*/
	  			UNION all
	  			SELECT SUM(afg2.valor)     * v_tiragem 	  valor,
	  					 	 SUM(afg2.valor_eur) * v_tiragem valor_eur
	  			FROM   BGO_ANALISE_FACTURACAO_GF_V afg2
	  			WHERE  afg2.oba_id = p_Oba_Id
	  			AND	 	 afg2.tipo_movimento_aux = '7B' 					/* Acabamentos Adicionar */
	  			AND	   p_tipo_movimento >= afg2.tipo_movimento_aux
	  			and		 afg2.gfo_id = p_gfo_id
	  			AND		 EXISTS (SELECT 1
												 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				 WHERE	tmp.oba_id = :P_Oba_Id
								 				 AND		tmp.Id = :P_Id
								 				 AND   tmp.gfo_id = afg2.gfo_id)
					GROUP BY /*afg2.oba_id,
						       afg2.gfo_id,*/  
						       afg2.descricao/*,
						       afg2.tipo_movimento_aux,
						       afg2.order_by,
						       afg2.unidade,
						       afg2.tempo*/
	 			)Subtotal;
	 		
	else


			SELECT  SUM(Subtotal.valor) 	   Valor,
	   					SUM(Subtotal.valor_eur) Valor_eur
			INTO		v_valor,
							v_valor_eur
			FROM (SELECT 	SUM(afg1.valor)    	valor,
	 		 							ROUND(SUM(afg1.valor_eur),2) valor_eur
			  		FROM   BGO_ANALISE_FACTURACAO_GF_V afg1
	  				WHERE  afg1.oba_id = p_Oba_Id
	  				AND	   afg1.tipo_movimento_aux BETWEEN '4A' AND p_tipo_movimento
	  				AND	   p_tipo_movimento >= afg1.tipo_movimento_aux
						AND	   afg1.tipo_movimento_aux NOT IN ('7B')
						and		 afg1.gfo_id = p_gfo_id
						AND		 EXISTS (SELECT 1
													 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 				 WHERE	tmp.oba_id = :P_Oba_Id
									 				 AND		tmp.Id = :P_Id
									 				 AND    tmp.gfo_id = afg1.gfo_id)
  					GROUP BY /*afg1.oba_id,
							       afg1.gfo_id,*/  
							       afg1.descricao/*,
							       afg1.tipo_movimento_aux,
							       afg1.order_by,
							       afg1.unidade,
							       afg1.tempo	*/								 				 
	  				UNION all
	  				SELECT SUM(afg2.valor) 			* v_tiragem 	  valor,
	  							 SUM(afg2.valor_eur)	* v_tiragem valor_eur
	  				FROM   BGO_ANALISE_FACTURACAO_GF_V afg2
	  				WHERE  afg2.oba_id = p_Oba_Id
	  				AND	 	 afg2.tipo_movimento_aux = '7B' 					/* Acabamentos Adicionar */
	  				AND	   p_tipo_movimento >= afg2.tipo_movimento_aux 
	  				and		 afg2.gfo_id = p_gfo_id
	  				AND		 EXISTS (SELECT 1
													 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 				 WHERE	tmp.oba_id = :P_Oba_Id
									 				 AND		tmp.Id = :P_Id
								 					 AND   tmp.gfo_id = afg2.gfo_id)	  				
						GROUP BY/* afg2.oba_id,
							       afg2.gfo_id,*/  
							       afg2.descricao/*,
							       afg2.tipo_movimento_aux,
							       afg2.order_by,
							       afg2.unidade,
							       afg2.tempo*/
	 				)Subtotal;
	
	
		if p_tipo_movimento >= '3X' then
			v_valor_3X := Subtotal_3X_RND (p_oba_id, p_gfo_id);
		end if;
						
	end if; /*:Tiragem_Edicao */
	
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := v_valor_eur;
	end if;

		
  return (nvl(v_valor,0) + nvl(v_valor_3X,0));
  
END;]]>
      </textSource>
    </function>
    <function name="subtotal_3x_rnd">
      <textSource>
      <![CDATA[FUNCTION Subtotal_3X_RND (p_Oba_Id Number, p_Gfo_Id Number) RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
		
  SELECT SUM(valor),
	 			 SUM(valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM
	(	
  SELECT SUM(afg.valor) valor,
	 			 --SUM(round(afg.valor_eur,2)) valor_eur--,
	 			 ROUND(SUM(afg.valor_eur),2) valor_eur--,
	 			 /*afg.oba_id,
	       afg.gfo_id, */ 
	       /*afg.descricao/*,
	       afg.tipo_movimento_aux,
	       afg.order_by,
	       afg.unidade,
	       afg.tempo*/
/*	INTO	 v_valor,
				 v_valor_eur*/
	FROM   BGO_ANALISE_FACTURACAO_GF_V afg
	WHERE  afg.oba_id = P_Oba_Id
	AND	   afg.tipo_movimento_aux = '3X'
	AND		 afg.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = afg.gfo_id)
	GROUP BY /*afg.oba_id,
		       afg.gfo_id, */ 
		       afg.descricao/*,
		       afg.tipo_movimento_aux,
		       afg.order_by,
		       afg.unidade,
		       afg.tempo*/);
		
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := nvl(v_valor_eur,0);
	end if;
	
	--return (Subtotal_1S_RND(p_Oba_id, p_gfo_id) * (:tiragem_TOTAL / nvl(:tiragem_edicao,:tiragem_TOTAL)) + v_valor);  --Está a dividir pelo NVL da :tiragem_edicao porque esta pode ser nula
	return (Subtotal_2A_RND(p_Oba_id, p_gfo_id) * (:tiragem_TOTAL / nvl(:tiragem_edicao,:tiragem_TOTAL)) + v_valor);  --Está a dividir pelo NVL da :tiragem_edicao porque esta pode ser nula	
END;]]>
      </textSource>
    </function>
    <function name="subtotal_1s_rnd">
      <textSource>
      <![CDATA[FUNCTION Subtotal_1S_RND (p_Oba_Id Number, p_gfo_id Number)RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
  SELECT SUM(valor),
	 			 SUM(valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM
  (
  SELECT SUM(afg.valor) valor,
	 			 --SUM(round(afg.valor_eur,2)) valor_eur--,
	 			 ROUND(SUM(afg.valor_eur),2) valor_eur--,
	 			 /*afg.oba_id,
	       afg.gfo_id, */ 
	       /*afg.descricao/*,
	       afg.tipo_movimento_aux,
	       afg.order_by,
	       afg.unidade,
	       afg.tempo*/
	FROM   BGO_ANALISE_FACTURACAO_GF_V afg
	WHERE  afg.oba_id = P_Oba_Id
	AND	   afg.tipo_movimento_aux = '1S'
	AND		 afg.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = afg.gfo_id)
	GROUP BY /*afg.oba_id,
		       afg.gfo_id,*/  
		       afg.descricao/*,
		       afg.tipo_movimento_aux,
		       afg.order_by,
		       afg.unidade,
		       afg.tempo*/);
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := v_valor_eur;
	end if;
	
	return (nvl(v_valor,0));
END;]]>
      </textSource>
    </function>
    <function name="cf_detalheformula" returnType="number">
      <textSource>
      <![CDATA[function CF_DETALHEFormula return Number is
	v_valor						Number(10,2):=0;
	v_valor_rnd						Number(10,2):=0;
begin
	if :tipo_mov_aux = '1S' then
		v_valor := Subtotal_1S (:P_Oba_Id,:gfo_id);
		v_valor_rnd := Subtotal_1S_rnd (:Oba_Id,:gfo_id);	
	elsif :tipo_mov_aux = '2A' then
  	v_valor := Subtotal_2A (:P_Oba_Id,:gfo_id);
  	v_valor_rnd := Subtotal_2A_rnd (:Oba_Id,:gfo_id);
	elsif :tipo_mov_aux = '3X' then
  	v_valor := Subtotal_3X (:P_Oba_Id,:gfo_id);
  	v_valor_rnd := Subtotal_3X_rnd (:Oba_Id,:gfo_id);
	else
		v_valor := Subtotal(:P_Oba_Id, :tipo_mov_aux,:gfo_id);
		v_valor_rnd := Subtotal_rnd(:Oba_Id, :tipo_mov_aux,:gfo_id);		
	end if;
	:cp_valor_1 := nvl(v_valor,0);        
	:cp_valor_2 := nvl(v_valor_rnd,0);       	
	
	return (:CP_VALOR_1);
	
end;
]]>
      </textSource>
    </function>
    <function name="m_g_descricao_detail_ftr1forma">
      <textSource>
      <![CDATA[function M_G_descricao_Detail_FTR1Forma return boolean is
begin
	-- IVO OLIVEIRA 2/05/2002
  if :tipo_mov_aux = '2N' and :tiragem_edicao is not null then
  	return (FALSE);
  end if;
  
  -- Ivo Oliveira 24/05/2006
  if :tipo_mov_aux = '7C' then
  	return (FALSE);
  end if;
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="cf_roundformula" returnType="number">
      <textSource>
      <![CDATA[function CF_ROUNDFormula return Number is
begin
    RETURN(:CS_VALOR_1-:CS_VALOR_2);
end;]]>
      </textSource>
    </function>
    <function name="m_g_descricao_detail_grpfr1for">
      <textSource>
      <![CDATA[function M_G_descricao_Detail_GRPFR1For return boolean is
begin
  if :tipo_mov_aux = '7B' and nvl(tiragem(:oba_id),0)=0 then 
  	return (FALSE);	
  else
    return (TRUE);
  end if;end;]]>
      </textSource>
    </function>
    <function name="f_descricao_detail1formattrigg">
      <textSource>
      <![CDATA[function F_descricao_Detail1FormatTrigg return boolean is
	/*V_PERC BGO_ASSOCIACOES_OBRAS.PERCENTAGEM_CUSTOS%TYPE;
	v_custos BGO_ASSOCIACOES_OBRAS.CUSTOS_VARIAVEIS%TYPE;*/
begin
	/*IF UPPER(:TIPO_MOV_AUX) IN ('2A','5O') THEN
		BEGIN
			SELECT PERCENTAGEM_CUSTOS,CUSTOS_VARIAVEIS
			INTO V_PERC,v_custos
			FROM BGO_ASSOCIACOES_OBRAS AOA
			WHERE AOA.OBA_ID_RECEPTORA=:OBA_ID
			AND AOA.OBA_ID_ASSOCIADA=:OBA_ID_PROV
			AND AOA.ID IN (SELECT MAX(ID)
										 FROM BGO_ASSOCIACOES_OBRAS
										 WHERE OBA_ID_ASSOCIADA=:OBA_ID_PROV
										 AND 	 OBA_ID_RECEPTORA=:OBA_ID);
			
			IF v_custos='S' THEN
	  		SRW.set_field_char (0,:Descricao_Detail||'   ('||V_PERC||'%)');
			ELSE
				SRW.set_field_char (0,:Descricao_Detail||'   ('||V_PERC||'%)*');-- Só custos fixos
			END IF;

		EXCEPTION WHEN OTHERS THEN
	  	SRW.set_field_char (0,:Descricao_Detail);			
		END;
	ELSE	
		if :unidade is null then
			SRW.set_field_char (0,:Descricao_Detail);
		else	
	  	SRW.set_field_char (0,:Descricao_Detail || '    (' || :unidade ||')');
	  end if;	
	END IF;*/
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="obs1formattrigger">
      <textSource>
      <![CDATA[function OBS1FormatTrigger return boolean is
begin
 	--SRW.set_field_char (0, ' '||:p_obs );
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="cf_detalhe1formula" returnType="number">
      <textSource>
      <![CDATA[function CF_DETALHE1Formula return Number is
	v_valor_rnd						Number(10,2):=0;
begin
	if :tipo_mov_aux1 = '1S' then
		v_valor_rnd := Subtotal1_1S_rnd (:Oba_Id,:gfo_id);	
	elsif :tipo_mov_aux1 = '3X' then
  	v_valor_rnd := Subtotal1_3X_rnd (:Oba_Id,:gfo_id);
	else
		v_valor_rnd := Subtotal1_rnd(:Oba_Id, :tipo_mov_aux1,:gfo_id);		
	end if;
	:cp1_valor_2 := nvl(v_valor_rnd,0);       	
	
	return (:CP1_VALOR_2);
	
end;
]]>
      </textSource>
    </function>
    <function name="subtotal1_1s_rnd">
      <textSource>
      <![CDATA[FUNCTION SUBTOTAL1_1S_RND (p_Oba_Id Number, p_gfo_id Number)RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valo_fact_empr_grup.valor%type:=0;
	v_valor_eur				bgo_valo_fact_empr_grup.valor_eur%type:=0;	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
  SELECT SUM(valor),
	 			 SUM(valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM
  (
  SELECT SUM(ang.valor) valor,
	 			 ROUND(SUM(ang.valor_eur),2) valor_eur
	FROM   BGO_ANALISE_NAO_FACT_GF_V ang
	WHERE  ang.oba_id = P_Oba_Id
	AND	   ang.tipo_movimento_aux = '1S'
	AND		 ang.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = ang.gfo_id)
	GROUP BY ang.descricao);
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := v_valor_eur;
	end if;
	
	return (nvl(v_valor,0));
END;]]>
      </textSource>
    </function>
    <function name="subtotal1_3x_rnd">
      <textSource>
      <![CDATA[FUNCTION SUBTOTAL1_3X_RND (p_Oba_Id Number, p_Gfo_Id Number) RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valo_fact_empr_grup.valor%type:=0;
	v_valor_eur				bgo_valo_fact_empr_grup.valor_eur%type:=0;	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
		
  SELECT SUM(valor),
	 			 SUM(valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM
	(	
  SELECT SUM(ang.valor) valor,
	 			 ROUND(SUM(ang.valor_eur),2) valor_eur
	FROM   BGO_ANALISE_NAO_FACT_GF_V ang
	WHERE  ang.oba_id = P_Oba_Id
	AND	   ang.tipo_movimento_aux = '3X'
	AND		 ang.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = ang.gfo_id)
	GROUP BY ang.descricao);
		
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := nvl(v_valor_eur,0);
	end if;
	
	return (Subtotal1_1S_RND(p_Oba_id, p_gfo_id) * (:tiragem_TOTAL / nvl(:tiragem_edicao,:tiragem_TOTAL)) + v_valor);  --Está a dividir pelo NVL da :tiragem_edicao porque esta pode ser nula
END;]]>
      </textSource>
    </function>
    <function name="subtotal1_rnd">
      <textSource>
      <![CDATA[FUNCTION SUBTOTAL1_RND (p_Oba_Id Number, p_tipo_movimento Varchar2, p_gfo_id Number)RETURN Number IS
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						bgo_valo_fact_empr_grup.valor%type:=0;
	v_valor_3X     		Number(16,5):=0;
	v_valor_eur				bgo_valo_fact_empr_grup.valor_eur%type:=0;
	v_tiragem					Number(16):= Tiragem(p_Oba_Id);	
BEGIN
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	

	if :tiragem_edicao is null then

		SELECT  SUM(Subtotal.valor) 	   Valor,
	  	 			SUM(Subtotal.valor_eur) Valor_eur
		INTO		v_valor,
						v_valor_eur
		FROM (SELECT 	SUM(ang1.valor)    	valor,
	 			 					ROUND(SUM(ang1.valor_eur),2) valor_eur
				  FROM   BGO_ANALISE_NAO_FACT_GF_V ang1
		  		WHERE  ang1.oba_id = p_Oba_Id
	  			AND	   ang1.tipo_movimento_aux BETWEEN '2N' AND p_tipo_movimento
	  			AND	   p_tipo_movimento >= ang1.tipo_movimento_aux
					AND	 	 ang1.tipo_movimento_aux NOT IN ('3X','7B')
					and		 ang1.gfo_id = p_gfo_id
					AND		 EXISTS (SELECT 1
												 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				 WHERE	tmp.oba_id = :P_Oba_Id
								 				 AND		tmp.Id = :P_Id
								 				 AND    tmp.gfo_id = ang1.gfo_id)
				  GROUP BY ang1.descricao
	  			UNION all
	  			SELECT SUM(ang2.valor)     * v_tiragem 	  valor,
	  					 	 SUM(ang2.valor_eur) * v_tiragem valor_eur
	  			FROM   BGO_ANALISE_NAO_FACT_GF_V ang2
	  			WHERE  ang2.oba_id = p_Oba_Id
	  			AND	 	 ang2.tipo_movimento_aux = '7B' 					/* Acabamentos Adicionar */
	  			AND	   p_tipo_movimento >= ang2.tipo_movimento_aux
	  			and		 ang2.gfo_id = p_gfo_id
	  			AND		 EXISTS (SELECT 1
												 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				 WHERE	tmp.oba_id = :P_Oba_Id
								 				 AND		tmp.Id = :P_Id
								 				 AND   tmp.gfo_id = ang2.gfo_id)
					GROUP BY ang2.descricao
	 			)Subtotal;
	 		
	else


			SELECT  SUM(Subtotal.valor) 	   Valor,
	   					SUM(Subtotal.valor_eur) Valor_eur
			INTO		v_valor,
							v_valor_eur
			FROM (SELECT 	SUM(ang1.valor)    	valor,
	 		 							ROUND(SUM(ang1.valor_eur),2) valor_eur
			  		FROM   BGO_ANALISE_NAO_FACT_GF_V ang1
	  				WHERE  ang1.oba_id = p_Oba_Id
	  				AND	   ang1.tipo_movimento_aux BETWEEN '4A' AND p_tipo_movimento
	  				AND	   p_tipo_movimento >= ang1.tipo_movimento_aux
						AND	   ang1.tipo_movimento_aux NOT IN ('7B')
						and		 ang1.gfo_id = p_gfo_id
						AND		 EXISTS (SELECT 1
													 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 				 WHERE	tmp.oba_id = :P_Oba_Id
									 				 AND		tmp.Id = :P_Id
									 				 AND    tmp.gfo_id = ang1.gfo_id)
  					GROUP BY ang1.descricao							 				 
	  				UNION all
	  				SELECT SUM(ang2.valor) 			* v_tiragem 	  valor,
	  							 SUM(ang2.valor_eur)	* v_tiragem valor_eur
	  				FROM   BGO_ANALISE_NAO_FACT_GF_V ang2
	  				WHERE  ang2.oba_id = p_Oba_Id
	  				AND	 	 ang2.tipo_movimento_aux = '7B' 					/* Acabamentos Adicionar */
	  				AND	   p_tipo_movimento >= ang2.tipo_movimento_aux 
	  				and		 ang2.gfo_id = p_gfo_id
	  				AND		 EXISTS (SELECT 1
													 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									 				 WHERE	tmp.oba_id = :P_Oba_Id
									 				 AND		tmp.Id = :P_Id
								 					 AND   tmp.gfo_id = ang2.gfo_id)	  				
						GROUP BY ang2.descricao
	 				)Subtotal;
	
	
		if p_tipo_movimento >= '3X' then
			v_valor_3X := Subtotal1_3X_RND (p_oba_id, p_gfo_id);
		end if;
						
	end if; /*:Tiragem_Edicao */
	
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			v_valor := v_valor_eur;
	end if;

		
  return (nvl(v_valor,0) + nvl(v_valor_3X,0));
  
END;]]>
      </textSource>
    </function>
    <function name="f_14formattrigger">
      <textSource>
      <![CDATA[function F_14FormatTrigger return boolean is
begin
	if :CS_tempo1 is not null then
  	SRW.set_field_char (0, FLOOR(:CS_tempo1/60) || ':' || to_char(MOD(:cs_tempo1,60),'00'));
	else
		SRW.set_field_char (0, ' ');
	end if;
	
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_total2formattrigger">
      <textSource>
      <![CDATA[function F_CS_total2FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_total 					Number (20,2):=0;
	v_max_tipo_mov		BGO_ANALISE_NAO_FACT_GF_V.tipo_movimento_aux%TYPE;
	
	V_TOTAL2          NUMBER;
	
	v_total_pe        NUMBER;
	
begin
	
	/* EURO */
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
			SRW.SET_FORMAT_MASK('999 999 990D09" "');
	end if;



    SELECT  sum(nvl(arf.valor_eur,0))    -- jgs20150313
    INTO    v_total_pe
    FROM    bgo_auxi_repo_fatu arf
    where   arf.seq_id = :P_SES_ID_CUS_PE
    and     tip_reg      = 'CUS_PE'
    AND     N1 = :GFO_ID
    and     c1= 'TOTAL';
  


	SRW.set_field_num (0, NVL(:CS1_valor_2,0)+nvl(:CS_TOT_SUB_OUTR,0) + NVL(v_total_pe,0));

  V_TOTAL2 := NVL(:CS1_valor_2,0)+nvl(:CS_TOT_SUB_OUTR,0)+ NVL(v_total_pe,0);

/* jgs20150612: mail RAMARAL
- obra 20120153 - na fatura 20150464 de montante de 19781,65  (custos BG), não foram considerados 30 000  (custos da editora) oriundos do registo de subcontratação com o ID 7668168;

O tratamento da bgo_vali_pre_fatu já não é feito no POR GRUPOS. Este tipo de updates apagava os custos da editora...

  -- JGS20140125
  UPDATE BGO_VALI_PRE_FATU
  SET    VAL_TOT_RES_DET_CUS = VAL_TOT_RES_DET_CUS + V_TOTAL2, 
         --VAL_TOT_BG_RES_DET_CUS = VAL_TOT_BG_RES_DET_CUS + V_TOTAL2,
         VAL_TOT_EDI_RES_DET_CUS = VAL_TOT_EDI_RES_DET_CUS + V_TOTAL2
  WHERE  ID = :P_VPF_ID;
  COMMIT;
  -- FIM JGS20140125

*/

	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail2formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail2FormatTrigger return boolean is
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
	v_valor 		Number(10,5):=0;
	v_valor_eur Number(10,5):=0;
	
	
	v_arf_reg   bgo_auxi_repo_fatu%rowtype;

begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	SELECT SUM(ang.valor), 
			   SUM(ang.valor_eur)
	into	 v_valor,
				 v_valor_eur	   
	FROM	 BGO_ANALISE_NAO_FACT_GF_V ang
	WHERE	 ang.oba_id = :P_Oba_Id
	AND		 ang.tipo_movimento_aux = '7B'
	AND		 ang.gfo_id = :gfo_id_detail1
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 WHERE	tmp.oba_id = :P_Oba_Id
								 AND		tmp.Id = :P_Id
								 AND    tmp.gfo_id = ang.gfo_id);

	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro then

    -- jgs20150121 tratar operacoes disrcriminadas 
    /*
    begin

        select *
        into   v_arf_reg
        from   bgo_auxi_repo_fatu
        where  seq_id                 = :p_ses_id
        and    tip_reg                = 'EDI'
        and    c1                     = 'ACUMULADO'
        and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
        and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
        and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
        and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
        and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
        and    nvl(unidade,'#')       = nvl(:unidade,'#')
        and    n1                     = :gfo_id;

    exception when others then v_arf_reg.valor_eur := 0;
    end;
    */
    --


    if trunc(:order_by_num2) != :order_by_num2 then    -- se for diferente É uma operação .. A operação tem + 0.5 e não tem acumulado. 

        SRW.set_field_num (0, 0);  -- vai tudo para a subcontratação ... 
              
    else

				SRW.SET_FORMAT_MASK('999 999 990D09" "');
				SRW.set_field_num (0, :CS_valor_eur_detail1);

		end if;
    -- jgs20150121


	end if;		
		
  if upper(:tipo_mov_aux1) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
  	SRW.set_field_num (0, nvl(v_valor_eur,1) * Tiragem(:P_Oba_Id));  	
  elsif upper(:tipo_mov_aux1) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') < v_data_euro) then
  	SRW.set_field_num (0, nvl(v_valor,1) * Tiragem(:P_Oba_Id));
  end if;
  
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_15formattrigger">
      <textSource>
      <![CDATA[function F_15FormatTrigger return boolean is
  
  
   V_QTD_FACTURADA number;--VARCHAR2(400);
   	v_teste varchar2(400);
		v_teste1 number;
		v_teste2 number;
 
v_data_euro				bgo_parametros.valor_bg%TYPE;
begin	
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	
	IF :TIPO_MOV_AUX1 <> '7B' THEN
		
			if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		 			V_TESTE := TO_CHAR(:CS_quantidade1,'999,999,990.00');
		 			V_TESTE := REPLACE(V_TESTE,',',' ');
		 			V_TESTE := REPLACE(V_TESTE,'.',',');
			ELSE
					V_TESTE := TO_CHAR(:CS_quantidade1,'999G999G990D99');
					V_TESTE := REPLACE(V_TESTE,'.00','');
				  V_TESTE := REPLACE(V_TESTE,',00','');
		 	  	V_TESTE := REPLACE(V_TESTE,'.',' ');
		 
			end if;
				
	 		SRW.set_field_char (0, V_TESTE);	
	
	ELSIF :P_ATENDER_ENTREGAS = 'N' AND :TIPO_MOV_AUX1 = '7B' THEN     
	   
	   v_qtd_facturada := tiragem(:p_oba_id);
	   	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		 			V_TESTE := TO_CHAR(tiragem(:p_oba_id),'999G999G990D99');
			ELSE
					V_TESTE := TO_CHAR(tiragem(:p_oba_id),'999G999G990D90');
					V_TESTE := REPLACE(V_TESTE,'.00','');
				  V_TESTE := REPLACE(V_TESTE,',00','');
		 	  	V_TESTE := REPLACE(V_TESTE,'.',' ');

					
		 	end if;
	    SRW.set_field_char (0, V_TESTE);
		
	ELSIF :P_ATENDER_ENTREGAS = 'S' AND :TIPO_MOV_AUX1 = '7B' THEN

		SELECT  nvl(SUM(lge.quantidade),0) --Alterado Joao Repolho 2000-09-07
		INTO		v_qtd_facturada
		FROM		bgo_linhas_guias_entrega lge
		,	      bgo_partes pre
		WHERE		oba_id_facturacao = :p_Oba_Id
		and     lge.estado != 'N'
		and     pre.id = lge.pre_id_facturacao
		and	    pre.gfo_id = :gfo_id;
    
    	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		 			V_TESTE := TO_CHAR(v_qtd_facturada,'999G999G990D99');
			ELSE
					V_TESTE := TO_CHAR(v_qtd_facturada,'999G999G990D90');
					V_TESTE := REPLACE(V_TESTE,'.00','');
				  V_TESTE := REPLACE(V_TESTE,',00','');
		 	  	V_TESTE := REPLACE(V_TESTE,'.',' ');

		 	end if;
    
	    SRW.set_field_char (0, V_TESTE);
		 
	END IF;
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_acabamento2formattrigger">
      <textSource>
      <![CDATA[function F_Acabamento2FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						Number(10,5):=0;
	v_valor_eur				Number(10,5):=0;
begin	

	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	
	SELECT SUM(ang.valor), 
	   		 SUM(ang.valor_eur)
	into	 v_valor,
				 v_valor_eur
	FROM	 BGO_ANALISE_NAO_FACT_GF_V ang
	WHERE	 ang.oba_id = :P_Oba_Id
	AND		 ang.tipo_movimento_aux = '7B'
	AND		 ang.gfo_id = :gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 WHERE	tmp.oba_id = :P_Oba_Id
								 AND		tmp.Id = :P_Id
								 AND    tmp.gfo_id = ang.gfo_id);

  if upper(:tipo_mov_aux1) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
  	SRW.set_field_char(0, to_char(v_valor_eur, '999990D09999') || ' /Ex.');
  	return (TRUE);
  	
  elsif upper(:tipo_mov_aux1) = '7B' and (to_char(sysdate, 'YYYY-MM-DD') < v_data_euro) then
  	SRW.set_field_char(0, to_char(v_valor, '99999990L99') || '/Ex.');
  	return (TRUE);

  else    
  	return (FALSE);
  end if;
  
  exception 
  	when no_data_found then
  		SRW.set_field_char(0, to_char(round(v_valor,3), '99999990L09') || '/Ex.');
  		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_descricao_detail2formattrigg">
      <textSource>
      <![CDATA[function F_descricao_Detail2FormatTrigg return boolean is
	/*V_PERC BGO_ASSOCIACOES_OBRAS.PERCENTAGEM_CUSTOS%TYPE;
	v_custos BGO_ASSOCIACOES_OBRAS.CUSTOS_VARIAVEIS%TYPE;*/
begin
	/*IF UPPER(:TIPO_MOV_AUX1)='5O' THEN
		BEGIN
			SELECT PERCENTAGEM_CUSTOS,CUSTOS_VARIAVEIS
			INTO V_PERC,v_custos
			FROM BGO_ASSOCIACOES_OBRAS AOA
			WHERE AOA.OBA_ID_RECEPTORA=:OBA_ID
			AND AOA.OBA_ID_ASSOCIADA=:OBA_ID_PROV2
			AND AOA.ID IN (SELECT MAX(ID)
										 FROM BGO_ASSOCIACOES_OBRAS
										 WHERE OBA_ID_ASSOCIADA=:OBA_ID_PROV2
										 AND 	 OBA_ID_RECEPTORA=:OBA_ID);
			
			IF v_custos='S' THEN
	  		SRW.set_field_char (0,:Descricao_Detail1||'   ('||V_PERC||'%)');
			ELSE
				SRW.set_field_char (0,:Descricao_Detail1||'   ('||V_PERC||'%)*');-- Só custos fixos
			END IF;
			
		EXCEPTION WHEN OTHERS THEN
	  	SRW.set_field_char (0,:Descricao_Detail1);			
		END;
	ELSE	
		if :unidade1 is null then
			SRW.set_field_char (0,:Descricao_Detail1);
		else	
	  	SRW.set_field_char (0,:Descricao_Detail1 || '    (' || :unidade1 ||')');
	  end if;	
	END IF;*/
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="r_g_descricao_detail2formattri">
      <textSource>
      <![CDATA[function R_G_descricao_Detail2FormatTri return boolean is
begin
	
	  -- jgs20150318# 
	  -- jgs20150417 (não percebo isto... está a duplicar com os 2N return true;
	  
	  	
	-- IVO OLIVEIRA 2/05/2002 - quando a tiragem_edicao está preenchida tem que ser 
	--													 sempre maior que a tiragem (Engº Furtado - 30/4/2002),
	--												   no entanto isso não se verificava

	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '**********:tipo_mov_aux1 = '||:tipo_mov_aux1||', :tiragem_edicao = '||:tiragem_edicao, null, null);

  --if :tipo_mov_aux = '2N' and :tiragem <> :tiragem_edicao then
  	if :tipo_mov_aux1 = '2N' and :tiragem_edicao is not null then
  		return (FALSE);
  	end if;
  	
    return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="m_g_descricao_detail_grpfr2for">
      <textSource>
      <![CDATA[function M_G_descricao_Detail_GRPFR2For return boolean is
begin
	
	  -- jgs20150318# 
	  -- JGS20150417: NÃO PERCEBO!!!!!!   return true;	


  if :tipo_mov_aux1 = '7B' and nvl(tiragem(:oba_id),0)=0 then 
  	return (FALSE);	
  else
    return (TRUE);
  end if;end;]]>
      </textSource>
    </function>
    <function name="m_29formattrigger">
      <textSource>
      <![CDATA[function M_29FormatTrigger return boolean is
begin
	
	  -- jgs20150318# 
	  -- JGS20150417 Não percebo: duplicava o 2N return true;	
	  
	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '**********:tipo_mov_aux1 = '||:tipo_mov_aux1||', :tiragem_edicao = '||:tiragem_edicao||', :tiragem='||:tiragem, null, null);
	  
	  
	  
  if :tipo_mov_aux1 = '2N' and :tiragem <> :tiragem_edicao then
  	return (FALSE);
  end if;
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="g_oba_id_detail1groupfilter">
      <textSource>
      <![CDATA[function G_oba_id_Detail1GroupFilter return boolean is
	v_custos_fixos	BGO_ANALISE_NAO_FACT_GF_V.tipo_movimento_aux%TYPE;
	v_temp					number(9);
begin
	
	  -- jgs20150318# 
	  -- jgs20150417: não pode ser assim... return true;

  /* Se a obra tiver Custos Fixos e Custos Variáveis devem ser mostrados os Tipos_Movimentos_Aux: '1S' e '3X' 
     Caso contrário deve ser mostrado o '2N' (Ver descrição no Designer - FAO0090R )*/
     
				/* Em termos funcionais uma obra possui tto Custos Fixos como Custo Variáveis qdo a Tiragem da Edição é
					 superior à Tiragem. Isto pode ser facilmente detectado pelo valor do campo 'Tiragem_Edicao' */
	  
	 if :tiragem_edicao is null and (:tipo_mov_aux1 = '1S' or :tipo_mov_aux1 = '3X')then 
	 	return (FALSE);
	 end if;
	   
	  if (:tiragem <> :tiragem_edicao) and :tipo_mov_aux1 = '2N' then
	  	return (FALSE);
	  end if;
	  
  
  /* Os restantes tipo_movimento_aux devem ser mostrado em todas as situações */

begin
  	
	SELECT	   tmp.gfo_id gfo_id
	into 			 v_temp
	FROM       BGO_RESUMO_ARTIGOS_GF_TEMP tmp/*,
					   BGO_VALO_FACT_EMPR_GRUP vfg*/
	WHERE      tmp.Id = :P_Id	
	--AND		     vfg.gfo_id = tmp.gfo_id
	and				 tmp.gfo_id = :gfo_id_detail1;
	--and				 vfg.gfo_id = :gfo_id_detail1;
	
	return(TRUE);
	
  exception
  		when no_data_found then
  				return (FALSE);
  		when too_many_rows then
  				return(TRUE);
end ;	
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="cf_desig_entformula" returnType="character">
      <textSource>
      <![CDATA[function CF_DESIG_ENTFormula RETURN CHAR IS
	V_EMPRESA BGO_VALO_FACT_EMPR_GRUP.EMPRESA%TYPE;
  V_TEXTO VARCHAR2(500);
	
	p_per_val BGO_DSI_PARA.VAL_EUR%TYPE := NULL;
	p_tipo  BGO_DSI_CTRL_PARA.PER_VAL%TYPE := NULL;
	p_mesg  VARCHAR2(0200):=NULL;
	
	
	v_num   NUMBER;
  
BEGIN
 BEGIN
	SELECT EMPRESA
	INTO V_EMPRESA
	FROM BGO_VALO_FACT_EMPR_GRUP VFG
	,		 BGO_INDICES_GERACAO_CUSTOS IGC
	WHERE /*VFG.OBA_ID_REFERENTE=VFG.OBA_ID_PROVENIENTE
	AND */IGC.ID=VFG.IGC_ID
	AND IGC.ESTADO='A'
	AND VFG.OBA_ID_REFERENTE=:OBA_ID
	AND EMPRESA IS NOT NULL
	AND ROWNUM=1;
	
	uc$varios.dsi_para('FAO0087R',V_EMPRESA,'designacao_entidade',p_per_val,p_tipo,p_mesg);
  
  V_TEXTO:=INITCAP(p_per_val);
	
 EXCEPTION WHEN OTHERS THEN
			 begin
				SELECT DISTINCT empresa
        into V_EMPRESA
				FROM    (SELECT cco.emp empresa
                   FROM bgo_subcontratacoes suo,
                        bgo_operacoes_processadas oda,
                        bgo_partes pre,
                        bgo_operacoes_anuais ono,
                        bgo_operacoes opo,
                        bgo_centros_custos cco
                  WHERE suo.oda_id = oda.ID
                    AND oda.ono_id = ono.ID
                    AND ono.opo_id = opo.ID
                    AND ono.cco_id = cco.ID
                    AND ROWNUM = 1
                    AND cco.emp <> 'B'
                    AND pre.ID = oda.pre_id
                    AND EXISTS (
                               SELECT 1
                                 FROM bgo_resumo_artigos_gf_temp tmp
                                WHERE tmp.ID = :p_id
                                      AND tmp.gfo_id = pre.gfo_id)
                    AND oda.igc_id IN (
                           SELECT igc.ID
                             FROM bgo_valores_facturacao vfo,
                                  bgo_indices_geracao_custos igc
                            WHERE vfo.oba_id_referente = oda.oba_id
                              AND vfo.igc_id = igc.ID
                              AND igc.estado = 'A'
                              AND oda.igc_id = igc.ID
                              AND ROWNUM = 1)
                    AND considerar <> 'S'
                    AND considerar IS NOT NULL      -- Ivo Oliveira 17/07/2003
                    AND uc$producao.aced_obra (oda.ono_id, 'OF') = 'N'
                    AND oda.oba_id = :oba_id
                 UNION ALL
                 SELECT cco.emp empresa
                   FROM bgo_subcontratacoes suo,
                        bgo_operacoes_processadas oda,
                        bgo_associacoes_obras aoa,
                        bgo_obras oba,
                        bgo_associacoes_partes ape,
                        bgo_partes pre,
                        bgo_operacoes_anuais ono,
                        bgo_operacoes opo,
                        bgo_centros_custos cco
                  WHERE suo.oda_id = oda.ID
                    AND oda.ono_id = ono.ID
                    AND ono.opo_id = opo.ID
                    AND ono.cco_id = cco.ID
                    AND ROWNUM = 1
                    AND cco.emp <> 'B'
                    AND aoa.oba_id_associada = oda.oba_id
                    AND pre.ID = ape.pre_id_receptora
                    AND EXISTS (
                               SELECT 1
                                 FROM bgo_resumo_artigos_gf_temp tmp
                                WHERE tmp.ID = :p_id
                                      AND tmp.gfo_id = pre.gfo_id)
                    AND oba.ID = aoa.oba_id_associada
                    AND ape.pre_id_associada = oda.pre_id
                    AND ape.pre_id_receptora IN (
                                           SELECT ID
                                             FROM bgo_partes
                                            WHERE oba_id =
                                                          aoa.oba_id_receptora)
                    AND aoa.ID =
                           (SELECT MAX (ID)
                              FROM bgo_associacoes_obras
                             WHERE oba_id_associada = aoa.oba_id_associada
                               AND oba_id_receptora = aoa.oba_id_receptora)
                    AND oda.igc_id IN (
                           SELECT igc_id_proveniente
                             FROM bgo_valores_facturacao vfo,
                                  bgo_indices_geracao_custos igc
                            WHERE vfo.oba_id_proveniente =
                                                          aoa.oba_id_associada
                              AND vfo.igc_id = igc.ID
                              AND igc.estado = 'A'
                              AND vfo.oba_id_referente = aoa.oba_id_receptora
                              AND vfo.tipo_movimento != 'G'
                              AND vfo.oba_id_referente <>
                                                        vfo.oba_id_proveniente
                              AND oda.igc_id = vfo.igc_id_proveniente
                              AND ROWNUM = 1)
                    AND considerar <> 'S'
                    AND considerar IS NOT NULL      -- Ivo Oliveira 17/07/2003
                    AND uc$producao.aced_obra (oda.ono_id, 'OF') = 'N'
                    AND aoa.oba_id_receptora = :oba_id);

				 uc$varios.dsi_para('FAO0087R',V_EMPRESA,'designacao_entidade',p_per_val,p_tipo,p_mesg);
 			  
			   V_TEXTO:=INITCAP(p_per_val);

			 exception when others then

       -- JGS20150313
       select count(1)
       into   v_num
       from   (
       SELECT  arf.oba_id oba_id_Detail1,
            arf.oba_id_prov oba_id_prov2,
            arf.descricao descricao_Detail1,
            arf.tipo_mov_aux tipo_mov_aux1,
            arf.order_by order_by_detail1,
            arf.order_by_num order_by_num2,
            sum(arf.quantidade) quantidade1,
            arf.unidade unidade1,
            sum(arf.tempo) tempo1,
            sum(arf.valor) Valor_Detail1,
            sum(arf.valor_eur) Valor_eur_Detail1,
            0 valor_sub,
            null dummy1
            FROM    bgo_auxi_repo_fatu arf
            where   arf.seq_id = :P_SES_ID_CUS_PE
            and     tip_reg      = 'CUS_PE'
            and     c1= 'TOTAL');
            
            if v_num > 0 then
                 V_TEXTO:='PORTO EDITORA';
            else
                 V_TEXTO:='Outras Empresas';
            end if;
      -- FIM JGS20150313

			 	 -- JGS20150318 V_TEXTO:='Outras Empresas';


			 end;	  	
 
 END;
 
 RETURN(V_TEXTO);
END;]]>
      </textSource>
    </function>
    <function name="cf_logoformula" returnType="character">
      <textSource>
      <![CDATA[function CF_LOGOFormula return Char is
v_per_val BGO_DSI_PARA.VAL_EUR%TYPE := NULL;
v_tipo    BGO_DSI_CTRL_PARA.PER_VAL%TYPE := NULL;
v_mesg    VARCHAR2(0200):=NULL;
v_letra   VARCHAR2(1):=NULL;

begin
	
	  return null; -- jgs20180228
	  
     Uc$varios.dsi_para('Uc$Varios.Letr_logo','B','letra_logotipos',v_per_val,v_tipo,v_mesg);
     IF v_mesg is not null then
			      v_letra:= NULL;
   	
	   ELSE     
     				v_letra := v_per_val;
     END IF;  
  RETURN(v_letra);  	  	  

EXCEPTION
  WHEN OTHERS THEN
     v_letra:= NULL;
     RETURN(v_letra);
END;]]>
      </textSource>
    </function>
    <function name="f_cs_subtotal2formattrigger">
      <textSource>
      <![CDATA[function F_CS_subtotal2FormatTrigger return boolean is
v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						Number(16,5):=0;
	v_tipo_mov			varchar2(3);
	
	v_tir           number;
	V_ACAB_EXT      number := 0;
	v_acab_sub      number := 0;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;	
	
	if :tipo_mov_aux = '1S' then
		v_valor := Subtotal_1S_RND(:Oba_Id,:GFO_ID);		
	elsif :tipo_mov_aux = '2A' then
		v_valor := Subtotal_2A_RND(:Oba_Id,:GFO_ID);
	elsif :tipo_mov_aux = '3X' then
		v_valor := Subtotal_3X_RND(:Oba_Id,:GFO_ID);			
	/*elsif upper(:tipo_mov_aux) not in ('4A','6D','7B') then
		v_valor := Subtotal_RND(:Oba_Id,:tipo_mov_aux,:GFO_ID);*/
	else
		v_valor := Subtotal_RND(:Oba_Id,:tipo_mov_aux,:GFO_ID);
  end if;

	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '%%%%%%%%%v_valor = '||v_valor||', :tipo_mov_aux = '||:tipo_mov_aux, null, null);
	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '%%%%%%%%%:cs_subcontratacao = '||:cs_subcontratacao, null, null);


  -- jgs20150121
    -- jgs20150121. Acumulados de acabamento
    
    if upper(:tipo_mov_aux) in ('7B') then
    
			 BEGIN
			 
			 				          v_tir := Tiragem (:p_Oba_Id);

				          

                  SELECT NVL(SUM(valor_euR*v_tir),0)
                  INTO   V_ACAB_EXT
                  from   BGO_AUXI_REPO_FATU
                  where  seq_id = :p_ses_id_ext
                  AND    N2     = :GFO_ID;
                --SRW.set_field_num (0, nvl(V_ACAB_EXT,0));
          
        EXCEPTION WHEN OTHERS THEN V_ACAB_EXT:=0;
        END;
        

				begin        
 
					SELECT nvl(sum(valor_euR),0) 
					into   v_acab_sub
					from   BGO_AUXI_REPO_FATU
					where  seq_id    = :p_ses_id_subc_encad
					and     n2       = :gfo_id;
				
				exception when others then v_acab_sub := 0; 
				end;
    
    end if; --if upper(:tipo_mov_aux) not in ('7B') then
    
  
  --

	if v_valor>nvl(:cs_subcontratacao,0) then
			v_valor:=v_valor-nvl(:cs_subcontratacao,0)-V_ACAB_EXT-v_acab_sub;
	else
			v_valor:=nvl(:cs_subcontratacao,0)-v_valor;
	end if;

	SRW.set_field_num (0, v_valor);	
  return (TRUE);
  
Exception
	when others then
		SRW.set_field_num (0, -1);
		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_subtotal3formattrigger">
      <textSource>
      <![CDATA[function F_CS_subtotal3FormatTrigger return boolean is
v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_valor						Number(16,5):=0;
	v_tipo_mov			varchar2(3);
	
	V_ACAB_EXT      number := 0;
	v_acab_sub      number := 0;
	
	v_tir           number;
	
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro /*and upper(:tipo_mov_aux) not in ('4A','6D','7B')*/ then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');

    -- jgs20150121. Acumulados de acabamento

    if upper(:tipo_mov_aux) in ('7B') then
    
			 BEGIN
			 
			 				          v_tir := Tiragem (:p_Oba_Id);

				          

                  SELECT NVL(SUM(valor_euR*v_tir),0)
                  INTO   V_ACAB_EXT
                  from   BGO_AUXI_REPO_FATU
                  where  seq_id = :p_ses_id_ext
                  AND    N2     = :GFO_ID;
                --SRW.set_field_num (0, nvl(V_ACAB_EXT,0));
          
        EXCEPTION WHEN OTHERS THEN V_ACAB_EXT:=0;
        END;
        

				begin        
 
					SELECT nvl(sum(valor_euR),0) 
					into   v_acab_sub
					from   BGO_AUXI_REPO_FATU
					where  seq_id    = :p_ses_id_subc_encad
					and     n2       = :gfo_id;
				
				exception when others then v_acab_sub := 0; 
				end;
    end if; --if upper(:tipo_mov_aux) in ('7B') then
    
    --

		SRW.set_field_num (0, nvl(:CS_SUBCONTRATACAO,0)+V_ACAB_EXT+v_acab_sub );
	ELSE
		return(FALSE);
	end if;	

  return (TRUE);
  
Exception
	when others then
		SRW.set_field_num (0, -1);
		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail3formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail3FormatTrigger return boolean is
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
	V_ACAB_EXT  NUMBER;
	V_TIR       NUMBER;
	
	v_acab_sub  number;
	
	v_arf_reg   bgo_auxi_repo_fatu%rowtype;
	
begin
	IF upper(:tipo_mov_aux)='7C' THEN -- Ivo Oliveira 24/05/2006 (7C)
		Return(False);
	Else	
		
		
		SELECT	valor_BG
		INTO		v_data_euro
		FROM 		BGO_PARAMETROS
		WHERE 	descricao = 'data_transicao';
		
		if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro /*and upper(:tipo_mov_aux) not in ('4A','6D','7B')*/ then
			SRW.SET_FORMAT_MASK('999 999 990D09"  "');
			
			if upper(:tipo_mov_aux)='7B' THEN		
			
			  -- jgs20141120

			  BEGIN
				          v_tir := Tiragem (:p_Oba_Id);
				          
	                UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'favalor_detail4 v_tir = '||to_char(nvl(v_tir ,-1)), null, null);

                  SELECT NVL(SUM(valor_euR*v_tir),0)
                  INTO   V_ACAB_EXT
                  from   BGO_AUXI_REPO_FATU
                  where  seq_id = :p_ses_id_ext
                  AND    N2     = :GFO_ID;
                --SRW.set_field_num (0, nvl(V_ACAB_EXT,0));
          
        EXCEPTION WHEN OTHERS THEN V_ACAB_EXT:=0;
        END;
			  
	      UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'V_ACAB_EXT = '||to_char(V_ACAB_EXT), null, null);

				begin        
 
					SELECT nvl(sum(valor_euR),0) 
					into   v_acab_sub
					from   BGO_AUXI_REPO_FATU
					where  seq_id    = :p_ses_id_subc_encad
					and     n2       = :gfo_id;
				
				exception when others then v_acab_sub := 0; 
				end;
        
	      UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'v_acab_sub = '||to_char(v_acab_sub), null, null);

			  -- jgs20141120
			
				if NVL(:CS_valor_eur_detail,0)* Tiragem(:P_Oba_Id)>nvl(:cf_subcontratacao,0) then
					SRW.set_field_num (0, NVL(:CS_valor_eur_detail,0)* Tiragem(:P_Oba_Id)-nvl(:CF_SUBCONTRATACAO,0) - V_ACAB_EXT- v_acab_sub);
				else
					SRW.set_field_num (0, v_acab_sub + V_ACAB_EXT + nvl(:CF_SUBCONTRATACAO,0)-NVL(:CS_valor_eur_detail,0)* Tiragem(:P_Oba_Id));
				end if;
			
			
			  --SRW.set_field_num (0, 8);  -- vai tudo para a subcontratação ... 
			
			
			else

          begin

                        select *
                        into   v_arf_reg
                        from   bgo_auxi_repo_fatu
                        where  seq_id                 = :p_ses_id
                        and    tip_reg                = 'BG'
                        and    c1                     = 'ACUMULADO'
                        and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
                        and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
                        and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
                        and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
                        and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
                        and    nvl(unidade,'#')       = nvl(:unidade,'#')
                        and    n1                     = :gfo_id;

          exception when others then v_arf_reg.valor_eur := 0;
          end;
          --


          if trunc(:order_by_num) != :order_by_num then    -- se for diferente É uma operação .. A operação tem + 0.5 e não tem acumulado. 

              SRW.set_field_num (0, 0);  -- vai tudo para a subcontratação ... 
                    
          else
          
            --  SRW.set_field_num (0, nvl(V_SUB,0) -  nvl(v_arf_reg.valor_eur,0));
						if NVL(:CS_valor_eur_detail,0) > nvl(:cf_subcontratacao,0) then
	
							SRW.set_field_num (0, NVL(:CS_valor_eur_detail,0)-nvl(:CF_SUBCONTRATACAO,0));  
	
						else
							SRW.set_field_num (0, nvl(:CF_SUBCONTRATACAO,0)-NVL(:CS_valor_eur_detail,0));
						end if;	

          end if; 
		 
		 end if;		

	  else
		  return(false);		
		end if;
	  	
		return (TRUE);
	End if;
end;
	]]>
      </textSource>
    </function>
    <function name="f_valor_detail4formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail4FormatTrigger return boolean is

	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
	V_ACAB_EXT  NUMBER;
	v_acab_sub  number;
	
	v_tir       number;
	v_arf_reg   bgo_auxi_repo_fatu%rowtype;
	
begin
	IF upper(:tipo_mov_aux)='7C' THEN -- Ivo Oliveira 24/05/2006 (7C)
		Return(False);
	Else
		
		
		SELECT	valor_BG
		INTO		v_data_euro
		FROM 		BGO_PARAMETROS
		WHERE 	descricao = 'data_transicao';
		
		if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro /*and upper(:tipo_mov_aux) not in ('4A','6D','7B') */then
			
			if upper(:tipo_mov_aux) in ('7B') then


			BEGIN
				          v_tir := Tiragem (:p_Oba_Id);
				          
	                UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'favalor_detail4 v_tir = '||to_char(nvl(v_tir ,-1)), null, null);

                  SELECT NVL(SUM(valor_euR*v_tir),0)
                  INTO   V_ACAB_EXT
                  from   BGO_AUXI_REPO_FATU
                  where  seq_id = :p_ses_id_ext
                  AND    N2     = :GFO_ID;
                --SRW.set_field_num (0, nvl(V_ACAB_EXT,0));
          
        EXCEPTION WHEN OTHERS THEN V_ACAB_EXT:=0;
        END;
        

				begin        
 
					SELECT sum(valor_euR) 
					into   v_acab_sub
					from   BGO_AUXI_REPO_FATU
					where  seq_id    = :p_ses_id_subc_encad
					and     n2       = :gfo_id;
				
				exception when others then v_acab_sub := 0; 
				end;
        
        

	      UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'favalor_detail4 :GFO_ID = '||to_char(nvl(:GFO_ID ,-1)), null, null);
	      UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'favalor_detail4 :p_ses_id_ext = '||to_char(nvl(:p_ses_id_ext ,-1)), null, null);
	      UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'favalor_detail4 V_ACAB_EXT = '||to_char(nvl(V_ACAB_EXT ,-1)), null, null);


				SRW.SET_FORMAT_MASK('999 999 990D09"  "');
				SRW.set_field_num (0, nvl(V_ACAB_EXT+v_acab_sub,0));
				
				--SRW.set_field_num (0, nvl(:CF_SUBCONTRATACAO,0));

			else


        --
        if trunc(:order_by_num) != :order_by_num then    -- se for diferente É uma operação .. A operação tem + 0.5 e não tem acumulado. 

                  begin

                                select sum(valor_eur)
                                into   v_arf_reg.valor_eur
                                from   bgo_auxi_repo_fatu
                                where  seq_id                 = :p_ses_id
                                and    tip_reg                = 'BG'
                                and    c1                     is null
                                and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
                                and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
                                and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
                                and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
                                and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
                                and    nvl(unidade,'#')       = nvl(:unidade,'#')
                                and    nvl(descricao,'#')     = nvl(:descricao_Detail,'#')
                                and    n1                     = :gfo_id;

                  exception when others then v_arf_reg.valor_eur := 0;
                  end;
        
        else
                -- jgs20141031
                  --
                  begin
        
                                select *
                                into   v_arf_reg
                                from   bgo_auxi_repo_fatu
                                where  seq_id                 = :p_ses_id
                                and    tip_reg                = 'BG'
                                and    c1                     = 'ACUMULADO'
                                and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
                                and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV,-1)
                                and    TIPO_MOV_AUX           = :TIPO_MOV_AUX
                                and    nvl(order_by,'#')      = nvl(:order_by_detail,'#')
                                and    nvl(order_by_num,-1)   = nvl(:order_by_num,-1)
                                and    nvl(unidade,'#')       = nvl(:unidade,'#')
                                and    n1                     = :gfo_id;
        
                  exception when others then v_arf_reg.valor_eur := 0;
                  end;
                        UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', 'F_Valor_Detail3FormatTrigger v_arf_reg.valor_eur = '||to_char(nvl(v_arf_reg.valor_eur,-1)), null, null);
                -- fim jgs20141031
        end if;   -- buscar acumulado para subtrair if trunc(:order_by_num) != :order_by_num then    -- se for diferente É uma operação .. A operação tem + 0.5 e não tem acumulado. 


				SRW.SET_FORMAT_MASK('999 999 990D09"  "');
				--SRW.set_field_num (0, nvl(:CF_SUBCONTRATACAO,0));
                
                -- SRW.set_field_num (0, nvl(:CF_SUBCONTRATACAO,0));
                -- jgs20141031 SRW.set_field_num (0, nvl(V_SUB,0));
        if trunc(:order_by_num) != :order_by_num then    -- se for diferente É uma operação .. A operação tem + 0.5
              SRW.set_field_num (0, nvl(v_arf_reg.valor_eur,0));
        else
              SRW.set_field_num (0, nvl(:CF_SUBCONTRATACAO,0) -  nvl(v_arf_reg.valor_eur,0));
        end if; 
        
			end if;
			
		else
			return(FALSE);
		end if;
	
	  	
		return (TRUE);
	End if;
end;]]>
      </textSource>
    </function>
    <function name="cf_subcontratacaoformula" returnType="number">
      <textSource>
      <![CDATA[function CF_SUBCONTRATACAOFormula return Number is
    VALOR NUMBER(15,5);
begin
-- Ivo Oliveira 24/10/2002 - Valor de Subcontratação    
---
   IF :TIPO_MOV_AUX NOT IN ('2A','5O') THEN
      
      BEGIN
      
         Select sum(valor_eur)
         INTO   VALOR
         From   -- ERIBEIRO 2010-03-31 -- (SELECT SUM(SUO.VALOR_EUR) valor_eur
               (SELECT SUM(SUO.pre_ven) valor_eur
                FROM   BGO_SUBCONTRATACOES SUO,
                       BGO_OPERACOES_PROCESSADAS ODA,
                       BGO_OPERACOES_ANUAIS ONO,
                      (SELECT OPO_ID,
                              CCO_ID
                       FROM   BGO_OPERACOES_ANUAIS ONO2,
                              BGO_PARAMETROS PAR
                       WHERE  ONO2.ANO = TO_NUMBER(PAR.VALOR_BG)
                       AND    PAR.DESCRICAO = 'ano_geracao_custos') aux, -- ERIBEIRO 2010-03-31 --  Tabela aux para ir buscar desc do ano da geração de custos                          
                       BGO_CENTROS_CUSTOS CCO
                WHERE  SUO.ODA_ID=ODA.ID
                AND    ODA.OBA_ID=:OBA_ID
                AND    ODA.ONO_ID=ONO.ID
                AND    ONO.OPO_ID = AUX.OPO_ID  -- ERIBEIRO 2010-03-31 -- 
                AND    AUX.CCO_ID = CCO.ID      -- ERIBEIRO 2010-03-31 -- 
                --AND ONO.CCO_ID=CCO.ID       
                AND    CCO.DESCRICAO=:DESCRICAO_DETAIL
                AND    ODA.IGC_ID IN (SELECT DISTINCT
                                             IGC.ID
                                      FROM   BGO_VALORES_FACTURACAO VFO,
                                             BGO_INDICES_GERACAO_CUSTOS IGC
                                      WHERE  VFO.OBA_ID_REFERENTE=ODA.OBA_ID
                                      AND    VFO.IGC_ID=IGC.ID
                                      AND    IGC.ESTADO='A'
                                      AND    VFO.OBA_ID_REFERENTE=:OBA_ID -- IVO OLIVEIRA 25/07/2003                                               
                                      AND    ODA.IGC_ID=IGC.ID /*AND ROWNUM=1*/)
                AND    SUO.CONSIDERAR='S'
                AND    ODA.PRE_ID IN (SELECT ID
                                      FROM   BGO_PARTES
                                      WHERE  OBA_ID=:OBA_ID
                                      AND    GFO_ID=:GFO_ID_DETAIL)
                union all
                -- ERIBEIRO 2010-03-31 -- SELECT sum(SUO.VALOR_EUR*AOA.PERCENTAGEM_CUSTOS/100) valor_eur
                SELECT sum(SUO.pre_ven*AOA.PERCENTAGEM_CUSTOS/100) VALOR_EUR
                FROM   BGO_SUBCONTRATACOES SUO,
                       BGO_OPERACOES_PROCESSADAS ODA,
                       BGO_ASSOCIACOES_OBRAS AOA,
                       BGO_OBRAS OBA,
                       BGO_ASSOCIACOES_PARTES APE,
                       BGO_PARTES PRE,
                       BGO_OPERACOES_ANUAIS ONO,
                      (SELECT OPO_ID,
                              CCO_ID
                       FROM   BGO_OPERACOES_ANUAIS ONO2,
                              BGO_PARAMETROS PAR
                       WHERE  ONO2.ANO = TO_NUMBER(PAR.VALOR_BG)
                       AND    PAR.DESCRICAO = 'ano_geracao_custos') aux, -- ERIBEIRO 2010-03-31 --  Tabela aux para ir buscar desc do ano da geração de custos     
                       BGO_CENTROS_CUSTOS CCO            
                WHERE  SUO.ODA_ID=ODA.ID
                AND    AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
                AND    PRE.ID=APE.PRE_ID_RECEPTORA
                AND    ODA.ONO_ID=ONO.ID
                AND    ONO.OPO_ID = AUX.OPO_ID  -- ERIBEIRO 2010-03-31 --
                AND    AUX.CCO_ID = CCO.ID      -- ERIBEIRO 2010-03-31 --
                --AND    ONO.CCO_ID=CCO.ID                
                AND    CCO.DESCRICAO=:DESCRICAO_DETAIL
                AND    AOA.FLG_DISC_VALO='N'-- Se não for p/ discriminar, os valores da associada aparecem somados à receptora             
                AND    PRE.ID IN (SELECT ID
                                  FROM   BGO_PARTES
                                  WHERE  OBA_ID=:OBA_ID
                                  AND    GFO_ID=:GFO_ID_DETAIL)
                AND    AOA.OBA_ID_RECEPTORA=:OBA_ID
                AND    OBA.ID=AOA.OBA_ID_ASSOCIADA
                --AND OBA.ID=:OBA_ID_PROV
                --AND OBA.TITULO_ABREVIADO=:DESCRICAO_DETAIL
                AND    APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
                AND    APE.PRE_ID_RECEPTORA IN (SELECT ID FROM BGO_PARTES WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
                AND    AOA.ID = (SELECT MAX(ID)
                                 FROM   BGO_ASSOCIACOES_OBRAS
                                 WHERE  OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
                                 AND    OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
                AND    ODA.IGC_ID IN (SELECT DISTINCT 
                                             IGC_id_proveniente
                                      FROM   BGO_VALORES_FACTURACAO VFO,
                                             BGO_INDICES_GERACAO_CUSTOS IGC
                                      WHERE  VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
                                      AND    VFO.IGC_ID=IGC.ID
                                      AND    IGC.ESTADO='A'
                                      and    vfo.oba_id_referente=aoa.oba_id_receptora
                                      AND    vfo.tipo_movimento != 'G' 
                                      AND    vfo.oba_id_referente <> vfo.oba_id_proveniente
                                      AND    ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
                                      AND    VFO.OBa_ID_REFERENTE=:OBA_ID -- IVO OLIVEIRA 25/07/2003 
                                      /*AND ROWNUM=1*/)
                AND    CONSIDERAR='S');            
      EXCEPTION 
      WHEN OTHERS THEN
         VALOR:=0;
      END;

   else

      BEGIN
         -- ERIBEIRO 2010-03-31 -- SELECT  sum(SUO.VALOR_EUR*AOA.PERCENTAGEM_CUSTOS/100)
         SELECT sum(SUO.pre_ven*AOA.PERCENTAGEM_CUSTOS/100)      
         into   valor
         FROM   BGO_SUBCONTRATACOES SUO,
                BGO_OPERACOES_PROCESSADAS ODA,
                BGO_ASSOCIACOES_OBRAS AOA,
                BGO_OBRAS OBA,
                BGO_ASSOCIACOES_PARTES APE,
                BGO_PARTES PRE
         WHERE  SUO.ODA_ID=ODA.ID
         AND    AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
         AND    PRE.ID=APE.PRE_ID_RECEPTORA
         AND    PRE.ID IN (SELECT ID
                           FROM   BGO_PARTES
                           WHERE  OBA_ID=:OBA_ID
                           AND    GFO_ID=:GFO_ID_DETAIL)
         AND    AOA.OBA_ID_RECEPTORA=:OBA_ID
         AND    OBA.ID=AOA.OBA_ID_ASSOCIADA
         AND    OBA.ID=:OBA_ID_PROV
         --AND OBA.TITULO_ABREVIADO=:DESCRICAO_DETAIL
         AND    APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
         AND    APE.PRE_ID_RECEPTORA IN (SELECT ID FROM BGO_PARTES WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
         AND    AOA.ID = (SELECT MAX(ID)
                          FROM   BGO_ASSOCIACOES_OBRAS
                          WHERE  OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
                          AND    OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
         AND    ODA.IGC_ID IN (SELECT DISTINCT 
                                      IGC_id_proveniente
                               FROM   BGO_VALORES_FACTURACAO VFO,
                                      BGO_INDICES_GERACAO_CUSTOS IGC
                               WHERE  VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
                               AND    VFO.IGC_ID=IGC.ID
                               AND    IGC.ESTADO='A'
                               and    vfo.oba_id_referente=aoa.oba_id_receptora
                               AND    vfo.tipo_movimento != 'G' 
                               AND    vfo.oba_id_referente <> vfo.oba_id_proveniente
                               AND    ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
                               AND    VFO.OBA_ID_REFERENTE=:OBA_ID -- IVO OLIVEIRA 25/07/2003
                                /*AND ROWNUM=1*/)
         AND    CONSIDERAR='S';
      EXCEPTION
      WHEN OTHERS THEN
         VALOR:=0;
      END;

   end if;
      
  RETURN(NVL(VALOR,0));
  
END;

	]]>
      </textSource>
    </function>
    <function name="b_cs_total3formattrigger">
      <textSource>
      <![CDATA[function B_CS_total3FormatTrigger return boolean is
begin

  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_total3formattrigger">
      <textSource>
      <![CDATA[function F_CS_total3FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_total_1S				bgo_valores_facturacao.valor%type:=0;
	v_total_3X				bgo_valores_facturacao.valor%type:=0;
	v_total 					Number (38,2):=0;
begin
	
	/* EURO */
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 999 999 990D09" "');
	end if;
	
	return (TRUE);
end;	]]>
      </textSource>
    </function>
    <function name="f_entidade1formattrigger">
      <textSource>
      <![CDATA[function F_Entidade1FormatTrigger return boolean is
begin
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_18formattrigger">
      <textSource>
      <![CDATA[function F_18FormatTrigger return boolean is
	v_tipo_mov varchar(3);
  dummy number(1);
begin
	
 	 	 --SRW.set_field_char (0, 'Sub-total');
 	 	 SRW.set_field_char (0, 'Subtotal');
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail5formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail5FormatTrigger return boolean is
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';

	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;
  
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_descricao_detail3formattrigg">
      <textSource>
      <![CDATA[function F_descricao_Detail3FormatTrigg return boolean is
begin
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_subtotal4formattrigger">
      <textSource>
      <![CDATA[function F_CS_subtotal4FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;	
	
  return (TRUE);
  
Exception
	when others then
		SRW.set_field_num (0, -1);
		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="m_g_descricao_detail_ftr2forma">
      <textSource>
      <![CDATA[function M_G_descricao_Detail_FTR2Forma return boolean is
begin
 
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="r_g_descricao_detail3formattri">
      <textSource>
      <![CDATA[function R_G_descricao_Detail3FormatTri return boolean is
begin
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail6formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail6FormatTrigger return boolean is
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
	
	v_arf_reg		bgo_auxi_repo_fatu%rowtype;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro and upper(:tipo_mov_aux1) not in ('4A','6D','7B') then


    if trunc(:order_by_num2) != :order_by_num2 then    -- se for diferente É uma operação .. A operação tem + 0.5 e não tem acumulado. 

			SRW.SET_FORMAT_MASK('999 999 990D09"  "');
			SRW.set_field_num (0, :CS_valor_eur_detail1);

    else

      -- é uma das anteriores... Subtrir acumulado...
	    begin
	
	        select *
	        into   v_arf_reg
	        from   bgo_auxi_repo_fatu
	        where  seq_id                 = :p_ses_id
	        and    tip_reg                = 'EDI'
	        and    c1                     = 'ACUMULADO'
	        and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
	        and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV2,-1)
	        and    TIPO_MOV_AUX           = :TIPO_MOV_AUX1
	        and    nvl(order_by,'#')      = nvl(:order_by_detail1,'#')
	        and    nvl(order_by_num,-1)   = nvl(:order_by_num2,-1)
	        and    nvl(unidade,'#')       = nvl(:unidade1,'#')
	        and    n1                     = :gfo_id_detail1;
	
	    exception when others then v_arf_reg.valor_eur := 0;
	    end;
      
      

			SRW.SET_FORMAT_MASK('999 999 990D09"  "');
			SRW.set_field_num (0, :CS_valor_eur_detail1+nvl(:CS_VALOR_SUB,0)-v_arf_reg.valor_eur);

    end if;


  else
	  return(false);		
	end if;
  	
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail7formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail7FormatTrigger return boolean is
	
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
	v_arf_reg bgo_auxi_repo_fatu%rowtype;
	
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro /*and upper(:tipo_mov_aux1) not in ('4A','6D','7B')*/ then

    if trunc(:order_by_num2) != :order_by_num2 then    -- se for diferente É uma operação .. A operação tem + 0.5 e não tem acumulado. 

				SRW.SET_FORMAT_MASK('999 999 990D09" "');
				SRW.set_field_num (0, :CS_valor_eur_detail1);
		
    else


	    begin
	
	        select *
	        into   v_arf_reg
	        from   bgo_auxi_repo_fatu
	        where  seq_id                 = :p_ses_id
	        and    tip_reg                = 'EDI'
	        and    c1                     = 'ACUMULADO'
	        and    nvl(oba_id,-1)         = nvl(:oba_id,-1)
	        and    nvl(OBA_ID_PROV,-1)    = nvl(:OBA_ID_PROV2,-1)
	        and    TIPO_MOV_AUX           = :TIPO_MOV_AUX1
	        and    nvl(order_by,'#')      = nvl(:order_by_detail1,'#')
	        and    nvl(order_by_num,-1)   = nvl(:order_by_num2,-1)
	        and    nvl(unidade,'#')       = nvl(:unidade1,'#')
	        and    n1                     = :gfo_id_detail1;
	
	    exception when others then v_arf_reg.valor_eur := 0;
	    end;
    --


      
			SRW.SET_FORMAT_MASK('999 999 990D09" "');
			SRW.set_field_num (0, nvl(:CS_VALOR_SUB,0)- v_arf_reg.valor_eur);

    end if;
		
	else
		return(FALSE);
	end if;

  	
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="b_cs_total4formattrigger">
      <textSource>
      <![CDATA[function B_CS_total4FormatTrigger return boolean is
begin

  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_total4formattrigger">
      <textSource>
      <![CDATA[function F_CS_total4FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_total_1S				bgo_valores_facturacao.valor%type:=0;
	v_total_3X				bgo_valores_facturacao.valor%type:=0;
	v_total 					Number (38,2):=0;
begin
	
	/* EURO */
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 999 999 990D09"  "');
	end if;
	
	return (TRUE);
end;	]]>
      </textSource>
    </function>
    <function name="f_entidade2formattrigger">
      <textSource>
      <![CDATA[function F_Entidade2FormatTrigger return boolean is
begin
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_19formattrigger">
      <textSource>
      <![CDATA[function F_19FormatTrigger return boolean is
	v_tipo_mov varchar(3);
  dummy number(1);
begin
	
 	 	 -- SRW.set_field_char (0, 'Sub-total');
 	 	 SRW.set_field_char (0, 'Subtotal');
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail8formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail8FormatTrigger return boolean is
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';

	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;
  
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_descricao_detail4formattrigg">
      <textSource>
      <![CDATA[function F_descricao_Detail4FormatTrigg return boolean is
begin
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_subtotal5formattrigger">
      <textSource>
      <![CDATA[function F_CS_subtotal5FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;	
	
  return (TRUE);
  
Exception
	when others then
		SRW.set_field_num (0, -1);
		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="m_g_descricao_detail_ftr3forma">
      <textSource>
      <![CDATA[function M_G_descricao_Detail_FTR3Forma return boolean is
begin
 
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="r_g_descricao_detail4formattri">
      <textSource>
      <![CDATA[function R_G_descricao_Detail4FormatTri return boolean is
begin
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="b_cs_total5formattrigger">
      <textSource>
      <![CDATA[function B_CS_total5FormatTrigger return boolean is
begin

  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_total5formattrigger">
      <textSource>
      <![CDATA[function F_CS_total5FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_total_1S				bgo_valores_facturacao.valor%type:=0;
	v_total_3X				bgo_valores_facturacao.valor%type:=0;
	v_total 					Number (38,2):=0;
begin
	
	/* EURO */
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 999 999 990D09"  "');
	end if;
	
	return (TRUE);
end;	]]>
      </textSource>
    </function>
    <function name="f_entidade3formattrigger">
      <textSource>
      <![CDATA[function F_Entidade3FormatTrigger return boolean is
begin
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_20formattrigger">
      <textSource>
      <![CDATA[function F_20FormatTrigger return boolean is
	v_tipo_mov varchar(3);
  dummy number(1);
begin
	
 	 	 -- SRW.set_field_char (0, 'Sub-total');
 	 	 SRW.set_field_char (0, 'Subtotal');
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_valor_detail9formattrigger">
      <textSource>
      <![CDATA[function F_Valor_Detail9FormatTrigger return boolean is
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';

	if to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;
  
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_descricao_detail5formattrigg">
      <textSource>
      <![CDATA[function F_descricao_Detail5FormatTrigg return boolean is
begin
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_subtotal6formattrigger">
      <textSource>
      <![CDATA[function F_CS_subtotal6FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
begin
	
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;	
	
  return (TRUE);
  
Exception
	when others then
		SRW.set_field_num (0, -1);
		return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="m_g_descricao_detail_ftr4forma">
      <textSource>
      <![CDATA[function M_G_descricao_Detail_FTR4Forma return boolean is
begin
 
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="r_g_descricao_detail5formattri">
      <textSource>
      <![CDATA[function R_G_descricao_Detail5FormatTri return boolean is
begin
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="m_g_consumiveis_grpfr2formattr">
      <textSource>
      <![CDATA[function M_G_Consumiveis_GRPFR2FormatTr return boolean is
begin
	if :cf_existe_sub='S' then
		return(true);
	else
		return(false);
	end if;
end;
]]>
      </textSource>
    </function>
    <function name="m_g_consumiveis_grpfr4formattr">
      <textSource>
      <![CDATA[function M_G_Consumiveis_GRPFR4FormatTr return boolean is
  DUMMY NUMBER(1);
begin
 begin
	SELECT distinct 1
	into dummy
	FROM 
	(select 1
	 from BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND PRE.ID=ODA.PRE_ID
   AND EXISTS (SELECT 1
	 			   	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		  				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
   AND ODA.IGC_ID IN (SELECT IGC.ID
							    	  FROM BGO_VALORES_FACTURACAO VFO
			   							,		 BGO_INDICES_GERACAO_CUSTOS IGC
			   							WHERE VFO.OBA_ID_REFERENTE=ODA.OBA_ID
			   							AND	 VFO.IGC_ID=IGC.ID
			   							AND IGC.ESTADO='A'
			   							AND ODA.IGC_ID=IGC.ID
			   							AND ROWNUM=1)
	 AND CONSIDERAR='N'
   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='S'	 
   AND ODA.OBA_ID=:OBA_ID
   AND ODA.PRE_ID IN (SELECT ID
   										FROM BGO_PARTES 
   										WHERE OBA_ID=:OBA_ID2
   										AND GFO_ID=:GFO_ID)
		-- JGS20150313
	 AND    ODA.ID NOT IN (SELECT ODA_ID FROM BGO_AUXI_REPO_FATU WHERE SEQ_ID = :P_SES_ID_CUS_PE AND ODA_ID IS NOT NULL and n1 = :GFO_ID )
		-- FIM JGS20150313
	 UNION ALL
	 SELECT 1
	 FROM BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_ASSOCIACOES_OBRAS AOA
	 ,		 BGO_OBRAS OBA
	 ,		 BGO_ASSOCIACOES_PARTES APE
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
	 AND PRE.ID=APE.PRE_ID_RECEPTORA
   AND EXISTS (SELECT 1
	 				 	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		   				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
	 AND PRE.GFO_ID=:GFO_ID
	 AND OBA.ID=AOA.OBA_ID_ASSOCIADA
	 AND APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
	 AND APE.PRE_ID_RECEPTORA IN (SELECT ID
	 														  FROM BGO_PARTES
	 														  WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
	 AND AOA.ID=(SELECT MAX(ID)
	 						 FROM BGO_ASSOCIACOES_OBRAS
							 WHERE OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
							 AND OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
	 AND ODA.IGC_ID IN (SELECT IGC_id_proveniente
									    FROM BGO_VALORES_FACTURACAO VFO
									    ,	BGO_INDICES_GERACAO_CUSTOS IGC
									    WHERE VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
									    AND VFO.IGC_ID=IGC.ID
									    AND IGC.ESTADO='A'
									    and vfo.oba_id_referente=aoa.oba_id_receptora
									    AND vfo.tipo_movimento != 'G' 
									    AND vfo.oba_id_referente <> vfo.oba_id_proveniente
			   							AND ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
			   							AND ROWNUM=1)
	 AND CONSIDERAR='N'
   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='S'	 
	 AND AOA.OBA_ID_RECEPTORA=:OBA_ID);

   return(true);
 exception when others then
   return(false);
 end;

  
end;

]]>
      </textSource>
    </function>
    <function name="m_g_consumiveis_grpfr3formattr">
      <textSource>
      <![CDATA[function M_G_Consumiveis_GRPFR3FormatTr return boolean is

  V_EXISTE		VARCHAR2(1);

begin
	
	--##JGS20150318##
	V_EXISTE := EXISTE_CUST_PE(:GFO_ID);
	
	IF V_EXISTE = 'S' THEN
		RETURN TRUE;
--	RETURN FALSE;
  END IF;
	
	if :cf_Existe_Sub_Outr='S' then
		return(true);
	else
		return(false);
	end if;
end;

		]]>
      </textSource>
    </function>
    <function name="m_g_master_cabecalho_grpfr1for">
      <textSource>
      <![CDATA[function M_G_Master_Cabecalho_GRPFR1For return boolean is
  dummy number(6);
  v_pe  varchar2(10);
  v_num NUMBER;
begin

    /*
	  -- jgs20150318 -parece ser generico
	  v_pe := existe_cust_pe(null);
	  IF V_PE = 'S' then
	  	return true;
	  end if;
	  */

   select count(1)
   into   v_num
   from   (
   SELECT  arf.oba_id oba_id_Detail1,
        arf.oba_id_prov oba_id_prov2,
        arf.descricao descricao_Detail1,
        arf.tipo_mov_aux tipo_mov_aux1,
        arf.order_by order_by_detail1,
        arf.order_by_num order_by_num2,
        sum(arf.quantidade) quantidade1,
        arf.unidade unidade1,
        sum(arf.tempo) tempo1,
        sum(arf.valor) Valor_Detail1,
        sum(arf.valor_eur) Valor_eur_Detail1,
        0 valor_sub,
        null dummy1
        FROM    bgo_auxi_repo_fatu arf
        where   arf.seq_id = :P_SES_ID_CUS_PE
        and     tip_reg      = 'CUS_PE'
        and     c1= 'TOTAL');
        
    IF V_NUM > 0 THEN
    	RETURN TRUE;
    END IF;


		SELECT count(*)
		into dummy
		FROM BGO_ANALISE_NAO_FACT_GF_V ANG
		where oba_id=:P_oba_id
    AND EXISTS (SELECT 1
			 	   	    FROM	 BGO_RESUMO_ARTIGOS_GF_TEMP tmp
  				 			WHERE  tmp.Id = :P_Id
           			AND    tmp.gfo_id = ANG.gfo_id);
	
	  if 	dummy>0 then
	  	return (TRUE);
	  else
			 begin
				SELECT distinct 1
				into dummy
				FROM 
				(select 1
				 from BGO_SUBCONTRATACOES SUO
				 ,		 BGO_OPERACOES_PROCESSADAS ODA
				 ,		 BGO_PARTES PRE
				 WHERE SUO.ODA_ID=ODA.ID
				 AND PRE.ID=ODA.PRE_ID
			   AND EXISTS (SELECT 1
				 			   	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
					  				 WHERE  tmp.Id = :P_Id
			               AND    tmp.gfo_id = pre.gfo_id)	 
			   AND ODA.IGC_ID IN (SELECT IGC.ID
										    	  FROM BGO_VALORES_FACTURACAO VFO
						   							,		 BGO_INDICES_GERACAO_CUSTOS IGC
						   							WHERE VFO.OBA_ID_REFERENTE=ODA.OBA_ID
						   							AND	 VFO.IGC_ID=IGC.ID
						   							AND IGC.ESTADO='A'
						   							AND ODA.IGC_ID=IGC.ID
						   							AND ROWNUM=1)
				 AND CONSIDERAR<>'S' AND CONSIDERAR IS NOT NULL -- Ivo Oliveira 17/07/2003
			   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='N'	 
			   AND ODA.OBA_ID=:P_OBA_ID
				 UNION ALL
				 SELECT 1
				 FROM BGO_SUBCONTRATACOES SUO
				 ,		 BGO_OPERACOES_PROCESSADAS ODA
				 ,		 BGO_ASSOCIACOES_OBRAS AOA
				 ,		 BGO_OBRAS OBA
				 ,		 BGO_ASSOCIACOES_PARTES APE
				 ,		 BGO_PARTES PRE
				 WHERE SUO.ODA_ID=ODA.ID
				 AND AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
				 AND PRE.ID=APE.PRE_ID_RECEPTORA
			   AND EXISTS (SELECT 1
				 				 	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
					   				 WHERE  tmp.Id = :P_Id
			               AND    tmp.gfo_id = pre.gfo_id)	 
				 AND OBA.ID=AOA.OBA_ID_ASSOCIADA
				 AND APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
				 AND APE.PRE_ID_RECEPTORA IN (SELECT ID
				 														  FROM BGO_PARTES
				 														  WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
				 AND AOA.ID=(SELECT MAX(ID)
				 						 FROM BGO_ASSOCIACOES_OBRAS
										 WHERE OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
										 AND OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
				 AND ODA.IGC_ID IN (SELECT IGC_id_proveniente
												    FROM BGO_VALORES_FACTURACAO VFO
												    ,	BGO_INDICES_GERACAO_CUSTOS IGC
												    WHERE VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
												    AND VFO.IGC_ID=IGC.ID
												    AND IGC.ESTADO='A'
												    and vfo.oba_id_referente=aoa.oba_id_receptora
												    AND vfo.tipo_movimento != 'G' 
												    AND vfo.oba_id_referente <> vfo.oba_id_proveniente
						   							AND ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
						   							AND ROWNUM=1)
				 AND CONSIDERAR<>'S' AND CONSIDERAR IS NOT NULL -- Ivo Oliveira 17/07/2003
			   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='N'	 
				 AND AOA.OBA_ID_RECEPTORA=:P_OBA_ID);
			
			   return(true);
			 exception when others then
			   return(false);
			 end;	 
		end if;
	  
end;]]>
      </textSource>
    </function>
    <function name="r_g_master_cabecalho1formattri">
      <textSource>
      <![CDATA[function R_G_Master_Cabecalho1FormatTri return boolean is
begin
	
	-- jgs20150318: atenção, pq mesmo sem existir para este grupo, está a aparecer o quadro.
	-- se depois pedirem para alterar, deve ser CR.
	
	  	return (TRUE);
	  
end;]]>
      </textSource>
    </function>
    <function name="f_9formattrigger">
      <textSource>
      <![CDATA[function F_9FormatTrigger return boolean is
	v_folhas number(14,5);
begin	
	v_folhas:=to_number(:cf_num_folhas);
	SRW.set_field_char(0, to_char(v_folhas, '999990D099') );
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_12formattrigger">
      <textSource>
      <![CDATA[function F_12FormatTrigger return boolean is
	v_folhas number(14,5);
begin		
	v_folhas:=to_number(:cf_num_folhas);
	SRW.set_field_char(0, rtrim(to_char(v_folhas, '999990D9999'),0) );
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="cf_existe_subformula" returnType="character">
      <textSource>
      <![CDATA[function CF_Existe_SubFormula return Char is
  DUMMY NUMBER(1);
begin
 -- Ivo Oliveira 21/11/2002
 -- Esta função serve para verificar se há ou não registos de subcontratação, de forma
 -- a mostrar ou não o quadro de subcontratação
 begin

	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', ':gfo_id = '||TO_CHAR(:gfo_id), null, null);

	SELECT distinct 1
	into dummy
	FROM 
	(select 1
	 from BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND PRE.ID=ODA.PRE_ID
   AND EXISTS (SELECT 1
	 			   	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		  				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
   AND ODA.IGC_ID IN (SELECT IGC.ID
							    	  FROM BGO_VALORES_FACTURACAO VFO
			   							,		 BGO_INDICES_GERACAO_CUSTOS IGC
			   							WHERE VFO.OBA_ID_REFERENTE=ODA.OBA_ID
			   							AND	 VFO.IGC_ID=IGC.ID
			   							AND IGC.ESTADO='A'
			   							AND ODA.IGC_ID=IGC.ID
			   							AND ROWNUM=1)
	 AND CONSIDERAR='S'
   AND ODA.OBA_ID=:OBA_ID
   AND ODA.PRE_ID IN (SELECT ID
   										FROM BGO_PARTES 
   										WHERE OBA_ID=:OBA_ID2
   										AND GFO_ID=:GFO_ID)
	 UNION ALL
	 SELECT 1
	 FROM BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_ASSOCIACOES_OBRAS AOA
	 ,		 BGO_OBRAS OBA
	 ,		 BGO_ASSOCIACOES_PARTES APE
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
	 AND PRE.ID=APE.PRE_ID_RECEPTORA
   AND EXISTS (SELECT 1
	 				 	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		   				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
	 AND PRE.GFO_ID=:GFO_ID
	 AND OBA.ID=AOA.OBA_ID_ASSOCIADA
	 AND APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
	 AND APE.PRE_ID_RECEPTORA IN (SELECT ID
	 														  FROM BGO_PARTES
	 														  WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
	 AND AOA.ID=(SELECT MAX(ID)
	 						 FROM BGO_ASSOCIACOES_OBRAS
							 WHERE OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
							 AND OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
	 AND ODA.IGC_ID IN (SELECT IGC_id_proveniente
									    FROM BGO_VALORES_FACTURACAO VFO
									    ,	BGO_INDICES_GERACAO_CUSTOS IGC
									    WHERE VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
									    AND VFO.IGC_ID=IGC.ID
									    AND IGC.ESTADO='A'
									    and vfo.oba_id_referente=aoa.oba_id_receptora
									    AND vfo.tipo_movimento != 'G' 
									    AND vfo.oba_id_referente <> vfo.oba_id_proveniente
			   							AND ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
			   							AND ROWNUM=1)
	 AND CONSIDERAR='S'
	 AND AOA.OBA_ID_RECEPTORA=:OBA_ID

	 UNION ALL   -- JGS20141120 
	 
		SELECT 1
		from  BGO_AUXI_REPO_FATU
		where seq_id = :p_ses_id_ext
		and     n2       = :gfo_id   

	 UNION ALL   -- JGS20141120 

		SELECT 1
		from  BGO_AUXI_REPO_FATU
		where seq_id = :p_ses_id_subc_encad
		and     n2       = :gfo_id
	 
	 );
		

	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'CF_EXISTE_SUB = S', null, null);


	 return('S');
 exception when others then
	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'CF_EXISTE_SUB = N', null, null);
   return('N');
 end;

  
end;]]>
      </textSource>
    </function>
    <function name="cf_existe_sub_outrformula" returnType="character">
      <textSource>
      <![CDATA[function CF_Existe_Sub_OutrFormula return Char is
  DUMMY NUMBER(1);
begin
 -- Ivo Oliveira 21/11/2002
 -- Esta função serve para verificar se há ou não registos de subcontratação, de forma
 -- a mostrar ou não o quadro de subcontratação
 begin
	SELECT distinct 1
	into dummy
	FROM 
	(select 1
	 from BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND PRE.ID=ODA.PRE_ID
   AND EXISTS (SELECT 1
	 			   	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		  				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
   AND ODA.IGC_ID IN (SELECT IGC.ID
							    	  FROM BGO_VALORES_FACTURACAO VFO
			   							,		 BGO_INDICES_GERACAO_CUSTOS IGC
			   							WHERE VFO.OBA_ID_REFERENTE=ODA.OBA_ID
			   							AND	 VFO.IGC_ID=IGC.ID
			   							AND IGC.ESTADO='A'
			   							AND ODA.IGC_ID=IGC.ID
			   							AND ROWNUM=1)
	 AND CONSIDERAR<>'S' AND CONSIDERAR IS NOT NULL -- Ivo Oliveira 17/07/2003
   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='N'	 
   AND ODA.OBA_ID=:OBA_ID
   AND ODA.PRE_ID IN (SELECT ID
   										FROM BGO_PARTES 
   										WHERE OBA_ID=:OBA_ID2
   										AND GFO_ID=:GFO_ID)
	 UNION ALL
	 SELECT 1
	 FROM BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_ASSOCIACOES_OBRAS AOA
	 ,		 BGO_OBRAS OBA
	 ,		 BGO_ASSOCIACOES_PARTES APE
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
	 AND PRE.ID=APE.PRE_ID_RECEPTORA
   AND EXISTS (SELECT 1
	 				 	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		   				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
	 AND PRE.GFO_ID=:GFO_ID
	 AND OBA.ID=AOA.OBA_ID_ASSOCIADA
	 AND APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
	 AND APE.PRE_ID_RECEPTORA IN (SELECT ID
	 														  FROM BGO_PARTES
	 														  WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
	 AND AOA.ID=(SELECT MAX(ID)
	 						 FROM BGO_ASSOCIACOES_OBRAS
							 WHERE OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
							 AND OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
	 AND ODA.IGC_ID IN (SELECT IGC_id_proveniente
									    FROM BGO_VALORES_FACTURACAO VFO
									    ,	BGO_INDICES_GERACAO_CUSTOS IGC
									    WHERE VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
									    AND VFO.IGC_ID=IGC.ID
									    AND IGC.ESTADO='A'
									    and vfo.oba_id_referente=aoa.oba_id_receptora
									    AND vfo.tipo_movimento != 'G' 
									    AND vfo.oba_id_referente <> vfo.oba_id_proveniente
			   							AND ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
			   							AND ROWNUM=1)
	 AND CONSIDERAR<>'S' AND CONSIDERAR IS NOT NULL -- Ivo Oliveira 17/07/2003
   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='N'	 
	 AND AOA.OBA_ID_RECEPTORA=:OBA_ID);

   return('S');
 exception when others then
   return('N');
 end;

  
end;

]]>
      </textSource>
    </function>
    <function name="f_exterior1formattrigger">
      <textSource>
      <![CDATA[function F_Exterior1FormatTrigger return boolean is
  DUMMY NUMBER(1);
begin
 begin
	SELECT distinct 1
	into dummy
	FROM 
	(select 1
	 from BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND PRE.ID=ODA.PRE_ID
   AND EXISTS (SELECT 1
	 			   	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		  				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
   AND ODA.IGC_ID IN (SELECT IGC.ID
							    	  FROM BGO_VALORES_FACTURACAO VFO
			   							,		 BGO_INDICES_GERACAO_CUSTOS IGC
			   							WHERE VFO.OBA_ID_REFERENTE=ODA.OBA_ID
			   							AND	 VFO.IGC_ID=IGC.ID
			   							AND IGC.ESTADO='A'
			   							AND ODA.IGC_ID=IGC.ID
			   							AND ROWNUM=1)
	 AND CONSIDERAR='S'
   AND ODA.OBA_ID=:OBA_ID
   AND ODA.PRE_ID IN (SELECT ID
   										FROM BGO_PARTES 
   										WHERE OBA_ID=:OBA_ID2
   										AND GFO_ID=:GFO_ID)
	 UNION ALL
	 SELECT 1
	 FROM BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_ASSOCIACOES_OBRAS AOA
	 ,		 BGO_OBRAS OBA
	 ,		 BGO_ASSOCIACOES_PARTES APE
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
	 AND PRE.ID=APE.PRE_ID_RECEPTORA
   AND EXISTS (SELECT 1
	 				 	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		   				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
	 AND PRE.GFO_ID=:GFO_ID
	 AND OBA.ID=AOA.OBA_ID_ASSOCIADA
	 AND APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
	 AND APE.PRE_ID_RECEPTORA IN (SELECT ID
	 														  FROM BGO_PARTES
	 														  WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
	 AND AOA.ID=(SELECT MAX(ID)
	 						 FROM BGO_ASSOCIACOES_OBRAS
							 WHERE OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
							 AND OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
	 AND ODA.IGC_ID IN (SELECT IGC_id_proveniente
									    FROM BGO_VALORES_FACTURACAO VFO
									    ,	BGO_INDICES_GERACAO_CUSTOS IGC
									    WHERE VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
									    AND VFO.IGC_ID=IGC.ID
									    AND IGC.ESTADO='A'
									    and vfo.oba_id_referente=aoa.oba_id_receptora
									    AND vfo.tipo_movimento != 'G' 
									    AND vfo.oba_id_referente <> vfo.oba_id_proveniente
			   							AND ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
			   							AND ROWNUM=1)
	 AND CONSIDERAR='S'
	 AND AOA.OBA_ID_RECEPTORA=:OBA_ID);

	 srw.set_field_char(0,'Externo *');	
 exception when others then
 	 srw.set_field_char(0,'Externo');	
 end;

  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_exterior2formattrigger">
      <textSource>
      <![CDATA[function F_Exterior2FormatTrigger return boolean is
  DUMMY NUMBER(1);
begin
 -- Ivo Oliveira 21/11/2002
 -- Esta função serve para verificar se há ou não registos de subcontratação, de forma
 begin
	SELECT distinct 1
	into dummy
	FROM 
	(select 1
	 from BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND PRE.ID=ODA.PRE_ID
   AND EXISTS (SELECT 1
	 			   	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		  				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
   AND ODA.IGC_ID IN (SELECT IGC.ID
							    	  FROM BGO_VALORES_FACTURACAO VFO
			   							,		 BGO_INDICES_GERACAO_CUSTOS IGC
			   							WHERE VFO.OBA_ID_REFERENTE=ODA.OBA_ID
			   							AND	 VFO.IGC_ID=IGC.ID
			   							AND IGC.ESTADO='A'
			   							AND ODA.IGC_ID=IGC.ID
			   							AND ROWNUM=1)
	 AND CONSIDERAR<>'S' AND CONSIDERAR IS NOT NULL -- Ivo Oliveira 17/07/2003
   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='N'	 
   AND ODA.OBA_ID=:OBA_ID
   AND ODA.PRE_ID IN (SELECT ID
   										FROM BGO_PARTES 
   										WHERE OBA_ID=:OBA_ID2
   										AND GFO_ID=:GFO_ID)
	 UNION ALL
	 SELECT 1
	 FROM BGO_SUBCONTRATACOES SUO
	 ,		 BGO_OPERACOES_PROCESSADAS ODA
	 ,		 BGO_ASSOCIACOES_OBRAS AOA
	 ,		 BGO_OBRAS OBA
	 ,		 BGO_ASSOCIACOES_PARTES APE
	 ,		 BGO_PARTES PRE
	 WHERE SUO.ODA_ID=ODA.ID
	 AND AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
	 AND PRE.ID=APE.PRE_ID_RECEPTORA
   AND EXISTS (SELECT 1
	 				 	   FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		   				 WHERE  tmp.Id = :P_Id
               AND    tmp.gfo_id = pre.gfo_id)	 
	 AND PRE.GFO_ID=:GFO_ID
	 AND OBA.ID=AOA.OBA_ID_ASSOCIADA
	 AND APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
	 AND APE.PRE_ID_RECEPTORA IN (SELECT ID
	 														  FROM BGO_PARTES
	 														  WHERE OBA_ID=AOA.OBA_ID_RECEPTORA)
	 AND AOA.ID=(SELECT MAX(ID)
	 						 FROM BGO_ASSOCIACOES_OBRAS
							 WHERE OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
							 AND OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
	 AND ODA.IGC_ID IN (SELECT IGC_id_proveniente
									    FROM BGO_VALORES_FACTURACAO VFO
									    ,	BGO_INDICES_GERACAO_CUSTOS IGC
									    WHERE VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
									    AND VFO.IGC_ID=IGC.ID
									    AND IGC.ESTADO='A'
									    and vfo.oba_id_referente=aoa.oba_id_receptora
									    AND vfo.tipo_movimento != 'G' 
									    AND vfo.oba_id_referente <> vfo.oba_id_proveniente
			   							AND ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
			   							AND ROWNUM=1)
	 AND CONSIDERAR<>'S' AND CONSIDERAR IS NOT NULL -- Ivo Oliveira 17/07/2003
   AND UC$PRODUCAO.ACED_OBRA(oda.ONO_ID,'OF')='N'	 
	 AND AOA.OBA_ID_RECEPTORA=:OBA_ID);

	 srw.set_field_char(0,'Externo *');	
 exception when others then
   srw.set_field_char(0,'Externo');	
 end;

 return(true);
end;]]>
      </textSource>
    </function>
    <function name="f_aux2formattrigger">
      <textSource>
      <![CDATA[function F_Aux2FormatTrigger return boolean is
begin
  if :tiragem_edicao is not null then
  	 SRW.set_field_char (0, to_char(:tiragem_TOTAL) || '/' || to_char(:tiragem_edicao) || ' X Custos fixos PE');	
  	 return (TRUE);
  else
  	 return (false);
  end if;
end; ]]>
      </textSource>
    </function>
    <function name="f_aux_valor2formattrigger">
      <textSource>
      <![CDATA[function F_Aux_valor2FormatTrigger return boolean is
	v_valor				Number (20,5) :=0;
		v_data_euro				bgo_parametros.valor_bg%TYPE;
begin

	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';


	-- jgs20140227: Ticket#2012092610000662
	/*
		É necessário implementar as seguintes alterações no SIBG:
		Análise de Valores de Faturação e Resumo de Custos: alterar o
		cálculo do custo unitário, passando o divisor a ser as entregas ou a tiragem
		consoante aquelas sejam ou não consideradas;	
  */

	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'f_aux_valor_2 :TIRAGEM = '||to_char(nvl(TIRAGEM(:OBA_ID),-1)), null, null);
 	
  begin
		v_valor := :cs_total_sub_pe * (:tiragem_TOTAL / TIRAGEM(:OBA_ID));
	exception when others then
		v_valor := :cs_total_sub_pe * (:tiragem_TOTAL / :tiragem_edicao);
	end;

	SRW.set_field_num(0, v_valor);
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 990D09"  "');
	end if;
	return (TRUE);
		
end;]]>
      </textSource>
    </function>
    <function name="m_35formattrigger">
      <textSource>
      <![CDATA[function M_35FormatTrigger return boolean is
begin
  if :tiragem_edicao is not null then
  	 return (TRUE);
  else
  	 return (false);
  end if;
end;]]>
      </textSource>
    </function>
    <function name="r_7formattrigger">
      <textSource>
      <![CDATA[function R_7FormatTrigger return boolean is
  dummy number(6);
  v_pe  varchar2(10);
begin
	
	
	  -- jgs20150318 -parece ser generico
	  v_pe := existe_cust_pe(:gfo_id);
	  IF V_PE = 'S' then
	  	return true;
	  end if;
	  
	  
		SELECT count(*)
		into dummy
		FROM BGO_ANALISE_NAO_FACT_GF_V ANG
		where oba_id= :P_oba_id
		and ang.gfo_id=:gfo_id
    AND EXISTS (SELECT   1
     			      FROM BGO_RESUMO_ARTIGOS_GF_TEMP tmp
          			WHERE tmp.Id = :P_Id
           			AND   tmp.gfo_id = ANG.gfo_id
           			and tmp.gfo_id=:gfo_id);
	
	  if 	dummy>0 then
	  	return (TRUE);
	  else
	  	if :cf_existe_sub_outr='S' then
	  		 return(true);
			else
			   return(false);
			end if;
	  end if;
	  
end;]]>
      </textSource>
    </function>
    <function name="subtotal_2a">
      <textSource>
      <![CDATA[FUNCTION Subtotal_2A (p_Oba_Id Number, p_Gfo_Id Number) RETURN Number IS
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;	
BEGIN
	
  SELECT SUM(afg.valor),
	 			 SUM(afg.valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM   BGO_ANALISE_FACTURACAO_GF_V afg
	WHERE  afg.oba_id = P_Oba_Id
	AND	   afg.tipo_movimento_aux = '2A'
	AND		 afg.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = afg.gfo_id);
		
	v_valor := nvl(v_valor_eur,0);
	
	return (Subtotal_1S(p_Oba_id, p_gfo_id)/* * (:tiragem_TOTAL / nvl(:tiragem_edicao,:tiragem_TOTAL))*/ + v_valor);  --Está a dividir pelo NVL da :tiragem_edicao porque esta pode ser nula
END;]]>
      </textSource>
    </function>
    <function name="subtotal_2a_rnd">
      <textSource>
      <![CDATA[FUNCTION Subtotal_2A_RND (p_Oba_Id Number, p_Gfo_Id Number) RETURN Number IS
	v_valor						bgo_valores_facturacao.valor%type:=0;
	v_valor_eur				bgo_valores_facturacao.valor_eur%type:=0;	
BEGIN
	
  SELECT SUM(valor),
	 			 SUM(valor_eur)
	INTO	 v_valor,
				 v_valor_eur
	FROM
	(	
  SELECT SUM(afg.valor) valor,
	 			 ROUND(SUM(afg.valor_eur),2) valor_eur--,
	FROM   BGO_ANALISE_FACTURACAO_GF_V afg
	WHERE  afg.oba_id = P_Oba_Id
	AND	   afg.tipo_movimento_aux = '2A'
	AND		 afg.gfo_id = p_gfo_id
	AND		 EXISTS (SELECT 1
								 FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
				 				 WHERE	tmp.oba_id = :P_Oba_Id
				 				 AND		tmp.Id = :P_Id
				 				 AND    tmp.gfo_id = afg.gfo_id)
	GROUP BY afg.descricao);
		
	v_valor := nvl(v_valor_eur,0);
	
	return (Subtotal_1S_RND(p_Oba_id, p_gfo_id) /** (:tiragem_TOTAL / nvl(:tiragem_edicao,:tiragem_TOTAL))*/ + v_valor);  --Está a dividir pelo NVL da :tiragem_edicao porque esta pode ser nula
END;]]>
      </textSource>
    </function>
    <function name="existe_mov_sup">
      <textSource>
      <![CDATA[FUNCTION EXISTE_MOV_SUP(tipo_mov varchar2,p_gfo_id number) RETURN CHAR IS
	dummy number(1);
begin
	-- Ivo Oliveira 21/05/2003
	-- Caso a obra tenha Tiragem Edição, verifica se existem tipos de movimento superior a '1S' ou '2A'

	If Tipo_Mov='1S' then
		
  	begin -- Verificar se existe tipo_mov_aux superior Ivo Oliveira 16/05/2003
  				-- Se for '1S' pode existir '2A' se for '2A' pode existir 3X
	 	   SELECT distinct 1
			 INTO dummy
			 FROM BGO_ANALISE_FACTURACAO_GF_V afg
			 WHERE  afg.oba_id = :p_Oba_Id
			 AND	  afg.tipo_movimento_aux>'1S'-- in ('2A','3X')
			 AND	  afg.tipo_movimento_aux<>'2N'
			 AND		afg.gfo_id = p_gfo_id
			 AND		EXISTS (SELECT 1
											FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
							 				WHERE	tmp.oba_id = :P_Oba_Id
							 				AND		tmp.Id = :P_Id
							 				AND    tmp.gfo_id = afg.gfo_id);
		exception when others then
			 dummy:=0;
		end;

		if dummy=0 then
			return('N');
		else
			return('S');
		end if;
	elsif Tipo_Mov='2A' then
			
  	begin
	 	   SELECT distinct 1
			 INTO dummy
			 FROM BGO_ANALISE_FACTURACAO_GF_V afg
			 WHERE  afg.oba_id = :p_Oba_Id
			 AND	  afg.tipo_movimento_aux>'2A'-- in ('3X')
			 AND	  afg.tipo_movimento_aux<>'2N'
			 AND		afg.gfo_id = p_gfo_id
			 AND		EXISTS (SELECT 1
											FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
							 				WHERE	tmp.oba_id = :P_Oba_Id
							 				AND		tmp.Id = :P_Id
							 				AND    tmp.gfo_id = afg.gfo_id);
		exception when others then
			 dummy:=0;
		end;

		if dummy=0 then
			return('N');
		else
			return('S');
		end if;

	end if;
	  
  return ('N');

end;]]>
      </textSource>
    </function>
    <function name="f_aux_valor3formattrigger">
      <textSource>
      <![CDATA[function F_Aux_valor3FormatTrigger return boolean is
	v_custos_fixos 		 Number (10,3) :=0;
begin
	
	SRW.SET_FORMAT_MASK('999 999 990D09" "');

	-- Ivo Oliveira 13/05/2003
	v_custos_fixos := Subtotal_2A_RND(:P_Oba_Id,:gfo_id);
	
 	SRW.set_field_num (0, subtotal_3x_rnd(:Oba_id,:gfo_id) ); -- Ivo Oliveira 21/05/2003
  
  VARS.V_1S := FALSE;
  
  return (TRUE);
  
exception
		when others then
			SRW.set_field_num (0, (:Tiragem_TOTAL / :tiragem_edicao) * v_custos_fixos);
end;]]>
      </textSource>
    </function>
    <function name="f_aux3formattrigger">
      <textSource>
      <![CDATA[function F_Aux3FormatTrigger return boolean is
begin
	
  --if :tipo_mov_aux = '3X' then  -- Ivo Oliveira 21/05/2003
  	SRW.set_field_char (0, to_char(:tiragem_TOTAL) || '/' || to_char(:tiragem_edicao) || ' X CUSTOS FIXOS');
  	return (TRUE);
  /*else
  	return (FALSE);
  end if;*/
  
end;]]>
      </textSource>
    </function>
    <function name="r_11formattrigger">
      <textSource>
      <![CDATA[function R_11FormatTrigger return boolean is
	dummy number(1);
	existe_3X varchar2(1);
begin
	-- Ivo Oliveira 16/05/2003
	-- Para os casos em que a seguir aos custos fixos não há mais valores
	
  if :tipo_mov_aux NOT IN ('1S','2A') then
  	return (FALSE);
  end if;

  IF VARS.V_1S = TRUE THEN
  	If existe_mov_sup(:tipo_mov_aux,:gfo_id)='N' then
  		Return(True);
  	else
  		Return(False);
  	end if;
  	
  	/*If :Tipo_Mov_Aux='1S' then
  		
	  	begin -- Verificar se existe tipo_mov_aux superior Ivo Oliveira 16/05/2003
	  				-- Se for '1S' pode existir '2A' se for '2A' pode existir 3X
		 	   SELECT distinct 1
				 INTO dummy
				 FROM BGO_ANALISE_FACTURACAO_GF_V afg
				 WHERE  afg.oba_id = :p_Oba_Id
				 AND	  afg.tipo_movimento_aux in ('2A','3X')
				 AND		EXISTS (SELECT 1
												FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				WHERE	tmp.oba_id = :P_Oba_Id
								 				AND		tmp.Id = :P_Id
								 				AND    tmp.gfo_id = afg.gfo_id);
			exception when others then
				 dummy:=0;
			end;

			if dummy=0 then
				return(true);
			else
				return(false);
			end if;
		elsif :Tipo_Mov_Aux='2A' then
				
	  	begin
		 	   SELECT distinct 1
				 INTO dummy
				 FROM BGO_ANALISE_FACTURACAO_GF_V afg
				 WHERE  afg.oba_id = :p_Oba_Id
				 AND	  afg.tipo_movimento_aux in ('3X')
				 AND		EXISTS (SELECT 1
												FROM		BGO_RESUMO_ARTIGOS_GF_TEMP tmp
								 				WHERE	tmp.oba_id = :P_Oba_Id
								 				AND		tmp.Id = :P_Id
								 				AND    tmp.gfo_id = afg.gfo_id);
			exception when others then
				 dummy:=0;
			end;

			if dummy=0 then
				return(true);
			else
				return(false);
			end if;


		end if;*/
			
  ELSIF VARS.V_1S = FALSE THEN
  	
  	RETURN(FALSE);
  	
  END IF;
  
  return (FALSE);

end;]]>
      </textSource>
    </function>
    <function name="cf_descriformula" returnType="character">
      <textSource>
      <![CDATA[function CF_DESCRIFormula return Char is
	V_PERC BGO_ASSOCIACOES_OBRAS.PERCENTAGEM_CUSTOS%TYPE;
	v_custos BGO_ASSOCIACOES_OBRAS.CUSTOS_VARIAVEIS%TYPE;
	V_DESCRI VARCHAR2(100);
	v_preco number;
begin
	:preco_venda := null;
	:CP_CUST_FIX:=0;
	IF UPPER(:TIPO_MOV_AUX) IN ('2A','5O') THEN
		BEGIN
			SELECT PERCENTAGEM_CUSTOS,CUSTOS_VARIAVEIS
			INTO V_PERC,v_custos
			FROM BGO_ASSOCIACOES_OBRAS AOA
			WHERE AOA.OBA_ID_RECEPTORA=:OBA_ID
			AND AOA.OBA_ID_ASSOCIADA=:OBA_ID_PROV
			AND AOA.ID IN (SELECT MAX(ID)
										 FROM BGO_ASSOCIACOES_OBRAS
										 WHERE OBA_ID_ASSOCIADA=:OBA_ID_PROV
										 AND 	 OBA_ID_RECEPTORA=:OBA_ID);
			
			IF v_custos='S' THEN
	  		--SRW.set_field_char (0,:Descricao_Detail||'   ('||V_PERC||'%)');
	  		v_descri:=:Descricao_Detail||'   ('||V_PERC||'%)';
			ELSE
				--SRW.set_field_char (0,:Descricao_Detail||'   ('||V_PERC||'%)*');-- Só custos fixos
				v_descri:=:Descricao_Detail||'   ('||V_PERC||'%)*';
				:CP_CUST_FIX:=1;
			END IF;

		EXCEPTION WHEN OTHERS THEN
	  	--SRW.set_field_char (0,:Descricao_Detail);
	  	v_descri:=:Descricao_Detail;
		END;
	ELSE	
		if :unidade is null then
			--SRW.set_field_char (0,:Descricao_Detail);
			v_descri:=:Descricao_Detail;
		else	
	  	--SRW.set_field_char (0,:Descricao_Detail || '    (' || :unidade ||')');
	  	-- JGS20150325: acrescento unidade a seguir ao preço. v_descri:=:Descricao_Detail || '    (' || lower(:unidade) ||')';
			v_descri:=:Descricao_Detail;
		end if;	
		IF UPPER(:TIPO_MOV_AUX) = '4A' THEN
			begin
/*				
				select PRECO_VENDA_EUR * ( 1 + ( PERCENTAGEM_LUCRO/100)) into v_preco
				from bgo_artigos
				where codigo = substr(v_descri,1,instr(v_descri,'-')-2);
*/

				--select round(:cs_valor_eur_detail,2)/:cs_quantidade -- Ivo Oliveira 12/01/2005
				select :cs_valor_eur_detail/:cs_quantidade
				into   v_preco
				from   dual;
				
			exception
				when others then v_preco := null;
			end;
			if v_preco is not null then	
				:preco_venda := v_preco;
			end if;
		end if;
	END IF;
  return (v_descri);
end;]]>
      </textSource>
    </function>
    <function name="cf_descri_outrformula" returnType="character">
      <textSource>
      <![CDATA[function CF_DESCRI_OUTRFormula return Char is
	V_PERC BGO_ASSOCIACOES_OBRAS.PERCENTAGEM_CUSTOS%TYPE;
	v_custos BGO_ASSOCIACOES_OBRAS.CUSTOS_VARIAVEIS%TYPE;
	v_descri varchar2(100);
begin
	:CP_CUST_FIX_OUTR:=0;
	IF UPPER(:TIPO_MOV_AUX1)='5O' THEN
		BEGIN
			SELECT PERCENTAGEM_CUSTOS,CUSTOS_VARIAVEIS
			INTO V_PERC,v_custos
			FROM BGO_ASSOCIACOES_OBRAS AOA
			WHERE AOA.OBA_ID_RECEPTORA=:OBA_ID
			AND AOA.OBA_ID_ASSOCIADA=:OBA_ID_PROV2
			AND AOA.ID IN (SELECT MAX(ID)
										 FROM BGO_ASSOCIACOES_OBRAS
										 WHERE OBA_ID_ASSOCIADA=:OBA_ID_PROV2
										 AND 	 OBA_ID_RECEPTORA=:OBA_ID);
			
			IF v_custos='S' THEN
	  		--SRW.set_field_char (0,:Descricao_Detail1||'   ('||V_PERC||'%)');
	  		v_descri:=:Descricao_Detail1||'   ('||V_PERC||'%)';
			ELSE
				--SRW.set_field_char (0,:Descricao_Detail1||'   ('||V_PERC||'%)*');-- Só custos fixos
				v_descri:=:Descricao_Detail1||'   ('||V_PERC||'%)*';
				:CP_CUST_FIX_OUTR:=1;
			END IF;
			
		EXCEPTION WHEN OTHERS THEN
	  	--SRW.set_field_char (0,:Descricao_Detail1);			
	  	v_descri:=:Descricao_Detail1;
		END;
	ELSE	
		if :unidade1 is null then
			--SRW.set_field_char (0,:Descricao_Detail1);
			v_descri:=:Descricao_Detail1;
		else	
	  	--SRW.set_field_char (0,:Descricao_Detail1 || '    (' || :unidade1 ||')');
	  	v_descri:=:Descricao_Detail1 || '    (' || :unidade1 ||')';
	  end if;	
	END IF;
  return (v_descri);
end;]]>
      </textSource>
    </function>
    <function name="m_36formattrigger">
      <textSource>
      <![CDATA[function M_36FormatTrigger return boolean is
begin
  /*if :tiragem_edicao is not null then
  	 return (TRUE);
  else
  	 return (false);
  end if;*/
  If :CS_CF_Asso=1 then
  	return (TRUE);
  Else
  	return (false);
  End if;
end;]]>
      </textSource>
    </function>
    <function name="m_37formattrigger">
      <textSource>
      <![CDATA[function M_37FormatTrigger return boolean is
begin
  /*if :tiragem_edicao is not null then
  	 return (TRUE);
  else
  	 return (false);
  end if;*/
  If :CS_CF_Asso_Outr=1 then
  	return (TRUE);
  Else
  	return (false);
  End if;
end;]]>
      </textSource>
    </function>
    <function name="val_suo" type="packageSpec">
      <textSource>
      <![CDATA[PACKAGE VAL_SUO IS
  
  V_VAL BOOLEAN := TRUE;
  
END;]]>
      </textSource>
    </function>
    <function name="r_g_descricao_detail6formattri">
      <textSource>
      <![CDATA[function R_G_descricao_Detail6FormatTri return boolean is
begin
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="b_cs_total6formattrigger">
      <textSource>
      <![CDATA[function B_CS_total6FormatTrigger return boolean is
begin

  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="f_cs_total6formattrigger">
      <textSource>
      <![CDATA[function F_CS_total6FormatTrigger return boolean is
	v_data_euro				bgo_parametros.valor_bg%TYPE;
	v_total_1S				bgo_valores_facturacao.valor%type:=0;
	v_total_3X				bgo_valores_facturacao.valor%type:=0;
	v_total 					Number (38,2):=0;
begin
	
	/* EURO */
	SELECT	valor_BG
	INTO		v_data_euro
	FROM 		BGO_PARAMETROS
	WHERE 	descricao = 'data_transicao';
	
	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 999 999 990D09"  "');
	end if;
	
	return (TRUE);
end;	]]>
      </textSource>
    </function>
    <function name="f_label1formattrigger">
      <textSource>
      <![CDATA[function F_label1FormatTrigger return boolean is
begin
	IF val_suo.v_val then
  	SRW.set_field_char (0, 'Valor');
		val_suo.v_val:=FALSE;
		return (TRUE);
	ELSE
		SRW.set_field_char (0, '');
		return (FALSE);
  END IF;
end;]]>
      </textSource>
    </function>
    <function name="f_emp1formattrigger">
      <textSource>
      <![CDATA[function F_EMP1FormatTrigger return boolean is
begin
  IF :EMP='BG' THEN
  	SRW.SET_FIELD_CHAR(0,'(valores não considerados)');
  	return (TRUE);
  ELSE
  	return(FALSE);
  END IF;
end;]]>
      </textSource>
    </function>
    <function name="cf_tituloformula" returnType="character">
      <textSource>
      <![CDATA[function CF_TITULOFormula return Char is
	V_DESC VARCHAR2(500);
begin
	:global_oba_id := :oba_id;
	
	BEGIN
	  -- JGS20090108 SELECT DESCRICAO
	  SELECT DECODE(FLG_TIP_COL,'F',DESCRICAO,NULL) -- JGS20090108
	  INTO V_DESC
	  FROM BGO_COLECCOES
	  WHERE ID=(SELECT CLO_ID
	  					FROM BGO_OBRAS
	  					WHERE ID=:OBA_ID);
	EXCEPTION WHEN OTHERS THEN
		V_DESC:=NULL;
	END;
	
	IF V_DESC IS NOT NULL THEN
		RETURN(substr(:TITULO||' (Col. '||V_DESC||')',1,200));   -- JGS20150407: Acrescento sbstr, dava erro com titulo_completo 200 + coleção
	ELSE
		RETURN(:TITULO);
	END IF;
end;]]>
      </textSource>
    </function>
    <function name="f_preco_vendaformattrigger">
      <textSource>
      <![CDATA[function f_preco_vendaFormatTrigger return boolean is
	v_data_euro BGO_PARAMETROS.valor_BG%TYPE;
begin
	
	begin
		SELECT	valor_BG
		INTO		v_data_euro
		FROM 		BGO_PARAMETROS
		WHERE 	descricao = 'data_transicao';
	exception
		when others then null;
	end;

	if (to_char(sysdate, 'YYYY-MM-DD') >= v_data_euro) then
		
		IF UPPER(:TIPO_MOV_AUX) NOT IN ('4A') THEN
  		SRW.SET_FORMAT_MASK('999 999 990D99990" "');
		ELSE
  		SRW.SET_FORMAT_MASK('999 999 990D99990"  / '||LOWER(:UNIDADE)||'"');
		END IF;
  	
		SRW.set_field_num (0,:preco_venda) ;		
 		return (TRUE); 	
	elsif (to_char(sysdate, 'YYYY-MM-DD') < v_data_euro) then
		SRW.SET_FORMAT_MASK('999 999 990D99990" $"');
		SRW.set_field_num (0, :preco_venda) ;	
  	return (TRUE);
  end if;
  
	return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="estragoformula" returnType="character">
      <textSource>
      <![CDATA[function estragoFormula return Char is
	str_aux varchar2(200) := '';
	qtd_aux varchar2(200) := '';

	cursor c1 is -- JR 20/09/04
		select tipo_estrago,sum(quantidade) quantidade from(
			select moo.quantidade quantidade,rla.TIPO_ESTRAGO tipo_estrago,rla.oba_id 
				from bgo_requisicoes_linhas rla
				, 	 bgo_movimentos moo
				, 	 bgo_artigos aro
				,		 bgo_partes pre
				where MOO.MOO_TYPE = 'LSA'
				AND MOO.MOVIMENTO_ANULADO = 'N' 
				and MOO.ARO_ID = RLA.ARO_ID
				and MOO.ARO_ID = ARO.ID
				and rla.aro_id = aro.id
				AND MOO.RLA_ID = RLA.ID 
			  	and RLA.TIPO_ESTRAGO IS NOT NULL
			 		and rla.oba_id = :oba_id_consumiveis 
			  	and aro.codigo = substr(:aro_consumido,1,instr(:aro_consumido,'-')-2)
			  and rla.pre_id = pre.id
				and pre.gfo_id = :gfo_id_consumiveis
				union all 
				select moo.quantidade*(aoa.percentagem_custos/100) quantidade,rla.TIPO_ESTRAGO tipo_estrago,rla.oba_id 
				from bgo_requisicoes_linhas rla
				, 	 bgo_movimentos moo
				, 	 bgo_artigos aro
				,	 bgo_associacoes_obras aoa
				, bgo_partes pre
				, bgo_associacoes_partes aoe
				where MOO.MOO_TYPE = 'LSA'
				AND MOO.MOVIMENTO_ANULADO = 'N' 
				and MOO.ARO_ID = RLA.ARO_ID
				and MOO.ARO_ID = ARO.ID
				and rla.aro_id = aro.id
				AND MOO.RLA_ID = RLA.ID 
			  	and RLA.TIPO_ESTRAGO IS NOT NULL
			  	and rla.oba_id = :oba_id_prov_cons
					and aoa.oba_id_associada = rla.oba_id
					and aoa.oba_id_receptora = :oba_id_consumiveis
					and aoa.id=(Select Max(id)
									    from bgo_Associacoes_obras
											where oba_id_associada = aoa.oba_id_associada
											and oba_id_receptora = aoa.oba_id_receptora)
			  	and aro.codigo = substr(:aro_consumido,1,instr(:aro_consumido,'-')-2)
				and aoe.pre_id_associada=rla.pre_id
				and aoe.pre_id_receptora=pre.id
				and pre.gfo_id=:gfo_id_consumiveis
			)
			group by tipo_estrago;
			
	
	function nome(cod_in cg_ref_codes.rv_low_value%type) return char is
		valor_aux cg_ref_codes.rv_meaning%type;
	begin
		select nvl(rv_abbreviation,rv_low_value) into valor_aux
		from cg_ref_codes 
		where rv_domain = 'TIPO ESTRAGOS' and rv_low_value = cod_in;
		return valor_aux;
	exception
		when others then return cod_in;
	end nome;
	
	
begin
	for i in c1 loop
		qtd_aux := replace(to_char(i.quantidade,'9G999G990D00'),' ','');
		if str_aux is null then
			str_aux := qtd_aux||' '||nome(i.tipo_estrago);
		else
			str_aux := qtd_aux||' '||nome(i.tipo_estrago)||'; '||str_aux;
		end if;
		qtd_aux := '';
	end loop;
	
	return str_aux;
  
end;]]>
      </textSource>
    </function>
    <function name="linha_mostrarformula" returnType="character">
      <textSource>
      <![CDATA[function linha_mostrarFormula return Char is
begin
  if :estrago is not null then
  	return :aro_consumido||' ('||:estrago||')';
	end if;               
	return :aro_consumido;
end;]]>
      </textSource>
    </function>
    <function name="obs2formattrigger">
      <textSource>
      <![CDATA[function OBS2FormatTrigger return boolean is
begin
 	--SRW.set_field_char (0, ' '||:p_obs );
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="userformula" returnType="character">
      <textSource>
      <![CDATA[function userFormula return Char is

v_user       VARCHAR2(80);
v_utilizador bgo_entidades.nome_abreviado%type:=null;
str_aux			 varchar2(200);
begin

  IF :P_USER IS NOT NULL THEN

		v_user := :P_USER; -- jgs20161006

  ELSE

		begin
		  select user 
		  into   v_user 
		  from   dual;
		exception
			when others then v_user := null;
		end;
	
	END IF;
	
	begin
	  select nvl(nome_abreviado,user) 
	  into   v_utilizador 
	  from   bgo_entidades
	  where  nome_utilizador = v_user;
	exception
		when others then v_utilizador := null;
	end;
	str_aux := 'Emitido por '||initcap(nvl(v_utilizador,v_user))||' ('
							||to_char(sysdate,'yyyy-mm-dd')||' ; '||to_char(sysdate,'hh24:mi')||')';
  return(str_aux);
 
EXCEPTION
	WHEN OTHERS	THEN RETURN null;
end;]]>
      </textSource>
    </function>
    <function name="estragos_obs1formula" returnType="character">
      <textSource>
      <![CDATA[function estragos_obs1Formula return Char is
	str_aux varchar2(2000) := '';
	estrago_aux varchar2(200) := '';	
 
  v_unis      varchar2(200);


cursor c1(oba_id_in bgo_obras.id%type) is
		SELECT  vfo.oba_id_referente oba_id_ref,
			vfo.oba_id_proveniente oba_id_prov,
			aro.codigo || ' - ' || aro.descricao descricao,
			-- jgs20140714 tO_CHAR(to_number(aro.codigo)) || ' - ' || aro.descricao descricao
			aro.descricao desc_order
			FROM (Select oba_id_referente,oba_id_proveniente,aro_id,quantidade,tempo,valor,valor_eur, 1 percentagem
				   From BGO_VALORES_FACTURACAO vfo
				   ,	BGO_INDICES_GERACAO_CUSTOS igc
				   Where vfo.igc_id=igc.id
				   and igc.estado='A'
				   and vfo.tipo_movimento='A'
				   and vfo.considerar_artigo='S'
				   and vfo.oba_id_referente=vfo.oba_id_proveniente
				   UNION ALL
				   Select oba_id_referente,oba_id_proveniente,aro_id,quantidade,tempo,valor,valor_eur, percentagem_custos/100 percentagem
				   From BGO_VALORES_FACTURACAO vfo
				   ,	BGO_INDICES_GERACAO_CUSTOS igc
				   ,	BGO_ASSOCIACOES_OBRAS AOA
				   WHERE aoa.oba_id_associada=vfo.oba_id_proveniente
				   AND   aoa.oba_id_receptora=vfo.oba_id_referente
				   AND   aoa.flg_disc_valo='N'
				   AND   aoa.id=(Select Max(Id)
				  	  		     From Bgo_Associacoes_Obras
								 where aoa.oba_id_associada=oba_id_associada
								 and aoa.oba_id_receptora=oba_id_receptora)
				   and vfo.igc_id=igc.id
				   and igc.estado='A'
				   and vfo.tipo_movimento='A'
				   and vfo.considerar_artigo='S'
				   and vfo.oba_id_referente<>vfo.oba_id_proveniente) vfo
			,	   BGO_ARTIGOS aro
			,	   BGO_UNIDADES une
			WHERE	aro.id = vfo.aro_id
			AND		aro.empresa = 'B'
			AND		une.id = aro.une_id
			and vfo.oba_id_referente = oba_id_in
			GROUP BY vfo.oba_id_referente, vfo.oba_id_proveniente,
			aro.codigo || ' - ' || aro.descricao, aro.descricao
			order by 4; 
			-- jgs20140714 TO_CHAR(to_number(aro.codigo)) || ' - ' || aro.descricao;
			
		/* -- JR 17/09/2004
		SELECT  vfo.oba_id_referente oba_id,
			to_number(NULL) OBA_ID_PROV,
			'4A' tipo_movimento_aux,
			TO_CHAR(to_number(aro.codigo)) || ' - ' || aro.descricao descricao,
			aro.descricao ORDER_BY,
			to_number(null) order_by_num,
			une.codigo unidade
			FROM (Select oba_id_referente,oba_id_proveniente,aro_id,quantidade,tempo,valor,valor_eur
				   From BGO_VALORES_FACTURACAO vfo
				   ,	BGO_INDICES_GERACAO_CUSTOS igc
				   Where vfo.igc_id=igc.id
				   and igc.estado='A'
				   and vfo.tipo_movimento='A'
				   and vfo.considerar_artigo='S'
				   and vfo.oba_id_referente=vfo.oba_id_proveniente
				   UNION ALL
				   Select oba_id_referente,oba_id_proveniente,aro_id,quantidade,tempo,valor,valor_eur
				   From BGO_VALORES_FACTURACAO vfo
				   ,	BGO_INDICES_GERACAO_CUSTOS igc
				   ,	BGO_ASSOCIACOES_OBRAS AOA
				   WHERE aoa.oba_id_associada=vfo.oba_id_proveniente
				   AND   aoa.oba_id_receptora=vfo.oba_id_referente
				   AND   aoa.flg_disc_valo='N'
				   AND   aoa.id=(Select Max(Id)
				  	  		     From Bgo_Associacoes_Obras
								 where aoa.oba_id_associada=oba_id_associada
								 and aoa.oba_id_receptora=oba_id_receptora)
				   and vfo.igc_id=igc.id
				   and igc.estado='A'
				   and vfo.tipo_movimento='A'
				   and vfo.considerar_artigo='S'
				   and vfo.oba_id_referente<>vfo.oba_id_proveniente) vfo
			,	   BGO_ARTIGOS aro
			,	   BGO_UNIDADES une
			WHERE	aro.id = vfo.aro_id
			AND		aro.empresa = 'B'
			AND		une.id = aro.une_id
			and vfo.oba_id_referente = oba_id_in
			GROUP BY vfo.oba_id_referente,
			'4A',
			TO_CHAR(to_number(aro.codigo)) || ' - ' || aro.descricao,
			aro.descricao,
			une.codigo;*/
			
	function estragoFormula(oba_id_ref_in bgo_obras.id%type, oba_id_prov_in bgo_obras.id%type,
			desc_aux varchar2) return Char is
			
			str_aux varchar2(200) := '';
			qtd_aux varchar2(200) := '';
		
			cursor c1_estrago is
					select tipo_estrago,sum(quantidade) quantidade from(
						select moo.quantidade quantidade,rla.TIPO_ESTRAGO tipo_estrago,rla.oba_id 
							from bgo_requisicoes_linhas rla
							, 	 bgo_movimentos moo
							, 	 bgo_artigos aro
							, bgo_partes pre
							where MOO.MOO_TYPE = 'LSA'
							AND MOO.MOVIMENTO_ANULADO = 'N' 
							and MOO.ARO_ID = RLA.ARO_ID
							and MOO.ARO_ID = ARO.ID
							and rla.aro_id = aro.id
							AND MOO.RLA_ID = RLA.ID 
						  	and RLA.TIPO_ESTRAGO IS NOT NULL
						 		and rla.oba_id = oba_id_ref_in 
						  	and aro.codigo = substr(desc_aux,1,instr(desc_aux,'-')-2)
						  and rla.pre_id = pre.id
							and pre.gfo_id = :gfo_id	
							and oba_id_ref_in=oba_id_prov_in -- Ivo Oliveira 28/07/2005 -- Trazia valores duplicados (Obra 20042543)
							union all 
							select moo.quantidade*(aoa.percentagem_custos/100) quantidade,rla.TIPO_ESTRAGO tipo_estrago,rla.oba_id 
							from bgo_requisicoes_linhas rla
							, 	 bgo_movimentos moo
							, 	 bgo_artigos aro
							,	 bgo_associacoes_obras aoa
							, bgo_partes pre
							, bgo_associacoes_partes aoe
							where MOO.MOO_TYPE = 'LSA'
							AND MOO.MOVIMENTO_ANULADO = 'N' 
							and MOO.ARO_ID = RLA.ARO_ID
							and MOO.ARO_ID = ARO.ID
							and rla.aro_id = aro.id
							AND MOO.RLA_ID = RLA.ID 
						  	and RLA.TIPO_ESTRAGO IS NOT NULL
						  	and rla.oba_id = oba_id_prov_in
								and aoa.oba_id_associada = rla.oba_id
								and aoa.oba_id_receptora = oba_id_ref_in
								and oba_id_ref_in<>oba_id_prov_in -- Ivo Oliveira 28/07/2005 -- Trazia valores duplicados (Obra 20042543)
								and aoa.id=(Select Max(id)
												    from bgo_Associacoes_obras
														where oba_id_associada = aoa.oba_id_associada
														and oba_id_receptora = aoa.oba_id_receptora)
						  	and aro.codigo = substr(desc_aux,1,instr(desc_aux,'-')-2)
						  and aoe.pre_id_associada=rla.pre_id
							and aoe.pre_id_receptora=pre.id
							and pre.gfo_id=:gfo_id
						)
						group by tipo_estrago;
						
				/* -- JR 17/09/2004
				select moo.quantidade,rla.TIPO_ESTRAGO 
				from bgo_requisicoes_linhas rla, bgo_movimentos moo, bgo_artigos aro
				where MOO.MOO_TYPE = 'LSA' AND MOO.MOVIMENTO_ANULADO = 'N' 
					and MOO.ARO_ID = RLA.ARO_ID and MOO.ARO_ID = ARO.ID and rla.aro_id = aro.id
			  	AND MOO.RLA_ID = RLA.ID 
			  	and RLA.TIPO_ESTRAGO IS NOT NULL
			  	and rla.oba_id = oba_id_in
			  	and aro.codigo = substr(desc_aux,1,instr(desc_aux,'-')-2);
				*/
			
			function nome(cod_in cg_ref_codes.rv_low_value%type) return char is
				valor_aux cg_ref_codes.rv_meaning%type;
			begin
				select nvl(rv_abbreviation,rv_low_value) into valor_aux
				from cg_ref_codes 
				where rv_domain = 'TIPO ESTRAGOS' and rv_low_value = cod_in;
				return valor_aux;
			exception
				when others then return cod_in;
			end nome;
			
			
		begin
			for i in c1_estrago loop
				qtd_aux := replace(to_char(i.quantidade,'9G999G990D00'),' ','');
				
				v_unis := UNI_ARTI(desc_aux);
				
				if str_aux is null then
					str_aux := qtd_aux||' '||v_unis||' '||nome(i.tipo_estrago);
				else
					str_aux := qtd_aux||' '||v_unis||' '||nome(i.tipo_estrago)||'; '||str_aux;
				end if;
				qtd_aux := '';
			end loop;
			
			return str_aux;
		end estragoFormula;			
			
begin
	
	for i in c1(:global_oba_id) loop
		estrago_aux := estragoFormula(i.oba_id_ref, i.oba_id_prov,i.descricao);
		if estrago_aux is not null then
			if str_aux is null then
				str_aux := i.descricao||' ('||estrago_aux||')';
			else
				-- jgs20150325 str_aux := i.descricao||' ('||estrago_aux||'); '||str_aux;
				str_aux := str_aux ||'; '||i.descricao||' ('||estrago_aux||')';
			end if;
		end if;
		estrago_aux := '';
	end loop;	
	return str_aux;
end;]]>
      </textSource>
    </function>
    <function name="afterpform">
      <textSource>
      <![CDATA[function AfterPForm return boolean is
begin
  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'p_atender_entregas = '||:p_atender_entregas||', p_id = '||to_char(:p_id)||', p_oba_id ='||to_char(nvl(:p_oba_id,0))||', p_obs = '||nvl(:p_obs,'x'), null, null);
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="cf_obsformula" returnType="character">
      <textSource>
      <![CDATA[function CF_obsFormula return Char is

  id_o              number;
  id_of             number;  -- jgs20200505
  v_tmp_obs         varchar2(4000);
  
  v_final           varchar2(1) := 'N'; -- jgs20200601
  
begin

  -- v_tmp_obs := to_char(:gfo_id)||' -'||:desc_gf;

  id_o := to_number(dsi_pack.val_par('B','id_obs_orcamento','-1'));
  id_of := to_number(dsi_pack.val_par('B','id_obs_orca_final','-1'));
  
  -- jgs20200505
    for r_of in (
      select *
      from   bgo_obras_obs
      where  oba_id = :p_oba_id
      and    rpo_id = id_of
      order  by id
  )
  loop
  	
  	v_final := 'S'; -- jgs20200601

  	if v_tmp_obs is null then
  		v_tmp_obs := r_of.obs;
  	else
  		v_tmp_obs := v_tmp_obs ||chr(10)||r_of.obs;
  	end if;
  	
  end loop;
  -- fim jgs20200505
  
    

  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'id_o = '||id_o||', :p_oba_id = '||:p_oba_id, null, null);
  
  for r_o in (
      select *
      from   bgo_obras_obs
      where  oba_id  = :p_oba_id
      and    rpo_id  = id_o
      -- JGS20200727 mail RAMARAL 20200715 and    v_final = 'N' -- jgs20200601
      order  by id
  )
  loop
      if v_tmp_obs is null then
          v_tmp_obs := r_o.obs;
      else
          v_tmp_obs := v_tmp_obs ||chr(10)||r_o.obs;
      end if;
  end loop;

  if v_tmp_obs is null then
      -- jgs20190830 return (:p_obs);
      -- jgs20190924 return (replace(replace(:p_obs,'forms_to_report_euro',''),chr(227),'ã'));
      return (replace(replace(:p_obs,'forms_to_report_euro',''),'forms_to_report_atilde','ã'));
  else
      -- jgs20190830 return v_tmp_obs ||chr(10)||:p_obs;
      return v_tmp_obs ||chr(10)||replace(replace(:p_obs,'forms_to_report_euro',''),'forms_to_report_atilde','ã');
  end if;
        
  
end;]]>
      </textSource>
    </function>
    <function name="cf_obs_gfoformula" returnType="character">
      <textSource>
      <![CDATA[function CF_obs_gfoFormula return Char is

  id_o              number;
  v_tmp_obs         varchar2(4000);
  
  -- jgs20150107: nos grupos de faturação, aparecem em todas!
  id_f              number;    -- jgs20150106
  v_separa          varchar2(1);

  v_dat_pri_ent     date; -- jgs20200421
  v_dat             varchar2(100);
  v_obs_edi_ant     varchar2(1000);
  
begin

  /* jgs20200421
  Ticket#2020040910004774  Resumo detalhado de custos - Data de 1.ª entrega em obs[...]
	Sim, deve ficar previsto o cenário de não haver data de entrega (obras sem existência física). Aqui fica a data limite de geração de valores.
	No segundo cenário, fica a data da entrega mais antiga por faturar, ou na sua ausência a data limite de geração de valores.
	'YYYY-MM-DD'
	*/
  begin

			SELECT MIN(cga.data_emissao) prim_entrega 
			INTO   v_dat_pri_ent
			FROM   BGO_LINHAS_GUIAS_ENTREGA lga,
				     BGO_CABECALHOS_GUIAS cga
			WHERE  cga.ID = lga.cga_id
			AND    lga.oba_id_facturacao = (select id from bgo_obras where id = :p_oba_id)
			AND    lga.estado in ('A','P') --qualquer tipo...
			--AND    NVL(lga.tipo_entrega_obras,'X') IN ('P','N')   -- primeira / unica
			--AND    NVL(lga.tipo_entrega_obras,'X') IN ('U')  ultima
			AND    cga.TIPO_GUIA IN ('S','R')
			GROUP BY 
			       lga.oba_id_facturacao;

  exception when others then v_dat_pri_ent:= Null;
  end;
  -- fim jgs20200421
  if v_dat_pri_ent is null then
  	v_dat := :p_data;
  else
  	v_dat := to_char(v_dat_pri_ent,'YYYY-MM-DD');
  end if;

  --v_tmp_obs := to_char(:gfo_id)||' - ';
  v_tmp_obs := 'Data: '||v_dat;  -- jgs20200422 :p_data;   -- jgs20170323

  id_o := to_number(dsi_pack.val_par('B','id_obs_orcamento','-1'));

  id_f := to_number(dsi_pack.val_par('B','id_obs_fatura','-1'));   -- jgs20150106

  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'id_o = '||id_o||', :p_oba_id = '||:p_oba_id, null, null);

  -- jgs20150106
  v_separa := null;

  for r_f in (
      select *
      from   bgo_obras_obs
      where  oba_id = :p_oba_id
      and    rpo_id = id_f
      order  by id
  )
  loop
      if v_tmp_obs is null then
          v_tmp_obs := r_f.obs;
      else
          v_tmp_obs := v_tmp_obs ||chr(10)||r_f.obs;
      end if;
      
      v_separa := chr(10);
      
  end loop;
  -- fim jgs20150106

  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '1.- v_tmp_obs = '||v_tmp_obs, null, null);
  
  for r_o in (
      select obs.*
      from   bgo_obras_obs obs,
             bgo_partes    pre,
             bgo_obras     oba
      where  obs.oba_id = :p_oba_id
      and    obs.rpo_id = id_o
      and    oba.id     = obs.oba_id
      and    oba.id     = pre.oba_id
      and    pre.gfo_id = :gfo_id
      and    obs.pre_id = pre.id
      order  by obs.id
  )
  loop

      v_tmp_obs := v_tmp_obs || v_separa;
      v_separa := null;

      if v_tmp_obs is null then
          v_tmp_obs := r_o.obs;
      else
          v_tmp_obs := substr(v_tmp_obs ||chr(10)||r_o.obs,1,200);
      end if;

      UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '2.- v_tmp_obs = '||v_tmp_obs, null, null);

  end loop;



  -- jgs20200421 Ticket#2020040210004278  Resumo Detalhado de Custos - observações sobre edição anterior 
  -- A observação deve ser (para o exemplo da imagem): "Edição anterior: Chave 20190636, Fatura 20190636 (2019-11-29), C.U. 1,63 , Tiragem 10 400 exs., Acabamento 0,77000  / ex."
  -- uc$id_edicao_anterior (p_oba_id in number, p_numero_codigo in varchar2, p_gpe_edi_id in number, p_titulo_compl in Varchar2 , p_chave_Principal in number) -- jgs20200421
  declare
  	v_reg_oba_act bgo_obras%rowtype;
  	v_reg_oba_ant bgo_obras%rowtype;
  	v_id_oba_ant  number;
  	t_numero_factura_ant	number;
  	t_data_factura_ant    date;
  	v_txt_fatura          varchar2(100);
  	v_cus_ant             varchar2(100) := null;
  	v_aca_ant             varchar2(100) := null;
  begin
  	
  	select * into v_reg_oba_act from bgo_obras where id = :p_oba_id;
  	
  	v_id_oba_ant  := uc$id_edicao_anterior (v_reg_oba_act.id,v_reg_oba_act.numero_codigo, v_reg_oba_act.gpe_edi_id, v_reg_oba_act.titulo_completo, v_reg_oba_act.chave_principal);
  	
  	if nvl(v_id_oba_ant,-1) = -1 then
  		v_obs_edi_ant := null;
  	else
  		
  	  select * into v_reg_oba_ant from bgo_obras where id = v_id_oba_ant;

      begin

			  SELECT  min( cur.numero) 
				into		t_numero_factura_ant
				FROM    BGO_CABECALHOS_FACTURAS cur,
							  BGO_FACTURAS_LINHAS fha
				WHERE		cur.id = fha.cur_id
				AND	    fha.oba_id = v_id_oba_ant;
			
			  SELECT  min( cur.data) 
				into		t_data_factura_ant
				FROM    BGO_CABECALHOS_FACTURAS cur,
							  BGO_FACTURAS_LINHAS fha
				WHERE		cur.id = fha.cur_id
				AND	    fha.oba_id = v_id_oba_ant;
				
				v_txt_fatura         := ', Fatura '||to_char(t_numero_factura_ant)||' ('||to_char(t_data_factura_ant,'yyyy-mm-dd')||')';

      exception when others then 
      	t_numero_factura_ant := null;
      	t_data_factura_ant   := null;
      	v_txt_fatura         := ', Sem Fatura ';
      end;

      UC$CUS_UNI_ANT (v_id_oba_ant, v_cus_ant);
      UC$ACA_ANT (v_id_oba_ant,v_aca_ant);
       
  		v_obs_edi_ant :=  'Edição anterior: Chave '||to_char(v_reg_oba_ant.chave_principal)||v_txt_fatura||v_cus_ant||', Tiragem '||v_reg_oba_ant.tiragem||' exs.'||v_aca_ant;
  	end if;
  exception when others then v_obs_edi_ant := null;
  end;
  -- fim jgs20200421  

  v_tmp_obs := v_tmp_obs || v_separa;
  if v_separa is null then
	  if v_obs_edi_ant is not null then
	  	v_obs_edi_ant := chr(10)||v_obs_edi_ant;
	  end if;
  end if;
  v_separa  := null;

  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '3.- v_tmp_obs = '||v_tmp_obs, null, null);

  if v_tmp_obs is null then
      -- jgs20190830 return substr((:p_obs),1,200);
      -- jgs20190924 return substr((replace(replace(:p_obs,'forms_to_report_euro',''),chr(227),'ã')),1,200);
      return substr((replace(replace(:p_obs,'forms_to_report_euro',''),'forms_to_report_atilde','ã')),1,200)||v_obs_edi_ant;
  else
   
      
      	
  	  if :p_obs is null then
  	  	 return v_tmp_obs||v_obs_edi_ant;
  	  else
      	-- jgs20190830 return v_tmp_obs ||chr(10)||:p_obs;
      	-- jgs20190924 return v_tmp_obs ||chr(10)||replace(replace(:p_obs,'forms_to_report_euro',''),chr(227),'ã');
      	return v_tmp_obs ||chr(10)||replace(replace(:p_obs,'forms_to_report_euro',''),'forms_to_report_atilde','ã')||v_obs_edi_ant;
      end if;
  end if;
        
  
end;]]>
      </textSource>
    </function>
    <function name="cf_autor_nome_liteformula" returnType="character">
      <textSource>
      <![CDATA[function CF_AUTOR_NOME_LITEFormula return Char is
    V_RET varchar2(200);
begin
   
    /*  jgs20140711
    select nvl(nome_lit,:autor)
    into   v_ret
    from   bgo_info_comp_mult
    where  ref_des = 'O'
    and    ene_des in ('EMAU','EMAD')
    and    flg_cri_int = 'N'
    and    ind = 1
    and    ref_id  = :oba_id;
    */

    v_ret := uc$bgo_info_comp_mult_dao.get_nome_lite_autor(:oba_id);   -- jgs20140711

    return v_ret;
  
exception when others then return null;
end;]]>
      </textSource>
    </function>
    <function name="acab_ext">
      <textSource>
      <![CDATA[PROCEDURE ACAB_EXT (P_OBA_ID         IN NUMBER,
                    P_ANO_GER_CUSTOS IN VARCHAR2,
                    P_GFO            IN VARCHAR2,
                    P_ID             IN NUMBER,
                    P_IGC_ID         IN NUMBER,
                    P_INDICATIVO     IN VARCHAR2)

IS

/************************************************************************
   NOME:        ACAB_EXT
   OBJECTIVO:   Gerar valores auxiliares para considerar como externos as entidades de 
                acabamento marcadas como externas (e descriminar)

   REVISÕES:
   Ver           Data            Autor             Descrição
   ---------  -----------  -----------------  -----------------------
    1.0        2014/11/18   José Sancho        Criação

Parece que uma boa obra para testar em QA é 20111790

**************************************************************************/

-- IVO OLIVEIRA 19/09/2002
-- SE P_FACTURAVEL = 'S' OPERAÇÕES FACTURÁVEIS --> OPERAÇÕES DA EMPRESA " BLOCO GRÁFICO "
-- SE P_FACTURAVEL = 'N' OPERAÇÕES NÃO FACTURÁVEIS --> OPERAÇÕES DA EMPRESA " AREAL "
-- IVO FIM   ISTO DEIXOU DE SER NECESSARIO POIS A SUBCONTRATACAO MESMO DE OUTRAS EMPRESAS
          -- SE TIVER CONSIDERAR='S' DEVE SER TRATADA COMO FACTURÁVEL 29/10/2002

CURSOR C_ENTIDADES_ACABAMENTO
IS
SELECT OBA_ID,
       chave,
       titulo,
       gfo_id,
       PRINCIPAL PRINCIPAL,
       VALOR_ACABAMENTO VALOR_ACABAMENTO,
       VALOR_ACABAMENTO_DIFERENCIAL VALOR_ACABAMENTO_DIFERENCIAL,
       unit_sub unit_sub,
       unit_sub_cus unit_sub_cus,  -- Eribeiro -- 2011-07-01 --
       VALOR_ACABAMENTO_EUR VALOR_ACABAMENTO_EUR,
       VALOR_ACABAMENTO_DIF_EUR VALOR_ACABAMENTO_DIF_EUR,
       unit_sub_eur unit_sub_eur,
       unit_sub_eur_cus unit_sub_eur_cus,  -- Eribeiro -- 2011-07-01 --
       DEC_TIRAGEM,
       DEC_TIPO_PARTE,
       VAL_CUS_ACA_EUR VAL_CUS_ACA_EUR,                -- #SAP# jgs20110105
       VAL_CUS_ACA_DIF_EUR VAL_CUS_ACA_DIF_EUR,         -- #SAP# jgs20110105 
       EAO_ID,
       ENE_ID
FROM  (SELECT OBA.ID OBA_ID,
              OBA.CHAVE_PRINCIPAL CHAVE,
              OBA.TITULO_ABREVIADO TITULO,
              PRE.GFO_ID GFO_ID,
              SUM(DECODE(TIPOS_PARTES.TIPO_PARTE,'P',1,0)) PRINCIPAL,
              SUM(DECODE(TIPOS_PARTES.TIPO_PARTE,'D',0,1) * DECODE(PAO.ID,NULL,0, ( DECODE(EAA.QUANTIDADE,NULL,1,0,1,EAA.QUANTIDADE) * PAO.PRECO_VENDA * DECODE(EAO.TIPO_CALCULO,'O', NVL(PRE.FORMATO_ALTURA,0)/100*NVL(PRE.FORMATO_LARGURA,0)/100, 1) / DECODE(EAO.TIPO_CALCULO,'N',1, 'D', 1, 'O', NVL(DECODE(PRE.ITENS_PLANO,0,1,PRE.ITENS_PLANO),1), TOTAL_PARTES.TOTAL) * DECODE(EAO.TIPO_CALCULO,'N',DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC), 'D', DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC),1)) )) VALOR_ACABAMENTO,
              SUM(DECODE(TIPOS_PARTES.TIPO_PARTE,'D',1,0) * DECODE(PAO.ID,NULL,0, ( DECODE(EAA.QUANTIDADE,NULL,1,0,1,EAA.QUANTIDADE) * PAO.PRECO_VENDA * DECODE(EAO.TIPO_CALCULO,'O', NVL(PRE.FORMATO_ALTURA,0)/100*NVL(PRE.FORMATO_LARGURA,0)/100, 1) / DECODE(EAO.TIPO_CALCULO,'N',1, 'D', 1, 'O', NVL(DECODE(PRE.ITENS_PLANO,0,1,PRE.ITENS_PLANO),1), TOTAL_PARTES.TOTAL) * DECODE(EAO.TIPO_CALCULO,'N',DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC), 'D', DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC),1)) )) VALOR_ACABAMENTO_DIFERENCIAL,
              0 unit_sub,
              0 unit_sub_cus, -- Eribeiro -- 2011-07-01 --
              SUM(DECODE(TIPOS_PARTES.TIPO_PARTE,'D',0,1) * DECODE(PAO.ID,NULL,0, ( DECODE(EAA.QUANTIDADE,NULL,1,0,1,EAA.QUANTIDADE) * PAO.PRECO_VENDA_EUR * DECODE(EAO.TIPO_CALCULO,'O', NVL(PRE.FORMATO_ALTURA,0)/100*NVL(PRE.FORMATO_LARGURA,0)/100, 1) / DECODE(EAO.TIPO_CALCULO,'N',1, 'D', 1, 'O', NVL(DECODE(PRE.ITENS_PLANO,0,1,PRE.ITENS_PLANO),1), TOTAL_PARTES.TOTAL) * DECODE(EAO.TIPO_CALCULO,'N',DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC), 'D', DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC),1)) )) VALOR_ACABAMENTO_EUR,
              SUM(DECODE(TIPOS_PARTES.TIPO_PARTE,'D',1,0) * DECODE(PAO.ID,NULL,0, ( DECODE(EAA.QUANTIDADE,NULL,1,0,1,EAA.QUANTIDADE) * PAO.PRECO_VENDA_EUR * DECODE(EAO.TIPO_CALCULO,'O', NVL(PRE.FORMATO_ALTURA,0)/100*NVL(PRE.FORMATO_LARGURA,0)/100, 1) / DECODE(EAO.TIPO_CALCULO,'N',1, 'D', 1, 'O', NVL(DECODE(PRE.ITENS_PLANO,0,1,PRE.ITENS_PLANO),1), TOTAL_PARTES.TOTAL) * DECODE(EAO.TIPO_CALCULO,'N',DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC), 'D', DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC),1)) )) VALOR_ACABAMENTO_DIF_EUR,
              0 unit_sub_eur,
              0 unit_sub_eur_cus, -- Eribeiro -- 2011-07-01 --
              DECODE(TIPOS_PARTES.TIPO_PARTE,'D',PRE.TIRAGEM,NULL) DEC_TIRAGEM,
              DECODE(TIPOS_PARTES.TIPO_PARTE,'P','P','D','D','OUTROS') DEC_TIPO_PARTE,
              SUM(DECODE(TIPOS_PARTES.TIPO_PARTE,'D',0,1) * DECODE(PAO.ID,NULL,0, ( DECODE(EAA.QUANTIDADE,NULL,1,0,1,EAA.QUANTIDADE) * PAO.PRECO_CUSTO_EUR * DECODE(EAO.TIPO_CALCULO,'O', NVL(PRE.FORMATO_ALTURA,0)/100*NVL(PRE.FORMATO_LARGURA,0)/100, 1) / DECODE(EAO.TIPO_CALCULO,'N',1, 'D', 1, 'O', NVL(DECODE(PRE.ITENS_PLANO,0,1,PRE.ITENS_PLANO),1), TOTAL_PARTES.TOTAL) * DECODE(EAO.TIPO_CALCULO,'N',DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC), 'D', DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC),1)) )) VAL_CUS_ACA_EUR,         -- #SAP# jgs20110105
              SUM(DECODE(TIPOS_PARTES.TIPO_PARTE,'D',1,0) * DECODE(PAO.ID,NULL,0, ( DECODE(EAA.QUANTIDADE,NULL,1,0,1,EAA.QUANTIDADE) * PAO.PRECO_CUSTO_EUR * DECODE(EAO.TIPO_CALCULO,'O', NVL(PRE.FORMATO_ALTURA,0)/100*NVL(PRE.FORMATO_LARGURA,0)/100, 1) / DECODE(EAO.TIPO_CALCULO,'N',1, 'D', 1, 'O', NVL(DECODE(PRE.ITENS_PLANO,0,1,PRE.ITENS_PLANO),1), TOTAL_PARTES.TOTAL) * DECODE(EAO.TIPO_CALCULO,'N',DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC), 'D', DECODE(PRE.REL_IMP_ACA_FAC,0,1,PRE.REL_IMP_ACA_FAC),1)) )) VAL_CUS_ACA_DIF_EUR,      -- #SAP# jgs20110105
              EAA.EAO_ID,
              EAA.ENE_ID
       FROM   BGO_ENTIDADES_ACABAMENTO_OBRAS EAA,
              BGO_ENTIDADE_ACABAMENTO EAO,
              BGO_PRECOS_ACABAMENTO PAO,
              BGO_OBRAS_PARTES_N1_V TIPOS_PARTES,
              BGO_OBRAS_PARTES_EA_V TOTAL_PARTES,
              BGO_PARTES_CFD_V SOMAS_PARTES,
              BGO_RESUMO_ARTIGOS_GF_TEMP RAT,
              BGO_OBRAS OBA,
              BGO_PARTES PRE
       WHERE  EAA.EAO_ID = EAO.ID (+)
       AND    EAA.FLG_CUS_EXT = 'S'
       AND    PAO.EAO_ID (+) = EAO.ID
       AND    EAA.PRE_ID (+) = PRE.ID
       AND    SOMAS_PARTES.OBA_ID = P_OBA_ID
       AND    somas_partes.eao_id = eaa.eao_id
       AND   ((PRE.GFO_ID IS NOT NULL
               AND
               SOMAS_PARTES.GFO_ID = PRE.GFO_ID)
              OR
              PRE.GFO_ID IS NULL)
       AND   ((EAO.ID IS NOT NULL
               AND
               TOTAL_PARTES.EAO_ID = EAO.ID )
              OR
              EAO.ID IS NULL )
       AND    TOTAL_PARTES.OBA_ID  = P_OBA_ID
       AND   ((PRE.GFO_ID IS NOT NULL
               AND
               TOTAL_PARTES.GFO_ID = PRE.GFO_ID)
              OR
              PRE.GFO_ID IS NULL)
       AND    TIPOS_PARTES.CODIGO_NIVEL1 = PRE.CODIGO_NIVEL1
       AND    TIPOS_PARTES.CHAVE_PRINCIPAL = OBA.CHAVE_PRINCIPAL
       AND   ((PAO.ID IS NULL)
              OR
              ((TO_CHAR(SYSDATE,'YYYY-MM-DD')<(SELECT valor_BG
                                               FROM   BGO_PARAMETROS
                                               WHERE  descricao = 'data_transicao'
                                               AND    ROWNUM=1)
                AND
                PAO.PRECO_VENDA IS NOT NULL)
               OR
               (TO_CHAR(SYSDATE,'YYYY-MM-DD')>=(SELECT valor_BG
                                                FROM   BGO_PARAMETROS
                                                WHERE  descricao = 'data_transicao'
                                                AND    ROWNUM=1)
                AND
                PAO.PRECO_VENDA_EUR IS NOT NULL)))
       AND    ((PAO.ID IS NOT NULL
                AND
                PAO.ANO = P_ANO_GER_CUSTOS)
               OR PAO.ID IS NULL)
       AND    ((EAO.ID IS NOT NULL
                AND
                ((EAO.TIPO_CALCULO IN ('N','O')
                  OR
                  (EAO.TIPO_CALCULO NOT IN ('N', 'O')
                   AND
                   DECODE(EAO.TIPO_CALCULO,'F',DECODE(TIPOS_PARTES.TIPO_PARTE,'D',SOMAS_PARTES.TOTAL_FOLHAS_DIFERENCIAL,SOMAS_PARTES.TOTAL_FOLHAS),
                                           'C',DECODE(TIPOS_PARTES.TIPO_PARTE,'D',SOMAS_PARTES.TOTAL_CADERNOS_DIFERENCIAL,SOMAS_PARTES.TOTAL_CADERNOS),
                                           'D',ROUND(NVL(PRE.NUMERO_PAGINAS,0)/(DECODE(PRE.REL_IMP_ACA_FAC,NULL,1,0,1,PRE.REL_IMP_ACA_FAC)))) BETWEEN PAO.LIMITE_INFERIOR AND PAO.LIMITE_SUPERIOR))))
               OR
               EAO.ID IS NULL)
       AND    (P_GFO = 'N'
               OR
               (P_GFO = 'S'
                AND
                RAT.GFO_ID = PRE.GFO_ID))
       AND     RAT.OBA_ID = P_OBA_ID
       AND     RAT.ID = P_ID
       AND     OBA.ID = P_OBA_ID
       AND     PRE.OBA_ID = P_OBA_ID
       GROUP BY
               OBA.ID,
                 EAA.EAO_ID,
                 EAA.ENE_ID,
               OBA.CHAVE_PRINCIPAL,
               OBA.TITULO_ABREVIADO,
               PRE.GFO_ID,
               DECODE(TIPOS_PARTES.TIPO_PARTE,'D',PRE.TIRAGEM,NULL),
               DECODE(TIPOS_PARTES.TIPO_PARTE,'P','P','D','D','OUTROS'))
ORDER BY
       principal DESC;

    /*VALORES FACTURAÇÃO - OBRAS ASSOCIADAS*/


    CURSOR C_ASSOC_GRUPOS_FACT(P_GFO_ID NUMBER)IS
    SELECT GFO_ID_RECEPTOR,
           PERCENTAGEM
    FROM   BGO_ASSOC_GRUPOS_FACTURACAO
    WHERE  GFO_ID_ASSOCIADO = P_GFO_ID;


    V_FIM                           VARCHAR2(1):='N';
    V_NUM_GRUPOS_ASSOC               NUMBER := 0;
    V_ASSOC_JA_FACT                   VARCHAR2(1) := 'N';
    v_logs                           VARCHAR2(1) := 'S';

    V_C_ENTIDADES_ACABAMENTO       C_ENTIDADES_ACABAMENTO%ROWTYPE;
    V_C_ENTIDADES_ACABAMENTO_TEMP  C_ENTIDADES_ACABAMENTO%ROWTYPE;

    V_PUA                      NUMBER(20,9) := 0;
    V_PDA                      NUMBER(20,9) := 0;
    V_PUA_EUR                  NUMBER(20,9) := 0;
    V_PDA_EUR                  NUMBER(20,9) := 0;
    V_EA_DIF_GFO_ID           NUMBER(9)    := 0;
    V_EA_FID_TIRAGEM           NUMBER(9)       := 0;
    V_DIF_SIM                  VARCHAR2(1)  := 'N';

    V_EMPRESA                  BGO_VALO_FACT_EMPR_GRUP.EMPRESA%TYPE;

    V_PUA_CUS                  NUMBER(20,9) := 0;
    V_PDA_CUS                  NUMBER(20,9) := 0;
    V_PUA_EUR_CUS              NUMBER(20,9) := 0;
    V_PDA_EUR_CUS              NUMBER(20,9) := 0;

    v_reg_vfo                 bgo_valores_facturacao%rowtype;
    v_reg_w                   BGO_ANALISE_FACTURACAO_V%rowtype;
    v_nome_abre               varchar2(1000);
    v_eao_desc                varchar2(1000);


    V_TIR NUMBER;


BEGIN
   
  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','*** INICIO DO PROCESSAMENTO: ACABAMENTO ***');

  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(P_oba_id));
  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',P_ano_ger_custos);
  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',P_gfo);
  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(P_id));

  FOR V_C_ENTIDADES_ACABAMENTO IN C_ENTIDADES_ACABAMENTO
  LOOP

    V_FIM:='S';

    Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO_EUR));
    Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.unit_sub_eur));
    Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.unit_sub_eur_cus));
    Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.VAL_CUS_ACA_EUR)); -- #SAP# jgs20110105


    /*Valores da Obra Referente - Acabamentos*/

    IF V_C_ENTIDADES_ACABAMENTO.DEC_TIPO_PARTE != 'D' THEN

       IF v_logs='S' THEN
          IF NVL(P_INDICATIVO,'N')='S' THEN
            Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','=> ESTOU A INSERIR A LINHA DE ACABAMENTOS (VALOR MERAMENTE INDICATIVO)');
          ELSE
            Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','=> ESTOU A INSERIR A LINHA DE ACABAMENTOS');
          END IF;
       END IF;

       IF V_C_ENTIDADES_ACABAMENTO.GFO_ID IS NOT NULL THEN
          SELECT COUNT(1)
          INTO   V_NUM_GRUPOS_ASSOC
          FROM   BGO_ASSOC_GRUPOS_FACTURACAO
          WHERE  GFO_ID_ASSOCIADO = V_C_ENTIDADES_ACABAMENTO.GFO_ID;
       END IF;

       IF V_C_ENTIDADES_ACABAMENTO.GFO_ID IS NOT NULL  AND V_NUM_GRUPOS_ASSOC > 0 THEN

          FOR XREG IN C_ASSOC_GRUPOS_FACT(V_C_ENTIDADES_ACABAMENTO.GFO_ID)
          LOOP

            BEGIN

             IF v_logs='S' THEN
                IF NVL(P_INDICATIVO,'N')='S' THEN
                  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','=> INSERIR (1) - (VALOR MERAMENTE INDICATIVO)');
                ELSE
                  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','=> INSERIR (1)');
                END IF;
             END IF;


                v_reg_vfo.OBA_ID_REFERENTE         := P_OBA_ID;
                v_reg_vfo.OBA_ID_PROVENIENTE    := P_OBA_ID;
                v_reg_vfo.GFO_ID              := XREG.GFO_ID_RECEPTOR;
                v_reg_vfo.IGC_ID              := P_IGC_ID;
                v_reg_vfo.VALOR               := NVL(ROUND((V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO+V_C_ENTIDADES_ACABAMENTO.unit_sub),1),0) * XREG.PERCENTAGEM / 100;
                v_reg_vfo.VALOR_EUR           := ROUND(NVL((V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO_EUR+V_C_ENTIDADES_ACABAMENTO.unit_sub_eur),0) * XREG.PERCENTAGEM / 100,5);
                v_reg_vfo.VAL_CUS             := ROUND(NVL((V_C_ENTIDADES_ACABAMENTO.VAL_CUS_ACA_EUR+V_C_ENTIDADES_ACABAMENTO.unit_sub_eur_cus),0) * XREG.PERCENTAGEM / 100,5);
                v_reg_vfo.TIPO_MOVIMENTO      := 'B';
                v_reg_vfo.IGC_ID_PROVENIENTE  := P_IGC_ID;

                           /*
                           SELECT     null ordenacao,
                           Cco.ORD    ordenacao_num,
                           ODA.OBA_ID OBA_ID_SUO,
                           OPO.DESCRICAO,
                           ENE.NOME_ABREVIADO,
                           decode(opo.sinal_operacao,'-',-1,1)*SUO.pre_ven SUO_VALOR
                           */

                begin
                             
                             select nome_abreviado
                             into   v_nome_abre
                             from   bgo_entidades
                             where  id = V_C_ENTIDADES_ACABAMENTO.ene_id;
                 
                exception when others then v_nome_abre := null;
                end;

                  begin
                               
                               select descricao
                               into   v_eao_desc
                               from   bgo_entidade_acabamento
                               where  id = V_C_ENTIDADES_ACABAMENTO.eao_id;
                   
                  exception when others then v_eao_desc  := null;
                  end;

                v_tir := Tiragem_2 (:p_Oba_Id,XREG.GFO_ID_RECEPTOR );

                insert into BGO_AUXI_REPO_FATU (tip_reg,SEQ_ID,c1,VALOR_EUR, DESCRICAO, n2, N3)        
                values ('BG_EXT',:p_ses_id_ext, v_nome_abre, v_reg_vfo.VALOR_EUR,v_eao_desc, v_reg_vfo.GFO_ID, V_TIR );

                -- FIM simular view BGO_ANALISE_FACTURACAO_V

             EXCEPTION
            WHEN OTHERS THEN
              ROLLBACK;
              Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','=> Erro ao Inserir Valores de Facturação referentes a Valores de Acabamentos da própria OBRA. '||SQLCODE);
              --DSI$ERRORS.UNHANDLED_EXCEPTION('Erro ao Inserir Valores de Facturação referentes a Valores de Acabamentos da própria OBRA. '||SQLCODE);
              END;

          END LOOP;

       ELSE

          BEGIN

             IF v_logs='S' THEN
                Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO_EUR));
                Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.unit_sub_eur));
                Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.unit_sub_eur_cus));
                Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_',TO_CHAR(V_C_ENTIDADES_ACABAMENTO.VAL_CUS_ACA_EUR)); -- #SAP# jgs20110105
                Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','=> INSERIR (2)');
             END IF;


              v_reg_vfo.OBA_ID_REFERENTE         := P_OBA_ID;
              v_reg_vfo.OBA_ID_PROVENIENTE    := P_OBA_ID;
              v_reg_vfo.GFO_ID              := V_C_ENTIDADES_ACABAMENTO.GFO_ID;
              v_reg_vfo.IGC_ID              := P_IGC_ID;
              v_reg_vfo.VALOR               := NVL(ROUND((V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO+V_C_ENTIDADES_ACABAMENTO.unit_sub),1),0);
              v_reg_vfo.VALOR_EUR           := ROUND(NVL((V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO_EUR+V_C_ENTIDADES_ACABAMENTO.unit_sub_eur),0),5);
              v_reg_vfo.VAL_CUS             := ROUND(NVL((V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO_EUR+V_C_ENTIDADES_ACABAMENTO.unit_sub_eur),0),5);
              v_reg_vfo.TIPO_MOVIMENTO      := 'B';
              v_reg_vfo.IGC_ID_PROVENIENTE  := P_IGC_ID;

              begin
                           
                           select nome_abreviado
                           into   v_nome_abre
                           from   bgo_entidades
                           where  id = V_C_ENTIDADES_ACABAMENTO.ene_id;
               
              exception when others then v_nome_abre := null;
              end;

              begin
                           
                           select descricao
                           into   v_eao_desc
                           from   bgo_entidade_acabamento
                           where  id = V_C_ENTIDADES_ACABAMENTO.eao_id;
               
              exception when others then v_eao_desc  := null;
              end;

                v_tir := Tiragem_2 (:p_Oba_Id,V_C_ENTIDADES_ACABAMENTO.GFO_ID);

              insert into BGO_AUXI_REPO_FATU (tip_reg,SEQ_ID,c1,VALOR_EUR,descricao, n2, N3)        
              values ('BG_EXT',:p_ses_id_ext, v_nome_abre, v_reg_vfo.VALOR_EUR,v_eao_desc, v_reg_vfo.GFO_ID, v_tir );

          EXCEPTION
          WHEN OTHERS THEN
            ROLLBACK;
            Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','=> Erro ao Inserir Valores de Facturação referentes a Valores de Acabamentos da própria OBRA. '||SQLCODE);
            --DSI$ERRORS.UNHANDLED_EXCEPTION('Erro ao Inserir Valores de Facturação referentes a Valores de Acabamentos da própria OBRA. '||SQLCODE);
          END;

       END IF;

       V_PUA := V_PUA + V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO + V_C_ENTIDADES_ACABAMENTO.unit_sub;
       V_PUA_EUR := V_PUA_EUR + V_C_ENTIDADES_ACABAMENTO.VALOR_ACABAMENTO_EUR + V_C_ENTIDADES_ACABAMENTO.unit_sub_eur;

       V_PUA_EUR_CUS := V_PUA_EUR_CUS + V_C_ENTIDADES_ACABAMENTO.VAL_CUS_ACA_EUR + V_C_ENTIDADES_ACABAMENTO.unit_sub_eur_cus; -- #SAP# jgs20110105

    END IF;
   
    -- por simplicidade, não trato os Diferenciais...


    V_C_ENTIDADES_ACABAMENTO_TEMP := V_C_ENTIDADES_ACABAMENTO;

  END LOOP;

  commit;

  Uc$varios.CRIA_LOG('ficheiros_log_adm','ACAB_EXT_','*** FIM DO PROCESSAMENTO: ACABAMENTO ***');
  
  
  
END ACAB_EXT;
]]>
      </textSource>
    </function>
    <function name="acab_sub">
      <textSource>
      <![CDATA[PROCEDURE ACAB_SUB IS

    v_nome_abre     varchar2(500);
    v_valor         number;
    
    v_tir           number;
    v_gfo_id        number;

    v_id_p          number := null;

BEGIN


  -- para simular o comportamento da geração de valores, calcular primeiro o preço medio por parte, porque o preço medio por parte é calculado
  -- independentemente da entidade.
  -- como no report depois temos que apresentar por entidade, depois desagregamos, mas usamos o mesmo valor para todas as entidades.


    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> ENTRO EM ACAB_SUB...', null, null);


  -- jgs20150128: se obra tiver uma parte de tipo P, só considerar nos cálculos essa e as filhas. Se não, todas.
  begin
        select id
        into   v_id_p
        from   bgo_partes
        where  oba_id     = :p_oba_id
        and    tipo_parte = 'P';
    
  exception when others then v_id_p := null;
  end;

  
  for r_pre in (

      select opo.id opo_id, oda.pre_id, sum(suo.pre_ven)/sum(nvl(suo.qtd_fat,oda.quantidade)) pre_uni, opo.descricao   -- jgs20170214 select opo.id opo_id, oda.pre_id, sum(suo.pre_ven)/sum(oda.quantidade) pre_uni, opo.descricao
      from   bgo_subcontratacoes       suo,
             bgo_operacoes_processadas oda,
             bgo_oda_igc_aux           oia,
             bgo_operacoes_anuais      ono,
             bgo_operacoes             opo
      where  oia.igc_id = (select  max (vfo2.igc_id_proveniente)
                             from  bgo_valores_facturacao    vfo2
                            where  vfo2.oba_id_referente    = :p_oba_id
                              and  vfo2.tipo_movimento = 'B'
                          ) 
      and   oia.oda_id     = oda.id
      and   oia.oda_id     = suo.oda_id                    
      and   oia.considerar = 'S'
      and   oda.ono_id     = ono.id
      and   ono.opo_id     = opo.id 
      -- JGS20150128
      and   ( v_id_p is null or
                    (v_id_p is not null and oda.pre_id in (
                                                            select v_id_p id from dual
                                                            union all
                                                            select id id
                                                            from   bgo_partes
                                                            where  oba_id = :p_oba_id
                                                            and    pre_id = v_id_p
                                                        )
                    )
            )
      group by opo.id, oda.pre_id, opo.descricao

  )
  loop

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> r_pre.PRE_ID = '||r_pre.PRE_ID, null, null);

    -- para cada uma das partes, todos os clientes...

      for r_sub in (
    
                select opo.id opo_id, oda.ene_id, r_pre.pre_uni pre_uni, opo.descricao,sum(nvl(suo.qtd_fat,oda.quantidade)) qtd     -- jgs20170214 select opo.id opo_id, oda.ene_id, r_pre.pre_uni pre_uni, opo.descricao,sum(oda.quantidade) qtd
                from   bgo_subcontratacoes       suo,
                       bgo_operacoes_processadas oda,
                       bgo_oda_igc_aux           oia,
                       bgo_operacoes_anuais      ono,
                       bgo_operacoes             opo
                where  oia.igc_id = (select  max (vfo2.igc_id_proveniente)
                                       from  bgo_valores_facturacao    vfo2
                                      where  vfo2.oba_id_referente    = :p_oba_id
                                        and  vfo2.tipo_movimento = 'B'
                                    ) 
                and   oia.oda_id     = oda.id
                and   oia.oda_id     = suo.oda_id                    
                and   oia.considerar = 'S'
                and   oda.ono_id     = ono.id
                and   oda.pre_id     = r_pre.pre_id
                and   ono.opo_id     = r_pre.opo_id
                and   ono.opo_id     = opo.id 
                group by opo.id, oda.ene_id, opo.descricao
    
      ) 
      loop
          
          begin
                       
                       select nome_abreviado
                       into   v_nome_abre
                       from   bgo_entidades
                       where  id = r_sub.ene_id;
           
          exception when others then v_nome_abre := null;
          end;
    
          --SRW.set_field_num (0, nvl(:valor_eur_detail,1) * Tiragem(:Oba_Id));
          
          begin 

	          select gfo_id
	          into   v_gfo_id
	          from   bgo_partes
	          where  id = r_pre.pre_id;

          exception when others then v_gfo_id := null;
          end;
    
          v_tir := Tiragem_2 (:p_Oba_Id,v_gfo_id);

          UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'ACAB_SUO->>>>>>>>>>>>>>>>>>v_tir = '||v_tir, null, null);
          UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'ACAB_SUO->>>>>>>>>>>>>>>>>>r_sub.pre_uni = '||r_sub.pre_uni, null, null);
    
          v_valor := r_sub.pre_uni * v_tir;       -- a diferença entre a primeira versão e esta é que o pre_uni agora vem da simulação do cálculo do acabamento.
                                                       -- o pre_uni que estava na primeira versão era:
                                                       /*
                                                                                                                  for r_sub in (
                                                                                                                            select opo.id opo_id, oda.ene_id, sum(suo.pre_ven)/sum(oda.quantidade) pre_uni, opo.descricao
                                                       
                                                       */
    
          insert into BGO_AUXI_REPO_FATU (tip_reg,SEQ_ID,c1,VALOR_EUR, DESCRICAO,n2,n3)        
          values ('BG_ACA_SUB',:p_ses_id_subc_encad, v_nome_abre, v_valor,r_sub.descricao,v_gfo_id,v_tir);
          
          
      end loop;
  
  end loop; --for r_pre in (
  

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> ANTES DE COMMIT 1 ACAB_SUB', null, null);
  
  commit;

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> DEPOIS DE COMMIT 1 ACAB_SUB', null, null);
  
  -- para não existir diferenças de arredondamento, ajustamos um dos registos
  -- SRW.set_field_num (0, nvl(:valor_eur_detail,1) * Tiragem(:Oba_Id));
  declare
      
        v_valor_eur_detail      number;
        v_av_menos_auxi         number; 
        v_av_menos_auxi_abs     number; 
      
  begin

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> VAI FAZER O SELECT ', null, null);


            SELECT 0 --DECODE(:P_ALTERA_50_2A,'N',afo.valor_eur,DECODE(afo.tipo_movimento_aux,'2A',UC$FACTURAS_OBRAS.reto_valo_2A_5O(afo.oba_id),(DECODE(afo.tipo_movimento_aux,'5O',UC$FACTURAS_OBRAS.reto_valo_2A_5O(afo.oba_id),afo.valor_eur)))) Valor_eur_Detail
            into   v_valor_eur_detail
            FROM   BGO_ANALISE_FACTURACAO_V afo
            --where  afo.flg_tip_ger        = :p_flg_tip_ger
            WHERE    afo.tipo_movimento_aux = '7B'
            and    afo.oba_id             = :p_oba_id;
            
    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> DEPOIS DO SELECT: ENCONTROU! ', null, null);

            -- se foi encontrada... 
        UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', '####### -- v_valor_eur_detail = '||TO_CHAR(NVL(v_valor_eur_detail,-1)), null, null);

      --:P_ACUM_ACA_SUBC;
      
      BEGIN
      
                  select nvl(sum(VALOR_EUR),0)
                  into   :P_ACUM_ACA_SUBC
                  from   BGO_AUXI_REPO_FATU
                  where  seq_id = :p_ses_id_subc_encad;

            UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', '####### -- :P_ACUM_ACA_SUBC = '||TO_CHAR(NVL(:P_ACUM_ACA_SUBC,-1)), null, null);
      
      EXCEPTION WHEN OTHERS THEN :P_ACUM_ACA_SUBC := 0;
      END; 

        UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', '####### -- :p_tiragem = '||TO_CHAR(NVL(:p_tiragem,-1)), null, null);

      v_av_menos_auxi := v_valor_eur_detail*nvl(:p_tiragem,0) - :P_ACUM_ACA_SUBC;
            
        UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', '####### -- v_av_menos_auxi = '||TO_CHAR(NVL(v_av_menos_auxi,-1)), null, null);

      select abs(nvl(v_av_menos_auxi,0))
      into   v_av_menos_auxi_abs
      from   dual;
      
      if v_av_menos_auxi_abs < 0.05 and v_av_menos_auxi_abs > 0 then   -- ajustar um dos valores, e recalcular total...

                    update BGO_AUXI_REPO_FATU
                    set    VALOR_EUR = VALOR_EUR + v_av_menos_auxi
                    where  id = (
                        
                          select min(id)
                          from   BGO_AUXI_REPO_FATU
                          where  seq_id = :p_ses_id_subc_encad

                    );


              BEGIN  
              
                          select nvl(sum(VALOR_EUR),0)
                          into   :P_ACUM_ACA_SUBC
                          from   BGO_AUXI_REPO_FATU
                          where  seq_id = :p_ses_id_subc_encad;
        
                    UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', '####### -- após ajuste... :P_ACUM_ACA_SUBC = '||TO_CHAR(NVL(:P_ACUM_ACA_SUBC,-1)), null, null);
              
              EXCEPTION WHEN OTHERS THEN :P_ACUM_ACA_SUBC := 0;
              END; 

      end if;

  exception when others then NULL;  -- NÃO ENCONTROU...
  end;
  
  IF :P_ACUM_ACA_SUBC IS NULL THEN
      
      :P_ACUM_ACA_SUBC := 0;
      
  END IF;
  
  commit;
  
END;]]>
      </textSource>
    </function>
    <function name="tiragem_2">
      <textSource>
      <![CDATA[FUNCTION Tiragem_2 (p_Oba_Id Number, P_GFO_ID IN NUMBER) RETURN Number IS
	v_qtd_facturada bgo_linhas_guias_entrega.quantidade_facturada%TYPE;
BEGIN

	if upper(:P_Atender_Entregas) = 'N' then

			SELECT MIN (x.total_entrega)
			INTO	 v_qtd_facturada
			FROM (SELECT  pre.gfo_id,
									  (NVL(pre.tiragem,0)) total_entrega
						FROM	BGO_PARTES pre
						WHERE	pre.oba_id = P_Oba_Id
						AND 	pre.codigo_nivel2 ='00'
						AND 	pre.codigo_nivel3 ='00'
						AND		nvl(pre.tiragem,0) <> 0
						-- Ivo Oliveira 23/09/2002
						--AND		pre.gfo_id = P_gfo_id_detail  -- Condição de no caso de se ter que procurar o mínimo por Grupo de Facturação
						AND		pre.gfo_id = P_gfo_id
						-- Ivo Fim
						AND		EXISTS (SELECT  1
   			    							FROM	BGO_RESUMO_ARTIGOS_GF_TEMP tmp
   												WHERE	tmp.oba_id = P_Oba_Id
   												AND		tmp.Id = :P_Id
   												AND     tmp.gfo_id = pre.gfo_id)) X;
   												
	elsif upper(:P_Atender_Entregas) = 'S' then

	
		SELECT MIN (X.tiragem)
		INTO	 v_qtd_facturada
		FROM (SELECT pre.gfo_id,
							   NVL(SUM(lge.quantidade - lge.quantidade_facturada),0) tiragem --Alterado Joao Repolho 2000-09-06
		  		FROM	 BGO_LINHAS_GUIAS_ENTREGA lge,
				  			 BGO_CABECALHOS_GUIAS cga,
				  			 BGO_PARTES pre
		  		WHERE	  oba_id_facturacao = p_Oba_Id
		  		AND		pre.id = lge.pre_id_facturacao
		  		AND		cga.id = lge.cga_id
		  		AND   lge.estado <>'N' --Acrescentado em 23/11/2000 Teresa Coutinho
		  		AND   cga.estado <>'N' --Acrescentado em 23/11/2000 Teresa Coutinho
		  		AND		cga.tipo_guia IN ('R','S')
		  		-- Ivo Oliveira 23/09/2002
		  		--AND		pre.gfo_id = P_gfo_id_detail  -- Condição de no caso de se ter que procurar o mínimo por Grupo de Facturação
		  		AND		pre.gfo_id = P_gfo_id
		  		-- Ivo Fim
		  		AND		EXISTS (SELECT  1
												FROM	BGO_RESUMO_ARTIGOS_GF_TEMP tmp
		 										WHERE	tmp.oba_id = P_Oba_Id
		 										AND		tmp.Id = :P_Id
		 										AND     tmp.gfo_id = pre.gfo_id)
		 			GROUP BY pre.gfo_id ) X;
		 							
	end if;
	  
	return (v_qtd_facturada);
	
exception
		when no_data_found then
			return (-1);
END;]]>
      </textSource>
    </function>
    <function name="cf_tiragemformula" returnType="number">
      <textSource>
      <![CDATA[function CF_TIRAGEMFormula return Number is
  v_ret        number;
begin
  v_ret := reps_resu_cust_dao.CF_TIRFormula (:p_oba_id);
    return  v_ret;
exception when others then    
  RETURN NULL;
end;]]>
      </textSource>
    </function>
    <function name="cf_coresformula" returnType="character">
      <textSource>
      <![CDATA[function CF_CORESFormula return Char is
   
   v_out      VARCHAR2(200) := NULL;
   
BEGIN
    
     v_out := reps_resu_cust_dao.CF_CAPA_GFormula (:p_oba_id);
   
   RETURN (v_out);

exception
when others then
   return (null);
end;

]]>
      </textSource>
    </function>
    <function name="cf_autorformula" returnType="character">
      <textSource>
      <![CDATA[function CF_AUTORFormula return Char is
   v_autor  VARCHAR2(2000) := NULL; 

BEGIN

   v_autor := reps_resu_cust_dao.CF_AUTORESFormula (:p_oba_id);
  
   return (v_autor);  
end;]]>
      </textSource>
    </function>
    <function name="cf_chaveformula" returnType="character">
      <textSource>
      <![CDATA[function CF_CHAVEFormula return Char is
  v_ch	varchar2(20);
  V_CHR10   VARCHAR2(1000) := null;
begin
	
	select to_char(chave_principal)
	into   v_ch
	from   bgo_obras
	where  id = :p_oba_id;


  IF LENGTH(:cf_tit) > 150 and :cf_clo is not null THEN
      
      V_CHR10 := V_CHR10 || chr(10);
      
  ELSE

      V_CHR10 := null;
      
  END IF;

	
  RETURN V_CHR10 || v_ch;
end;]]>
      </textSource>
    </function>
    <function name="cf_g_titformula" returnType="character">
      <textSource>
      <![CDATA[function CF_G_TITFormula return Char is
    v_titu varchar2(200);
begin
    
    return null;
    /* jgs20150701
    v_titu := reps_resu_cust_dao.CF_tituFormula(:p_oba_id);
    RETURN(substr(v_titu,1,200)); -- JGS20150407: Acrescento sbstr, dava erro com titulo_completo 200 + coleção
    */
end;]]>
      </textSource>
    </function>
    <function name="cf_num_codformula" returnType="character">
      <textSource>
      <![CDATA[function CF_NUM_CODFormula return Char is
  v_ret varchar2(100);
  V_CHR10   VARCHAR2(1000) := null;
begin
    
  select UC$SGP_PLAN_OPER.OBTE_OBA_NUME_CODI_MASC_02 (oba.numero_codigo,oba.add_on)
  into   v_ret
  from   bgo_obras oba
  where  oba.id = :p_oba_id;

  IF LENGTH(:cf_tit) > 150 and :cf_clo is not null THEN
      
      V_CHR10 := V_CHR10 || chr(10);
      
  ELSE

      V_CHR10 := null;
      
  END IF;

  return V_CHR10||v_ret;

end;]]>
      </textSource>
    </function>
    <function name="cf_clienteformula" returnType="character">
      <textSource>
      <![CDATA[function CF_CLIENTEFormula return Char is
    v_ret        varchar2(200);
begin

  v_ret := reps_resu_cust_dao.CF_CLIENTEFormula (:p_oba_id);

    return v_ret;

exception when others then return null;  
end;
]]>
      </textSource>
    </function>
    <function name="cf_num_folformula" returnType="character">
      <textSource>
      <![CDATA[function CF_NUM_FOLFormula return Char is
   
   v_out      VARCHAR2(200) := NULL;
   

BEGIN

   -- JGS20201014 v_out := reps_resu_cust_dao.CF_FOLHAS_GFormula (:p_oba_id);
   v_out :=lCF_FOLHAS_GFormula (:p_oba_id);
   RETURN (v_out);
  
end;]]>
      </textSource>
    </function>
    <function name="cf_reg_graformula" returnType="character">
      <textSource>
      <![CDATA[function CF_REG_GRAFormula return varchar2 is
    v_ret    varchar2(2000);
begin
    v_ret := reps_resu_cust_dao.CF_REG_GRAFormula(:p_oba_id);
  RETURN v_ret;
end;]]>
      </textSource>
    </function>
    <function name="cf_coordenaformula" returnType="character">
      <textSource>
      <![CDATA[function CF_COORDENAFormula return Char is
  V_TXT        VARCHAR2(1000);
begin
  V_TXT := :CF_EDITORES||:CF_COORDENADORES;
  IF V_TXT IS NULL THEN RETURN NULL;
  ELSE
      IF :CF_EDITORES IS NULL THEN
          RETURN INITCAP(:CF_COORDENADORES);
      ELSE
          RETURN INITCAP(:CF_EDITORES||'; '||:CF_COORDENADORES);
      END IF;
  END IF;
end;]]>
      </textSource>
    </function>
    <function name="cf_editoresformula" returnType="character">
      <textSource>
      <![CDATA[function CF_EDITORESFormula return Char is

   v_editor  VARCHAR2(2000) := NULL; 

BEGIN

   v_editor := reps_resu_cust_dao.CF_editoresFormula (:p_oba_id);
   return (v_editor);  
end;
]]>
      </textSource>
    </function>
    <function name="cf_coordenadoresformula" returnType="character">
      <textSource>
      <![CDATA[function CF_COORDENADORESFormula return Char is

   v_coord  VARCHAR2(2000) := NULL; 

BEGIN

   v_coord := reps_resu_cust_dao.CF_coordenadoresFormula (:p_oba_id);
   return (v_coord);  
end;

]]>
      </textSource>
    </function>
    <function name="uc$trata_oper_discr">
      <textSource>
      <![CDATA[PROCEDURE UC$TRATA_OPER_DISCR IS

   v_cco_id    number;
   v_igc_id    number;
   
   v_tot_qtd   number;
   v_tot_val   number;
   v_tot_tem   number;

	 -- jgs20150127   
   v_ccc_reg   BGO_CLASSES_CENTROS_CUSTOS%rowtype;
   aoa_reg     bgo_associacoes_obras%rowtype;
   v_perc      number;
   
BEGIN

	 UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '####### -- UC$TRATA_OPER_DISCR: :P_Id = '||TO_CHAR(NVL(:P_Id,-1)), null, null);

   -- jgs20150126 inserir na tabela tmp os oba_id das associadas.
   delete from bgo_auxi_perg_resp where tab_nom = 'IDS_OBRAS_ASSOCIADAS';
   insert into bgo_auxi_perg_resp (tab_nom,tab_id) values ('IDS_OBRAS_ASSOCIADAS',:P_oba_id);
   insert into bgo_auxi_perg_resp (tab_nom,tab_id)
   select 'IDS_OBRAS_ASSOCIADAS',OBA_ID_ASSOCIADA
   from   bgo_associacoes_obras
   where  OBA_ID_RECEPTORA = :P_oba_id
	 and    FLG_DISC_VALO    = 'N';

   -- BG ----------------------------------------
  
	 FOR r_g1 in (
		    
		      -- loop inicial 
					SELECT     afg.oba_id oba_id_Detail,
	                   afg.oba_id_prov oba_id_prov,
	                   afg.gfo_id gfo_id_Detail,  
	                   afg.descricao descricao_Detail,
	                   afg.tipo_movimento_aux tipo_mov_aux,
	                   afg.order_by order_by_detail,
	                   afg.order_by_num order_by_num,
	                   SUM(afg.quantidade) quantidade,
	                    afg.unidade unidade,
	                   SUM(afg.tempo) tempo,
					           SUM(afg.valor) Valor_Detail,
					           SUM(afg.valor_eur) Valor_eur_Detail,
					           NULL dummy
					FROM       BGO_ANALISE_FACTURACAO_GF_V afg
					WHERE      afg.oba_id = :p_oba_id    
					and        EXISTS (SELECT 1
					                 FROM  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
					                WHERE  tmp.Id = :P_Id
					                AND    tmp.gfo_id = afg.gfo_id
					                       )
					GROUP BY
					       afg.oba_id,
					       afg.oba_id_prov,
					       afg.gfo_id,  
					       afg.descricao,
					       afg.tipo_movimento_aux,
					       afg.order_by,
					       afg.order_by_num,
					       afg.unidade/*,
					       afg.tempo*/
					       		)
		loop

       delete from bgo_auxi_perg_resp where tab_nom = 'IGCS_OBRAS_ASSOCIADAS';
       insert into bgo_auxi_perg_resp (tab_nom,tab_id) 
       select distinct 'IGCS_OBRAS_ASSOCIADAS',IGC.ID
       FROM   BGO_VALORES_FACTURACAO VFO,
              BGO_INDICES_GERACAO_CUSTOS IGC
       WHERE  VFO.IGC_ID=IGC.ID
       AND    IGC.ESTADO='A'
       AND    VFO.OBA_ID_REFERENTE=:p_OBA_ID;                                    
       
       insert into bgo_auxi_perg_resp (tab_nom,tab_id)
       select DISTINCT 'IGCS_OBRAS_ASSOCIADAS',IGC_ID_PROVENIENTE
       FROM   BGO_VALORES_FACTURACAO VFO,
              BGO_INDICES_GERACAO_CUSTOS IGC
       WHERE  VFO.IGC_ID=IGC.ID
       AND    IGC.ESTADO='A'
       AND    VFO.OBA_ID_REFERENTE=:p_OBA_ID;                                    

		   v_tot_qtd  := 0;
		   v_tot_val  := 0;
		   v_tot_tem  := 0;
		
	     UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '####### -- UC$TRATA_OPER_DISCR: tipo_mov_aux = '||r_g1.tipo_mov_aux ||', :DESCRICAO_DETAIL = '||r_g1.descricao_Detail||', v_igc_id = '||TO_CHAR(NVL(v_igc_id,-1)), null, null);
		
		    -- Para o centro de custo...
		    begin
		
		        begin
		        
		            select id
		            into   v_cco_id
		            from   bgo_centros_custos
		            where  descricao = r_g1.descricao_Detail;
		        
		        exception when others then v_cco_id := null;
		        end;
		
	          UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '####### --v_cco_id = '||TO_CHAR(NVL(v_cco_id,-1))||', :P_ANO_GERA_CUS = '||:P_ANO_GERA_CUS, null, null);

		        if v_cco_id is not null then

                for v_opo_disc in (

							    select distinct opo1.id, opo1.codigo, opo1.des_orc descricao 
							    from   bgo_operacoes_anuais ono1,
							           bgo_operacoes        opo1
							    where  ono1.cco_id   = v_cco_id
							    and    ono1.opo_id   = opo1.id 
							    and    flg_dis       = 'S' 

                )
                loop
                	
										-- para esta operação, todas as anuais...
				            for r_ono_disc in (
				            
				                select *
				                from   bgo_operacoes_anuais
				                where  opo_id   = v_opo_disc.id
				                and    flg_dis  = 'S' 
				            
				            )
				            loop
		
			                  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '####### --r_ono_disc.ID = '||TO_CHAR(NVL(r_ono_disc.ID,-1)), null, null);
		
				                for r_ope_disc in (
				                
				                    -- jgs20170214 select ID, VALOR_FACTURACAO_EUR, quantidade, (NVL(ODA.DURACAO_HORAS,0) + ( NVL(ODA.DURACAO_MINUTOS,0)/60 ) ) * 60 TOTAL_TEMPO, OBA_ID
				                    select oda.ID, VALOR_FACTURACAO_EUR, nvl(suo.qtd_fat,oda.quantidade) quantidade, (NVL(ODA.DURACAO_HORAS,0) + ( NVL(ODA.DURACAO_MINUTOS,0)/60 ) ) * 60 TOTAL_TEMPO, OBA_ID
				                    from   bgo_operacoes_processadas oda, 
				                           bgo_subcontratacoes       suo    -- jgs20170214   
				                    where  oba_id in (select tab_id from bgo_auxi_perg_resp where tab_nom = 'IDS_OBRAS_ASSOCIADAS' )     -- jgs20150127 where  oba_id = :P_oba_id
				                    and    SUO.ODA_ID (+) = ODA.ID  -- jgs20170214 
				                    and    ono_id = r_ono_disc.id
				                    and    oda.igc_id in (
															select tab_id from bgo_auxi_perg_resp where tab_nom = 'IGCS_OBRAS_ASSOCIADAS'     -- jgs20150127 where  oba_id = :P_oba_id
				                    )
/* jgs20150127													  AND    ODA.IGC_ID IN (SELECT DISTINCT
													                               IGC.ID
													                        FROM   BGO_VALORES_FACTURACAO VFO,
													                               BGO_INDICES_GERACAO_CUSTOS IGC
													                        WHERE  VFO.OBA_ID_REFERENTE=ODA.OBA_ID
													                        AND    VFO.IGC_ID=IGC.ID
													                        AND    IGC.ESTADO='A'
													                        AND    VFO.OBA_ID_REFERENTE=:p_OBA_ID                                    
													                        AND    ODA.IGC_ID=IGC.ID )     */
				                    and    subcontratacao  = 'S'                -- acrescento isto para garantir
				                    and    nvl(VALOR_FACTURACAO_EUR,0) != 0   -- a partida, o valor faturado é igual ao bgo_subcontratacoes.
				                    -- jgs20160108: considerar só as ODAS para esse grupo!
				                    and    r_g1.gfo_id_Detail in  (
                                              select g.id                                                
                                              FROM   BGO_PARTES p,
                                                     BGO_GRUPOS_FACTURACAO g
                                              WHERE  p.gfo_id = g.id
                                              AND    p.id     = oda.pre_id
				                    )
				                    -- fim jgs20160108: considerar só as ODAS para esse grupo!
				                
				                )
				                loop
				
				                   -- jgs20150127 
                           IF r_ope_disc.OBA_ID = :P_oba_id THEN
                               
                               V_PERC := 1;
                               
                           ELSE
                               
                             begin
                               
                                  select ccc.*
                                  into   v_ccc_reg
                                  from   BGO_CLASSES_CENTROS_CUSTOS CCC,
                                         BGO_CENTROS_CUSTOS CCO, 
                                         BGO_OPERACOES_ANUAIS ONO
                                  where  ono.id = r_ono_disc.id
                                  and    cco.id = ono.cco_id
                                  and    ccc.id = cco.ccc_id;

                                    select *
                                    into   aoa_reg
                                    from   bgo_associacoes_obras
                                    where  OBA_ID_RECEPTORA =  :P_oba_id
                                    and    OBA_ID_ASSOCIADA =  r_ope_disc.OBA_ID;
                               
                                  if v_ccc_reg.CUSTO_FIXO = 'S' then
                                      v_perc := aoa_reg.PER_CUS_FIX/100;
                                  elsif v_ccc_reg.ACABAMENTO = 'S' then
                                      v_perc := aoa_reg.PER_CUS_VAR/100;
                                  elsif v_ccc_reg.CUS_CHA = 'S' then
                                      v_perc := aoa_reg.PER_CHA/100;
                                  else
                                      v_perc := 1;
                                  end if;
                               
                               
                               exception when others then v_perc := 1;
                               end;
                               
                           END IF;
				                   -- fim jgs20150127

				                   insert into BGO_AUXI_REPO_FATU (n1, tip_reg,SEQ_ID,ODA_ID, OBA_ID, OBA_ID_PROV, DESCRICAO, TIPO_MOV_AUX, ORDER_BY, ORDER_BY_NUM, QUANTIDADE, UNIDADE, TEMPO, VALOR, VALOR_EUR)        
				                   values (r_g1.gfo_id_Detail,'BG',:p_ses_id,R_OPE_Disc.ID,r_g1.oba_id_Detail,r_g1.oba_id_prov,v_opo_disc.descricao ,r_g1.TIPO_MOV_AUX,r_g1.ORDER_BY_detail,r_g1.ORDER_BY_NUM+0.5,NVL(r_ope_disc.QUANTIDADE,0),r_g1.UNIDADE,r_ope_disc.total_tempo, r_g1.VALOR_detail, r_ope_disc.VALOR_FACTURACAO_EUR*v_perc);
				
				                   -- acumular para saber se temos que não apresentar o principal, e para saber quanto temos que subtrair...
											     v_tot_qtd  := v_tot_qtd + nvl(r_ope_disc.QUANTIDADE,0);     -- podiamos não guardar, mas guardamos para discriminar
											     v_tot_val  := v_tot_val + r_ope_disc.VALOR_FACTURACAO_EUR*v_perc;
											     v_tot_tem  := v_tot_tem + nvl(r_ope_disc.total_tempo,0);

				                end loop;
				            
				            end loop;

                    -- fim todas as anuais
                    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> fim todas as anuais...', null, null);


                end loop;

                UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> depois do loop...', null, null);
 
		   					if v_tot_qtd  != 0 or v_tot_val  != 0 or  v_tot_tem  != 0 then

	                -- inserir o acumulado...
	                insert into BGO_AUXI_REPO_FATU (n1,TIP_REG,c1, SEQ_ID,ODA_ID, OBA_ID, OBA_ID_PROV, DESCRICAO, TIPO_MOV_AUX, ORDER_BY, ORDER_BY_NUM, QUANTIDADE, UNIDADE, TEMPO, VALOR, VALOR_EUR)        
	                values (r_g1.gfo_id_Detail, 'BG','ACUMULADO',:p_ses_id,NULL,r_g1.oba_id_Detail,r_g1.oba_id_prov,null ,r_g1.TIPO_MOV_AUX,r_g1.ORDER_BY_detail,r_g1.ORDER_BY_NUM,v_tot_qtd,r_g1.UNIDADE,v_tot_tem, r_g1.VALOR_detail, v_tot_val);

		   					end if;    --if v_tot_qtd  != 0 or v_tot_val  != 0 or  v_tot_tem  != 0 then


		        end if; -- if v_cco_id is not null then
		
		   		  exception when others then 
                UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> erro = '||sqlerrm, null, null);
		    end;
		
		end loop;      -- r_g1

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> ANTES DO COMMIT inicial...', null, null);

		commit;

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> depois DO COMMIT inicial...', null, null);

   -- EDITORAS ----------------------------------------
   -- jgs20141117: altero após testes de RAMARAL. As operações faturadas ao BG, não são para aparecer cá!

   -- O problema aqui é que temos duas linhas para a mesma combinação.
   -- Como só queremos as de subcontratação, acrescento valor_sub != 0.
   -- Só que depois, estes registos devem ser apenas subtraidos se valor_sub != 0;
   
   declare 
   	V_EXISTE VARCHAR2(1);
   begin  -- jgs20151210 para ver se ganha velocidade...

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> Antes do select S...', null, null);
   	
   	SELECT 'S'
   	into   V_EXISTE
   	FROM   BGO_ANALISE_NAO_FACT_GF_V
   	WHERE  OBA_ID =  :P_oba_id  
   	AND    ROWNUM = 1;
   	
   	-- se não existir o primeiro, salta fora...

	 FOR r_g1 in (
		    
							SELECT      ang.oba_id oba_id_Detail,
							                    ang.oba_id_prov oba_id_prov,
							                   ang.gfo_id gfo_id_Detail,  
							                   ang.descricao descricao_Detail,
							                   ang.tipo_movimento_aux tipo_mov_aux,
							                   ang.order_by order_by_detail,
							                   ang.order_by_num order_by_num,
							                   SUM(ang.quantidade) quantidade,
							                    ang.unidade unidade,
							                   SUM(ang.tempo) tempo,
								   SUM(ang.valor) Valor_Detail,
								   SUM(ang.valor_eur) Valor_eur_Detail,
							                   SUM(ang.valor_sub) valor_sub,
							                   NULL dummy
							FROM         BGO_ANALISE_NAO_FACT_GF_V ang
							WHERE       OBA_ID =  :P_oba_id  
							AND            EXISTS (SELECT 1
								   	  FROM	  BGO_RESUMO_ARTIGOS_GF_TEMP tmp
									  WHERE  tmp.Id = :P_Id
							                                  AND    tmp.gfo_id = ang.gfo_id)
							GROUP BY
							       ang.oba_id,
							       ang.oba_id_prov,
							       ang.gfo_id,  
							       ang.descricao,
							       ang.tipo_movimento_aux,
							       ang.order_by,
							       ang.order_by_num,
							       ang.unidade/*,
							       ang.tempo*/
							ORDER BY ang.order_by			
         
		
		)
		loop

		   v_tot_qtd  := 0;
		   v_tot_val  := 0;
		   v_tot_tem  := 0;
		
	     UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'EDITORAS......####### -- UC$TRATA_OPER_DISCR: tipo_mov_aux (não selecionado), :DESCRICAO_DETAIL = '||r_g1.descricao_Detail||', v_igc_id = '||TO_CHAR(NVL(v_igc_id,-1)), null, null);
		
		    -- Para o centro de custo...
		    begin
		
		        begin
		        
		            select id
		            into   v_cco_id
		            from   bgo_centros_custos
		            where  descricao = r_g1.descricao_Detail;
		        
		        exception when others then v_cco_id := null;
		        end;
		
	          UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'EDITORAS......####### --v_cco_id = '||TO_CHAR(NVL(v_cco_id,-1))||', :P_ANO_GERA_CUS = '||:P_ANO_GERA_CUS, null, null);

		        if v_cco_id is not null then
		

                for v_opo_disc in (

							    select distinct opo1.id, opo1.codigo, opo1.des_orc descricao 
							    from   bgo_operacoes_anuais ono1,
							           bgo_operacoes        opo1
							    where  ono1.cco_id   = v_cco_id
							    and    ono1.opo_id   = opo1.id 
							    and    flg_dis       = 'S' 

                )
                loop
                	
										-- para esta operação, todas as anuais...
				            for r_ono_disc in (
				            
				                select *
				                from   bgo_operacoes_anuais
				                where  opo_id   = v_opo_disc.id
				                and    flg_dis  = 'S' 
				            
				            )
				            loop
				            
		
			                  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'EDITORAS......####### --r_ono_disc.ID = '||TO_CHAR(NVL(r_ono_disc.ID,-1)), null, null);
		
				                for r_ope_disc in (
				                
				                    -- select ID, VALOR_FACTURACAO_EUR, quantidade, (NVL(ODA.DURACAO_HORAS,0) + ( NVL(ODA.DURACAO_MINUTOS,0)/60 ) ) * 60 TOTAL_TEMPO
				                    -- jgs20170214 select oda.ID, suo.valor_eur VALOR_FACTURACAO_EUR, oda.quantidade, (NVL(ODA.DURACAO_HORAS,0) + ( NVL(ODA.DURACAO_MINUTOS,0)/60 ) ) * 60 TOTAL_TEMPO
				                    select oda.ID, suo.valor_eur VALOR_FACTURACAO_EUR, nvl(suo.qtd_fat, oda.quantidade) quantidade, (NVL(ODA.DURACAO_HORAS,0) + ( NVL(ODA.DURACAO_MINUTOS,0)/60 ) ) * 60 TOTAL_TEMPO
				                    from   bgo_operacoes_processadas oda,
				                           bgo_subcontratacoes       suo,
				                           bgo_partes                pre
				                    where  oda.oba_id = :P_oba_id
				                    and    ono_id = r_ono_disc.id
				                    --and    igc_id = v_igc_id     -- pode ser necessário repor..
				                    and    subcontratacao  = 'S'                -- acrescento isto para garantir
				                    -- jgs20141117: o valor faturado nestes casos não fica nas operacoes processadas... and    nvl(VALOR_FACTURACAO_EUR,0) != 0
				                    and    suo.oda_id = oda.id
				                    and    nvl(suo.emp_fac,'B') != 'B'
				                    and    nvl(suo.valor_eur,0) != 0
				                    and    oda.pre_id = pre.id
				                    and    pre.gfo_id = r_g1.gfo_id_Detail
				                )
				
				                loop

			                     UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'EDITORAS......####### --r_ope_disc.id = '||TO_CHAR(NVL(r_ope_disc.id,-1)), null, null);

				                   insert into BGO_AUXI_REPO_FATU (N1, TIP_REG,SEQ_ID,ODA_ID, OBA_ID, OBA_ID_PROV, DESCRICAO, TIPO_MOV_AUX, ORDER_BY, ORDER_BY_NUM, QUANTIDADE, UNIDADE, TEMPO, VALOR, VALOR_EUR)        
				                   values (r_g1.gfo_id_Detail, 'EDI',:p_ses_id,R_OPE_Disc.ID,r_g1.oba_id_Detail,r_g1.oba_id_prov,v_opo_disc.descricao ,r_g1.TIPO_MOV_AUX,r_g1.ORDER_BY_detail,r_g1.ORDER_BY_NUM+0.5,NVL(r_ope_disc.QUANTIDADE,0),r_g1.UNIDADE,r_ope_disc.total_tempo, r_g1.VALOR_detail, r_ope_disc.VALOR_FACTURACAO_EUR);
				
				                   -- acumular para saber se temos que não apresentar o principal, e para saber quanto temos que subtrair...
											     v_tot_qtd  := v_tot_qtd + nvl(r_ope_disc.QUANTIDADE,0);
											     v_tot_val  := v_tot_val + r_ope_disc.VALOR_FACTURACAO_EUR;
											     v_tot_tem  := v_tot_tem + nvl(r_ope_disc.total_tempo,0);
				
				                end loop;
				            
				            end loop;

                    -- fim todas as anuais

                end loop;
                
 
		   					if v_tot_qtd  != 0 or v_tot_val  != 0 or  v_tot_tem  != 0 then

	                -- inserir o acumulado...
	                insert into BGO_AUXI_REPO_FATU (N1,TIP_REG,c1, SEQ_ID,ODA_ID, OBA_ID, OBA_ID_PROV, DESCRICAO, TIPO_MOV_AUX, ORDER_BY, ORDER_BY_NUM, QUANTIDADE, UNIDADE, TEMPO, VALOR, VALOR_EUR)        
	                values (r_g1.gfo_id_Detail,'EDI','ACUMULADO',:p_ses_id,NULL,r_g1.oba_id_Detail,r_g1.oba_id_prov,null ,r_g1.TIPO_MOV_AUX,r_g1.ORDER_BY_detail,r_g1.ORDER_BY_NUM,v_tot_qtd,r_g1.UNIDADE,v_tot_tem, r_g1.VALOR_detail, v_tot_val);

		   					end if;    --if v_tot_qtd  != 0 or v_tot_val  != 0 or  v_tot_tem  != 0 then


		        end if; -- if v_cco_id is not null then
		
		    exception when others then NULL;
		    end;
		
		end loop;      -- r_g1

	 exception when others then

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> Não encontrou ...', null, null);

   end;  -- begin  -- jgs20151210 para ver se ganha velocidade...

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> ANTES DO COMMIT...', null, null);


		commit;

    UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', '---->>>>>>>> DEPOIS DO COMMIT...', null, null);


EXCEPTION WHEN OTHERS THEN null;
      	
END;]]>
      </textSource>
    </function>
    <function name="uc$custos_pe">
      <textSource>
      <![CDATA[PROCEDURE UC$CUSTOS_PE IS

BEGIN

  UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', ':P_SES_ID_CUS_PE = '||:P_SES_ID_CUS_PE , null, null);

  -- todos os registos que aparecem na parte de baixo.
  -- Devemos excluir todos os que por algum motivo já estão a ser considerados na parte superior.
  -- depois acumular...
  for r_cus_pe in (
					SELECT ODA.OBA_ID OBA_ID_SUO,
					       PRE.GFO_ID,
					       OPO.DESCRICAO,
					       ENE.NOME_ABREVIADO,
					       decode(opo.sinal_operacao,'-',-1,1)*SUO.VALOR_EUR SUO_VALOR,
					       null order_by,
					       cco.ord order_by_num,
					       CG.RV_MEANING EMP,
					       oda.id   oda_id,
					       nvl(nvl(suo.qtd_fat,oda.quantidade),0) quantidade,       -- jgs20170214 nvl(oda.quantidade,0) quantidade,
                 (NVL(ODA.DURACAO_HORAS,0) + ( NVL(ODA.DURACAO_MINUTOS,0)/60 ) ) * 60 TOTAL_TEMPO
					FROM   BGO_SUBCONTRATACOES SUO,
					       BGO_OPERACOES_PROCESSADAS ODA,
					       BGO_OPERACOES_ANUAIS ONO,
					       BGO_CENTROS_CUSTOS CCO,
					       BGO_ENTIDADES ENE,
					       BGO_PARTES PRE,
					       BGO_CLASSES_CENTROS_CUSTOS CCC,
					       BGO_OPERACOES OPO,
					       CG_REF_CODES CG
					WHERE  SUO.ODA_ID=ODA.ID
					AND    ONO.OPO_ID=OPO.ID
					AND    CG.RV_DOMAIN='EMPRESA_SUBCONTRATACAO'
					AND    CG.RV_LOW_VALUE=SUO.EMP_FAC
					AND    ODA.OBA_ID=:p_OBA_ID
					AND    EXISTS (SELECT 1
					               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
					               WHERE  tmp.Id = :P_Id
					               AND    tmp.gfo_id = pre.gfo_id)
					AND    ODA.ONO_ID=ONO.ID
					AND    CCC.ID=CCO.CCC_ID
					AND    ONO.CCO_ID=CCO.ID
					AND    ENE.ID=SUO.ENE_ID_PRODUTOR
					AND    ODA.IGC_ID IN (SELECT DISTINCT
					                             IGC.ID
					                      FROM   BGO_VALORES_FACTURACAO VFO,
					                             BGO_INDICES_GERACAO_CUSTOS IGC
					                      WHERE  VFO.OBA_ID_REFERENTE=ODA.OBA_ID
					                      AND    VFO.IGC_ID=IGC.ID
					                      AND    IGC.ESTADO='A'
					                      AND    ODA.IGC_ID=IGC.ID
					                      AND    VFO.OBA_ID_REFERENTE=:p_OBA_ID)
					AND    CONSIDERAR='N'
					AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='S'
					AND    ODA.PRE_ID=PRE.ID
					union all
					SELECT aoa.OBA_ID_receptora OBA_ID_SUO,
					       PRE.GFO_ID,
					       OPO.DESCRICAO descricao,
					       ENE.NOME_ABREVIADO,
					       decode(opo.sinal_operacao,'-',-1,1)*(SUO.VALOR_EUR*AOA.PERCENTAGEM_CUSTOS/100) SUO_VALOR,
					       oba.titulo_abreviado order_by,
					       to_number(null) order_by_num,
					       CG.RV_MEANING EMP,
					       oda.id oda_id,
					       nvl(nvl(suo.qtd_fat,oda.quantidade),0) quantidade,     -- jgs20170214 nvl(oda.quantidade,0) quantidade,
                 (NVL(ODA.DURACAO_HORAS,0) + ( NVL(ODA.DURACAO_MINUTOS,0)/60 ) ) * 60 TOTAL_TEMPO
					FROM   BGO_SUBCONTRATACOES SUO,
					       BGO_OPERACOES_PROCESSADAS ODA,
					       BGO_OPERACOES_ANUAIS ONO,
					       BGO_ASSOCIACOES_OBRAS AOA,
					       BGO_OBRAS OBA,
					       BGO_ASSOCIACOES_PARTES APE,
					       BGO_ENTIDADES ENE,
					       BGO_PARTES PRE,
					       BGO_OPERACOES OPO,
					       CG_REF_CODES CG
					WHERE  SUO.ODA_ID=ODA.ID
					AND    ONO.OPO_ID=OPO.ID
					AND    CG.RV_DOMAIN='EMPRESA_SUBCONTRATACAO'
					AND    CG.RV_LOW_VALUE=SUO.EMP_FAC
					AND    ODA.ONO_ID=ONO.ID
					AND    ENE.ID=SUO.ENE_ID_PRODUTOR
					AND    AOA.OBA_ID_ASSOCIADA=ODA.OBA_ID
					AND    OBA.ID=AOA.OBA_ID_ASSOCIADA
					AND    AOA.OBA_ID_RECEPTORA=:p_OBA_ID
					AND    APE.PRE_ID_ASSOCIADA=ODA.PRE_ID
					AND    PRE.ID=APE.PRE_ID_RECEPTORA
					AND    EXISTS (SELECT 1
					               FROM   BGO_RESUMO_ARTIGOS_GF_TEMP tmp
					               WHERE  tmp.Id = :P_Id
					               AND    tmp.gfo_id = pre.gfo_id)
					AND    APE.PRE_ID_RECEPTORA IN (SELECT ID 
					                                FROM   BGO_PARTES 
					                                WHERE  OBA_ID=AOA.OBA_ID_RECEPTORA)
					AND    AOA.ID=(SELECT MAX(ID)
					               FROM   BGO_ASSOCIACOES_OBRAS
					               WHERE  OBA_ID_ASSOCIADA=AOA.OBA_ID_ASSOCIADA
					               AND    OBA_ID_RECEPTORA=AOA.OBA_ID_RECEPTORA)
					AND    ODA.IGC_ID IN (SELECT DISTINCT 
					                             IGC_id_proveniente
					                      FROM   BGO_VALORES_FACTURACAO VFO,
					                             BGO_INDICES_GERACAO_CUSTOS IGC
					                      WHERE  VFO.OBA_ID_proveniente=AOA.OBA_ID_associada
					                      AND    VFO.IGC_ID=IGC.ID
					                      AND    IGC.ESTADO='A'
					                      and    vfo.oba_id_referente=aoa.oba_id_receptora
					                      AND    vfo.tipo_movimento != 'G' 
					                      AND    vfo.oba_id_referente <> vfo.oba_id_proveniente
					                      AND    ODA.IGC_ID=VFO.IGC_ID_PROVENIENTE
					                      AND    VFO.OBA_ID_REFERENTE=:p_OBA_ID)
					AND    CONSIDERAR='N'
					AND    UC$PRODUCAO.ACED_OBRA(ONO.ID,'OF')='S' 
  )
  loop
  	
      UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', 'R_CUS_PE.ODA_ID = '||R_CUS_PE.ODA_ID , null, null);

      BEGIN
      insert into BGO_AUXI_REPO_FATU (n1,TIP_REG,SEQ_ID,ODA_ID, OBA_ID, OBA_ID_PROV, DESCRICAO, TIPO_MOV_AUX, ORDER_BY, ORDER_BY_NUM, QUANTIDADE, UNIDADE, TEMPO, VALOR, VALOR_EUR)        
      values (r_cus_pe.gfo_id,'CUS_PE',:P_SES_ID_CUS_PE,R_CUS_PE.ODA_ID,:P_OBA_ID,:P_OBA_ID,R_CUS_PE.descricao ,'1S',NULL,R_CUS_PE.order_by_num,NVL(R_CUS_PE.QUANTIDADE,0),NULL,NVL(R_CUS_PE.TOTAL_TEMPO,0), R_CUS_PE.SUO_VALOR, R_CUS_PE.SUO_VALOR);
      EXCEPTION WHEN OTHERS THEN
            UC$LOGS.GERA_LOG (null, 'FAO0080R', 'A PREENCHER', 'D', 'SQLERRM = '||SQLERRM , null, null);
      END;
  	
  end loop;  

   insert into BGO_AUXI_REPO_FATU (n1, c1,TIP_REG,SEQ_ID,ODA_ID, OBA_ID, OBA_ID_PROV, DESCRICAO, TIPO_MOV_AUX, ORDER_BY, ORDER_BY_NUM, QUANTIDADE, UNIDADE, TEMPO, VALOR, VALOR_EUR)        
   select n1, 'TOTAL','CUS_PE',:P_SES_ID_CUS_PE,NULL,:P_OBA_ID,:P_OBA_ID,DESCRICAO ,'1S',NULL, ORDER_BY_NUM,SUM(QUANTIDADE),NULL,SUM(TEMPO), SUM(VALOR), SUM(VALOR_EUR)
   FROM   BGO_AUXI_REPO_FATU
   WHERE  TIP_REG = 'CUS_PE'
   AND    SEQ_ID  = :P_SES_ID_CUS_PE
   GROUP BY DESCRICAO, ORDER_BY_NUM, n1;

  
END;]]>
      </textSource>
    </function>
    <function name="existe_cust_pe">
      <textSource>
      <![CDATA[FUNCTION EXISTE_CUST_PE (p_gfo_id in number) RETURN VARCHAR2 IS   -- jgs20150318

     v_num NUMBER;  

BEGIN
 
	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'p_gfo_id  = '||to_char(nvl(p_gfo_id,-1)), null, null);
	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'p_gfo_id  = '||to_char(nvl(p_gfo_id,-1)), null, null);
 
 
 
  -- JGS20150313
   select count(1)
   into   v_num
   from   (
   SELECT  arf.oba_id oba_id_Detail1,
        arf.oba_id_prov oba_id_prov2,
        arf.descricao descricao_Detail1,
        arf.tipo_mov_aux tipo_mov_aux1,
        arf.order_by order_by_detail1,
        arf.order_by_num order_by_num2
        FROM    bgo_auxi_repo_fatu arf
        where   arf.seq_id = :P_SES_ID_CUS_PE
        and     tip_reg      = 'CUS_PE'
        AND     N1 IS NOT NULL
        and     n1 = :GFO_ID --nvl(p_gfo_id,n1)
        and     c1= 'TOTAL');

	UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'v_num  = '||to_char(nvl(v_num,-1)), null, null);

        
    if NVL(v_num,0) > 0 then
        return 'S';
    else
        return 'N';
    end if;
  
END;
]]>
      </textSource>
    </function>
    <function name="m_11formattrigger">
      <textSource>
      <![CDATA[function M_11FormatTrigger return boolean is

  id_o              number;
  v_tmp_obs         varchar2(4000);
  
  -- jgs20150107: nos grupos de faturação, aparecem em todas!
  id_f              number;    -- jgs20150106
  v_separa          varchar2(1);
  
  v_existe          varchar2(1) := 'N';
  
begin

  --if :estragos_obs is null then  -- jgs2017020 Ticket#2017021710000807 - Alterações visuais a reports de SIBG  
  v_tmp_obs := 'Data: '||:p_data;
  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'Alterei V_TMP!: '||:p_data, null, null);

  --else
  --	v_tmp_obs := 'Data: '||:p_data||chr(10)||:estragos_obs;
  --end if; 


  --v_tmp_obs := to_char(:gfo_id)||' - ';

  id_o := to_number(dsi_pack.val_par('B','id_obs_orcamento','-1'));

  id_f := to_number(dsi_pack.val_par('B','id_obs_fatura','-1'));   -- jgs20150106

  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'id_o = '||id_o||', :p_oba_id = '||:p_oba_id, null, null);

  -- jgs20150106
  v_separa := null;

  for r_f in (
      select *
      from   bgo_obras_obs
      where  oba_id = :p_oba_id
      and    rpo_id = id_f
      order  by id
  )
  loop
      if v_tmp_obs is null then
          v_tmp_obs := r_f.obs;
      else
          v_tmp_obs := v_tmp_obs ||chr(10)||r_f.obs;
      end if;
      
      v_separa := chr(10);
      v_existe := 'S';
      
  end loop;
  -- fim jgs20150106

  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'v_existe = '||v_existe, null, null);

  if v_existe = 'S' then
  	return true;
  end if;
  
  for r_o in (
      select obs.*
      from   bgo_obras_obs obs,
             bgo_partes    pre,
             bgo_obras     oba
      where  obs.oba_id = :p_oba_id
      and    obs.rpo_id = id_o
      and    oba.id     = obs.oba_id
      and    oba.id     = pre.oba_id
      and    pre.gfo_id = :gfo_id
      and    obs.pre_id = pre.id
      order  by obs.id
  )
  loop

      v_tmp_obs := v_tmp_obs || v_separa;
      v_separa := null;

      if v_tmp_obs is null then
          v_tmp_obs := r_o.obs;
      else
          v_tmp_obs := v_tmp_obs ||chr(10)||r_o.obs;
      end if;
      
      v_existe := 'S';

      
  end loop;

  UC$LOGS.GERA_LOG (null, 'FAO0087R', 'A PREENCHER', 'D', 'RETURT TRUE = '||v_tmp_obs, null, null);
  
  	return true;  -- jgs20170323: sempre existe data!
  	
  /*	

  if v_existe = 'S' then
  	return true;
  else
  	return false;
  end if;

  */
  
end;]]>
      </textSource>
    </function>
    <function name="uni_arti">
      <textSource>
      <![CDATA[FUNCTION UNI_ARTI(p_desc in varchar2) RETURN VARCHAR2 IS
-- JGS20150324

	v_une_id number;
	v_uni    varchar2(200);

BEGIN

  	select une_id
		into   v_une_id
		from   bgo_artigos
		where  codigo = substr(p_desc,1,instr(p_desc,'-')-2);
		--where  codigo = substr(p_desc,1,6);

    -- podia ser substr(desc_aux,1,instr(desc_aux,'-')-2)
		
		select lower(codigo)
		into   v_uni
		from   bgo_unidades
		where  id = v_une_id;
		
		return v_uni;
	
exception when others then return null;
END;]]>
      </textSource>
    </function>
    <function name="obs3formattrigger">
      <textSource>
      <![CDATA[function OBS3FormatTrigger return boolean is
begin
 	--SRW.set_field_char (0, ' '||:p_obs );
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="cf_dados_adicformula" returnType="character">
      <textSource>
      <![CDATA[function CF_DADOS_ADICFormula return Char is
  v_ret varchar2(2000);
begin

    --v_ret := reps_resu_cust_dao.CF_dados_adicFormula (:p_oba_id);
    v_ret := null;
      
  begin

        select 'Cliente interno: '||cieo.des
        into   v_ret
        from   bgo_obras oba,
               bgo_clie_inte_obra cio,
               bgo_clie_inte      cieo
        where  oba.id      = :p_oba_id
        and    cio.oba_id  = oba.id
        and    cio.flg_tip = 'F'
        and    cio.cieo_id = cieo.id;

  exception when others then null;
  end;

  -- data de vencimento
  declare
      
      DATA_FACTURA date;
      v_cliente    bgo_obras.ene_id_dest%type;

  begin

    SELECT TO_DATE(VALOR_BG,'YYYY-MM-DD')
    INTO   DATA_FACTURA
    FROM   BGO_PARAMETROS
    WHERE  UPPER(DESCRICAO) = 'PROXIMO_DIA_UTIL_FACTURACAO';

        SELECT ene_id_dest
        INTO   v_cliente
        FROM   BGO_OBRAS
        WHERE  ID=:p_oba_id;

        select v_ret || chr(10)||'Data de Vencimento: '||to_char(Uc$Facturacao.Data_Venc(NULL,DATA_FACTURA,/*v_data,*/v_cliente,oba.id),'yyyy-mm-dd')
        into   v_ret
      from   bgo_obras oba
      where  id = :p_oba_id;

  exception when others then null;
  end;


    
  begin

        select v_ret || chr(10)||'Taxa IVA: '||to_char(tia.TAXA_IVA)
        into   v_ret
      from   BGO_TAXAS_IVA tia,
             bgo_obras     oba,
             BGO_TIPOS_FACTURACAO L_TFO
      where  L_TFO.id = oba.tfo_id 
      and    tia.ID   = l_tfo.tia_id
      and    oba.id   = :p_oba_id;

  exception when others then null;
  end;


  begin

        select v_ret || chr(10)||'Texto da fatura: '||L_TLA.DESCRICAO
        into   v_ret
      from   BGO_TEXTOS_LINHAS_FACTURAS L_TLA,
             bgo_obras                  oba
      where  L_TLA.ID = oba.tla_id
      and    oba.id   = :p_oba_id;

  exception when others then null;
  end;
    
    
    return(v_ret);
end;]]>
      </textSource>
    </function>
    <function name="cf_cloformula" returnType="character">
      <textSource>
      <![CDATA[function CF_cloFormula return Char is
    V_DESC VARCHAR2(500);
begin

    BEGIN
      -- JGS20090108 SELECT DESCRICAO
      SELECT DECODE(FLG_TIP_COL,'F',DESCRICAO,NULL)
      INTO V_DESC
      FROM BGO_COLECCOES
      WHERE ID=(SELECT CLO_ID
                          FROM BGO_OBRAS
                          WHERE ID=:p_OBA_ID);
    EXCEPTION WHEN OTHERS THEN
        V_DESC:=NULL;
    END;
    if V_DESC is null then return null;
    else RETURN('(Col. '||V_DESC||')');
    end if;
end;
]]>
      </textSource>
    </function>
    <function name="cf_titformula" returnType="character">
      <textSource>
      <![CDATA[function CF_titFormula return Char is
    V_TIT    VARCHAR2(200);
begin
  
  SELECT TITULO_COMPLETO INTO V_TIT FROM BGO_OBRAS WHERE ID = :P_OBA_ID;
  RETURN V_TIT;

EXCEPTION WHEN OTHERS THEN RETURN NULL;  
end;
]]>
      </textSource>
    </function>
    <function name="f_titulo2formattrigger">
      <textSource>
      <![CDATA[function F_titulo2FormatTrigger return boolean is
begin
  if :cf_clo is null then return false;
  else return (TRUE);
  end if;
end;]]>
      </textSource>
    </function>
    <function name="m_14formattrigger">
      <textSource>
      <![CDATA[function M_14FormatTrigger return boolean is
begin
  
  if :cf_clo is null then return false;
  else return (TRUE);
  end if;
end;]]>
      </textSource>
    </function>
    <function name="m_17formattrigger">
      <textSource>
      <![CDATA[function M_17FormatTrigger return boolean is
begin
  
  if :cf_clo is null then return false;
  else return (TRUE);
  end if;
end;]]>
      </textSource>
    </function>
    <function name="f_1formattrigger">
      <textSource>
      <![CDATA[function F_1FormatTrigger return boolean is
-- jgs20180228
   v_nom_fon    varchar2(20); 
   v_car        varchar2(20); 
   v_cod_err    number;
   v_msg_err   varchar2(3000);

begin

    UC$LOGOTIPOS_BLL.UC$GET_FONTE_LOGO_PARA (
                             'B'
                            ,'letra_logotipos'
                            ,v_NOM_FON
                            ,v_CAR     
                            ,v_COD_ERR  
                            ,v_MSG_ERR  
                            );


 
  srw.set_font_face(v_nom_fon);
  srw.set_field(0,v_car);  
  
  return (TRUE);
end;]]>
      </textSource>
    </function>
    <function name="uc$cus_uni_ant">
      <textSource>
      <![CDATA[PROCEDURE UC$CUS_UNI_ANT (T_OBA_ID IN NUMBER, P_TXT IN OUT VARCHAR2) IS  -- jgs20200421

	T_OBA_TIR number;
	t_numero_factura_ant BGO_CABECALHOS_FACTURAS.numero%TYPE;
	t_valor_ant BGO_CABECALHOS_FACTURAS.valor_eur%TYPE;
	
	v_existe varchar2(1):='N'; -- Ivo Oliveira 21/05/2004
	
	v_sepa   varchar2(1):='N'; -- jgs20160519

begin
	
	/* jgs20160517 Ticket#2016021910000752  Custo Unitário em Obra com entregas separadas
	
     Quando e apenas quando a obra anterior à qual está a ser analisada for faturada com entregas separadas. O C.U. (custo unitário) a figurar na Ficha de Obra tenha em consideração não só os custos da 1.ª fatura,
     mas também os custos relativos às encadernações a dividir pelas quantidades entregues.
 
     Atualmente, o que o sistema está a fazer é a ter em consideração apenas a primeira fatura, não considerando qualquer valor relativo ao acabamento. 
     No anexo do justificativo, aparece exatamente o que o sistema calcula e bem (para o justificativo de fatura). - 1582,16 / 2000 = 0,79108
     O pretendido para o caso seria [ 1582,16 + 1168,85 (encadernações) + 61,77 (encadernações) ] / 2032 = 1,38424 , a figurar na Ficha de Obra da chave seguinte - 20160317.	
	
	*/
	

  if nvl(t_oba_id,-1) = -1 then
  	P_TXT := null;
  else
	
		BEGIN  -- JGS20160519
			
	     select 'S'
	     into   v_sepa
	     from   BGO_TIPOS_FACTURACAO tfo,
	            bgo_obras            oba
	     where  oba.id       = t_oba_id
	     and    oba.tfo_id   = tfo.id
	     and    tfo.entregas = 'S';	
			
			
		EXCEPTION WHEN OTHERS THEN v_sepa := 'N';
		END;
		
		
		IF V_SEPA = 'N' then   -- jgs20160519 -- como estava
		
			SELECT TIRAGEM
			INTO T_OBA_TIR
			FROM BGO_OBRAS
			WHERE ID = t_oba_id;
		
		else
	
		  begin
			
				SELECT  nvl(SUM(nvl(lge.quantidade,0)),0)
				into    T_OBA_TIR
				FROM    bgo_linhas_guias_entrega lge
				WHERE	  oba_id_facturacao = t_oba_id
				AND     lge.estado <>'N';
			
		  exception when others then T_OBA_TIR := 0;
		  end;
	
		end if;
	
		select sum(round(valor_total_eur,2))
		into 	 t_valor_ant 
		FROM   BGO_CABECALHOS_FACTURAS cur
		,		   BGO_FACTURAS_LINHAS FHA
		WHERE	 cur.numero in 
												(
								        Select distinct cur2.numero --distinct 'S'
								        --into v_existe
								        From   bgo_facturas_linhas fha2
								        ,      bgo_cabecalhos_facturas cur2
								        Where  fha2.cur_id=cur2.id
								        --and   cur.numero=20061746
								        and 	 (V_SEPA = 'S' OR (V_SEPA != 'S' AND cur2.tipo_factura='P' ))                                   -- jgs20160519 cur2.tipo_factura='P'
								        and 	 fha2.oba_id is not null
								        and 	 fha2.oba_id=t_oba_id
												)
		and    cur.id=fha.cur_id
		and    fha.oba_id=t_oba_id;
		
		if t_valor_ant/T_OBA_TIR is null then
			p_txt := null;   		
	  else    
	  -- A observação deve ser (para o exemplo da imagem): "Edição anterior: Chave 20190636, Fatura 20190636 (2019-11-29), C.U. 1,63 , Tiragem 10 400 exs., Acabamento 0,77000  / ex."
			p_txt := ', C.U. '||ltrim(to_char(t_valor_ant/T_OBA_TIR, '990d90'))||' ';  		
		end if;

  end if;	--if nvl(t_oba_id,-1) = -1 then
  
exception
	when others then
		p_txt := null;   		
end;]]>
      </textSource>
    </function>
    <function name="uc$aca_ant">
      <textSource>
      <![CDATA[PROCEDURE UC$ACA_ANT (v_id in number,p_txt in out varchar2) IS   -- jgs20200422

	v_Valor_acabamento_anterior Number;
  v_data_transicao VARCHAR2(80);
  
  --Alterado em 2002-07-10 Por Rui Losa Faria
  cursor c_vfo (b_oba_id bgo_obras.id%TYPE) is
  SELECT SUM( vfo.valor) 
  FROM BGO_valores_facturacao vfo,
  		 BGO_indices_geracao_custos igc
  WHERE vfo.tipo_movimento = 'B' 
  AND   igc.estado = 'F'
  AND   vfo.igc_id = igc.id
  AND b_oba_id = vfo.oba_id_referente 
  AND b_oba_id = vfo.oba_id_proveniente
  GROUP BY vfo.igc_id
  ORDER BY vfo.igc_id DESC;
  
  cursor c_vfo_eur (b_oba_id bgo_obras.id%TYPE) is
  SELECT SUM( vfo.valor_eur) 
  FROM BGO_valores_facturacao vfo, 
  	   BGO_indices_geracao_custos igc 
  WHERE vfo.tipo_movimento = 'B'
  AND   igc.estado = 'F'
  AND   vfo.igc_id = igc.id 
  AND b_oba_id = vfo.oba_id_referente 
  AND b_oba_id = vfo.oba_id_proveniente
  GROUP BY vfo.igc_id
  ORDER BY vfo.igc_id DESC;
  
begin
	
	
	if nvl(v_id,-1) = -1 then 
		
			p_txt := null; 

	else	
			
		open  c_vfo_eur( v_id);
	  fetch c_vfo_eur
	  into  v_valor_acabamento_anterior;
	  close c_vfo_eur;
		
		if v_Valor_acabamento_anterior is null then
			p_txt := null;
		else	
			--SRW.set_field_char (0, to_char( v_Valor_acabamento_anterior, '990d99990')||' ' || ' /ex.');
      p_txt := ', Acabamento '||ltrim(to_char( v_Valor_acabamento_anterior, '990d99990'))||' ' || ' /ex.';
		end if;
			
	end if; --if nvl(v_id,-1) = -1 then 


exception
	when others then
			p_txt := null; 
end;

]]>
      </textSource>
    </function>
    <function name="uc$id_edicao_anterior">
      <textSource>
      <![CDATA[FUNCTION uc$id_edicao_anterior (p_oba_id in number, p_numero_codigo in varchar2, p_gpe_edi_id in number, p_titulo_compl in Varchar2 , p_chave_Principal in number) -- jgs20200421
RETURN Number
IS

   t_oba_id BGO_OBRAS.id%TYPE;
  
   cursor c_oba_sem_codigo is
   SELECT oba.id
   FROM BGO_OBRAS oba
	 WHERE rtrim( p_titulo_compl) = rtrim( oba.titulo_completo)
	 and p_chave_principal > oba.chave_principal
	 order by oba.chave_principal desc; 
	
BEGIN
	/* Esta função retorna o ID da obra c/ edição anterior */
	
	-- jgs20150925 -- obras GBC!
	-- O sistema poderá descobrir a informação pretendida pesquisando a obra pelo código, (no caso em anexo: 000068000286) 
	-- e devolvendo as informações relativas à chave anterior, com o mesmo código.

  if UC$OBRAS_BLL.GET_OBA_E_BERTRAND (p_oba_id, p_gpe_edi_id) = 'S' then   -- JGS20150925


	  begin

				select max(id)
				into   t_oba_id
				from   bgo_obras
				where  numero_codigo = p_numero_codigo
				and    id < p_oba_id;

		    return (t_oba_id);

	  exception when others then 	return (-1);
	  end;


  else
	
		if p_numero_codigo is not null 
	  then
	     
-- Se a obra tiver CODIGO:
-- Esta função devolve o ID da obra referente à edição anterior.
	     	     
	     t_oba_id := uc$obras_bll.GET_OBRA_EDICAO_ANTERIOR (null,p_chave_principal,null,null);
		
		else
		
-- Se a obra NÃO tiver CÓDIGO:
-- Quando não existirem Obras anteriores(por falta de número de código)
-- ir-se-á buscar a Obra com o mesmo título e a maior das 
-- chaves principais menor do que a da Obra em questão.		
		
		 	 open c_oba_sem_codigo;
		   fetch c_oba_sem_codigo 
			 into t_oba_id;
			 close c_oba_sem_codigo;
		
		end if;
		
		return (t_oba_id);

  end if;  -- if UC$OBRAS_BLL.GET_OBA_E_BERTRAND (:oba_id, :gpe_edi_id) = 'S' then   -- JGS20150925

	
exception
		when others then
			return (-1);
END;]]>
      </textSource>
    </function>
    <function name="lcf_folhas_gformula">
      <textSource>
      <![CDATA[function LCF_FOLHAS_GFormula (p_oba_id in number) return Char is
/******************************************************************************
   nome:        reps_resu_cust_dao
   objectivo:   funções e procedimentos cumuns nos reports de resumo de custos

   revisões:
   ver           data            autor             descrição
   ---------  -----------  -----------------  --------------------
   1.0        2017/03/20   José Sancho         Ticket#2017021710000807  Alterações visuais a reports de SIBG
   2.0        2017/08/22   José Sancho         Ticket#2017071310000949  Correção em reports de orçamentação / faturação
   3.0        2020/09/28   José Sancho         Ticket#2020091010006439  Resumo de Custos e Resumo detalhado de custos - Alterar
                                                                         "Nº pág.: 48 (3 fls, 4/4 cores, 23,0 x 23,0)".


************************************************************************/

   v_out      VARCHAR2(200) := NULL;

   v_oba_reg  bgo_obras%rowtype;

   v_zero					 varchar2(1):= NULL; -- jgs20170822


BEGIN

 
   select *
   into   v_oba_reg
   from   bgo_obras
   where  id = p_oba_id;

   if v_oba_reg.numero_folhas > 0 and v_oba_reg.numero_folhas < 1 then --jgs20170822
      	v_zero := '0';
   end if;

   -- jgs20200928 "Nº pág.: 48 (3 fls, 4/4 cores, 23,0 x 23,0)".

   -- jgs20170320 v_out := TO_CHAR(v_oba_reg.numero_folhas)||' ('||to_char(v_oba_reg.numero_folhas*16)||' págs) ';
   v_out := to_char(v_oba_reg.numero_folhas*16)||' ('||v_zero||TO_CHAR(v_oba_reg.numero_folhas)||' fls, '; -- jgs20200928) ';

   IF TO_CHAR(v_oba_reg.cores_frente)||'/'||TO_CHAR(v_oba_reg.cores_retiracao) != '/' THEN
      -- jgs20200928 v_out := v_out||'('||TO_CHAR(v_oba_reg.cores_frente)||'/'||TO_CHAR(v_oba_reg.cores_retiracao)||' cores)';
      v_out := v_out||TO_CHAR(v_oba_reg.cores_frente)||'/'||TO_CHAR(v_oba_reg.cores_retiracao)||' cores, '; -- )';
   END IF;

   /* jgs20200928
   IF v_oba_reg.num_fol_com is not null or TO_CHAR(v_oba_reg.cor_fre_com)||'/'||TO_CHAR(v_oba_reg.cor_ret_com) != '/' THEN
         v_out := v_out||' + '||TO_CHAR(v_oba_reg.num_fol_com)||' ';
      v_out := v_out||'('||TO_CHAR(v_oba_reg.cor_fre_com)||'/'||TO_CHAR(v_oba_reg.cor_ret_com)||' cores)';
   END IF;
   */

   -- aparado_largura * aparado_altura
   -- jgs20201014 IF (TO_CHAR(v_oba_reg.aparado_largura)||'x'||TO_CHAR(v_oba_reg.aparado_altura) != 'x') THEN
   IF v_oba_reg.aparado_largura is not null and v_oba_reg.aparado_altura is not null and (TO_CHAR(v_oba_reg.aparado_largura)||'x'||TO_CHAR(v_oba_reg.aparado_altura) != 'x') THEN
      v_out := v_out||TO_CHAR(v_oba_reg.aparado_largura)||'x'||TO_CHAR(v_oba_reg.aparado_altura)||')';
   ELSE
      -- tirar o ', ' final
      v_out := substr(v_out,1,length(v_out)-2)||')';
   END IF;

   RETURN (v_out);

end LCF_FOLHAS_GFormula;
]]>
      </textSource>
    </function>
  </programUnits>
  <attachedLibrary name="DSIEVH10"/>
  <attachedLibrary name="OFGMES"/>
  <attachedLibrary name="DSILIB10"/>
  <attachedLibrary name="OFGHPL"/>
  <attachedLibrary name="OFGTEL"/>
  <attachedLibrary name="OFGCALL"/>
  <webSource>
  <![CDATA[<%@ taglib uri="/WEB-INF/lib/reports_tld.jar" prefix="rw" %> 
<%@ page language="java" import="java.io.*" errorPage="/rwerror.jsp" session="false" %>
<%@ page contentType="text/html;charset=ISO-8859-1" %>
<!--
<rw:report id="report"> 
<rw:objects id="objects">
</rw:objects>
-->

<html>

<head>
<meta name="GENERATOR" content="Oracle 10gR2 Reports Developer"/>
<title> Your Title </title>

<rw:style id="yourStyle">
   <!-- Report Wizard inserts style link clause here -->
</rw:style>

</head>


<body>

<rw:dataArea id="yourDataArea">
   <!-- Report Wizard inserts the default jsp here -->
</rw:dataArea>



</body>
</html>

<!--
</rw:report> 
-->
]]>
  </webSource>
  <reportPrivate defaultReportType="masterDetail" versionFlags2="0"
   charPromptMustSplit="35" charPromptMaySplit="35" minFontPoints="8"
   templateName="D:\ORANT\HSD21\hst\admin\qmsbmp50.tdf" isCustomName="1"/>
  <reportWebSettings>
  <![CDATA[#NULL#]]>
  </reportWebSettings>
</report>